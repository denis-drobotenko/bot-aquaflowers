#!/usr/bin/env python3
"""
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã /newses
"""

import sys
import os
import time
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
from src import database, session_manager

def demo_newses_usage():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã /newses"""
    print("=== –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –ö–û–ú–ê–ù–î–´ /NEWSES ===")
    print()
    
    sender_id = "demo_user_newses"
    
    # –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç –¥–∏–∞–ª–æ–≥
    print("üì± –°–¶–ï–ù–ê–†–ò–ô: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç –¥–∏–∞–ª–æ–≥")
    session_id = session_manager.get_or_create_session_id(sender_id)
    print(f"   –°–æ–∑–¥–∞–Ω–∞ —Å–µ—Å—Å–∏—è: {session_id}")
    
    # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
    messages = [
        "–ü—Ä–∏–≤–µ—Ç! –•–æ—á—É –∑–∞–∫–∞–∑–∞—Ç—å –±—É–∫–µ—Ç –¥–ª—è –º–∞–º—ã",
        "–ü–æ–∫–∞–∂–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –∫–∞—Ç–∞–ª–æ–≥",
        "–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è –±—É–∫–µ—Ç '–†–æ–∑–æ–≤–∞—è –º–µ—á—Ç–∞'",
        "–°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –¥–æ—Å—Ç–∞–≤–∫–∞?"
    ]
    
    for msg in messages:
        database.add_message(sender_id, session_id, "user", msg)
        print(f"   üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {msg}")
    
    # AI –æ—Ç–≤–µ—á–∞–µ—Ç
    ai_responses = [
        "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è –º–∞–º—ã üå∏",
        "–í–æ—Ç –Ω–∞—à –∫–∞—Ç–∞–ª–æ–≥ –±—É–∫–µ—Ç–æ–≤...",
        "–û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä! –ë—É–∫–µ—Ç '–†–æ–∑–æ–≤–∞—è –º–µ—á—Ç–∞' —Å—Ç–æ–∏—Ç 2500 —Ä—É–±",
        "–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –≥–æ—Ä–æ–¥—É - 300 —Ä—É–±, –∑–∞ –≥–æ—Ä–æ–¥ - 500 —Ä—É–±"
    ]
    
    for response in ai_responses:
        database.add_message_with_parts(sender_id, session_id, "assistant", [{"text": response}])
        print(f"   ü§ñ AI: {response}")
    
    history = database.get_conversation_history_for_ai(sender_id, session_id)
    print(f"   üìä –í —Å–µ—Å—Å–∏–∏ {len(history)} —Å–æ–æ–±—â–µ–Ω–∏–π")
    print()
    
    # –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥
    print("üîÑ –°–¶–ï–ù–ê–†–ò–ô: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç /newses")
    print("   üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /newses")
    
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /newses
    new_session_id = session_manager.create_new_session_after_order(sender_id)
    print(f"   ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è: {new_session_id}")
    print("   ü§ñ AI: ‚úÖ –ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è —Å–æ–∑–¥–∞–Ω–∞! ID: " + new_session_id)
    print("        –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥. üå∏")
    print()
    
    # –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—á–∏–Ω–∞–µ—Ç –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥
    print("üÜï –°–¶–ï–ù–ê–†–ò–ô: –ù–æ–≤—ã–π –¥–∏–∞–ª–æ–≥ –≤ –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏")
    
    new_messages = [
        "–ü—Ä–∏–≤–µ—Ç! –•–æ—á—É –∑–∞–∫–∞–∑–∞—Ç—å –±—É–∫–µ—Ç –¥–ª—è –¥–µ–≤—É—à–∫–∏",
        "–ö–∞–∫–∏–µ —É –≤–∞—Å –µ—Å—Ç—å —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –±—É–∫–µ—Ç—ã?"
    ]
    
    for msg in new_messages:
        database.add_message(sender_id, new_session_id, "user", msg)
        print(f"   üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: {msg}")
    
    new_ai_responses = [
        "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –î–ª—è –¥–µ–≤—É—à–∫–∏ —É –Ω–∞—Å –µ—Å—Ç—å –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–µ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –±—É–∫–µ—Ç—ã üíï",
        "–í–æ—Ç –Ω–∞—à–∏ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –±—É–∫–µ—Ç—ã: '–ö—Ä–∞—Å–Ω–∞—è —Å—Ç—Ä–∞—Å—Ç—å', '–ë–µ–ª–∞—è –Ω–µ–∂–Ω–æ—Å—Ç—å', '–†–æ–∑–æ–≤–∞—è –º–µ—á—Ç–∞'"
    ]
    
    for response in new_ai_responses:
        database.add_message_with_parts(sender_id, new_session_id, "assistant", [{"text": response}])
        print(f"   ü§ñ AI: {response}")
    
    new_history = database.get_conversation_history_for_ai(sender_id, new_session_id)
    print(f"   üìä –í –Ω–æ–≤–æ–π —Å–µ—Å—Å–∏–∏ {len(new_history)} —Å–æ–æ–±—â–µ–Ω–∏–π")
    print()
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å —Å–µ—Å—Å–∏–π
    old_history = database.get_conversation_history_for_ai(sender_id, session_id)
    print("üìã –ü–†–û–í–ï–†–ö–ê –ù–ï–ó–ê–í–ò–°–ò–ú–û–°–¢–ò –°–ï–°–°–ò–ô:")
    print(f"   –°—Ç–∞—Ä–∞—è —Å–µ—Å—Å–∏—è {session_id}: {len(old_history)} —Å–æ–æ–±—â–µ–Ω–∏–π")
    print(f"   –ù–æ–≤–∞—è —Å–µ—Å—Å–∏—è {new_session_id}: {len(new_history)} —Å–æ–æ–±—â–µ–Ω–∏–π")
    print("   ‚úÖ –°–µ—Å—Å–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã!")
    print()
    
    print("=== –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê ===")
    print()
    print("üí° –ö–û–ú–ê–ù–î–ê /NEWSES –ü–û–õ–ï–ó–ù–ê –ö–û–ì–î–ê:")
    print("   ‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑")
    print("   ‚Ä¢ –ù—É–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –¥–∏–∞–ª–æ–≥–∞")
    print("   ‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å –æ –¥—Ä—É–≥–æ–º")
    print("   ‚Ä¢ –ù—É–∂–Ω–æ —Å–±—Ä–æ—Å–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—Ç–∞")

if __name__ == "__main__":
    demo_newses_usage() 