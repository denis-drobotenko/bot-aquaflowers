prompt to Gemini
[AI_RESPONSE] RequestID: 6dccd539 | Raw response: ```json
{
  "text": "Я покажу Вам каждый букет с фотографией!\\n\\nПожалуйста, подождите минутку...",
  "text_en": "I'll show you each bouquet with photo!\\n\\nPlease wait a moment...",
  "text_thai": "ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณ!\\n\\nกรุณารอสักครู่...",
  "command": {
    "type": "send_catalog"
  }
}
```
[AI_SUCCESS] RequestID: 6dccd539 | Final response: Я покажу Вам каждый букет с фотографией!\n\nПожалуйста, подождите минутку...
[AI] Сгенерирован ответ длиной 76 символов
[AI_RESPONSE] Ответ AI готов к отправке
[WEBHOOK] Команда send_catalog - пропускаем отправку текста
[DEBUG] Logging enabled for session_service.get_or_create_session_id
Found valid session: 20250705_201145_905382_356 for 79140775712
[DEBUG] Logging enabled for command_service.handle_command
Handling command: send_catalog for session 20250705_201145_905382_356
[CATALOG_DEBUG] Всего товаров получено: 7
[CATALOG_DEBUG] Доступных товаров: 5
[CATALOG_DEBUG] Первый доступный товар: {'id': '9798919800236955', 'name': 'Love is on the air', 'description': '.', 'price': '2\xa0200,00\xa0฿', 'retailer_id': 'sdaj38xhfz', 'image_url': 'https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/503765845_1222228859683151_4028827634893880558_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=sb7DUXn5wNAQ7kNvwHJc5Vs&_nc_oc=AdmOxoDXIxrkBjHtpsTcXkZgXV7jH82e_PPl2FAXoCOH3grfE1PamTUm0WMVsCbWOiMSp5C79nMN6lQbVtaelKoD&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=8ZUCv5ljIF18vELJpituew&oh=00_AfR1gLySFlEkk3INBbblpgh2LZunXCoOUa88ggcYi0KqCg&oe=686EF88A', 'availability': 'in stock'}
[CATALOG_DEBUG] Всего товаров получено: 7
[CATALOG_DEBUG] Доступных товаров: 5
[CATALOG_DEBUG] Первый доступный товар: {'id': '9798919800236955', 'name': 'Love is on the air', 'description': '.', 'price': '2\xa0200,00\xa0฿', 'retailer_id': 'sdaj38xhfz', 'image_url': 'https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/503765845_1222228859683151_4028827634893880558_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=sb7DUXn5wNAQ7kNvwHJc5Vs&_nc_oc=AdmOxoDXIxrkBjHtpsTcXkZgXV7jH82e_PPl2FAXoCOH3grfE1PamTUm0WMVsCbWOiMSp5C79nMN6lQbVtaelKoD&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=yvumOM7uQeKniA8pJZv46A&oh=00_AfRLUJBOJ7UZOqNIpLttio1afTcIVBeasH50a10zmJcP3w&oe=686EF88A', 'availability': 'in stock'}
[DEBUG] Logging enabled for message_processor.send_message
[MESSAGE_PROCESSOR] Отправка сообщения типа image пользователю 79140775712
INFO:     127.0.0.1:63860 - "GET /api/logs HTTP/1.1" 200 OK
Image sent successfully to 79140775712, ID: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA (session_id=None)
[MESSAGE_PROCESSOR] Извлечен wa_message_id из meta: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA
[DEBUG] Logging enabled for message_service.add_message_to_conversation
Message saved to 79140775712/20250705_201145_905382_356 with wa_id: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA
Message added to conversation: 79140775712/20250705_201145_905382_356
[MESSAGE_PROCESSOR] Сообщение сохранено в БД с wa_message_id: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA
[MESSAGE_PROCESSOR] Изображение сохранено в БД с wamid: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA
[DEBUG] Logging enabled for message_processor.send_message
[MESSAGE_PROCESSOR] Отправка сообщения типа image пользователю 79140775712
Image sent successfully to 79140775712, ID: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA (session_id=None)
[MESSAGE_PROCESSOR] Извлечен wa_message_id из meta: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA
[DEBUG] Logging enabled for message_service.add_message_to_conversation
Message saved to 79140775712/20250705_201145_905382_356 with wa_id: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA
Message added to conversation: 79140775712/20250705_201145_905382_356
[MESSAGE_PROCESSOR] Сообщение сохранено в БД с wa_message_id: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA
[MESSAGE_PROCESSOR] Изображение сохранено в БД с wamid: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA
[DEBUG] Logging enabled for message_processor.send_message
[MESSAGE_PROCESSOR] Отправка сообщения типа image пользователю 79140775712
INFO:     2a03:2880:22ff:70:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
Image sent successfully to 79140775712, ID: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA (session_id=None)
[MESSAGE_PROCESSOR] Извлечен wa_message_id из meta: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA
[DEBUG] Logging enabled for message_service.add_message_to_conversation
Message saved to 79140775712/20250705_201145_905382_356 with wa_id: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA
Message added to conversation: 79140775712/20250705_201145_905382_356
[MESSAGE_PROCESSOR] Сообщение сохранено в БД с wa_message_id: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA
[MESSAGE_PROCESSOR] Изображение сохранено в БД с wamid: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA
[DEBUG] Logging enabled for message_processor.send_message
[MESSAGE_PROCESSOR] Отправка сообщения типа image пользователю 79140775712
INFO:     2a03:2880:22ff:6:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
INFO:     2a03:2880:10ff:1:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
INFO:     2a03:2880:22ff:3:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA', 'status': 'sent', 'timestamp': '1751721366', 'recipient_id': '79140775712', 'conversation': {'id': '90bb4e33c016bc0cdae2d8a8bfd04267', 'expiration_timestamp': '1751721366', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA', 'status': 'sent', 'timestamp': '1751721366', 'recipient_id': '79140775712', 'conversation': {'id': '90bb4e33c016bc0cdae2d8a8bfd04267', 'expiration_timestamp': '1751721366', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}
[WEBHOOK_STATUS] Обрабатываем статус: sent для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': True, 'type': 'status_update', 'status': {'message_id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA', 'status': 'sent', 'timestamp': '1751721366', 'recipient_id': '79140775712'}}
[WEBHOOK_STATUS] Статус доставки: sent для сообщения None в 1751721366
INFO:     2a03:2880:22ff:70:::0 - "POST /webhook/ HTTP/1.1" 200 OK
INFO:     2a03:2880:10ff:4b:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA', 'status': 'delivered', 'timestamp': '1751721366', 'recipient_id': '79140775712', 'conversation': {'id': '90bb4e33c016bc0cdae2d8a8bfd04267', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA', 'status': 'delivered', 'timestamp': '1751721366', 'recipient_id': '79140775712', 'conversation': {'id': '90bb4e33c016bc0cdae2d8a8bfd04267', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}
[WEBHOOK_STATUS] Обрабатываем статус: delivered для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': True, 'type': 'status_update', 'status': {'message_id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA', 'status': 'delivered', 'timestamp': '1751721366', 'recipient_id': '79140775712'}}
[WEBHOOK_STATUS] Статус доставки: delivered для сообщения None в 1751721366
INFO:     2a03:2880:22ff:3:::0 - "POST /webhook/ HTTP/1.1" 200 OK
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA', 'status': 'delivered', 'timestamp': '1751721366', 'recipient_id': '79140775712', 'conversation': {'id': '90bb4e33c016bc0cdae2d8a8bfd04267', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA', 'status': 'delivered', 'timestamp': '1751721366', 'recipient_id': '79140775712', 'conversation': {'id': '90bb4e33c016bc0cdae2d8a8bfd04267', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}
[WEBHOOK_DUPLICATE] Дубликат статуса delivered для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': False, 'error': 'Duplicate status'}
[WEBHOOK] Невалидный webhook: Duplicate status
[WEBHOOK_DUPLICATE_STATUS] Получен дубликат статуса - игнорируем
INFO:     2a03:2880:10ff:1:::0 - "POST /webhook/ HTTP/1.1" 200 OK
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA', 'status': 'read', 'timestamp': '1751721366', 'recipient_id': '79140775712'}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA', 'status': 'read', 'timestamp': '1751721366', 'recipient_id': '79140775712'}]}
[WEBHOOK_STATUS] Обрабатываем статус: read для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': True, 'type': 'status_update', 'status': {'message_id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIyRDlDRkEyRkEzRjM5NjBCMzQA', 'status': 'read', 'timestamp': '1751721366', 'recipient_id': '79140775712'}}
[WEBHOOK_STATUS] Статус доставки: read для сообщения None в 1751721366
INFO:     2a03:2880:22ff:6:::0 - "POST /webhook/ HTTP/1.1" 200 OK
INFO:     2a03:2880:22ff:70:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
INFO:     2a03:2880:22ff:5:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
Image sent successfully to 79140775712, ID: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA (session_id=None)
[MESSAGE_PROCESSOR] Извлечен wa_message_id из meta: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA
[DEBUG] Logging enabled for message_service.add_message_to_conversation
Message saved to 79140775712/20250705_201145_905382_356 with wa_id: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA
Message added to conversation: 79140775712/20250705_201145_905382_356
[MESSAGE_PROCESSOR] Сообщение сохранено в БД с wa_message_id: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA
[MESSAGE_PROCESSOR] Изображение сохранено в БД с wamid: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA
[DEBUG] Logging enabled for message_processor.send_message
[MESSAGE_PROCESSOR] Отправка сообщения типа image пользователю 79140775712
INFO:     2a03:2880:10ff:50:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA', 'status': 'sent', 'timestamp': '1751721367', 'recipient_id': '79140775712', 'conversation': {'id': '29587af3eaf99d628c138699763f468f', 'expiration_timestamp': '1751721367', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA', 'status': 'sent', 'timestamp': '1751721367', 'recipient_id': '79140775712', 'conversation': {'id': '29587af3eaf99d628c138699763f468f', 'expiration_timestamp': '1751721367', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}
[WEBHOOK_STATUS] Обрабатываем статус: sent для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': True, 'type': 'status_update', 'status': {'message_id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA', 'status': 'sent', 'timestamp': '1751721367', 'recipient_id': '79140775712'}}
[WEBHOOK_STATUS] Статус доставки: sent для сообщения None в 1751721367
INFO:     2a03:2880:10ff:4b:::0 - "POST /webhook/ HTTP/1.1" 200 OK
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA', 'status': 'delivered', 'timestamp': '1751721367', 'recipient_id': '79140775712', 'conversation': {'id': '29587af3eaf99d628c138699763f468f', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA', 'status': 'delivered', 'timestamp': '1751721367', 'recipient_id': '79140775712', 'conversation': {'id': '29587af3eaf99d628c138699763f468f', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}
[WEBHOOK_STATUS] Обрабатываем статус: delivered для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': True, 'type': 'status_update', 'status': {'message_id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA', 'status': 'delivered', 'timestamp': '1751721367', 'recipient_id': '79140775712'}}
[WEBHOOK_STATUS] Статус доставки: delivered для сообщения None в 1751721367
INFO:     2a03:2880:22ff:70:::0 - "POST /webhook/ HTTP/1.1" 200 OK
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA', 'status': 'delivered', 'timestamp': '1751721367', 'recipient_id': '79140775712', 'conversation': {'id': '29587af3eaf99d628c138699763f468f', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA', 'status': 'delivered', 'timestamp': '1751721367', 'recipient_id': '79140775712', 'conversation': {'id': '29587af3eaf99d628c138699763f468f', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}
[WEBHOOK_DUPLICATE] Дубликат статуса delivered для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': False, 'error': 'Duplicate status'}
[WEBHOOK] Невалидный webhook: Duplicate status
[WEBHOOK_DUPLICATE_STATUS] Получен дубликат статуса - игнорируем
INFO:     2a03:2880:22ff:5:::0 - "POST /webhook/ HTTP/1.1" 200 OK
INFO:     2a03:2880:22ff:73:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA', 'status': 'read', 'timestamp': '1751721367', 'recipient_id': '79140775712'}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA', 'status': 'read', 'timestamp': '1751721367', 'recipient_id': '79140775712'}]}
[WEBHOOK_STATUS] Обрабатываем статус: read для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': True, 'type': 'status_update', 'status': {'message_id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQTRFQzlGM0QwMDI1OUIyNEUA', 'status': 'read', 'timestamp': '1751721367', 'recipient_id': '79140775712'}}
[WEBHOOK_STATUS] Статус доставки: read для сообщения None в 1751721367
INFO:     2a03:2880:10ff:50:::0 - "POST /webhook/ HTTP/1.1" 200 OK
Image sent successfully to 79140775712, ID: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBNTUyNzZCMzgwQ0I0QzgyMTYA (session_id=None)
[MESSAGE_PROCESSOR] Извлечен wa_message_id из meta: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBNTUyNzZCMzgwQ0I0QzgyMTYA
[DEBUG] Logging enabled for message_service.add_message_to_conversation
Message saved to 79140775712/20250705_201145_905382_356 with wa_id: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBNTUyNzZCMzgwQ0I0QzgyMTYA
Message added to conversation: 79140775712/20250705_201145_905382_356
[MESSAGE_PROCESSOR] Сообщение сохранено в БД с wa_message_id: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBNTUyNzZCMzgwQ0I0QzgyMTYA
[MESSAGE_PROCESSOR] Изображение сохранено в БД с wamid: wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBNTUyNzZCMzgwQ0I0QzgyMTYA
[WEBHOOK] Команда от AI обработана: {'status': 'success', 'action': 'catalog_sent', 'products_count': 5}
INFO:     2a03:2880:21ff:6:::0 - "POST /webhook/ HTTP/1.1" 200 OK
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA', 'status': 'sent', 'timestamp': '1751721368', 'recipient_id': '79140775712', 'conversation': {'id': 'c8bd4bde97a3d253432fb2f91ff38813', 'expiration_timestamp': '1751721368', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA', 'status': 'sent', 'timestamp': '1751721368', 'recipient_id': '79140775712', 'conversation': {'id': 'c8bd4bde97a3d253432fb2f91ff38813', 'expiration_timestamp': '1751721368', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}
[WEBHOOK_STATUS] Обрабатываем статус: sent для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': True, 'type': 'status_update', 'status': {'message_id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA', 'status': 'sent', 'timestamp': '1751721368', 'recipient_id': '79140775712'}}
[WEBHOOK_STATUS] Статус доставки: sent для сообщения None в 1751721368
INFO:     2a03:2880:22ff:73:::0 - "POST /webhook/ HTTP/1.1" 200 OK
INFO:     2a03:2880:22ff:74:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
INFO:     2a03:2880:10ff:3:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
INFO:     2a03:2880:10ff:4a:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
INFO:     2a03:2880:10ff:1:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA', 'status': 'delivered', 'timestamp': '1751721369', 'recipient_id': '79140775712', 'conversation': {'id': 'c8bd4bde97a3d253432fb2f91ff38813', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA', 'status': 'delivered', 'timestamp': '1751721369', 'recipient_id': '79140775712', 'conversation': {'id': 'c8bd4bde97a3d253432fb2f91ff38813', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}
[WEBHOOK_STATUS] Обрабатываем статус: delivered для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': True, 'type': 'status_update', 'status': {'message_id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA', 'status': 'delivered', 'timestamp': '1751721369', 'recipient_id': '79140775712'}}
[WEBHOOK_STATUS] Статус доставки: delivered для сообщения None в 1751721369
INFO:     2a03:2880:22ff:74:::0 - "POST /webhook/ HTTP/1.1" 200 OK
INFO:     2a03:2880:21ff:44:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
INFO:     2a03:2880:10ff:2:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA', 'status': 'delivered', 'timestamp': '1751721369', 'recipient_id': '79140775712', 'conversation': {'id': 'c8bd4bde97a3d253432fb2f91ff38813', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA', 'status': 'delivered', 'timestamp': '1751721369', 'recipient_id': '79140775712', 'conversation': {'id': 'c8bd4bde97a3d253432fb2f91ff38813', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}
[WEBHOOK_DUPLICATE] Дубликат статуса delivered для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': False, 'error': 'Duplicate status'}
[WEBHOOK] Невалидный webhook: Duplicate status
[WEBHOOK_DUPLICATE_STATUS] Получен дубликат статуса - игнорируем
INFO:     2a03:2880:10ff:3:::0 - "POST /webhook/ HTTP/1.1" 200 OK
INFO:     2a03:2880:22ff:2:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA', 'status': 'read', 'timestamp': '1751721369', 'recipient_id': '79140775712'}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA', 'status': 'read', 'timestamp': '1751721369', 'recipient_id': '79140775712'}]}
[WEBHOOK_STATUS] Обрабатываем статус: read для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': True, 'type': 'status_update', 'status': {'message_id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Mjk4RDM0RURBQkQ4QjI0RDgA', 'status': 'read', 'timestamp': '1751721369', 'recipient_id': '79140775712'}}
[WEBHOOK_STATUS] Статус доставки: read для сообщения None в 1751721369
INFO:     2a03:2880:10ff:4a:::0 - "POST /webhook/ HTTP/1.1" 200 OK
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA', 'status': 'sent', 'timestamp': '1751721369', 'recipient_id': '79140775712', 'conversation': {'id': 'b2930eafc7b33366af6d4aa2a339f7be', 'expiration_timestamp': '1751721369', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA', 'status': 'sent', 'timestamp': '1751721369', 'recipient_id': '79140775712', 'conversation': {'id': 'b2930eafc7b33366af6d4aa2a339f7be', 'expiration_timestamp': '1751721369', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}
[WEBHOOK_STATUS] Обрабатываем статус: sent для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': True, 'type': 'status_update', 'status': {'message_id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA', 'status': 'sent', 'timestamp': '1751721369', 'recipient_id': '79140775712'}}
[WEBHOOK_STATUS] Статус доставки: sent для сообщения None в 1751721369
INFO:     2a03:2880:10ff:1:::0 - "POST /webhook/ HTTP/1.1" 200 OK
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA', 'status': 'delivered', 'timestamp': '1751721370', 'recipient_id': '79140775712', 'conversation': {'id': 'b2930eafc7b33366af6d4aa2a339f7be', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA', 'status': 'delivered', 'timestamp': '1751721370', 'recipient_id': '79140775712', 'conversation': {'id': 'b2930eafc7b33366af6d4aa2a339f7be', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}
[WEBHOOK_STATUS] Обрабатываем статус: delivered для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': True, 'type': 'status_update', 'status': {'message_id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA', 'status': 'delivered', 'timestamp': '1751721370', 'recipient_id': '79140775712'}}
[WEBHOOK_STATUS] Статус доставки: delivered для сообщения None в 1751721370
INFO:     2a03:2880:21ff:44:::0 - "POST /webhook/ HTTP/1.1" 200 OK
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA', 'status': 'delivered', 'timestamp': '1751721370', 'recipient_id': '79140775712', 'conversation': {'id': 'b2930eafc7b33366af6d4aa2a339f7be', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA', 'status': 'delivered', 'timestamp': '1751721370', 'recipient_id': '79140775712', 'conversation': {'id': 'b2930eafc7b33366af6d4aa2a339f7be', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}
[WEBHOOK_DUPLICATE] Дубликат статуса delivered для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': False, 'error': 'Duplicate status'}
[WEBHOOK] Невалидный webhook: Duplicate status
[WEBHOOK_DUPLICATE_STATUS] Получен дубликат статуса - игнорируем
INFO:     2a03:2880:10ff:2:::0 - "POST /webhook/ HTTP/1.1" 200 OK
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA', 'status': 'read', 'timestamp': '1751721370', 'recipient_id': '79140775712'}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA', 'status': 'read', 'timestamp': '1751721370', 'recipient_id': '79140775712'}]}
[WEBHOOK_STATUS] Обрабатываем статус: read для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': True, 'type': 'status_update', 'status': {'message_id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBRTdGRTdBNEY2MTQyQzZEQjcA', 'status': 'read', 'timestamp': '1751721370', 'recipient_id': '79140775712'}}
[WEBHOOK_STATUS] Статус доставки: read для сообщения None в 1751721370
INFO:     2a03:2880:22ff:2:::0 - "POST /webhook/ HTTP/1.1" 200 OK
INFO:     2a03:2880:10ff:7:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
INFO:     2a03:2880:12ff:70:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
INFO:     2a03:2880:10ff:70:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBNTUyNzZCMzgwQ0I0QzgyMTYA', 'status': 'sent', 'timestamp': '1751721371', 'recipient_id': '79140775712', 'conversation': {'id': '7acae4e4fab19fc0fa8eef2def7e8188', 'expiration_timestamp': '1751721371', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBNTUyNzZCMzgwQ0I0QzgyMTYA', 'status': 'sent', 'timestamp': '1751721371', 'recipient_id': '79140775712', 'conversation': {'id': '7acae4e4fab19fc0fa8eef2def7e8188', 'expiration_timestamp': '1751721371', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}
[WEBHOOK_STATUS] Обрабатываем статус: sent для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBNTUyNzZCMzgwQ0I0QzgyMTYA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': True, 'type': 'status_update', 'status': {'message_id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBNTUyNzZCMzgwQ0I0QzgyMTYA', 'status': 'sent', 'timestamp': '1751721371', 'recipient_id': '79140775712'}}
[WEBHOOK_STATUS] Статус доставки: sent для сообщения None в 1751721371
INFO:     2a03:2880:10ff:7:::0 - "POST /webhook/ HTTP/1.1" 200 OK
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBNTUyNzZCMzgwQ0I0QzgyMTYA', 'status': 'read', 'timestamp': '1751721371', 'recipient_id': '79140775712'}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBNTUyNzZCMzgwQ0I0QzgyMTYA', 'status': 'read', 'timestamp': '1751721371', 'recipient_id': '79140775712'}]}
[WEBHOOK_STATUS] Обрабатываем статус: read для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBNTUyNzZCMzgwQ0I0QzgyMTYA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': True, 'type': 'status_update', 'status': {'message_id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBNTUyNzZCMzgwQ0I0QzgyMTYA', 'status': 'read', 'timestamp': '1751721371', 'recipient_id': '79140775712'}}
[WEBHOOK_STATUS] Статус доставки: read для сообщения None в 1751721371
INFO:     2a03:2880:10ff:70:::0 - "POST /webhook/ HTTP/1.1" 200 OK
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBNTUyNzZCMzgwQ0I0QzgyMTYA', 'status': 'delivered', 'timestamp': '1751721371', 'recipient_id': '79140775712', 'conversation': {'id': '7acae4e4fab19fc0fa8eef2def7e8188', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBNTUyNzZCMzgwQ0I0QzgyMTYA', 'status': 'delivered', 'timestamp': '1751721371', 'recipient_id': '79140775712', 'conversation': {'id': '7acae4e4fab19fc0fa8eef2def7e8188', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}
[WEBHOOK_STATUS] Обрабатываем статус: delivered для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBNTUyNzZCMzgwQ0I0QzgyMTYA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': True, 'type': 'status_update', 'status': {'message_id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBNTUyNzZCMzgwQ0I0QzgyMTYA', 'status': 'delivered', 'timestamp': '1751721371', 'recipient_id': '79140775712'}}
[WEBHOOK_STATUS] Статус доставки: delivered для сообщения None в 1751721371
INFO:     2a03:2880:12ff:70:::0 - "POST /webhook/ HTTP/1.1" 200 OK
INFO:     127.0.0.1:64229 - "GET /api/logs HTTP/1.1" 200 OK
INFO:     127.0.0.1:64382 - "GET /api/logs HTTP/1.1" 200 OK
INFO:     127.0.0.1:64666 - "GET /api/logs HTTP/1.1" 200 OK
INFO:     2a03:2880:10ff:6:::0 - "POST /webhook HTTP/1.1" 307 Temporary Redirect
[WEBHOOK] Получен webhook от WhatsApp
[WEBHOOK_DEBUG] Тело webhook: {'object': 'whatsapp_business_account', 'entry': [{'id': '515848908286141', 'changes': [{'value': {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIzODM1Qjc1Q0U2MzI2QTg1M0QA', 'status': 'sent', 'timestamp': '1751721255', 'recipient_id': '79140775712', 'conversation': {'id': 'c6d95610a60e55ae4f9498d6171801b3', 'expiration_timestamp': '1751721255', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}, 'field': 'messages'}]}]}
[WEBHOOK_DEBUG] Вызываем validate_webhook
[DEBUG] Logging enabled for webhook_handler.validate_webhook
[WEBHOOK_DEBUG] value: {'messaging_product': 'whatsapp', 'metadata': {'display_phone_number': '66963617068', 'phone_number_id': '494991623707876'}, 'statuses': [{'id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIzODM1Qjc1Q0U2MzI2QTg1M0QA', 'status': 'sent', 'timestamp': '1751721255', 'recipient_id': '79140775712', 'conversation': {'id': 'c6d95610a60e55ae4f9498d6171801b3', 'expiration_timestamp': '1751721255', 'origin': {'type': 'service'}}, 'pricing': {'billable': False, 'pricing_model': 'PMP', 'category': 'service', 'type': 'free_customer_service'}}]}
[WEBHOOK_STATUS] Обрабатываем статус: sent для сообщения wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIzODM1Qjc1Q0U2MzI2QTg1M0QA
[WEBHOOK_DEBUG] Результат validate_webhook: {'valid': True, 'type': 'status_update', 'status': {'message_id': 'wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIzODM1Qjc1Q0U2MzI2QTg1M0QA', 'status': 'sent', 'timestamp': '1751721255', 'recipient_id': '79140775712'}}
[WEBHOOK_STATUS] Статус доставки: sent для сообщения None в 1751721255
INFO:     2a03:2880:10ff:6:::0 - "POST /webhook/ HTTP/1.1" 200 OK
INFO:     127.0.0.1:64871 - "GET /api/logs HTTP/1.1" 200 OK
INFO:     127.0.0.1:65032 - "GET /api/logs HTTP/1.1" 200 OK
INFO:     127.0.0.1:65268 - "GET /api/logs HTTP/1.1" 200 OK
INFO:     127.0.0.1:49197 - "GET /api/logs HTTP/1.1" 200 OK
INFO:     127.0.0.1:49420 - "GET /api/logs HTTP/1.1" 200 OK
[2025-07-05 23:49:26] ERROR: root - [WEBHOOK_ROUTES] Error processing webhook: 'dict' object has no attribute '__name__'
[2025-07-05 23:50:25] ERROR: root - [WEBHOOK_ROUTES] Error processing webhook: 'dict' object has no attribute '__name__'
[2025-07-05 23:50:28] ERROR: root - [WEBHOOK_ROUTES] Error processing webhook: 'dict' object has no attribute '__name__'
[2025-07-05 23:50:53] ERROR: root - [WEBHOOK_ROUTES] Error processing webhook: 'dict' object has no attribute '__name__'
[2025-07-05 23:53:00] ERROR: root - [WEBHOOK_ROUTES] Error processing webhook: 'dict' object has no attribute '__name__'
[2025-07-05 23:53:38] ERROR: root - [WEBHOOK_ROUTES] Error processing webhook: 'dict' object has no attribute '__name__'
[2025-07-05 23:57:19] INFO: root - {"event": "function_start", "module": "webhook_handler", "function": "validate_webhook", "timestamp": "2025-07-05T23:57:19.201183", "parameters": {"body": {"object": "whatsapp_business_account", "entry": [{"id": "515848908286141", "changes": [{"value": {"messaging_product": "whatsapp", "metadata": {"display_phone_number": "66963617068", "phone_number_id": "494991623707876"}, "contacts": [{"profile": {"name": "Denis Drobotenko"}, "wa_id": "79140775712"}], "messages": [{"from": "79140775712", "id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTkxNzE4RUU1REI5OUQwMUYzMwA=", "timestamp": "1751734637", "text": {"body": "Привет!"}, "type": "text"}]}, "field": "messages"}]}]}}}
[2025-07-05 23:57:19] INFO: root - {"event": "function_end", "module": "webhook_handler", "function": "validate_webhook", "timestamp": "2025-07-05T23:57:19.211730", "execution_time_ms": 3.44, "result": {"valid": true, "type": "message", "message_type": "text"}}
[2025-07-05 23:57:22] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-05T23:57:22.664851", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1074a2fd0>", "sender_id": "79140775712", "message_text": "Привет!", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTkxNzE4RUU1REI5OUQwMUYzMwA=", "message_type": "text", "timestamp": "1751734637"}, "sender_name": "Denis Drobotenko"}}
[2025-07-05 23:57:24] ERROR: root - [MESSAGE_PROCESSOR] Error processing message: 'SessionService' object has no attribute 'get_or_create_session'
[2025-07-05 23:57:24] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-05T23:57:24.233535", "execution_time_ms": 1568.0, "result": false}
[2025-07-05 23:57:28] INFO: root - {"event": "function_start", "module": "webhook_handler", "function": "validate_webhook", "timestamp": "2025-07-05T23:57:28.287189", "parameters": {"body": {"object": "whatsapp_business_account", "entry": [{"id": "515848908286141", "changes": [{"value": {"messaging_product": "whatsapp", "metadata": {"display_phone_number": "66963617068", "phone_number_id": "494991623707876"}, "statuses": [{"id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJERDMwQzYxNTBERDNCRjFENTIA", "status": "delivered", "timestamp": "1751728305", "recipient_id": "79140775712", "conversation": {"id": "9abd4c642522fab1454a298465d0b01d", "origin": {"type": "service"}}, "pricing": {"billable": false, "pricing_model": "PMP", "category": "service", "type": "free_customer_service"}}]}, "field": "messages"}]}]}}}
[2025-07-05 23:57:28] INFO: root - {"event": "function_end", "module": "webhook_handler", "function": "validate_webhook", "timestamp": "2025-07-05T23:57:28.288844", "execution_time_ms": 0.62, "result": {"valid": true, "type": "status", "status_type": "delivered"}}
[2025-07-05 23:58:07] INFO: root - {"event": "function_start", "module": "webhook_handler", "function": "validate_webhook", "timestamp": "2025-07-05T23:58:07.888455", "parameters": {"body": {"object": "whatsapp_business_account", "entry": [{"id": "515848908286141", "changes": [{"value": {"messaging_product": "whatsapp", "metadata": {"display_phone_number": "66963617068", "phone_number_id": "494991623707876"}, "contacts": [{"profile": {"name": "Denis Drobotenko"}, "wa_id": "79140775712"}], "messages": [{"from": "79140775712", "id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUQwMzlDQTJDRjI4Q0Q3NkNDQwA=", "timestamp": "1751725346", "text": {"body": "Зрасьте"}, "type": "text"}]}, "field": "messages"}]}]}}}
[2025-07-05 23:58:07] INFO: root - {"event": "function_end", "module": "webhook_handler", "function": "validate_webhook", "timestamp": "2025-07-05T23:58:07.889837", "execution_time_ms": 0.55, "result": {"valid": true, "type": "message", "message_type": "text"}}
[2025-07-05 23:58:07] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-05T23:58:07.890064", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1074a2fd0>", "sender_id": "79140775712", "message_text": "Зрасьте", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUQwMzlDQTJDRjI4Q0Q3NkNDQwA=", "message_type": "text", "timestamp": "1751725346"}, "sender_name": "Denis Drobotenko"}}
[2025-07-05 23:58:09] ERROR: root - [MESSAGE_PROCESSOR] Error processing message: 'SessionService' object has no attribute 'get_or_create_session'
[2025-07-05 23:58:09] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-05T23:58:09.785286", "execution_time_ms": 1895.1, "result": false}
[2025-07-05 23:58:34] INFO: root - {"event": "function_start", "module": "webhook_handler", "function": "validate_webhook", "timestamp": "2025-07-05T23:58:34.264821", "parameters": {"body": {"object": "whatsapp_business_account", "entry": [{"id": "515848908286141", "changes": [{"value": {"messaging_product": "whatsapp", "metadata": {"display_phone_number": "66963617068", "phone_number_id": "494991623707876"}, "statuses": [{"id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJFNzA4NEJDQTUyRUQ4NzFERTYA", "status": "sent", "timestamp": "1751728193", "recipient_id": "79140775712", "conversation": {"id": "f8b0c41bf000f79d347df15f7d2b7dd3", "expiration_timestamp": "1751728193", "origin": {"type": "service"}}, "pricing": {"billable": false, "pricing_model": "PMP", "category": "service", "type": "free_customer_service"}}]}, "field": "messages"}]}]}}}
[2025-07-05 23:58:34] INFO: root - {"event": "function_end", "module": "webhook_handler", "function": "validate_webhook", "timestamp": "2025-07-05T23:58:34.267416", "execution_time_ms": 0.98, "result": {"valid": true, "type": "status", "status_type": "sent"}}
[2025-07-05 23:58:57] INFO: root - {"event": "function_start", "module": "webhook_handler", "function": "validate_webhook", "timestamp": "2025-07-05T23:58:57.104125", "parameters": {"body": {"object": "whatsapp_business_account", "entry": [{"id": "515848908286141", "changes": [{"value": {"messaging_product": "whatsapp", "metadata": {"display_phone_number": "66963617068", "phone_number_id": "494991623707876"}, "statuses": [{"id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJFNzA4NEJDQTUyRUQ4NzFERTYA", "status": "read", "timestamp": "1751728215", "recipient_id": "79140775712"}]}, "field": "messages"}]}]}}}
[2025-07-05 23:58:57] INFO: root - {"event": "function_end", "module": "webhook_handler", "function": "validate_webhook", "timestamp": "2025-07-05T23:58:57.104806", "execution_time_ms": 0.23, "result": {"valid": true, "type": "status", "status_type": "read"}}
[2025-07-06 00:01:14] INFO: root - {"event": "function_start", "module": "webhook_handler", "function": "validate_webhook", "timestamp": "2025-07-06T00:01:14.334107", "parameters": {"body": {"object": "whatsapp_business_account", "entry": [{"id": "515848908286141", "changes": [{"value": {"messaging_product": "whatsapp", "metadata": {"display_phone_number": "66963617068", "phone_number_id": "494991623707876"}, "contacts": [{"profile": {"name": "Denis Drobotenko"}, "wa_id": "79140775712"}], "messages": [{"from": "79140775712", "id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTc4MjQ4RUFBNTQ4RDlCOEJEMgA=", "timestamp": "1751728014", "text": {"body": "эй"}, "type": "text"}]}, "field": "messages"}]}]}}}
[2025-07-06 00:01:14] INFO: root - {"event": "function_end", "module": "webhook_handler", "function": "validate_webhook", "timestamp": "2025-07-06T00:01:14.337638", "execution_time_ms": 1.28, "result": {"valid": true, "type": "message", "message_type": "text"}}
[2025-07-06 00:01:17] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:01:17.004717", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x123037890>", "sender_id": "79140775712", "message_text": "эй", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTc4MjQ4RUFBNTQ4RDlCOEJEMgA=", "message_type": "text", "timestamp": "1751728014"}, "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:01:24] ERROR: root - [MESSAGE_PROCESSOR] Error processing message: 'MessageService' object has no attribute 'get_messages_for_session'
[2025-07-06 00:01:24] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:01:24.986065", "execution_time_ms": 7981.04, "result": false}
[2025-07-06 00:02:08] INFO: root - {"event": "function_start", "module": "webhook_handler", "function": "validate_webhook", "timestamp": "2025-07-06T00:02:08.872467", "parameters": {"body": {"object": "whatsapp_business_account", "entry": [{"id": "515848908286141", "changes": [{"value": {"messaging_product": "whatsapp", "metadata": {"display_phone_number": "66963617068", "phone_number_id": "494991623707876"}, "contacts": [{"profile": {"name": "Denis Drobotenko"}, "wa_id": "79140775712"}], "messages": [{"from": "79140775712", "id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTIzNzhGQzhDRTI4QjA1MEI1MAA=", "timestamp": "1751734522", "text": {"body": "Привет!"}, "type": "text"}]}, "field": "messages"}]}]}}}
[2025-07-06 00:02:08] INFO: root - {"event": "function_end", "module": "webhook_handler", "function": "validate_webhook", "timestamp": "2025-07-06T00:02:08.874398", "execution_time_ms": 0.86, "result": {"valid": true, "type": "message", "message_type": "text"}}
[2025-07-06 00:02:08] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:02:08.874734", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x123037890>", "sender_id": "79140775712", "message_text": "Привет!", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTIzNzhGQzhDRTI4QjA1MEI1MAA=", "message_type": "text", "timestamp": "1751734522"}, "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:02:19] ERROR: root - [MESSAGE_PROCESSOR] Error processing message: 'MessageService' object has no attribute 'get_messages_for_session'
[2025-07-06 00:02:19] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:02:19.713587", "execution_time_ms": 10838.68, "result": false}
[2025-07-06 00:05:56] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:05:56.540048", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1092b7250>", "sender_id": "79140775712", "message_text": "Привет", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTZCN0MwRTgyOUI5MTlEN0IyOQA=", "message_type": "text", "timestamp": "1751735152"}, "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:06:05] ERROR: root - [MESSAGE_PROCESSOR] Error processing message: AIService.__init__() missing 1 required positional argument: 'api_key'
[2025-07-06 00:06:05] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:06:05.046574", "execution_time_ms": 8505.41, "result": false}
[2025-07-06 00:08:32] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:08:32.884873", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x106cef750>", "sender_id": "79140775712", "message_text": "Hi", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUIxODI0NjAyNUQwRjQ2Q0I1MgA=", "message_type": "text", "timestamp": "1751735308"}, "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:08:41] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:08:41.417106", "parameters": {"self": "<src.services.ai_service.AIService object at 0x106d9d010>", "messages": [{"role": "assistant", "content": "эй", "timestamp": "2025-07-06 00:01:21.344891+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTc4MjQ4RUFBNTQ4RDlCOEJEMgA="}, {"role": "assistant", "content": "Привет!", "timestamp": "2025-07-06 00:02:16.496297+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTIzNzhGQzhDRTI4QjA1MEI1MAA="}, {"role": "assistant", "content": "Привет", "timestamp": "2025-07-06 00:06:00.611839+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTZCN0MwRTgyOUI5MTlEN0IyOQA="}, {"role": "assistant", "content": "Hi", "timestamp": "2025-07-06 00:08:37.146005+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUIxODI0NjAyNUQwRjQ2Q0I1MgA="}], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:08:41] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:08:41.417983", "execution_time_ms": 0.13, "result": ["Извините, произошла ошибка. Попробуйте еще раз. 🌸", "Sorry, an error occurred. Please try again. 🌸", "ขออภัย เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง 🌸", null]}
[2025-07-06 00:08:41] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:08:41.418247", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x106cef750>", "to_number": "79140775712", "content": "Извините, произошла ошибка. Попробуйте еще раз. 🌸", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": null, "sender_id": null, "content_en": null, "content_thai": null}}
[2025-07-06 00:08:42] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:08:42] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:08:42.410197", "execution_time_ms": 991.86, "result": true}
[2025-07-06 00:08:42] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:08:42.410749", "execution_time_ms": 9525.14, "result": true}
[2025-07-06 00:11:38] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:11:38.543139", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107173610>", "sender_id": "79140775712", "message_text": "эй", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUE5QjE4RDQ0RjQyODU5MjQ0OQA=", "message_type": "text", "timestamp": "1751735493"}, "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:11:47] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:11:47.572362", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10721d010>", "messages": [{"role": "assistant", "content": "эй", "timestamp": "2025-07-06 00:01:21.344891+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTc4MjQ4RUFBNTQ4RDlCOEJEMgA="}, {"role": "assistant", "content": "Привет!", "timestamp": "2025-07-06 00:02:16.496297+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTIzNzhGQzhDRTI4QjA1MEI1MAA="}, {"role": "assistant", "content": "Привет", "timestamp": "2025-07-06 00:06:00.611839+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTZCN0MwRTgyOUI5MTlEN0IyOQA="}, {"role": "assistant", "content": "Hi", "timestamp": "2025-07-06 00:08:37.146005+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUIxODI0NjAyNUQwRjQ2Q0I1MgA="}, {"role": "assistant", "content": "эй", "timestamp": "2025-07-06 00:11:42.670152+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUE5QjE4RDQ0RjQyODU5MjQ0OQA="}], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:11:48] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:11:48.546668", "execution_time_ms": 972.9, "result": ["Извините, произошла ошибка. Попробуйте еще раз. 🌸", "Sorry, an error occurred. Please try again. 🌸", "ขออภัย เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง 🌸", null]}
[2025-07-06 00:11:48] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:11:48.546921", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107173610>", "to_number": "79140775712", "content": "Извините, произошла ошибка. Попробуйте еще раз. 🌸", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": null, "sender_id": null, "content_en": null, "content_thai": null}}
[2025-07-06 00:11:49] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:11:49] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:11:49.339524", "execution_time_ms": 792.46, "result": true}
[2025-07-06 00:11:49] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:11:49.341193", "execution_time_ms": 10796.97, "result": true}
[2025-07-06 00:16:06] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:16:06.570215", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1077bb390>", "sender_id": "79140775712", "message_text": "Привет", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUE2RUMwQ0FDMzZCRjk5MUM1QwA=", "message_type": "text", "timestamp": "1751735762"}, "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:16:15] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:16:15.177857", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10785cec0>", "messages": [{"role": "assistant", "content": "эй", "timestamp": "2025-07-06 00:01:21.344891+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTc4MjQ4RUFBNTQ4RDlCOEJEMgA="}, {"role": "assistant", "content": "Привет!", "timestamp": "2025-07-06 00:02:16.496297+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTIzNzhGQzhDRTI4QjA1MEI1MAA="}, {"role": "assistant", "content": "Привет", "timestamp": "2025-07-06 00:06:00.611839+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTZCN0MwRTgyOUI5MTlEN0IyOQA="}, {"role": "assistant", "content": "Hi", "timestamp": "2025-07-06 00:08:37.146005+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUIxODI0NjAyNUQwRjQ2Q0I1MgA="}, {"role": "assistant", "content": "эй", "timestamp": "2025-07-06 00:11:42.670152+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUE5QjE4RDQ0RjQyODU5MjQ0OQA="}, {"role": "assistant", "content": "Привет", "timestamp": "2025-07-06 00:16:10.683871+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUE2RUMwQ0FDMzZCRjk5MUM1QwA="}], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:16:19] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:16:19.427744", "execution_time_ms": 4248.22, "result": ["Доброй ночи, Денис!\\n\\nХотели бы Вы посмотреть наш каталог цветов?", "Good night, Denis!\\n\\nWould you like to see our flower catalog?", "ราตรีสวัสดิ์ค่ะ เดนิส!\\n\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 00:16:19] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:16:19.428137", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1077bb390>", "to_number": "79140775712", "content": "Доброй ночи, Денис!\\n\\nХотели бы Вы посмотреть наш каталог цветов?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": null, "sender_id": null, "content_en": null, "content_thai": null}}
[2025-07-06 00:16:20] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:16:20] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:16:20.183228", "execution_time_ms": 754.98, "result": true}
[2025-07-06 00:16:20] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:16:20.184348", "execution_time_ms": 13613.26, "result": true}
[2025-07-06 00:18:17] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:18:17.377921", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1077bb390>", "sender_id": "79140775712", "message_text": "да", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTkwRjFDRDk0OEJGMzhDNzhENAA=", "message_type": "text", "timestamp": "1751735895"}, "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:18:26] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:18:26.168411", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1077bb110>", "messages": [{"role": "assistant", "content": "эй", "timestamp": "2025-07-06 00:01:21.344891+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTc4MjQ4RUFBNTQ4RDlCOEJEMgA="}, {"role": "assistant", "content": "Привет!", "timestamp": "2025-07-06 00:02:16.496297+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTIzNzhGQzhDRTI4QjA1MEI1MAA="}, {"role": "assistant", "content": "Привет", "timestamp": "2025-07-06 00:06:00.611839+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTZCN0MwRTgyOUI5MTlEN0IyOQA="}, {"role": "assistant", "content": "Hi", "timestamp": "2025-07-06 00:08:37.146005+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUIxODI0NjAyNUQwRjQ2Q0I1MgA="}, {"role": "assistant", "content": "эй", "timestamp": "2025-07-06 00:11:42.670152+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUE5QjE4RDQ0RjQyODU5MjQ0OQA="}, {"role": "assistant", "content": "Привет", "timestamp": "2025-07-06 00:16:10.683871+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUE2RUMwQ0FDMzZCRjk5MUM1QwA="}, {"role": "assistant", "content": "да", "timestamp": "2025-07-06 00:18:22.191350+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTkwRjFDRDk0OEJGMzhDNzhENAA="}], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:18:30] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:18:30.056680", "execution_time_ms": 3885.87, "result": ["Отлично!\\n\\nСейчас я покажу вам каждый букет с фотографией.\\nПожалуйста, подождите немного...", "Excellent!\\n\\nI'll show you each bouquet with a photo now.\\nPlease wait a moment...", "ยอดเยี่ยม!\\n\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\nกรุณารอสักครู่...", {"type": "send_catalog"}]}
[2025-07-06 00:18:33] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 00:18:33] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 00:18:34] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 00:18:34] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-06 00:18:34] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:18:34.120769", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1077081a0>", "to_number": "79140775712", "content": "Love is on the air\n2 200,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/503765845_1222228859683151_4028827634893880558_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=sb7DUXn5wNAQ7kNvwHJc5Vs&_nc_oc=AdmOxoDXIxrkBjHtpsTcXkZgXV7jH82e_PPl2FAXoCOH3grfE1PamTUm0WMVsCbWOiMSp5C79nMN6lQbVtaelKoD&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=tXeSYAhNQ-cOEf7yb0t7jg&oh=00_AfQMpcpMFt9KE-K_IB2KlVspX47KNFgaTnxS117cLa17gg&oe=686F30CA"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 00:18:35] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:18:36] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:18:36.400359", "execution_time_ms": 2279.29, "result": true}
[2025-07-06 00:18:36] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-06 00:18:36] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:18:36.402604", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1077081a0>", "to_number": "79140775712", "content": "Good vibes🌸\n2 350,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/511947769_2130442957421658_3783812242789464194_n.jpg?_nc_cat=109&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=VaAlBK3MuWcQ7kNvwHogCDm&_nc_oc=AdnUzVnOUYaHvO4I4_0frRo0aQYlyGA4jjbTJPe49BEIkEo6eRND_bzXFzQWkP4GMSNTS4tmLthT636eFMBcbLpB&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=tXeSYAhNQ-cOEf7yb0t7jg&oh=00_AfQ0NUYbnHKeCWXM9bGOmUKRv-3XhqESHOd41Q1L9YsQGQ&oe=686F337D"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 00:18:37] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:18:37] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:18:37.668241", "execution_time_ms": 1265.12, "result": true}
[2025-07-06 00:18:37] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-06 00:18:37] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:18:37.669052", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1077081a0>", "to_number": "79140775712", "content": "Clouds\n2 400,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513288773_3083699665127219_1955152157776052338_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=lZG4SBZGUpIQ7kNvwH7bJIs&_nc_oc=Adm1ilZgCtJ1rQLnfYCXpOgKsczuH9KLtnBjR2yFiSHV43K743WUOr07yG9ly3kFmS3DAjvofLUp7VAKd8BZnh_p&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=tXeSYAhNQ-cOEf7yb0t7jg&oh=00_AfRUVXssMxGxbXa2rnMwmNi1x3ZeMsnPOHl333-kBWKgqQ&oe=686F4CE8"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 00:18:38] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:18:39] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:18:39.073993", "execution_time_ms": 1404.68, "result": true}
[2025-07-06 00:18:39] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-06 00:18:39] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:18:39.074493", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1077081a0>", "to_number": "79140775712", "content": "Candy’s\n1 450,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513521068_1203881994842049_840424551106600581_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=i-cncoMZAXwQ7kNvwHWHy8f&_nc_oc=AdkHkGfaT-HYLERdInl2JW7G0LOvLTinf22KPRCsyGaveSaJ8NZDPbbGk0E-8M10XwBKRGryKrZiSnviG0Uzf1om&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=tXeSYAhNQ-cOEf7yb0t7jg&oh=00_AfQvRM1Gc7GjPI-NDUMEeBJd4wuGrGHOqtceUYKNH2NMaw&oe=686F4966"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 00:18:40] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:18:40] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:18:40.411512", "execution_time_ms": 1336.83, "result": true}
[2025-07-06 00:18:40] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-06 00:18:40] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:18:40.412369", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1077081a0>", "to_number": "79140775712", "content": "Pretty 😍\n2 600,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513058785_748208634241719_9170859285232997266_n.jpg?_nc_cat=106&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=-kFXCnhe93kQ7kNvwFyUk9S&_nc_oc=AdmNwD11W_gUAmJfYFtowZRpCN6hm7C0Zy386eF8VfovjuFC8K-2lqvPIBSIWSIWNRqlg47PyBzQhb36M828BAwy&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=tXeSYAhNQ-cOEf7yb0t7jg&oh=00_AfROPCdsvdAp0whgm-EiZ4qefkmB_BIo36NKUzE28vN0Kw&oe=686F21AC"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 00:18:41] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:18:42] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:18:42.307358", "execution_time_ms": 1894.73, "result": true}
[2025-07-06 00:18:42] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79140775712
[2025-07-06 00:18:42] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:18:42.307894", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1077bb390>", "to_number": "79140775712", "content": "Отлично!\\n\\nСейчас я покажу вам каждый букет с фотографией.\\nПожалуйста, подождите немного...", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": null, "sender_id": null, "content_en": null, "content_thai": null}}
[2025-07-06 00:18:43] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:18:43] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:18:43.163991", "execution_time_ms": 855.95, "result": true}
[2025-07-06 00:18:43] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:18:43.166000", "execution_time_ms": 25787.27, "result": true}
[2025-07-06 00:24:07] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:24:07.139234", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x119237610>", "sender_id": "79140775712", "message_text": "Этот", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUY0REIyNTlBMzA1MkExQzNFRgA=", "message_type": "text", "timestamp": "1751736242"}, "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:24:16] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:24:16.052098", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1192a3e00>", "messages": [{"role": "assistant", "content": "эй", "timestamp": "2025-07-06 00:01:21.344891+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTc4MjQ4RUFBNTQ4RDlCOEJEMgA="}, {"role": "assistant", "content": "Привет!", "timestamp": "2025-07-06 00:02:16.496297+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTIzNzhGQzhDRTI4QjA1MEI1MAA="}, {"role": "assistant", "content": "Привет", "timestamp": "2025-07-06 00:06:00.611839+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTZCN0MwRTgyOUI5MTlEN0IyOQA="}, {"role": "assistant", "content": "Hi", "timestamp": "2025-07-06 00:08:37.146005+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUIxODI0NjAyNUQwRjQ2Q0I1MgA="}, {"role": "assistant", "content": "эй", "timestamp": "2025-07-06 00:11:42.670152+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUE5QjE4RDQ0RjQyODU5MjQ0OQA="}, {"role": "assistant", "content": "Привет", "timestamp": "2025-07-06 00:16:10.683871+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUE2RUMwQ0FDMzZCRjk5MUM1QwA="}, {"role": "assistant", "content": "да", "timestamp": "2025-07-06 00:18:22.191350+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTkwRjFDRDk0OEJGMzhDNzhENAA="}, {"role": "assistant", "content": "Love is on the air\n2 200,00 ฿ 🌸", "timestamp": "2025-07-06 00:18:35.181659+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1OEI3QUM3MTVENUIxNTdFQUYA"}, {"role": "assistant", "content": "Good vibes\n2 350,00 ฿ 🌸", "timestamp": "2025-07-06 00:18:37.263815+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1MUU4RUY2QTgzQ0FCQjkyODQA"}, {"role": "assistant", "content": "Clouds\n2 400,00 ฿ 🌸", "timestamp": "2025-07-06 00:18:38.628340+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Q0YyMkEzNDU3QTJDMjc4QjYA"}], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:24:25] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:24:25.479863", "execution_time_ms": 9425.95, "result": ["Букет 'Clouds' сохранен.\\n\\nВам нужна доставка?", "Your bouquet 'Clouds' is saved.\\n\\nDo you need delivery?", "ช่อดอกไม้ 'Clouds' ของคุณถูกบันทึกแล้วค่ะ\\n\\nคุณต้องการจัดส่งหรือไม่คะ?", {"type": "save_order_info", "bouquet": "Clouds", "retailer_id": "uztv8n7g9i"}]}
[2025-07-06 00:24:29] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:24:29.240371", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x119237610>", "to_number": "79140775712", "content": "Букет 'Clouds' сохранен.\\n\\nВам нужна доставка?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": null, "sender_id": null, "content_en": null, "content_thai": null}}
[2025-07-06 00:24:30] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:24:30] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:24:30.074760", "execution_time_ms": 833.92, "result": true}
[2025-07-06 00:24:30] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:24:30.075861", "execution_time_ms": 22935.39, "result": true}
[2025-07-06 00:26:06] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:26:06.540105", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x119237610>", "sender_id": "79140775712", "message_text": "да", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTQyNzAxQkNGMDM5MDU2NDkwQgA=", "message_type": "text", "timestamp": "1751736365"}, "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:26:15] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:26:15.597935", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1192dc2d0>", "messages": [{"role": "assistant", "content": "эй", "timestamp": "2025-07-06 00:01:21.344891+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTc4MjQ4RUFBNTQ4RDlCOEJEMgA="}, {"role": "assistant", "content": "Привет!", "timestamp": "2025-07-06 00:02:16.496297+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTIzNzhGQzhDRTI4QjA1MEI1MAA="}, {"role": "assistant", "content": "Привет", "timestamp": "2025-07-06 00:06:00.611839+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTZCN0MwRTgyOUI5MTlEN0IyOQA="}, {"role": "assistant", "content": "Hi", "timestamp": "2025-07-06 00:08:37.146005+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUIxODI0NjAyNUQwRjQ2Q0I1MgA="}, {"role": "assistant", "content": "эй", "timestamp": "2025-07-06 00:11:42.670152+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUE5QjE4RDQ0RjQyODU5MjQ0OQA="}, {"role": "assistant", "content": "Привет", "timestamp": "2025-07-06 00:16:10.683871+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUE2RUMwQ0FDMzZCRjk5MUM1QwA="}, {"role": "assistant", "content": "да", "timestamp": "2025-07-06 00:18:22.191350+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTkwRjFDRDk0OEJGMzhDNzhENAA="}, {"role": "assistant", "content": "Love is on the air\n2 200,00 ฿ 🌸", "timestamp": "2025-07-06 00:18:35.181659+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1OEI3QUM3MTVENUIxNTdFQUYA"}, {"role": "assistant", "content": "Good vibes\n2 350,00 ฿ 🌸", "timestamp": "2025-07-06 00:18:37.263815+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1MUU4RUY2QTgzQ0FCQjkyODQA"}, {"role": "assistant", "content": "Clouds\n2 400,00 ฿ 🌸", "timestamp": "2025-07-06 00:18:38.628340+00:00", "content_en": null, "content_thai": null, "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1Q0YyMkEzNDU3QTJDMjc4QjYA"}], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:26:22] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:26:22.557011", "execution_time_ms": 6956.97, "result": ["Ваш букет 'Clouds' сохранен.\\n\\nВам нужна доставка?", "Your bouquet 'Clouds' is saved.\\n\\nDo you need delivery?", "ช่อดอกไม้ 'Clouds' ของคุณถูกบันทึกแล้วค่ะ\\n\\nคุณต้องการบริการจัดส่งไหมคะ?", {"type": "save_order_info", "bouquet": "Clouds", "retailer_id": "uztv8n7g9i"}]}
[2025-07-06 00:26:26] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:26:26.482885", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x119237610>", "to_number": "79140775712", "content": "Ваш букет 'Clouds' сохранен.\\n\\nВам нужна доставка?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": null, "sender_id": null, "content_en": null, "content_thai": null}}
[2025-07-06 00:26:27] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:26:27] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:26:27.292681", "execution_time_ms": 809.41, "result": true}
[2025-07-06 00:26:27] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:26:27.293907", "execution_time_ms": 20751.97, "result": true}
[2025-07-06 00:45:24] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:45:24.771445", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10962e710>", "sender_id": "79140775712", "message_text": "Привет!", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTY5QUNFNzVGMEIyNjE4QjQ0RQA=", "message_type": "text", "timestamp": "1751737520"}, "sender_name": "Denis Drobotenko", "reply_to_message_id": null}}
[2025-07-06 00:45:34] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T00:45:34.452168", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1098046e0>", "text": "Привет!"}}
[2025-07-06 00:45:34] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T00:45:34.454757", "execution_time_ms": 0.93, "result": "ru"}
[2025-07-06 00:45:34] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T00:45:34.653154", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1098046e0>", "text": "Привет!", "user_lang": "ru"}}
[2025-07-06 00:45:34] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:45:34.653553", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1098046e0>", "text": "Привет!", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 00:45:35] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:45:35.666272", "execution_time_ms": 1012.42, "result": "Hello!"}
[2025-07-06 00:45:35] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:45:35.667779", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1098046e0>", "text": "Привет!", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 00:45:38] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:45:38.570370", "execution_time_ms": 2901.82, "result": "สวัสดี"}
[2025-07-06 00:45:38] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T00:45:38.570986", "execution_time_ms": 3917.51, "result": ["Привет!", "Hello!", "สวัสดี"]}
[2025-07-06 00:45:40] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:45:40.114492", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1098046e0>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 6, 0, 45, 40, 114263), content_en='Hello!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:45:43] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:45:43.151969", "execution_time_ms": 3037.02, "result": ["Доброй ночи, Денис! Хотите посмотреть наш каталог цветов?", "Good night, Denis! Would you like to see our flower catalog?", "ราตรีสวัสดิ์ค่ะ เดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 00:45:43] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:45:43.156425", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10962e710>", "to_number": "79140775712", "content": "Доброй ночи, Денис! Хотите посмотреть наш каталог цветов?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": null, "sender_id": null, "content_en": null, "content_thai": null}}
[2025-07-06 00:45:44] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:45:44] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:45:44.143064", "execution_time_ms": 986.46, "result": true}
[2025-07-06 00:45:44] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:45:44.143597", "execution_time_ms": 19370.76, "result": true}
[2025-07-06 00:45:56] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:45:56.690297", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10962e990>", "sender_id": "79140775712", "message_text": "Да", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUE5RENDMERGNEIzMTk5NDIxMAA=", "message_type": "text", "timestamp": "1751737552"}, "sender_name": "Denis Drobotenko", "reply_to_message_id": null}}
[2025-07-06 00:46:06] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T00:46:06.402567", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10962ed50>", "text": "Да"}}
[2025-07-06 00:46:06] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T00:46:06.403979", "execution_time_ms": 0.06, "result": "ru"}
[2025-07-06 00:46:06] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T00:46:06.546194", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10962ed50>", "text": "Да", "user_lang": "ru"}}
[2025-07-06 00:46:06] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:46:06.547033", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10962ed50>", "text": "Да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 00:46:07] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:46:07.494427", "execution_time_ms": 947.23, "result": "Yes"}
[2025-07-06 00:46:07] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:46:07.494746", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10962ed50>", "text": "Да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 00:46:12] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:46:12.512631", "execution_time_ms": 5017.52, "result": "ค่ะ"}
[2025-07-06 00:46:12] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T00:46:12.513337", "execution_time_ms": 5966.56, "result": ["Да", "Yes", "ค่ะ"]}
[2025-07-06 00:46:13] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:46:13.948285", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10962ed50>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 6, 0, 46, 13, 948171), content_en='Hello!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 0, 46, 13, 948184), content_en='Yes', content_thai='ค่ะ', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:46:18] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:46:18.350726", "execution_time_ms": 4401.9, "result": ["Сейчас я покажу вам каждый букет с фотографией!\\n\\nПожалуйста, подождите минутку...", "I will now show you each bouquet with a photo!\\n\\nPlease wait a moment...", "ตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ!\\n\\nกรุณารอสักครู่...", {"type": "send_catalog"}]}
[2025-07-06 00:46:22] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 00:46:22] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 00:46:22] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 00:46:22] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:46:22.976399", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10957d7f0>", "to_number": "79140775712", "content": "Отлично!\n\nСейчас я покажу вам каждый букет с фотографией.\nПожалуйста, подождите немного... 🌸", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 00:46:23] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:46:24] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:46:24.872838", "execution_time_ms": 1896.06, "result": true}
[2025-07-06 00:46:24] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-06 00:46:24] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:46:24.873930", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10957d7f0>", "to_number": "79140775712", "content": "Love is on the air\n2 200,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/503765845_1222228859683151_4028827634893880558_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=sb7DUXn5wNAQ7kNvwHJc5Vs&_nc_oc=AdmOxoDXIxrkBjHtpsTcXkZgXV7jH82e_PPl2FAXoCOH3grfE1PamTUm0WMVsCbWOiMSp5C79nMN6lQbVtaelKoD&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=gIMQMV5ipiYFAsXjZtxgBw&oh=00_AfTcWzUNS1cS45MgT_5iR8VeoNSId6qhEeWjchHE2rQBzw&oe=686F30CA"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 00:46:25] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:46:26] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:46:26.156300", "execution_time_ms": 1282.01, "result": true}
[2025-07-06 00:46:26] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-06 00:46:26] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:46:26.157077", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10957d7f0>", "to_number": "79140775712", "content": "Good vibes🌸\n2 350,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/511947769_2130442957421658_3783812242789464194_n.jpg?_nc_cat=109&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=VaAlBK3MuWcQ7kNvwHogCDm&_nc_oc=AdnUzVnOUYaHvO4I4_0frRo0aQYlyGA4jjbTJPe49BEIkEo6eRND_bzXFzQWkP4GMSNTS4tmLthT636eFMBcbLpB&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=gIMQMV5ipiYFAsXjZtxgBw&oh=00_AfS9G13EAsZXTdF_A3yH7PRLhJajnW5B_bRdpeFciEdWkA&oe=686F337D"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 00:46:27] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:46:27] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:46:27.387560", "execution_time_ms": 1230.05, "result": true}
[2025-07-06 00:46:27] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-06 00:46:27] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:46:27.387856", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10957d7f0>", "to_number": "79140775712", "content": "Clouds\n2 400,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513288773_3083699665127219_1955152157776052338_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=lZG4SBZGUpIQ7kNvwH7bJIs&_nc_oc=Adm1ilZgCtJ1rQLnfYCXpOgKsczuH9KLtnBjR2yFiSHV43K743WUOr07yG9ly3kFmS3DAjvofLUp7VAKd8BZnh_p&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=gIMQMV5ipiYFAsXjZtxgBw&oh=00_AfRNE_diVqzdAp4jyI5vGMka8LDCIrClY_vnXsjCTYf8LA&oe=686F4CE8"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 00:46:28] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:46:28] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:46:28.535406", "execution_time_ms": 1147.41, "result": true}
[2025-07-06 00:46:28] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-06 00:46:28] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:46:28.536243", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10957d7f0>", "to_number": "79140775712", "content": "Candy’s\n1 450,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513521068_1203881994842049_840424551106600581_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=i-cncoMZAXwQ7kNvwHWHy8f&_nc_oc=AdkHkGfaT-HYLERdInl2JW7G0LOvLTinf22KPRCsyGaveSaJ8NZDPbbGk0E-8M10XwBKRGryKrZiSnviG0Uzf1om&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=gIMQMV5ipiYFAsXjZtxgBw&oh=00_AfSkKXQqNi_7nN9l82hq6yfeJL9v2p3JCY5Uqt5XG8ssbg&oe=686F4966"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 00:46:29] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:46:29] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:46:29.714822", "execution_time_ms": 1178.29, "result": true}
[2025-07-06 00:46:29] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-06 00:46:29] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:46:29.715294", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10957d7f0>", "to_number": "79140775712", "content": "Pretty 😍\n2 600,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513058785_748208634241719_9170859285232997266_n.jpg?_nc_cat=106&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=-kFXCnhe93kQ7kNvwFyUk9S&_nc_oc=AdmNwD11W_gUAmJfYFtowZRpCN6hm7C0Zy386eF8VfovjuFC8K-2lqvPIBSIWSIWNRqlg47PyBzQhb36M828BAwy&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=gIMQMV5ipiYFAsXjZtxgBw&oh=00_AfQHwvANnfhJfpOc5zBlf_-AxXcn4IanM4TJsv_5ilooRw&oe=686F21AC"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 00:46:30] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:46:30] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:46:30.986076", "execution_time_ms": 1270.44, "result": true}
[2025-07-06 00:46:30] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79140775712
[2025-07-06 00:46:30] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:46:30.986950", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10962e990>", "to_number": "79140775712", "content": "Сейчас я покажу вам каждый букет с фотографией!\\n\\nПожалуйста, подождите минутку...", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": null, "sender_id": null, "content_en": null, "content_thai": null}}
[2025-07-06 00:46:31] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:46:31] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:46:31.816754", "execution_time_ms": 829.38, "result": true}
[2025-07-06 00:46:31] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:46:31.818260", "execution_time_ms": 35126.95, "result": true}
[2025-07-06 00:48:53] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:48:53.720425", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1055a6fd0>", "sender_id": "79140775712", "message_text": "Этот (ответ на сообщение: [текст исходного сообщения])", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTgzMUQyQkI2NURCOERDRTQzMgA=", "message_type": "text", "timestamp": "1751737729"}, "sender_name": "Denis Drobotenko", "reply_to_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI4M0NGOEJBMDE0QTk4OUUwOTgA"}}
[2025-07-06 00:49:06] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T00:49:06.731928", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1056606e0>", "text": "Этот (ответ на сообщение: [текст исходного сообщения]) (ответ на: Clouds\n2 400,00 ฿ 🌸)", "user_lang": "ru"}}
[2025-07-06 00:49:06] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:49:06.732795", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1056606e0>", "text": "Этот (ответ на сообщение: [текст исходного сообщения]) (ответ на: Clouds\n2 400,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 00:49:10] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:49:10.195983", "execution_time_ms": 3462.91, "result": "This (reply to message: [original message text]) (reply to: Clouds 2 400,00 ฿ 🌸)"}
[2025-07-06 00:49:10] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:49:10.196670", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1056606e0>", "text": "Этот (ответ на сообщение: [текст исходного сообщения]) (ответ на: Clouds\n2 400,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 00:49:21] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:49:21.446296", "execution_time_ms": 11249.17, "result": "Этот (ответ на сообщение: [текст исходного сообщения]) (ответ на: Clouds\n2 400,00 ฿ 🌸)"}
[2025-07-06 00:49:21] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T00:49:21.448173", "execution_time_ms": 14715.45, "result": ["Этот (ответ на сообщение: [текст исходного сообщения]) (ответ на: Clouds\n2 400,00 ฿ 🌸)", "This (reply to message: [original message text]) (reply to: Clouds 2 400,00 ฿ 🌸)", "Этот (ответ на сообщение: [текст исходного сообщения]) (ответ на: Clouds\n2 400,00 ฿ 🌸)"]}
[2025-07-06 00:49:22] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:49:22.333541", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1056606e0>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 6, 0, 49, 22, 332792), content_en='Hello!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 0, 49, 22, 332830), content_en='Yes', content_thai='ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\n\\nСейчас я покажу вам каждый букет с фотографией.\\nПожалуйста, подождите немного... 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 49, 22, 332837), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 49, 22, 332841), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 49, 22, 332877), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 49, 22, 332883), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 49, 22, 332886), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty \\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 49, 22, 332889), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Этот (ответ на сообщение: [текст исходного сообщения]) (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 0, 49, 22, 332892), content_en='This (reply to message: [original message text]) (reply to: Clouds 2 400,00 ฿ 🌸)', content_thai='Этот (ответ на сообщение: [текст исходного сообщения]) (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:49:25] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:49:25.335944", "execution_time_ms": 3001.38, "result": ["Букет 'Clouds' выбран.\\n\\nВам потребуется доставка?", "The 'Clouds' bouquet has been selected.\\n\\nDo you need delivery?", "ได้เลือกช่อดอกไม้ 'Clouds' แล้วค่ะ\\n\\nคุณต้องการบริการจัดส่งไหมคะ?", {"type": "save_order_info", "bouquet": "Clouds", "retailer_id": "uztv8n7g9i"}]}
[2025-07-06 00:49:28] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:49:28.863183", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1055a6fd0>", "to_number": "79140775712", "content": "Букет 'Clouds' выбран.\\n\\nВам потребуется доставка?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": null, "sender_id": null, "content_en": null, "content_thai": null}}
[2025-07-06 00:49:29] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:49:29] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:49:29.642656", "execution_time_ms": 778.45, "result": true}
[2025-07-06 00:49:29] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:49:29.644123", "execution_time_ms": 35922.43, "result": true}
[2025-07-06 00:51:53] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:51:53.377590", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10729ae90>", "sender_id": "79140775712", "message_text": "да", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTQwN0Q0MTc5Rjg0NEYxMEE5QQA=", "message_type": "text", "timestamp": "1751737908"}, "sender_name": "Denis Drobotenko", "reply_to_message_id": null}}
[2025-07-06 00:52:03] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T00:52:03.265922", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1075086e0>", "text": "да", "user_lang": "ru"}}
[2025-07-06 00:52:03] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:52:03.266612", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1075086e0>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 00:52:05] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:52:05.153525", "execution_time_ms": 1886.75, "result": "yes"}
[2025-07-06 00:52:05] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:52:05.153966", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1075086e0>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 00:52:15] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:52:15.123344", "execution_time_ms": 9968.52, "result": "ใช่"}
[2025-07-06 00:52:15] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T00:52:15.124824", "execution_time_ms": 11858.24, "result": ["да", "yes", "ใช่"]}
[2025-07-06 00:52:16] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:52:16.682136", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1075086e0>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 6, 0, 52, 16, 681775), content_en='Hello!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 0, 52, 16, 681803), content_en='Yes', content_thai='ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\n\\nСейчас я покажу вам каждый букет с фотографией.\\nПожалуйста, подождите немного... 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 52, 16, 681820), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 52, 16, 681824), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 52, 16, 681827), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 52, 16, 681831), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 52, 16, 681834), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty \\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 52, 16, 681837), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Этот (ответ на сообщение: [текст исходного сообщения]) (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 0, 52, 16, 681840), content_en='This (reply to message: [original message text]) (reply to: Clouds 2 400,00 ฿ 🌸)', content_thai='Этот (ответ на сообщение: [текст исходного сообщения]) (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 0, 52, 16, 681842), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:52:21] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:52:21.159478", "execution_time_ms": 4476.29, "result": ["Ваш букет 'Clouds' сохранен.\\n\\nВам нужна доставка?", "Your bouquet 'Clouds' has been saved.\\n\\nDo you need delivery?", "ช่อดอกไม้ 'Clouds' ของคุณถูกบันทึกแล้วค่ะ\\n\\nคุณต้องการจัดส่งไหมคะ?", {"type": "save_order_info", "bouquet": "Clouds", "retailer_id": "uztv8n7g9i"}]}
[2025-07-06 00:52:24] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:52:24.655362", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10729ae90>", "to_number": "79140775712", "content": "Ваш букет 'Clouds' сохранен.\\n\\nВам нужна доставка?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": null, "sender_id": null, "content_en": null, "content_thai": null}}
[2025-07-06 00:52:25] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:52:25] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:52:25.462837", "execution_time_ms": 806.69, "result": true}
[2025-07-06 00:52:25] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:52:25.464399", "execution_time_ms": 32085.34, "result": true}
[2025-07-06 00:59:13] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:59:13.496103", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x109e8b110>", "sender_id": "79140775712", "message_text": "да", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUMwQzFCNjU1RkU3MzZFMzgyMgA=", "message_type": "text", "timestamp": "1751738349"}, "sender_name": "Denis Drobotenko", "reply_to_message_id": null}}
[2025-07-06 00:59:22] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T00:59:22.797261", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109f2c830>", "text": "да", "user_lang": "ru"}}
[2025-07-06 00:59:22] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:59:22.799219", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109f2c830>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 00:59:23] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:59:23.811926", "execution_time_ms": 1012.42, "result": "yes"}
[2025-07-06 00:59:23] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:59:23.813662", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109f2c830>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 00:59:31] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T00:59:31.551096", "execution_time_ms": 7736.8, "result": "ใช่"}
[2025-07-06 00:59:31] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T00:59:31.552409", "execution_time_ms": 8753.27, "result": ["да", "yes", "ใช่"]}
[2025-07-06 00:59:32] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:59:32.953385", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109f2c830>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 6, 0, 59, 32, 953190), content_en='Hello!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 0, 59, 32, 953209), content_en='Yes', content_thai='ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\n\\nСейчас я покажу вам каждый букет с фотографией.\\nПожалуйста, подождите немного... 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 59, 32, 953214), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 59, 32, 953216), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 59, 32, 953218), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 59, 32, 953220), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 59, 32, 953222), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty \\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 0, 59, 32, 953224), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Этот (ответ на сообщение: [текст исходного сообщения]) (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 0, 59, 32, 953226), content_en='This (reply to message: [original message text]) (reply to: Clouds 2 400,00 ฿ 🌸)', content_thai='Этот (ответ на сообщение: [текст исходного сообщения]) (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 0, 59, 32, 953228), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 00:59:38] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T00:59:38.688067", "execution_time_ms": 5732.64, "result": ["Отлично, я отметила, что доставка нужна.\\n\\nСтоимость доставки по Пхукету:\\n\\nРаваи: 500 бат\\nЧалонг: 380 бат\\nПхукет-Таун: 300 бат\\nКату: 280 бат\\nПатонг: 400 бат\\nБанг Тао: 500 бат\\nЛагуна: 500 бат\\nТаланг/Май Кхао: 550 бат\\n\\nПожалуйста, укажите полный адрес доставки.", "Excellent, I've noted that delivery is needed.\\n\\nDelivery cost across Phuket:\\n\\nRawai: 500 baht\\nChalong: 380 baht\\nPhuket Town: 300 baht\\nKathu: 280 baht\\nPatong: 400 baht\\nBang Tao: 500 baht\\nLaguna: 500 baht\\nThalang/Mai Khao: 550 baht\\n\\nPlease provide the full delivery address.", "เยี่ยมมากค่ะ ฉันได้บันทึกไว้ว่าต้องการจัดส่ง\\n\\nค่าจัดส่งทั่วภูเก็ต:\\n\\nราไวย์: 500 บาท\\nฉลอง: 380 บาท\\nภูเก็ตทาวน์: 300 บาท\\nกะทู้: 280 บาท\\nป่าตอง: 400 บาท\\nบางเทา: 500 บาท\\nลากูน่า: 500 บาท\\nถลาง/ไม้ขาว: 550 บาท\\n\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ", {"type": "save_order_info", "bouquet": "Clouds", "retailer_id": "uztv8n7g9i", "delivery_needed": true}]}
[2025-07-06 00:59:42] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:59:42.144374", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x109e8b110>", "to_number": "79140775712", "content": "Отлично, я отметила, что доставка нужна.\\n\\nСтоимость доставки по Пхукету:\\n\\nРаваи: 500 бат\\nЧалонг: 380 бат\\nПхукет-Таун: 300 бат\\nКату: 280 бат\\nПатонг: 400 бат\\nБанг Тао: 500 бат\\nЛагуна: 500 бат\\nТаланг/Май Кхао: 550 бат\\n\\nПожалуйста, укажите полный адрес доставки.", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": null, "sender_id": null, "content_en": null, "content_thai": null}}
[2025-07-06 00:59:42] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 00:59:42] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T00:59:42.978306", "execution_time_ms": 833.65, "result": true}
[2025-07-06 00:59:42] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T00:59:42.979970", "execution_time_ms": 29482.25, "result": true}
[2025-07-06 01:00:20] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:00:20.553111", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x109e8b9d0>", "sender_id": "79140775712", "message_text": "centrio condo", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUE0ODI2MUU2QURENEFGQUZBNwA=", "message_type": "text", "timestamp": "1751738416"}, "sender_name": "Denis Drobotenko", "reply_to_message_id": null}}
[2025-07-06 01:00:31] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:00:31.100161", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109e8a850>", "text": "centrio condo", "user_lang": "ru"}}
[2025-07-06 01:00:31] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:00:31.101708", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109e8a850>", "text": "centrio condo", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 01:00:32] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:00:32.410792", "execution_time_ms": 1308.74, "result": "centrio condo"}
[2025-07-06 01:00:32] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:00:32.411344", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109e8a850>", "text": "centrio condo", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 01:00:34] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:00:34.632462", "execution_time_ms": 2220.7, "result": "เซนทริโอ คอนโด"}
[2025-07-06 01:00:34] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:00:34.632865", "execution_time_ms": 3531.31, "result": ["centrio condo", "centrio condo", "เซนทริโอ คอนโด"]}
[2025-07-06 01:00:35] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:00:35.896729", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109e8a850>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 6, 1, 0, 35, 896481), content_en='Hello!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 1, 0, 35, 896520), content_en='Yes', content_thai='ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\n\\nСейчас я покажу вам каждый букет с фотографией.\\nПожалуйста, подождите немного... 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 0, 35, 896527), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 0, 35, 896531), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 0, 35, 896534), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 0, 35, 896538), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 0, 35, 896541), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty \\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 0, 35, 896545), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Этот (ответ на сообщение: [текст исходного сообщения]) (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 1, 0, 35, 896548), content_en='This (reply to message: [original message text]) (reply to: Clouds 2 400,00 ฿ 🌸)', content_thai='Этот (ответ на сообщение: [текст исходного сообщения]) (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 1, 0, 35, 896551), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 01:00:43] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:00:43.156872", "execution_time_ms": 7258.79, "result": ["Ваш букет 'Clouds' сохранен.\\n\\nВам нужна доставка?", "Your bouquet 'Clouds' is saved.\\n\\nDo you need delivery?", "บันทึกช่อดอกไม้ 'Clouds' ของคุณแล้วค่ะ\\n\\nคุณต้องการจัดส่งไหมคะ?", {"type": "save_order_info", "bouquet": "Clouds", "retailer_id": "uztv8n7g9i"}]}
[2025-07-06 01:00:46] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:00:46.867143", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x109e8b9d0>", "to_number": "79140775712", "content": "Ваш букет 'Clouds' сохранен.\\n\\nВам нужна доставка?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": null, "sender_id": null, "content_en": null, "content_thai": null}}
[2025-07-06 01:00:47] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:00:47] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:00:47.684582", "execution_time_ms": 816.89, "result": true}
[2025-07-06 01:00:47] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:00:47.685448", "execution_time_ms": 27131.53, "result": true}
[2025-07-06 01:05:48] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:05:48.782605", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a04f110>", "sender_id": "79140775712", "message_text": "Привет", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUI5MzMyMjUwRjgzNjFENERFNgA=", "message_type": "text", "timestamp": "1751738744"}, "sender_name": "Denis Drobotenko", "reply_to_message_id": null}}
[2025-07-06 01:05:58] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T01:05:58.393342", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a1086e0>", "text": "Привет"}}
[2025-07-06 01:05:58] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T01:05:58.395613", "execution_time_ms": 0.58, "result": "ru"}
[2025-07-06 01:05:58] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:05:58.621623", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a1086e0>", "text": "Привет", "user_lang": "ru"}}
[2025-07-06 01:05:58] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:05:58.622412", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a1086e0>", "text": "Привет", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 01:05:59] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:05:59.700520", "execution_time_ms": 1077.88, "result": "Hello"}
[2025-07-06 01:05:59] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:05:59.701085", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a1086e0>", "text": "Привет", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 01:06:00] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:06:00.576909", "execution_time_ms": 875.47, "result": "สวัสดี"}
[2025-07-06 01:06:00] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:06:00.577722", "execution_time_ms": 1955.34, "result": ["Привет", "Hello", "สวัสดี"]}
[2025-07-06 01:06:02] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:06:02.091553", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a1086e0>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 1, 6, 2, 91442), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 01:06:05] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:06:05.965446", "execution_time_ms": 3872.34, "result": ["Доброй ночи, Денис!\\n\\nХотели бы Вы посмотреть наш каталог цветов?", "Good night, Denis!\\n\\nWould you like to see our flower catalog?", "ราตรีสวัสดิ์ค่ะ Denis!\\n\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ", null]}
[2025-07-06 01:06:05] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:06:05.967365", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a04f110>", "to_number": "79140775712", "content": "Доброй ночи, Денис!\\n\\nХотели бы Вы посмотреть наш каталог цветов?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": "Good night, Denis!\\n\\nWould you like to see our flower catalog?", "content_thai": "ราตรีสวัสดิ์ค่ะ Denis!\\n\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ"}}
[2025-07-06 01:06:07] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:06:08] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:06:08.735672", "execution_time_ms": 2768.07, "result": true}
[2025-07-06 01:06:08] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:06:08.737777", "execution_time_ms": 19954.33, "result": true}
[2025-07-06 01:06:19] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:06:19.289515", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a04fb10>", "sender_id": "79140775712", "message_text": "да", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTVDMkZEQTM0QkU4RDEzQUExRQA=", "message_type": "text", "timestamp": "1751738775"}, "sender_name": "Denis Drobotenko", "reply_to_message_id": null}}
[2025-07-06 01:06:28] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T01:06:28.945040", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a04f110>", "text": "да"}}
[2025-07-06 01:06:28] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T01:06:28.946599", "execution_time_ms": 0.33, "result": "ru"}
[2025-07-06 01:06:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:06:29.314436", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a04f110>", "text": "да", "user_lang": "ru"}}
[2025-07-06 01:06:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:06:29.315332", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a04f110>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 01:06:30] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:06:30.364196", "execution_time_ms": 1048.46, "result": "yes"}
[2025-07-06 01:06:30] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:06:30.364802", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a04f110>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 01:06:38] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:06:38.456883", "execution_time_ms": 8091.51, "result": "ค่ะ"}
[2025-07-06 01:06:38] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:06:38.471326", "execution_time_ms": 9156.09, "result": ["да", "yes", "ค่ะ"]}
[2025-07-06 01:06:40] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:06:40.034765", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a04f110>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 1, 6, 40, 31479), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи, Денис!\\\\n\\\\nХотели бы Вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 6, 40, 32084), content_en='Good night, Denis!\\\\n\\\\nWould you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์ค่ะ Denis!\\\\n\\\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 1, 6, 40, 32089), content_en='yes', content_thai='ค่ะ', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 01:06:44] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:06:44.519182", "execution_time_ms": 4482.71, "result": ["Я покажу Вам каждый букет с фотографией!\\n\\nПожалуйста, подождите минутку...", "I will show you each bouquet with a photo!\\n\\nPlease wait a moment...", "ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณ!\\n\\nโปรดรอสักครู่...", {"type": "send_catalog"}]}
[2025-07-06 01:06:48] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 01:06:48] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 01:06:49] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 01:06:49] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-06 01:06:49] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:06:49.121575", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108e957f0>", "to_number": "79140775712", "content": "Love is on the air\n2 200,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/503765845_1222228859683151_4028827634893880558_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=sb7DUXn5wNAQ7kNvwHJc5Vs&_nc_oc=AdmOxoDXIxrkBjHtpsTcXkZgXV7jH82e_PPl2FAXoCOH3grfE1PamTUm0WMVsCbWOiMSp5C79nMN6lQbVtaelKoD&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=xskIwlQTInb5xOMzixaoAw&oh=00_AfQ5e9DyHayLP7OOvw_TBVbEXDFY8dDeElX3Q9sErD0w3Q&oe=686F30CA"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 01:06:51] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:06:52] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:06:52.906463", "execution_time_ms": 3784.05, "result": true}
[2025-07-06 01:06:52] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-06 01:06:52] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:06:52.907255", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108e957f0>", "to_number": "79140775712", "content": "Good vibes🌸\n2 350,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/511947769_2130442957421658_3783812242789464194_n.jpg?_nc_cat=109&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=VaAlBK3MuWcQ7kNvwHogCDm&_nc_oc=AdnUzVnOUYaHvO4I4_0frRo0aQYlyGA4jjbTJPe49BEIkEo6eRND_bzXFzQWkP4GMSNTS4tmLthT636eFMBcbLpB&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=xskIwlQTInb5xOMzixaoAw&oh=00_AfSobfIWbZ7-MLg4McGdmTuc-z_e0_jgpyEJz0uGKyTS6Q&oe=686F337D"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 01:06:53] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:06:54] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:06:54.198417", "execution_time_ms": 1290.86, "result": true}
[2025-07-06 01:06:54] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-06 01:06:54] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:06:54.199095", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108e957f0>", "to_number": "79140775712", "content": "Clouds\n2 400,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513288773_3083699665127219_1955152157776052338_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=lZG4SBZGUpIQ7kNvwH7bJIs&_nc_oc=Adm1ilZgCtJ1rQLnfYCXpOgKsczuH9KLtnBjR2yFiSHV43K743WUOr07yG9ly3kFmS3DAjvofLUp7VAKd8BZnh_p&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=xskIwlQTInb5xOMzixaoAw&oh=00_AfSqpADbk_eS-eXEo7g0amc_8fX9WStIgHcfruDTCvqOXg&oe=686F4CE8"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 01:06:55] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:06:55] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:06:55.653255", "execution_time_ms": 1453.83, "result": true}
[2025-07-06 01:06:55] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-06 01:06:55] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:06:55.654146", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108e957f0>", "to_number": "79140775712", "content": "Candy’s\n1 450,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513521068_1203881994842049_840424551106600581_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=i-cncoMZAXwQ7kNvwHWHy8f&_nc_oc=AdkHkGfaT-HYLERdInl2JW7G0LOvLTinf22KPRCsyGaveSaJ8NZDPbbGk0E-8M10XwBKRGryKrZiSnviG0Uzf1om&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=xskIwlQTInb5xOMzixaoAw&oh=00_AfRS4dMBOhfXjsSUA0ZGOKd6aRuEvVJCSom6W2wbkixvhg&oe=686F4966"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 01:06:56] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:06:56] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:06:56.884163", "execution_time_ms": 1229.12, "result": true}
[2025-07-06 01:06:56] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-06 01:06:56] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:06:56.886375", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108e957f0>", "to_number": "79140775712", "content": "Pretty 😍\n2 600,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513058785_748208634241719_9170859285232997266_n.jpg?_nc_cat=106&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=-kFXCnhe93kQ7kNvwFyUk9S&_nc_oc=AdmNwD11W_gUAmJfYFtowZRpCN6hm7C0Zy386eF8VfovjuFC8K-2lqvPIBSIWSIWNRqlg47PyBzQhb36M828BAwy&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=xskIwlQTInb5xOMzixaoAw&oh=00_AfQ5-LoH2Fhkisv50kQu4WuZ4LSwvWjcC8EbKtIDC6Ryeg&oe=686F21AC"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 01:06:57] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:06:58] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:06:58.352559", "execution_time_ms": 1466.0, "result": true}
[2025-07-06 01:06:58] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79140775712
[2025-07-06 01:06:58] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:06:58.353518", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a04fb10>", "to_number": "79140775712", "content": "Я покажу Вам каждый букет с фотографией!\\n\\nПожалуйста, подождите минутку...", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": "I will show you each bouquet with a photo!\\n\\nPlease wait a moment...", "content_thai": "ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณ!\\n\\nโปรดรอสักครู่..."}}
[2025-07-06 01:06:59] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:07:00] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:07:00.546828", "execution_time_ms": 2193.03, "result": true}
[2025-07-06 01:07:00] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:07:00.547802", "execution_time_ms": 41257.76, "result": true}
[2025-07-06 01:08:16] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:08:16.524814", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a02bbb0>", "sender_id": "79140775712", "message_text": "этот", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUIyRUMxMDE0QjczMTlCOTQwRAA=", "message_type": "text", "timestamp": "1751738892"}, "sender_name": "Denis Drobotenko", "reply_to_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJDMUEwRkQ0NDVBM0ZFRDRDNzAA"}}
[2025-07-06 01:08:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:08:29.154282", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a04f890>", "text": "этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "user_lang": "ru"}}
[2025-07-06 01:08:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:08:29.156038", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a04f890>", "text": "этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 01:08:30] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:08:30.776313", "execution_time_ms": 1619.92, "result": "This (reply to: Candy’s\n1,450.00 ฿ 🌸)"}
[2025-07-06 01:08:30] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:08:30.777197", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a04f890>", "text": "этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 01:08:35] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:08:35.885343", "execution_time_ms": 5107.62, "result": "นี่ (ตอบกลับถึง: Candy’s 1,450.00 ฿ 🌸)"}
[2025-07-06 01:08:35] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:08:35.887243", "execution_time_ms": 6731.28, "result": ["этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "This (reply to: Candy’s\n1,450.00 ฿ 🌸)", "นี่ (ตอบกลับถึง: Candy’s 1,450.00 ฿ 🌸)"]}
[2025-07-06 01:08:37] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:08:37.032722", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a04f890>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 1, 8, 37, 32334), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи, Денис!\\\\n\\\\nХотели бы Вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 8, 37, 32372), content_en='Good night, Denis!\\\\n\\\\nWould you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์ค่ะ Denis!\\\\n\\\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 1, 8, 37, 32378), content_en='yes', content_thai='ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 8, 37, 32382), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 8, 37, 32384), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 8, 37, 32387), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 8, 37, 32389), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty \\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 8, 37, 32392), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Я покажу Вам каждый букет с фотографией!\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 8, 37, 32395), content_en='I will show you each bouquet with a photo!\\\\n\\\\nPlease wait a moment...', content_thai='ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณ!\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='этот (ответ на: Candy’s\\n1\\xa0450,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 1, 8, 37, 32398), content_en='This (reply to: Candy’s\\n1,450.00 ฿ 🌸)', content_thai='นี่ (ตอบกลับถึง: Candy’s 1,450.00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 01:08:40] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:08:40.811599", "execution_time_ms": 3777.78, "result": ["Букет 'Candy’s' сохранен.\\n\\nВам нужна доставка?", "The 'Candy’s' bouquet is saved.\\n\\nDo you need delivery?", "บันทึกช่อดอกไม้ 'Candy’s' แล้วค่ะ\\n\\nคุณต้องการจัดส่งหรือไม่คะ", {"type": "save_order_info", "bouquet": "Candy’s", "retailer_id": "t8bpd4wssw"}]}
[2025-07-06 01:08:44] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:08:44.409579", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a02bbb0>", "to_number": "79140775712", "content": "Букет 'Candy’s' сохранен.\\n\\nВам нужна доставка?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": "The 'Candy’s' bouquet is saved.\\n\\nDo you need delivery?", "content_thai": "บันทึกช่อดอกไม้ 'Candy’s' แล้วค่ะ\\n\\nคุณต้องการจัดส่งหรือไม่คะ"}}
[2025-07-06 01:08:45] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:08:46] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:08:46.945755", "execution_time_ms": 2535.47, "result": true}
[2025-07-06 01:08:46] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:08:46.947587", "execution_time_ms": 30421.72, "result": true}
[2025-07-06 01:08:59] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:08:59.319711", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a02aea0>", "sender_id": "79140775712", "message_text": "да", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTE4QjBGNThBRDUyQTU5RURCQQA=", "message_type": "text", "timestamp": "1751738934"}, "sender_name": "Denis Drobotenko", "reply_to_message_id": null}}
[2025-07-06 01:09:08] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:09:08.536227", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a02ab10>", "text": "да", "user_lang": "ru"}}
[2025-07-06 01:09:08] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:09:08.538112", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a02ab10>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 01:09:09] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:09:09.655292", "execution_time_ms": 1116.93, "result": "yes"}
[2025-07-06 01:09:09] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:09:09.655712", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a02ab10>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 01:09:12] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:09:12.565106", "execution_time_ms": 2909.05, "result": "ใช่"}
[2025-07-06 01:09:12] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:09:12.565801", "execution_time_ms": 4027.76, "result": ["да", "yes", "ใช่"]}
[2025-07-06 01:09:13] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:09:13.959414", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a02ab10>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 1, 9, 13, 959267), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи, Денис!\\\\n\\\\nХотели бы Вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 9, 13, 959276), content_en='Good night, Denis!\\\\n\\\\nWould you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์ค่ะ Denis!\\\\n\\\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 1, 9, 13, 959277), content_en='yes', content_thai='ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 9, 13, 959279), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 9, 13, 959280), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 9, 13, 959282), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 9, 13, 959283), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty \\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 9, 13, 959284), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Я покажу Вам каждый букет с фотографией!\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 9, 13, 959285), content_en='I will show you each bouquet with a photo!\\\\n\\\\nPlease wait a moment...', content_thai='ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณ!\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='этот (ответ на: Candy’s\\n1\\xa0450,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 1, 9, 13, 959286), content_en='This (reply to: Candy’s\\n1,450.00 ฿ 🌸)', content_thai='นี่ (ตอบกลับถึง: Candy’s 1,450.00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 01:09:17] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:09:17.949065", "execution_time_ms": 3986.56, "result": ["Ваш букет 'Candy’s' сохранен.\\n\\nВам нужна доставка?", "Your bouquet 'Candy’s' has been saved.\\n\\nDo you need delivery?", "ช่อดอกไม้ 'Candy’s' ของคุณถูกบันทึกแล้วค่ะ\\n\\nคุณต้องการบริการจัดส่งหรือไม่คะ?", {"type": "save_order_info", "bouquet": "Candy’s", "retailer_id": "t8bpd4wssw"}]}
[2025-07-06 01:09:21] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:09:21.388441", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a02aea0>", "to_number": "79140775712", "content": "Ваш букет 'Candy’s' сохранен.\\n\\nВам нужна доставка?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": "Your bouquet 'Candy’s' has been saved.\\n\\nDo you need delivery?", "content_thai": "ช่อดอกไม้ 'Candy’s' ของคุณถูกบันทึกแล้วค่ะ\\n\\nคุณต้องการบริการจัดส่งหรือไม่คะ?"}}
[2025-07-06 01:09:23] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:09:24] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:09:24.064212", "execution_time_ms": 2674.24, "result": true}
[2025-07-06 01:09:24] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:09:24.065167", "execution_time_ms": 24744.75, "result": true}
[2025-07-06 01:19:09] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:19:09.420208", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108ec7ad0>", "sender_id": "79140775712", "message_text": "Привет", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTY1OEE4OTNGREQzMUY5RkNGMAA=", "message_type": "text", "timestamp": "1751739544"}, "sender_name": "Denis Drobotenko", "reply_to_message_id": null}}
[2025-07-06 01:19:19] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T01:19:19.486424", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a02b950>", "text": "Привет"}}
[2025-07-06 01:19:19] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T01:19:19.487273", "execution_time_ms": 0.26, "result": "ru"}
[2025-07-06 01:19:19] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:19:19.727709", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a02b950>", "text": "Привет", "user_lang": "ru"}}
[2025-07-06 01:19:19] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:19:19.728661", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a02b950>", "text": "Привет", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 01:19:20] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:19:20.783835", "execution_time_ms": 1054.79, "result": "Hello"}
[2025-07-06 01:19:20] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:19:20.784365", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a02b950>", "text": "Привет", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 01:19:21] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:19:21.827244", "execution_time_ms": 1042.65, "result": "สวัสดี"}
[2025-07-06 01:19:21] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:19:21.827654", "execution_time_ms": 2099.1, "result": ["Привет", "Hello", "สวัสดี"]}
[2025-07-06 01:19:23] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:19:23.354634", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a02b950>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 1, 19, 23, 354533), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 01:19:27] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:19:27.690888", "execution_time_ms": 4335.7, "result": ["Доброй ночи, Денис Дроботенко! Хотите посмотреть наш каталог цветов?", "Good night, Denis Drobotenko! Would you like to see our flower catalog?", "ราตรีสวัสดิ์, เดนิส โดรโบเตนโก! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหม?", null]}
[2025-07-06 01:19:27] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:19:27.693009", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108ec7ad0>", "to_number": "79140775712", "content": "Доброй ночи, Денис Дроботенко! Хотите посмотреть наш каталог цветов?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": "Good night, Denis Drobotenko! Would you like to see our flower catalog?", "content_thai": "ราตรีสวัสดิ์, เดนิส โดรโบเตนโก! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหม?"}}
[2025-07-06 01:19:29] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:19:30] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:19:30.459656", "execution_time_ms": 2766.38, "result": true}
[2025-07-06 01:19:30] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:19:30.460950", "execution_time_ms": 21039.94, "result": true}
[2025-07-06 01:19:45] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:19:45.690198", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a033790>", "sender_id": "79140775712", "message_text": "Да", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUNCMDE3RUYwNjg4RTYzQzdDNgA=", "message_type": "text", "timestamp": "1751739580"}, "sender_name": "Denis Drobotenko", "reply_to_message_id": null}}
[2025-07-06 01:19:55] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T01:19:55.040775", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a0d95b0>", "text": "Да"}}
[2025-07-06 01:19:55] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T01:19:55.042802", "execution_time_ms": 0.08, "result": "ru"}
[2025-07-06 01:19:55] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:19:55.228068", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a0d95b0>", "text": "Да", "user_lang": "ru"}}
[2025-07-06 01:19:55] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:19:55.228674", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a0d95b0>", "text": "Да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 01:19:57] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:19:57.173523", "execution_time_ms": 1944.55, "result": "Yes"}
[2025-07-06 01:19:57] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:19:57.174033", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a0d95b0>", "text": "Да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 01:20:05] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:20:05.541940", "execution_time_ms": 8367.28, "result": "ค่ะ"}
[2025-07-06 01:20:05] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:20:05.544120", "execution_time_ms": 10315.5, "result": ["Да", "Yes", "ค่ะ"]}
[2025-07-06 01:20:06] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:20:06.874812", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a0d95b0>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 1, 20, 6, 874691), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи, Денис Дроботенко! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 20, 6, 874698), content_en='Good night, Denis Drobotenko! Would you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์, เดนิส โดรโบเตนโก! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหม?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 1, 20, 6, 874700), content_en='Yes', content_thai='ค่ะ', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 01:20:10] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:20:10.588213", "execution_time_ms": 3713.05, "result": ["Отлично! Сейчас я покажу вам каждый букет с фотографией.\\n\\nПожалуйста, подождите минутку...", "Excellent! I will now show you each bouquet with a photo.\\n\\nPlease wait a moment...", "ยอดเยี่ยม! ตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูค่ะ\\n\\nกรุณารอสักครู่นะคะ...", {"type": "send_catalog"}]}
[2025-07-06 01:20:13] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 01:20:13] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 01:20:13] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 01:20:13] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-06 01:20:13] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:20:13.517182", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108e957f0>", "to_number": "79140775712", "content": "Love is on the air\n2 200,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/503765845_1222228859683151_4028827634893880558_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=sb7DUXn5wNAQ7kNvwHJc5Vs&_nc_oc=AdmOxoDXIxrkBjHtpsTcXkZgXV7jH82e_PPl2FAXoCOH3grfE1PamTUm0WMVsCbWOiMSp5C79nMN6lQbVtaelKoD&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=xskIwlQTInb5xOMzixaoAw&oh=00_AfQ5e9DyHayLP7OOvw_TBVbEXDFY8dDeElX3Q9sErD0w3Q&oe=686F30CA"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 01:20:15] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:20:15] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:20:15.937028", "execution_time_ms": 2419.54, "result": true}
[2025-07-06 01:20:15] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-06 01:20:15] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:20:15.940024", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108e957f0>", "to_number": "79140775712", "content": "Good vibes🌸\n2 350,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/511947769_2130442957421658_3783812242789464194_n.jpg?_nc_cat=109&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=VaAlBK3MuWcQ7kNvwHogCDm&_nc_oc=AdnUzVnOUYaHvO4I4_0frRo0aQYlyGA4jjbTJPe49BEIkEo6eRND_bzXFzQWkP4GMSNTS4tmLthT636eFMBcbLpB&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=xskIwlQTInb5xOMzixaoAw&oh=00_AfSobfIWbZ7-MLg4McGdmTuc-z_e0_jgpyEJz0uGKyTS6Q&oe=686F337D"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 01:20:16] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:20:17] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:20:17.111301", "execution_time_ms": 1171.18, "result": true}
[2025-07-06 01:20:17] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-06 01:20:17] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:20:17.111703", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108e957f0>", "to_number": "79140775712", "content": "Clouds\n2 400,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513288773_3083699665127219_1955152157776052338_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=lZG4SBZGUpIQ7kNvwH7bJIs&_nc_oc=Adm1ilZgCtJ1rQLnfYCXpOgKsczuH9KLtnBjR2yFiSHV43K743WUOr07yG9ly3kFmS3DAjvofLUp7VAKd8BZnh_p&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=xskIwlQTInb5xOMzixaoAw&oh=00_AfSqpADbk_eS-eXEo7g0amc_8fX9WStIgHcfruDTCvqOXg&oe=686F4CE8"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 01:20:18] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:20:18] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:20:18.369516", "execution_time_ms": 1257.63, "result": true}
[2025-07-06 01:20:18] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-06 01:20:18] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:20:18.369806", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108e957f0>", "to_number": "79140775712", "content": "Candy’s\n1 450,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513521068_1203881994842049_840424551106600581_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=i-cncoMZAXwQ7kNvwHWHy8f&_nc_oc=AdkHkGfaT-HYLERdInl2JW7G0LOvLTinf22KPRCsyGaveSaJ8NZDPbbGk0E-8M10XwBKRGryKrZiSnviG0Uzf1om&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=xskIwlQTInb5xOMzixaoAw&oh=00_AfRS4dMBOhfXjsSUA0ZGOKd6aRuEvVJCSom6W2wbkixvhg&oe=686F4966"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 01:20:19] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:20:19] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:20:19.556264", "execution_time_ms": 1186.34, "result": true}
[2025-07-06 01:20:19] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-06 01:20:19] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:20:19.556598", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108e957f0>", "to_number": "79140775712", "content": "Pretty 😍\n2 600,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513058785_748208634241719_9170859285232997266_n.jpg?_nc_cat=106&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=-kFXCnhe93kQ7kNvwFyUk9S&_nc_oc=AdmNwD11W_gUAmJfYFtowZRpCN6hm7C0Zy386eF8VfovjuFC8K-2lqvPIBSIWSIWNRqlg47PyBzQhb36M828BAwy&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=xskIwlQTInb5xOMzixaoAw&oh=00_AfQ5-LoH2Fhkisv50kQu4WuZ4LSwvWjcC8EbKtIDC6Ryeg&oe=686F21AC"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 01:20:20] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:20:20] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:20:20.683444", "execution_time_ms": 1126.77, "result": true}
[2025-07-06 01:20:20] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79140775712
[2025-07-06 01:20:20] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:20:20.683799", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a033790>", "to_number": "79140775712", "content": "Отлично! Сейчас я покажу вам каждый букет с фотографией.\\n\\nПожалуйста, подождите минутку...", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": "Excellent! I will now show you each bouquet with a photo.\\n\\nPlease wait a moment...", "content_thai": "ยอดเยี่ยม! ตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูค่ะ\\n\\nกรุณารอสักครู่นะคะ..."}}
[2025-07-06 01:20:21] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:20:22] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:20:22.483346", "execution_time_ms": 1799.43, "result": true}
[2025-07-06 01:20:22] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:20:22.483974", "execution_time_ms": 36792.83, "result": true}
[2025-07-06 01:21:18] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:21:18.662525", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a033f00>", "sender_id": "79140775712", "message_text": "Этот", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTVBNDU5MDBCMjNCNEJCMThCNwA=", "message_type": "text", "timestamp": "1751739674"}, "sender_name": "Denis Drobotenko", "reply_to_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI5NTkxNDZBMUJFRjJBMzBEM0UA"}}
[2025-07-06 01:21:31] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:21:31.387703", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a033df0>", "text": "Этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "user_lang": "ru"}}
[2025-07-06 01:21:31] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:21:31.388963", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a033df0>", "text": "Этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 01:21:32] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:21:32.985744", "execution_time_ms": 1596.57, "result": "This (reply to: Candy’s\n1,450.00 ฿ 🌸)"}
[2025-07-06 01:21:32] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:21:32.986262", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a033df0>", "text": "Этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 01:21:42] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:21:42.798748", "execution_time_ms": 9812.06, "result": "ตอบกลับ: ของ Candy\n1,450.00 ฿ 🌸"}
[2025-07-06 01:21:42] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:21:42.800474", "execution_time_ms": 11411.54, "result": ["Этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "This (reply to: Candy’s\n1,450.00 ฿ 🌸)", "ตอบกลับ: ของ Candy\n1,450.00 ฿ 🌸"]}
[2025-07-06 01:21:43] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:21:43.566028", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a033df0>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 1, 21, 43, 565769), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи, Денис Дроботенко! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 21, 43, 565782), content_en='Good night, Denis Drobotenko! Would you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์, เดนิส โดรโบเตนโก! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหม?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 1, 21, 43, 565786), content_en='Yes', content_thai='ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 21, 43, 565789), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 21, 43, 565793), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 21, 43, 565796), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 21, 43, 565799), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty \\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 21, 43, 565802), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично! Сейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 21, 43, 565805), content_en='Excellent! I will now show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม! ตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูค่ะ\\\\n\\\\nกรุณารอสักครู่นะคะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Candy’s\\n1\\xa0450,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 1, 21, 43, 565807), content_en='This (reply to: Candy’s\\n1,450.00 ฿ 🌸)', content_thai='ตอบกลับ: ของ Candy\\n1,450.00 ฿ 🌸', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 01:21:49] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:21:49.449211", "execution_time_ms": 5882.17, "result": ["Букет 'Candy’s' сохранен.\\n\\nВам нужна доставка?", "The 'Candy’s' bouquet is saved.\\n\\nDo you need delivery?", "บันทึกช่อดอกไม้ 'Candy’s' แล้วค่ะ\\n\\nคุณต้องการบริการจัดส่งหรือไม่คะ?", {"type": "save_order_info", "bouquet": "Candy’s", "retailer_id": "t8bpd4wssw"}]}
[2025-07-06 01:21:53] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:21:53.099542", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a033f00>", "to_number": "79140775712", "content": "Букет 'Candy’s' сохранен.\\n\\nВам нужна доставка?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": "The 'Candy’s' bouquet is saved.\\n\\nDo you need delivery?", "content_thai": "บันทึกช่อดอกไม้ 'Candy’s' แล้วค่ะ\\n\\nคุณต้องการบริการจัดส่งหรือไม่คะ?"}}
[2025-07-06 01:21:54] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:21:55] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:21:55.500739", "execution_time_ms": 2400.92, "result": true}
[2025-07-06 01:21:55] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:21:55.503840", "execution_time_ms": 36840.59, "result": true}
[2025-07-06 01:22:17] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:22:17.669302", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a023c50>", "sender_id": "79140775712", "message_text": "да", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUI4NzM2MDVBNkM4OUYyNzBFRgA=", "message_type": "text", "timestamp": "1751739732"}, "sender_name": "Denis Drobotenko", "reply_to_message_id": null}}
[2025-07-06 01:22:27] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:22:27.877294", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a033f00>", "text": "да", "user_lang": "ru"}}
[2025-07-06 01:22:27] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:22:27.878550", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a033f00>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 01:22:29] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:22:29.693959", "execution_time_ms": 1815.18, "result": "yes"}
[2025-07-06 01:22:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:22:29.694499", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a033f00>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 01:22:34] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:22:34.595012", "execution_time_ms": 4900.17, "result": "ใช่"}
[2025-07-06 01:22:34] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:22:34.595826", "execution_time_ms": 6717.34, "result": ["да", "yes", "ใช่"]}
[2025-07-06 01:22:36] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:22:36.088665", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a033f00>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 1, 22, 36, 88475), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи, Денис Дроботенко! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 22, 36, 88497), content_en='Good night, Denis Drobotenko! Would you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์, เดนิส โดรโบเตนโก! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหม?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 1, 22, 36, 88500), content_en='Yes', content_thai='ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 22, 36, 88503), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 22, 36, 88505), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 22, 36, 88509), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 22, 36, 88511), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty \\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 22, 36, 88514), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично! Сейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 22, 36, 88516), content_en='Excellent! I will now show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม! ตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูค่ะ\\\\n\\\\nกรุณารอสักครู่นะคะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Candy’s\\n1\\xa0450,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 1, 22, 36, 88519), content_en='This (reply to: Candy’s\\n1,450.00 ฿ 🌸)', content_thai='ตอบกลับ: ของ Candy\\n1,450.00 ฿ 🌸', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 01:22:39] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:22:39.610134", "execution_time_ms": 3519.95, "result": ["Ваш букет 'Candy’s' сохранен.\\n\\nВам нужна доставка?", "Your bouquet 'Candy’s' is saved.\\n\\nDo you need delivery?", "ช่อดอกไม้ 'Candy’s' ของคุณถูกบันทึกแล้วค่ะ\\n\\nคุณต้องการบริการจัดส่งหรือไม่คะ?", {"type": "save_order_info", "bouquet": "Candy’s", "retailer_id": "t8bpd4wssw"}]}
[2025-07-06 01:22:42] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:22:42.978849", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a023c50>", "to_number": "79140775712", "content": "Ваш букет 'Candy’s' сохранен.\\n\\nВам нужна доставка?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": "Your bouquet 'Candy’s' is saved.\\n\\nDo you need delivery?", "content_thai": "ช่อดอกไม้ 'Candy’s' ของคุณถูกบันทึกแล้วค่ะ\\n\\nคุณต้องการบริการจัดส่งหรือไม่คะ?"}}
[2025-07-06 01:22:44] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:22:45] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:22:45.517598", "execution_time_ms": 2537.47, "result": true}
[2025-07-06 01:22:45] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:22:45.519507", "execution_time_ms": 27849.43, "result": true}
[2025-07-06 01:33:19] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:33:19.456462", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a023c50>", "sender_id": "79140775712", "message_text": "Привет!", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTY3QzA2MTlDRjBFQzNCMDUzQgA=", "message_type": "text", "timestamp": "1751733701"}, "sender_name": "Denis Drobotenko", "reply_to_message_id": null}}
[2025-07-06 01:33:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:33:29.308883", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a0d3550>", "text": "Привет!", "user_lang": "ru"}}
[2025-07-06 01:33:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:33:29.310526", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a0d3550>", "text": "Привет!", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 01:33:31] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:33:31.279597", "execution_time_ms": 1968.8, "result": "Hi!"}
[2025-07-06 01:33:31] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:33:31.280226", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a0d3550>", "text": "Привет!", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 01:33:32] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:33:32.647221", "execution_time_ms": 1366.78, "result": "สวัสดี"}
[2025-07-06 01:33:32] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:33:32.647497", "execution_time_ms": 3337.07, "result": ["Привет!", "Hi!", "สวัสดี"]}
[2025-07-06 01:33:33] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:33:33.986448", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a0d3550>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 1, 33, 33, 985966), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи, Денис Дроботенко! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 33, 33, 986037), content_en='Good night, Denis Drobotenko! Would you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์, เดนิส โดรโบเตนโก! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหม?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 1, 33, 33, 986042), content_en='Yes', content_thai='ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 33, 33, 986045), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 33, 33, 986048), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 33, 33, 986051), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 33, 33, 986054), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty \\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 33, 33, 986056), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично! Сейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 33, 33, 986059), content_en='Excellent! I will now show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม! ตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูค่ะ\\\\n\\\\nกรุณารอสักครู่นะคะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Candy’s\\n1\\xa0450,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 1, 33, 33, 986061), content_en='This (reply to: Candy’s\\n1,450.00 ฿ 🌸)', content_thai='ตอบกลับ: ของ Candy\\n1,450.00 ฿ 🌸', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 01:33:37] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:33:37.890946", "execution_time_ms": 3902.79, "result": ["Букет 'Candy’s' сохранен.\\n\\nВам нужна доставка?", "Bouquet 'Candy’s' is saved.\\n\\nDo you need delivery?", "บันทึกช่อดอกไม้ 'Candy’s' แล้วค่ะ\\n\\nคุณต้องการบริการจัดส่งหรือไม่คะ?", {"type": "save_order_info", "bouquet": "Candy’s", "retailer_id": "t8bpd4wssw"}]}
[2025-07-06 01:33:41] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:33:41.268915", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a023c50>", "to_number": "79140775712", "content": "Букет 'Candy’s' сохранен.\\n\\nВам нужна доставка?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": "Bouquet 'Candy’s' is saved.\\n\\nDo you need delivery?", "content_thai": "บันทึกช่อดอกไม้ 'Candy’s' แล้วค่ะ\\n\\nคุณต้องการบริการจัดส่งหรือไม่คะ?"}}
[2025-07-06 01:33:42] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:33:43] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:33:43.990054", "execution_time_ms": 2720.67, "result": true}
[2025-07-06 01:33:43] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:33:43.991499", "execution_time_ms": 24534.04, "result": true}
[2025-07-06 01:34:51] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:34:51.891446", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a101f40>", "sender_id": "79140775712", "message_text": "привет", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTNDMEQxN0Y2MUFCRkEzRkRBOQA=", "message_type": "text", "timestamp": "1751724453"}, "sender_name": "Denis Drobotenko", "reply_to_message_id": null}}
[2025-07-06 01:35:01] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:35:01.408087", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a0d2e50>", "text": "привет", "user_lang": "ru"}}
[2025-07-06 01:35:01] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:35:01.409230", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a0d2e50>", "text": "привет", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 01:35:03] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:35:03.483187", "execution_time_ms": 2073.7, "result": "hello"}
[2025-07-06 01:35:03] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:35:03.483598", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a0d2e50>", "text": "привет", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 01:35:04] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:35:04.469022", "execution_time_ms": 985.32, "result": "สวัสดี"}
[2025-07-06 01:35:04] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:35:04.469595", "execution_time_ms": 3060.45, "result": ["привет", "hello", "สวัสดี"]}
[2025-07-06 01:35:05] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:35:05.836019", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10a0d2e50>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 1, 35, 5, 835903), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи, Денис Дроботенко! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 35, 5, 835922), content_en='Good night, Denis Drobotenko! Would you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์, เดนิส โดรโบเตนโก! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหม?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 1, 35, 5, 835925), content_en='Yes', content_thai='ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 35, 5, 835928), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 35, 5, 835930), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 35, 5, 835933), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 35, 5, 835935), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty \\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 35, 5, 835937), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично! Сейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 35, 5, 835939), content_en='Excellent! I will now show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม! ตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูค่ะ\\\\n\\\\nกรุณารอสักครู่นะคะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Candy’s\\n1\\xa0450,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 1, 35, 5, 835941), content_en='This (reply to: Candy’s\\n1,450.00 ฿ 🌸)', content_thai='ตอบกลับ: ของ Candy\\n1,450.00 ฿ 🌸', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis Drobotenko"}}
[2025-07-06 01:35:09] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:35:09.926496", "execution_time_ms": 4089.69, "result": ["Ваш букет 'Candy’s' сохранен.\\n\\nТребуется ли доставка?", "Your bouquet 'Candy’s' is saved.\\n\\nDo you need delivery?", "บันทึกช่อดอกไม้ 'Candy’s' ของคุณแล้ว\\n\\nคุณต้องการจัดส่งหรือไม่?", {"type": "save_order_info", "bouquet": "Candy’s", "retailer_id": "t8bpd4wssw"}]}
[2025-07-06 01:35:13] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:35:13.548350", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10a101f40>", "to_number": "79140775712", "content": "Ваш букет 'Candy’s' сохранен.\\n\\nТребуется ли доставка?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": "Your bouquet 'Candy’s' is saved.\\n\\nDo you need delivery?", "content_thai": "บันทึกช่อดอกไม้ 'Candy’s' ของคุณแล้ว\\n\\nคุณต้องการจัดส่งหรือไม่?"}}
[2025-07-06 01:35:15] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:35:16] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:35:16.085550", "execution_time_ms": 2533.69, "result": true}
[2025-07-06 01:35:16] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:35:16.086943", "execution_time_ms": 24194.56, "result": true}
[2025-07-06 01:41:06] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:41:06.892870", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x11311afd0>", "sender_id": "79140775712", "message_text": "Привет", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTU1QTczQjcxODlFQTBGNkE0OQA=", "message_type": "text", "timestamp": "1751740862"}, "sender_name": "Denis", "reply_to_message_id": null}}
[2025-07-06 01:41:16] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T01:41:16.727160", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1131b06e0>", "text": "Привет"}}
[2025-07-06 01:41:16] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T01:41:16.728592", "execution_time_ms": 0.79, "result": "ru"}
[2025-07-06 01:41:16] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:41:16.969329", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1131b06e0>", "text": "Привет", "user_lang": "ru"}}
[2025-07-06 01:41:16] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:41:16.969817", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1131b06e0>", "text": "Привет", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 01:41:19] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:41:19.044110", "execution_time_ms": 2074.03, "result": "Hello"}
[2025-07-06 01:41:19] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:41:19.044557", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1131b06e0>", "text": "Привет", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 01:41:19] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:41:19.941933", "execution_time_ms": 897.26, "result": "สวัสดี"}
[2025-07-06 01:41:19] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:41:19.942481", "execution_time_ms": 2972.74, "result": ["Привет", "Hello", "สวัสดี"]}
[2025-07-06 01:41:21] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:41:21.448535", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1131b06e0>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 1, 41, 21, 448406), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis"}}
[2025-07-06 01:41:24] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:41:24.879013", "execution_time_ms": 3429.95, "result": ["Доброй ночи, Денис!\\n\\nХотели бы вы посмотреть наш каталог цветов?", "Good night, Denis!\\n\\nWould you like to see our flower catalog?", "ราตรีสวัสดิ์ค่ะ เดนิส!\\n\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 01:41:24] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:41:24.885623", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x11311afd0>", "to_number": "79140775712", "content": "Доброй ночи, Денис!\\n\\nХотели бы вы посмотреть наш каталог цветов?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": "Good night, Denis!\\n\\nWould you like to see our flower catalog?", "content_thai": "ราตรีสวัสดิ์ค่ะ เดนิส!\\n\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?"}}
[2025-07-06 01:41:27] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:41:29] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:41:29.154568", "execution_time_ms": 4268.78, "result": true}
[2025-07-06 01:41:29] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:41:29.155080", "execution_time_ms": 22258.48, "result": true}
[2025-07-06 01:41:39] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:41:39.219520", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x113a79e50>", "sender_id": "79140775712", "message_text": "да", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTA2QjMwMzI2NUY4QUNFODIxMwA=", "message_type": "text", "timestamp": "1751740894"}, "sender_name": "Denis", "reply_to_message_id": null}}
[2025-07-06 01:41:48] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T01:41:48.275245", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11311b4d0>", "text": "да"}}
[2025-07-06 01:41:48] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T01:41:48.276751", "execution_time_ms": 0.04, "result": "ru"}
[2025-07-06 01:41:48] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:41:48.494779", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11311b4d0>", "text": "да", "user_lang": "ru"}}
[2025-07-06 01:41:48] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:41:48.495685", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11311b4d0>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 01:41:50] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:41:50.718212", "execution_time_ms": 2222.22, "result": "Yes"}
[2025-07-06 01:41:50] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:41:50.718856", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11311b4d0>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 01:42:00] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:42:00.933144", "execution_time_ms": 10212.86, "result": "ใช่"}
[2025-07-06 01:42:00] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:42:00.935112", "execution_time_ms": 12439.53, "result": ["да", "Yes", "ใช่"]}
[2025-07-06 01:42:02] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:42:02.263175", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11311b4d0>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 1, 42, 2, 262722), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи, Денис!\\\\n\\\\nХотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 42, 2, 262758), content_en='Good night, Denis!\\\\n\\\\nWould you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์ค่ะ เดนิส!\\\\n\\\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 1, 42, 2, 262762), content_en='Yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis"}}
[2025-07-06 01:42:06] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:42:06.658735", "execution_time_ms": 4395.05, "result": ["Отлично!\\n\\nСейчас я покажу вам каждый букет с фотографией.\\n\\nПожалуйста, подождите минутку...", "Excellent!\\n\\nI will now show you each bouquet with a photo.\\n\\nPlease wait a moment...", "ยอดเยี่ยม!\\n\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูค่ะ\\n\\nกรุณารอสักครู่...", {"type": "send_catalog"}]}
[2025-07-06 01:42:09] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 01:42:09] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 01:42:10] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 01:42:10] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-06 01:42:10] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:42:10.348172", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1130696a0>", "to_number": "79140775712", "content": "Love is on the air\n2 200,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/503765845_1222228859683151_4028827634893880558_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=sb7DUXn5wNAQ7kNvwHJc5Vs&_nc_oc=AdmOxoDXIxrkBjHtpsTcXkZgXV7jH82e_PPl2FAXoCOH3grfE1PamTUm0WMVsCbWOiMSp5C79nMN6lQbVtaelKoD&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=GPcj242yH6I-vm0pghA5WA&oh=00_AfQZkPbEEvpJ6_ea2McvkUCWPLj0SHktMevBl_Cy9WOWcw&oe=686F30CA"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 01:42:12] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:42:14] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:42:14.757303", "execution_time_ms": 4408.66, "result": true}
[2025-07-06 01:42:14] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-06 01:42:14] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:42:14.758953", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1130696a0>", "to_number": "79140775712", "content": "Good vibes🌸\n2 350,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/511947769_2130442957421658_3783812242789464194_n.jpg?_nc_cat=109&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=VaAlBK3MuWcQ7kNvwHogCDm&_nc_oc=AdnUzVnOUYaHvO4I4_0frRo0aQYlyGA4jjbTJPe49BEIkEo6eRND_bzXFzQWkP4GMSNTS4tmLthT636eFMBcbLpB&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=GPcj242yH6I-vm0pghA5WA&oh=00_AfRrdpJ92QESQb7lWko3tLNLHL6QeoBVQ9EAfppezbtIQA&oe=686F337D"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 01:42:16] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:42:17] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:42:17.586383", "execution_time_ms": 2826.77, "result": true}
[2025-07-06 01:42:17] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-06 01:42:17] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:42:17.587579", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1130696a0>", "to_number": "79140775712", "content": "Clouds\n2 400,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513288773_3083699665127219_1955152157776052338_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=lZG4SBZGUpIQ7kNvwH7bJIs&_nc_oc=Adm1ilZgCtJ1rQLnfYCXpOgKsczuH9KLtnBjR2yFiSHV43K743WUOr07yG9ly3kFmS3DAjvofLUp7VAKd8BZnh_p&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=GPcj242yH6I-vm0pghA5WA&oh=00_AfThopcmChWu5xGu0haanE14gUFbhgsSBQqXibd2WWypwQ&oe=686F4CE8"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 01:42:18] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:42:20] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:42:20.228385", "execution_time_ms": 2640.51, "result": true}
[2025-07-06 01:42:20] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-06 01:42:20] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:42:20.229629", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1130696a0>", "to_number": "79140775712", "content": "Candy’s\n1 450,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513521068_1203881994842049_840424551106600581_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=i-cncoMZAXwQ7kNvwHWHy8f&_nc_oc=AdkHkGfaT-HYLERdInl2JW7G0LOvLTinf22KPRCsyGaveSaJ8NZDPbbGk0E-8M10XwBKRGryKrZiSnviG0Uzf1om&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=GPcj242yH6I-vm0pghA5WA&oh=00_AfQcQuNsxpqmcQbps0RezuWWdpwAQH8QJiGXQSgIKHQ8ag&oe=686F4966"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 01:42:21] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:42:22] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:42:22.869627", "execution_time_ms": 2639.56, "result": true}
[2025-07-06 01:42:22] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-06 01:42:22] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:42:22.870495", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1130696a0>", "to_number": "79140775712", "content": "Pretty 😍\n2 600,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513058785_748208634241719_9170859285232997266_n.jpg?_nc_cat=106&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=-kFXCnhe93kQ7kNvwFyUk9S&_nc_oc=AdmNwD11W_gUAmJfYFtowZRpCN6hm7C0Zy386eF8VfovjuFC8K-2lqvPIBSIWSIWNRqlg47PyBzQhb36M828BAwy&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=GPcj242yH6I-vm0pghA5WA&oh=00_AfTy9v3Sq2V2kE4kc_V_3qU9wUSNdYXfJ_pfybpPlWfQKA&oe=686F59EC"}, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 01:42:24] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:42:25] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:42:25.565101", "execution_time_ms": 2694.29, "result": true}
[2025-07-06 01:42:25] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79140775712
[2025-07-06 01:42:25] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:42:25.566148", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x113a79e50>", "to_number": "79140775712", "content": "Отлично!\\n\\nСейчас я покажу вам каждый букет с фотографией.\\n\\nПожалуйста, подождите минутку...", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": "Excellent!\\n\\nI will now show you each bouquet with a photo.\\n\\nPlease wait a moment...", "content_thai": "ยอดเยี่ยม!\\n\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูค่ะ\\n\\nกรุณารอสักครู่..."}}
[2025-07-06 01:42:27] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:42:29] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:42:29.419521", "execution_time_ms": 3853.19, "result": true}
[2025-07-06 01:42:29] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:42:29.424214", "execution_time_ms": 50204.18, "result": true}
[2025-07-06 01:43:28] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:43:28.848716", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x113a1a520>", "sender_id": "79140775712", "message_text": "этот", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTQwMkFDQUQyRDVGRUMxRDY1OAA=", "message_type": "text", "timestamp": "1751741004"}, "sender_name": "Denis", "reply_to_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJFOEE1MjkyMEU4NzkxNDhDRDcA"}}
[2025-07-06 01:43:42] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:43:42.307488", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1131b4cd0>", "text": "этот", "user_lang": "ru"}}
[2025-07-06 01:43:42] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:43:42.309055", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1131b4cd0>", "text": "этот", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 01:43:43] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:43:43.202821", "execution_time_ms": 893.22, "result": "this"}
[2025-07-06 01:43:43] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:43:43.203147", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1131b4cd0>", "text": "этот", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 01:43:44] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:43:44.602379", "execution_time_ms": 1398.97, "result": "นี้"}
[2025-07-06 01:43:44] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:43:44.602858", "execution_time_ms": 2293.91, "result": ["этот", "this", "นี้"]}
[2025-07-06 01:43:45] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:43:45.580447", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1131b4cd0>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 1, 43, 45, 580132), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи, Денис!\\\\n\\\\nХотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 43, 45, 580149), content_en='Good night, Denis!\\\\n\\\\nWould you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์ค่ะ เดนิส!\\\\n\\\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 1, 43, 45, 580153), content_en='Yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 43, 45, 580157), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 43, 45, 580160), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 43, 45, 580163), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 43, 45, 580166), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty \\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 43, 45, 580168), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 43, 45, 580171), content_en='Excellent!\\\\n\\\\nI will now show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูค่ะ\\\\n\\\\nกรุณารอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='этот', timestamp=datetime.datetime(2025, 7, 6, 1, 43, 45, 580174), content_en='this', content_thai='นี้', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis"}}
[2025-07-06 01:43:56] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:43:56.990128", "execution_time_ms": 11408.62, "result": ["Ваш букет 'Pretty 😍' сохранен.\\n\\nВам нужна доставка?", "Your bouquet 'Pretty 😍' is saved.\\n\\nDo you need delivery?", "ช่อดอกไม้ 'Pretty 😍' ของคุณถูกบันทึกแล้ว\\n\\nคุณต้องการบริการจัดส่งหรือไม่?", {"type": "save_order_info", "bouquet": "Pretty 😍", "retailer_id": "kie4sy3qsy"}]}
[2025-07-06 01:44:00] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:44:00.606821", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x113a1a520>", "to_number": "79140775712", "content": "Ваш букет 'Pretty 😍' сохранен.\\n\\nВам нужна доставка?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": "Your bouquet 'Pretty 😍' is saved.\\n\\nDo you need delivery?", "content_thai": "ช่อดอกไม้ 'Pretty 😍' ของคุณถูกบันทึกแล้ว\\n\\nคุณต้องการบริการจัดส่งหรือไม่?"}}
[2025-07-06 01:44:03] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:44:04] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:44:04.558961", "execution_time_ms": 3951.6, "result": true}
[2025-07-06 01:44:04] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:44:04.560791", "execution_time_ms": 35710.84, "result": true}
[2025-07-06 01:44:20] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:44:20.034235", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x113a190f0>", "sender_id": "79140775712", "message_text": "Да", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTMwQjhEMzdGN0NGRDRENUVGOAA=", "message_type": "text", "timestamp": "1751741054"}, "sender_name": "Denis", "reply_to_message_id": null}}
[2025-07-06 01:44:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:44:29.836347", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a195b0>", "text": "Да", "user_lang": "ru"}}
[2025-07-06 01:44:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:44:29.836901", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a195b0>", "text": "Да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 01:44:30] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:44:30.741580", "execution_time_ms": 904.49, "result": "Yes"}
[2025-07-06 01:44:30] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:44:30.742081", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a195b0>", "text": "Да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 01:44:34] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T01:44:34.860183", "execution_time_ms": 4117.81, "result": "ค่ะ"}
[2025-07-06 01:44:34] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T01:44:34.863937", "execution_time_ms": 5027.06, "result": ["Да", "Yes", "ค่ะ"]}
[2025-07-06 01:44:36] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:44:36.125001", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a195b0>", "messages": ["Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 1, 44, 36, 124656), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи, Денис!\\\\n\\\\nХотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 44, 36, 124672), content_en='Good night, Denis!\\\\n\\\\nWould you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์ค่ะ เดนิส!\\\\n\\\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 1, 44, 36, 124683), content_en='Yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 44, 36, 124685), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 44, 36, 124688), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 44, 36, 124690), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 44, 36, 124694), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty \\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 44, 36, 124696), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 1, 44, 36, 124698), content_en='Excellent!\\\\n\\\\nI will now show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูค่ะ\\\\n\\\\nกรุณารอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250705_221836_840365_781', role=<MessageRole.USER: 'user'>, content='этот', timestamp=datetime.datetime(2025, 7, 6, 1, 44, 36, 124701), content_en='this', content_thai='นี้', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis"}}
[2025-07-06 01:44:42] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T01:44:42.554892", "execution_time_ms": 6427.44, "result": ["Ваш букет 'Pretty 😍' сохранен.\\n\\nВам нужна доставка?", "Your bouquet 'Pretty 😍' is saved.\\n\\nDo you need delivery?", "ช่อดอกไม้ 'Pretty 😍' ของคุณถูกบันทึกแล้วค่ะ\\n\\nคุณต้องการจัดส่งหรือไม่คะ?", {"type": "save_order_info", "bouquet": "Pretty 😍", "retailer_id": "kie4sy3qsy"}]}
[2025-07-06 01:44:45] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:44:45.928469", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x113a190f0>", "to_number": "79140775712", "content": "Ваш букет 'Pretty 😍' сохранен.\\n\\nВам нужна доставка?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": "Your bouquet 'Pretty 😍' is saved.\\n\\nDo you need delivery?", "content_thai": "ช่อดอกไม้ 'Pretty 😍' ของคุณถูกบันทึกแล้วค่ะ\\n\\nคุณต้องการจัดส่งหรือไม่คะ?"}}
[2025-07-06 01:44:48] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 01:44:49] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T01:44:49.905789", "execution_time_ms": 3976.72, "result": true}
[2025-07-06 01:44:49] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T01:44:49.906461", "execution_time_ms": 29871.25, "result": true}
[2025-07-06 08:06:13] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T08:06:13.907355", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1131ac4d0>", "sender_id": "79140775712", "message_text": "/newses", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTdBQThDODgwQzI4QkZGRjk4MwA=", "message_type": "text", "timestamp": "1751665761"}, "sender_name": "Denis", "reply_to_message_id": null}}
[2025-07-06 08:06:23] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:06:23.267636", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1131ac4d0>", "to_number": "79140775712", "content": "✅ Новая сессия создана! ID: 20250706_080623_98425_766\n\nТеперь вы можете начать новый диалог. 🌸", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250705_221836_840365_781", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 08:06:25] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 08:06:27] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:06:27.330296", "execution_time_ms": 4061.87, "result": true}
[2025-07-06 08:06:27] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T08:06:27.331156", "execution_time_ms": 13422.35, "result": true}
[2025-07-06 08:12:48] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T08:12:48.619162", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x113a3f020>", "sender_id": "79140775712", "message_text": "Привет", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTc2RDY1ODJENTA0NkNDMDY4RAA=", "message_type": "text", "timestamp": "1751764363"}, "sender_name": "Denis", "reply_to_message_id": null}}
[2025-07-06 08:12:59] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T08:12:59.875194", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a64050>", "text": "Привет"}}
[2025-07-06 08:12:59] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T08:12:59.877391", "execution_time_ms": 1.4, "result": "ru"}
[2025-07-06 08:13:00] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T08:13:00.066153", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a64050>", "text": "Привет", "user_lang": "ru"}}
[2025-07-06 08:13:00] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T08:13:00.066982", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a64050>", "text": "Привет", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 08:13:02] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T08:13:02.104259", "execution_time_ms": 2036.85, "result": "Hi"}
[2025-07-06 08:13:02] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T08:13:02.105517", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a64050>", "text": "Привет", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 08:13:02] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T08:13:02.869686", "execution_time_ms": 763.91, "result": "สวัสดี"}
[2025-07-06 08:13:02] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T08:13:02.870069", "execution_time_ms": 2803.53, "result": ["Привет", "Hi", "สวัสดี"]}
[2025-07-06 08:13:04] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T08:13:04.429294", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a64050>", "messages": ["Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 8, 13, 4, 429159), content_en='Hi', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis"}}
[2025-07-06 08:13:08] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T08:13:08.815695", "execution_time_ms": 4385.89, "result": ["Доброе утро, Денис!\\n\\nХотели бы Вы посмотреть наш каталог цветов?", "Good morning, Denis!\\n\\nWould you like to see our flower catalog?", "สวัสดีตอนเช้าค่ะ เดนิส!\\n\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 08:13:08] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:13:08.818013", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x113a3f020>", "to_number": "79140775712", "content": "Доброе утро, Денис!\\n\\nХотели бы Вы посмотреть наш каталог цветов?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_080623_98425_766", "sender_id": "79140775712", "content_en": "Good morning, Denis!\\n\\nWould you like to see our flower catalog?", "content_thai": "สวัสดีตอนเช้าค่ะ เดนิส!\\n\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?"}}
[2025-07-06 08:13:11] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 08:13:13] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:13:13.646015", "execution_time_ms": 4827.57, "result": true}
[2025-07-06 08:13:13] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T08:13:13.647023", "execution_time_ms": 25026.96, "result": true}
[2025-07-06 08:24:18] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T08:24:18.624339", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x113a3c8d0>", "sender_id": "79140775712", "message_text": "да", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTNGQjA5OUZBQTQ0NTlFOUFGQQA=", "message_type": "text", "timestamp": "1751765053"}, "sender_name": "Denis", "reply_to_message_id": null}}
[2025-07-06 08:24:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T08:24:29.177671", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a3e030>", "text": "да"}}
[2025-07-06 08:24:29] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T08:24:29.179616", "execution_time_ms": 0.31, "result": "ru"}
[2025-07-06 08:24:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T08:24:29.420141", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a3e030>", "text": "да", "user_lang": "ru"}}
[2025-07-06 08:24:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T08:24:29.420701", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a3e030>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 08:24:31] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T08:24:31.516371", "execution_time_ms": 2095.04, "result": "yes"}
[2025-07-06 08:24:31] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T08:24:31.517419", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a3e030>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 08:24:42] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T08:24:42.477085", "execution_time_ms": 10959.19, "result": "ใช่"}
[2025-07-06 08:24:42] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T08:24:42.478993", "execution_time_ms": 13058.39, "result": ["да", "yes", "ใช่"]}
[2025-07-06 08:24:43] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T08:24:43.944713", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a3e030>", "messages": ["Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 8, 24, 43, 944392), content_en='Hi', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброе утро, Денис!\\\\n\\\\nХотели бы Вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 8, 24, 43, 944413), content_en='Good morning, Denis!\\\\n\\\\nWould you like to see our flower catalog?', content_thai='สวัสดีตอนเช้าค่ะ เดนิส!\\\\n\\\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 8, 24, 43, 944417), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis"}}
[2025-07-06 08:24:47] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T08:24:47.742045", "execution_time_ms": 3796.8, "result": ["Показываю наш каталог цветов!\\n\\nПожалуйста, подождите немного...", "I'll show you our flower catalog!\\n\\nPlease wait a moment...", "ฉันจะแสดงแคตตาล็อกดอกไม้ของเราให้คุณดู!\\n\\nโปรดรอสักครู่...", {"type": "send_catalog"}]}
[2025-07-06 08:24:51] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 08:24:51] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 08:24:51] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 08:24:51] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-06 08:24:51] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:24:51.252636", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1130696a0>", "to_number": "79140775712", "content": "Love is on the air\n2 200,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/503765845_1222228859683151_4028827634893880558_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=sb7DUXn5wNAQ7kNvwHJc5Vs&_nc_oc=AdmOxoDXIxrkBjHtpsTcXkZgXV7jH82e_PPl2FAXoCOH3grfE1PamTUm0WMVsCbWOiMSp5C79nMN6lQbVtaelKoD&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=GPcj242yH6I-vm0pghA5WA&oh=00_AfQZkPbEEvpJ6_ea2McvkUCWPLj0SHktMevBl_Cy9WOWcw&oe=686F30CA"}, "save_to_db": true, "session_id": "20250706_080623_98425_766", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 08:24:55] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 08:24:56] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:24:56.985460", "execution_time_ms": 5732.47, "result": true}
[2025-07-06 08:24:56] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-06 08:24:56] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:24:56.986110", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1130696a0>", "to_number": "79140775712", "content": "Good vibes🌸\n2 350,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/511947769_2130442957421658_3783812242789464194_n.jpg?_nc_cat=109&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=VaAlBK3MuWcQ7kNvwHogCDm&_nc_oc=AdnUzVnOUYaHvO4I4_0frRo0aQYlyGA4jjbTJPe49BEIkEo6eRND_bzXFzQWkP4GMSNTS4tmLthT636eFMBcbLpB&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=GPcj242yH6I-vm0pghA5WA&oh=00_AfRrdpJ92QESQb7lWko3tLNLHL6QeoBVQ9EAfppezbtIQA&oe=686F337D"}, "save_to_db": true, "session_id": "20250706_080623_98425_766", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 08:24:58] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 08:24:59] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:24:59.891396", "execution_time_ms": 2905.04, "result": true}
[2025-07-06 08:24:59] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-06 08:24:59] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:24:59.892498", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1130696a0>", "to_number": "79140775712", "content": "Clouds\n2 400,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513288773_3083699665127219_1955152157776052338_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=lZG4SBZGUpIQ7kNvwH7bJIs&_nc_oc=Adm1ilZgCtJ1rQLnfYCXpOgKsczuH9KLtnBjR2yFiSHV43K743WUOr07yG9ly3kFmS3DAjvofLUp7VAKd8BZnh_p&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=GPcj242yH6I-vm0pghA5WA&oh=00_AfThopcmChWu5xGu0haanE14gUFbhgsSBQqXibd2WWypwQ&oe=686F4CE8"}, "save_to_db": true, "session_id": "20250706_080623_98425_766", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 08:25:01] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 08:25:02] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:25:02.835513", "execution_time_ms": 2942.76, "result": true}
[2025-07-06 08:25:02] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-06 08:25:02] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:25:02.836528", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1130696a0>", "to_number": "79140775712", "content": "Candy’s\n1 450,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513521068_1203881994842049_840424551106600581_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=i-cncoMZAXwQ7kNvwHWHy8f&_nc_oc=AdkHkGfaT-HYLERdInl2JW7G0LOvLTinf22KPRCsyGaveSaJ8NZDPbbGk0E-8M10XwBKRGryKrZiSnviG0Uzf1om&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=GPcj242yH6I-vm0pghA5WA&oh=00_AfQcQuNsxpqmcQbps0RezuWWdpwAQH8QJiGXQSgIKHQ8ag&oe=686F4966"}, "save_to_db": true, "session_id": "20250706_080623_98425_766", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 08:25:03] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 08:25:05] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:25:05.670589", "execution_time_ms": 2833.73, "result": true}
[2025-07-06 08:25:05] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-06 08:25:05] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:25:05.672066", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1130696a0>", "to_number": "79140775712", "content": "Pretty 😍\n2 600,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513058785_748208634241719_9170859285232997266_n.jpg?_nc_cat=106&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=-kFXCnhe93kQ7kNvwFyUk9S&_nc_oc=AdmNwD11W_gUAmJfYFtowZRpCN6hm7C0Zy386eF8VfovjuFC8K-2lqvPIBSIWSIWNRqlg47PyBzQhb36M828BAwy&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=GPcj242yH6I-vm0pghA5WA&oh=00_AfTy9v3Sq2V2kE4kc_V_3qU9wUSNdYXfJ_pfybpPlWfQKA&oe=686F59EC"}, "save_to_db": true, "session_id": "20250706_080623_98425_766", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 08:25:06] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 08:25:08] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:25:08.560743", "execution_time_ms": 2888.48, "result": true}
[2025-07-06 08:25:08] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79140775712
[2025-07-06 08:25:08] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:25:08.561174", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x113a3c8d0>", "to_number": "79140775712", "content": "Показываю наш каталог цветов!\\n\\nПожалуйста, подождите немного...", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_080623_98425_766", "sender_id": "79140775712", "content_en": "I'll show you our flower catalog!\\n\\nPlease wait a moment...", "content_thai": "ฉันจะแสดงแคตตาล็อกดอกไม้ของเราให้คุณดู!\\n\\nโปรดรอสักครู่..."}}
[2025-07-06 08:25:10] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 08:25:12] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:25:12.148936", "execution_time_ms": 3587.62, "result": true}
[2025-07-06 08:25:12] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T08:25:12.150239", "execution_time_ms": 53524.99, "result": true}
[2025-07-06 08:27:11] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T08:27:11.169787", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1130ffe50>", "sender_id": "79140775712", "message_text": "этот", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTczMDUyQUMwQzU5RjdGRUFENwA=", "message_type": "text", "timestamp": "1751765226"}, "sender_name": "Denis", "reply_to_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI1QTM4QkY3Nzc4QzBERkI5RTcA"}}
[2025-07-06 08:27:26] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T08:27:26.168337", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a3c5a0>", "text": "этот", "user_lang": "ru"}}
[2025-07-06 08:27:26] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T08:27:26.169283", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a3c5a0>", "text": "этот", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 08:27:28] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T08:27:28.141458", "execution_time_ms": 1971.96, "result": "this"}
[2025-07-06 08:27:28] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T08:27:28.141948", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a3c5a0>", "text": "этот", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 08:27:30] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T08:27:30.052660", "execution_time_ms": 1910.49, "result": "นี้"}
[2025-07-06 08:27:30] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T08:27:30.053136", "execution_time_ms": 3883.91, "result": ["этот", "this", "นี้"]}
[2025-07-06 08:27:30] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T08:27:30.812693", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a3c5a0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 8, 27, 30, 812575), content_en='Hi', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброе утро, Денис!\\\\n\\\\nХотели бы Вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 8, 27, 30, 812587), content_en='Good morning, Denis!\\\\n\\\\nWould you like to see our flower catalog?', content_thai='สวัสดีตอนเช้าค่ะ เดนิส!\\\\n\\\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 8, 27, 30, 812590), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 8, 27, 30, 812593), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 8, 27, 30, 812596), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 8, 27, 30, 812598), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 8, 27, 30, 812601), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty \\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 8, 27, 30, 812603), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Показываю наш каталог цветов!\\\\n\\\\nПожалуйста, подождите немного... 🌸', timestamp=datetime.datetime(2025, 7, 6, 8, 27, 30, 812606), content_en=\"I'll show you our flower catalog!\\\\n\\\\nPlease wait a moment...\", content_thai='ฉันจะแสดงแคตตาล็อกดอกไม้ของเราให้คุณดู!\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.USER: 'user'>, content='этот', timestamp=datetime.datetime(2025, 7, 6, 8, 27, 30, 812608), content_en='this', content_thai='นี้', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis"}}
[2025-07-06 08:27:42] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T08:27:42.864331", "execution_time_ms": 12050.65, "result": ["Ваш букет 'Pretty 😍' сохранен.\\n\\nВам нужна доставка?", "Your bouquet 'Pretty 😍' is saved.\\n\\nDo you need delivery?", "บันทึกช่อดอกไม้ 'Pretty 😍' ของคุณแล้วค่ะ\\n\\nคุณต้องการบริการจัดส่งไหมคะ?", {"type": "save_order_info", "bouquet": "Pretty 😍", "retailer_id": "kie4sy3qsy"}]}
[2025-07-06 08:27:47] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:27:47.256278", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1130ffe50>", "to_number": "79140775712", "content": "Ваш букет 'Pretty 😍' сохранен.\\n\\nВам нужна доставка?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_080623_98425_766", "sender_id": "79140775712", "content_en": "Your bouquet 'Pretty 😍' is saved.\\n\\nDo you need delivery?", "content_thai": "บันทึกช่อดอกไม้ 'Pretty 😍' ของคุณแล้วค่ะ\\n\\nคุณต้องการบริการจัดส่งไหมคะ?"}}
[2025-07-06 08:27:50] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 08:27:51] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:27:51.815297", "execution_time_ms": 4557.65, "result": true}
[2025-07-06 08:27:51] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T08:27:51.817101", "execution_time_ms": 40646.34, "result": true}
[2025-07-06 08:29:56] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T08:29:56.315169", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x11319db50>", "sender_id": "79140775712", "message_text": "да", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTkzRjY2MTgwOUNGOTgwOUVFQwA=", "message_type": "text", "timestamp": "1751765391"}, "sender_name": "Denis", "reply_to_message_id": null}}
[2025-07-06 08:30:06] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T08:30:06.015608", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a80450>", "text": "да", "user_lang": "ru"}}
[2025-07-06 08:30:06] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T08:30:06.017080", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a80450>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 08:30:07] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T08:30:07.943705", "execution_time_ms": 1926.36, "result": "yes"}
[2025-07-06 08:30:07] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T08:30:07.944255", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a80450>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 08:30:16] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T08:30:16.678706", "execution_time_ms": 8734.11, "result": "ใช่"}
[2025-07-06 08:30:16] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T08:30:16.681445", "execution_time_ms": 10664.46, "result": ["да", "yes", "ใช่"]}
[2025-07-06 08:30:17] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T08:30:17.950683", "parameters": {"self": "<src.services.ai_service.AIService object at 0x113a80450>", "messages": ["Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 8, 30, 17, 950327), content_en='Hi', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброе утро, Денис!\\\\n\\\\nХотели бы Вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 8, 30, 17, 950357), content_en='Good morning, Denis!\\\\n\\\\nWould you like to see our flower catalog?', content_thai='สวัสดีตอนเช้าค่ะ เดนิส!\\\\n\\\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 8, 30, 17, 950361), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 8, 30, 17, 950364), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 8, 30, 17, 950367), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 8, 30, 17, 950371), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 8, 30, 17, 950373), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty \\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 8, 30, 17, 950376), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Показываю наш каталог цветов!\\\\n\\\\nПожалуйста, подождите немного... 🌸', timestamp=datetime.datetime(2025, 7, 6, 8, 30, 17, 950378), content_en=\"I'll show you our flower catalog!\\\\n\\\\nPlease wait a moment...\", content_thai='ฉันจะแสดงแคตตาล็อกดอกไม้ของเราให้คุณดู!\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.USER: 'user'>, content='этот', timestamp=datetime.datetime(2025, 7, 6, 8, 30, 17, 950381), content_en='this', content_thai='นี้', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis"}}
[2025-07-06 08:30:26] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T08:30:26.695993", "execution_time_ms": 8744.2, "result": ["Пожалуйста, уточните, какой именно букет Вы выбрали.", "Please specify which bouquet you have chosen.", "กรุณาระบุช่อดอกไม้ที่คุณเลือก", null]}
[2025-07-06 08:30:26] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:30:26.698409", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x11319db50>", "to_number": "79140775712", "content": "Пожалуйста, уточните, какой именно букет Вы выбрали.", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_080623_98425_766", "sender_id": "79140775712", "content_en": "Please specify which bouquet you have chosen.", "content_thai": "กรุณาระบุช่อดอกไม้ที่คุณเลือก"}}
[2025-07-06 08:30:29] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 08:30:32] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T08:30:32.179804", "execution_time_ms": 5480.54, "result": true}
[2025-07-06 08:30:32] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T08:30:32.180715", "execution_time_ms": 35864.67, "result": true}
[2025-07-06 11:36:29] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T11:36:29.377501", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x113ab2c60>", "sender_id": "79140775712", "message_text": "Привет", "message_type": "text", "meta": {"wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTVDOTgyRjEyMkJDNDlENDI4QQA=", "message_type": "text", "timestamp": "1751663367"}, "sender_name": "Denis", "reply_to_message_id": null}}
[2025-07-06 11:36:39] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T11:36:39.141110", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11319c050>", "text": "Привет", "user_lang": "ru"}}
[2025-07-06 11:36:39] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T11:36:39.143257", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11319c050>", "text": "Привет", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 11:36:41] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T11:36:41.002254", "execution_time_ms": 1858.32, "result": "Hello"}
[2025-07-06 11:36:41] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T11:36:41.003166", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11319c050>", "text": "Привет", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 11:36:41] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T11:36:41.758731", "execution_time_ms": 755.36, "result": "สวัสดี"}
[2025-07-06 11:36:41] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T11:36:41.758948", "execution_time_ms": 2615.9, "result": ["Привет", "Hello", "สวัสดี"]}
[2025-07-06 11:36:43] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T11:36:43.232541", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11319c050>", "messages": ["Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 11, 36, 43, 232385), content_en='Hi', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброе утро, Денис!\\\\n\\\\nХотели бы Вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 11, 36, 43, 232402), content_en='Good morning, Denis!\\\\n\\\\nWould you like to see our flower catalog?', content_thai='สวัสดีตอนเช้าค่ะ เดนิส!\\\\n\\\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 11, 36, 43, 232405), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 11, 36, 43, 232409), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 11, 36, 43, 232412), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 11, 36, 43, 232415), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 11, 36, 43, 232418), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty \\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 11, 36, 43, 232421), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.ASSISTANT: 'assistant'>, content='Показываю наш каталог цветов!\\\\n\\\\nПожалуйста, подождите немного... 🌸', timestamp=datetime.datetime(2025, 7, 6, 11, 36, 43, 232424), content_en=\"I'll show you our flower catalog!\\\\n\\\\nPlease wait a moment...\", content_thai='ฉันจะแสดงแคตตาล็อกดอกไม้ของเราให้คุณดู!\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_080623_98425_766', role=<MessageRole.USER: 'user'>, content='этот', timestamp=datetime.datetime(2025, 7, 6, 11, 36, 43, 232427), content_en='this', content_thai='นี้', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis"}}
[2025-07-06 11:36:50] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T11:36:50.828985", "execution_time_ms": 7595.47, "result": ["Чтобы я могла сохранить Ваш выбор, пожалуйста, назовите название букета, который Вам понравился.", "To save your selection, please tell me the name of the bouquet you liked.", "เพื่อให้ฉันสามารถบันทึกตัวเลือกของคุณได้ โปรดบอกชื่อช่อดอกไม้ที่คุณชอบ", null]}
[2025-07-06 11:36:50] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:36:50.830612", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x113ab2c60>", "to_number": "79140775712", "content": "Чтобы я могла сохранить Ваш выбор, пожалуйста, назовите название букета, который Вам понравился.", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_080623_98425_766", "sender_id": "79140775712", "content_en": "To save your selection, please tell me the name of the bouquet you liked.", "content_thai": "เพื่อให้ฉันสามารถบันทึกตัวเลือกของคุณได้ โปรดบอกชื่อช่อดอกไม้ที่คุณชอบ"}}
[2025-07-06 11:36:53] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 11:36:55] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:36:55.825278", "execution_time_ms": 4994.37, "result": true}
[2025-07-06 11:36:55] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_message", "timestamp": "2025-07-06T11:36:55.825828", "execution_time_ms": 26446.91, "result": true}
[2025-07-06 11:50:45] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T11:50:45.774086", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108cc3750>", "message_data": {"sender_id": "79140775712", "message_text": "Привет!", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTlDODVGODc3NDg3QjQ0RTJCRQA=", "timestamp": "1751777436", "reply_to_message_id": null}}}
[2025-07-06 11:50:47] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T11:50:47.774052", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108d58190>", "text": "Привет!"}}
[2025-07-06 11:50:47] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T11:50:47.774627", "execution_time_ms": 0.35, "result": "ru"}
[2025-07-06 11:50:47] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T11:50:47.956886", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108d58190>", "text": "Привет!", "user_lang": "ru"}}
[2025-07-06 11:50:47] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T11:50:47.957561", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108d58190>", "text": "Привет!", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 11:50:49] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T11:50:49.040793", "execution_time_ms": 1082.76, "result": "Hello!"}
[2025-07-06 11:50:49] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T11:50:49.041981", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108d58190>", "text": "Привет!", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 11:50:50] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T11:50:50.225103", "execution_time_ms": 1182.74, "result": "สวัสดี"}
[2025-07-06 11:50:50] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T11:50:50.226252", "execution_time_ms": 2268.84, "result": ["Привет!", "Hello!", "สวัสดี"]}
[2025-07-06 11:50:52] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T11:50:52.189158", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108d58190>", "messages": ["Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 6, 11, 50, 52, 91653), content_en='Hello!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)"], "user_lang": "auto", "sender_name": "Denis"}}
[2025-07-06 11:50:55] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T11:50:55.481751", "execution_time_ms": 3291.21, "result": ["Доброе утро! Хотели бы вы посмотреть наш каталог цветов?", "Good morning! Would you like to see our flower catalog?", "อรุณสวัสดิ์ค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 11:50:55] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:50:55.485220", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108cc3750>", "to_number": "79140775712", "content": "Доброе утро! Хотели бы вы посмотреть наш каталог цветов?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "Good morning! Would you like to see our flower catalog?", "content_thai": "อรุณสวัสดิ์ค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?"}}
[2025-07-06 11:50:57] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 11:50:57] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:50:57.529679", "execution_time_ms": 2044.17, "result": true}
[2025-07-06 11:50:57] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T11:50:57.530537", "execution_time_ms": 11755.07, "result": true}
[2025-07-06 11:51:25] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T11:51:25.264068", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108d5a350>", "message_data": {"sender_id": "79140775712", "message_text": "да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTNBMkQ2M0Q2MzY4QUMwRThGNwA=", "timestamp": "1751777472", "reply_to_message_id": null}}}
[2025-07-06 11:51:26] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T11:51:26.959422", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108d5b250>", "text": "да"}}
[2025-07-06 11:51:26] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T11:51:26.960393", "execution_time_ms": 0.08, "result": "ru"}
[2025-07-06 11:51:27] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T11:51:27.175027", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108d5b250>", "text": "да", "user_lang": "ru"}}
[2025-07-06 11:51:27] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T11:51:27.177129", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108d5b250>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 11:51:29] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T11:51:29.026330", "execution_time_ms": 1848.83, "result": "yes"}
[2025-07-06 11:51:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T11:51:29.027278", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108d5b250>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 11:51:37] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T11:51:37.469534", "execution_time_ms": 8441.7, "result": "ค่ะ"}
[2025-07-06 11:51:37] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T11:51:37.470783", "execution_time_ms": 10294.36, "result": ["да", "yes", "ค่ะ"]}
[2025-07-06 11:51:39] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T11:51:39.003548", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108d5b250>", "messages": ["Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 6, 11, 51, 38, 907019), content_en='Hello!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброе утро! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 11, 51, 38, 907051), content_en='Good morning! Would you like to see our flower catalog?', content_thai='อรุณสวัสดิ์ค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 11, 51, 38, 907055), content_en='yes', content_thai='ค่ะ', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis"}}
[2025-07-06 11:51:42] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T11:51:42.887165", "execution_time_ms": 3883.09, "result": ["Покажу вам каждый букет с фотографией!\\n\\nПожалуйста, подождите минутку...", "I'll show you each bouquet with photo!\\n\\nPlease wait a moment...", "ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดู!\\n\\nกรุณารอสักครู่...", {"type": "send_catalog"}]}
[2025-07-06 11:51:43] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 11:51:43] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 11:51:44] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 11:51:44] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:51:44.400428", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108c1d940>", "to_number": "79140775712", "content": "Отлично!\n\nСейчас я покажу вам каждый букет с фотографией.\n\nПожалуйста, подождите минутку...", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "Excellent!\n\nI will now show you each bouquet with a photo.\n\nPlease wait a moment...", "content_thai": "ยอดเยี่ยม!\n\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูค่ะ\n\nกรุณารอสักครู่..."}}
[2025-07-06 11:51:45] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 11:51:46] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:51:46.962821", "execution_time_ms": 2562.09, "result": true}
[2025-07-06 11:51:46] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-06 11:51:46] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:51:46.963655", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108c1d940>", "to_number": "79140775712", "content": "Love is on the air\n2 200,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/503765845_1222228859683151_4028827634893880558_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=sb7DUXn5wNAQ7kNvwHJc5Vs&_nc_oc=AdmOxoDXIxrkBjHtpsTcXkZgXV7jH82e_PPl2FAXoCOH3grfE1PamTUm0WMVsCbWOiMSp5C79nMN6lQbVtaelKoD&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=T2EH6Hm14ozR4e14_TmGFQ&oh=00_AfS_qHnRiWa12HzyQIl7kEvYfmS9b34piTP1VWqv7-7lGA&oe=686FD98A"}, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 11:51:47] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 11:51:48] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:51:48.187644", "execution_time_ms": 1223.83, "result": true}
[2025-07-06 11:51:48] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-06 11:51:48] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:51:48.188870", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108c1d940>", "to_number": "79140775712", "content": "Good vibes🌸\n2 350,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/511947769_2130442957421658_3783812242789464194_n.jpg?_nc_cat=109&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=GmbXR_yO18MQ7kNvwEyogX9&_nc_oc=AdmMHrB-5CwxhuEAmG7FKP3CxQTi5cadq0BuOPDsXpT7brujupYk7hBCQmPWOjSwPquykd9mzs1NOwB6XCnM80IZ&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=T2EH6Hm14ozR4e14_TmGFQ&oh=00_AfS2mcZCGbnw__xzW6wob8DZEZ3ECXFgk-vAy3_LnoTuEw&oe=686FDC3D"}, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 11:51:49] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 11:51:49] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:51:49.409950", "execution_time_ms": 1220.73, "result": true}
[2025-07-06 11:51:49] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-06 11:51:49] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:51:49.410547", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108c1d940>", "to_number": "79140775712", "content": "Clouds\n2 400,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513288773_3083699665127219_1955152157776052338_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=lZG4SBZGUpIQ7kNvwH7bJIs&_nc_oc=Adm1ilZgCtJ1rQLnfYCXpOgKsczuH9KLtnBjR2yFiSHV43K743WUOr07yG9ly3kFmS3DAjvofLUp7VAKd8BZnh_p&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=T2EH6Hm14ozR4e14_TmGFQ&oh=00_AfTrbT_WMxoaXVP0jozGs4qB-OiGw2e7u1gD7gZeqjRlTA&oe=686FBD68"}, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 11:51:50] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 11:51:50] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:51:50.654076", "execution_time_ms": 1243.36, "result": true}
[2025-07-06 11:51:50] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-06 11:51:50] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:51:50.654831", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108c1d940>", "to_number": "79140775712", "content": "Candy’s\n1 450,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513521068_1203881994842049_840424551106600581_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=R8uTNyO1i80Q7kNvwFmQLKd&_nc_oc=AdnXKdrPcLIqp8qliM64wZ0bwREA4z07EJ__Fzl_0S6UDXb2JVZvnF3vxk8aTRzi2b-Kman9ELlv6bwvD-i0aflF&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=T2EH6Hm14ozR4e14_TmGFQ&oh=00_AfQo3SpQlpLLs33JfSKbLvOs6rOXpmTgE_BQu2TcF3VAFw&oe=686FB9E6"}, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 11:51:51] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 11:51:51] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:51:51.826916", "execution_time_ms": 1171.85, "result": true}
[2025-07-06 11:51:51] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-06 11:51:51] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:51:51.827160", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108c1d940>", "to_number": "79140775712", "content": "Pretty 😍\n2 600,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.furt2-1.fna.fbcdn.net/v/t45.5328-4/513058785_748208634241719_9170859285232997266_n.jpg?_nc_cat=106&ccb=1-7&_nc_sid=c7e7b7&_nc_ohc=-kFXCnhe93kQ7kNvwFyUk9S&_nc_oc=AdmNwD11W_gUAmJfYFtowZRpCN6hm7C0Zy386eF8VfovjuFC8K-2lqvPIBSIWSIWNRqlg47PyBzQhb36M828BAwy&_nc_zt=23&_nc_ht=scontent.furt2-1.fna&edm=ANyJclEEAAAA&_nc_gid=T2EH6Hm14ozR4e14_TmGFQ&oh=00_AfSiLG5oB5LqxngiKdkijkPRsMBa1_KpAx8A5jMMh_c2MQ&oe=686FCA6C"}, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 11:51:52] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 11:51:53] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:51:53.012157", "execution_time_ms": 1184.91, "result": true}
[2025-07-06 11:51:53] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79140775712
[2025-07-06 11:51:53] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:51:53.012876", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108d5a350>", "to_number": "79140775712", "content": "Покажу вам каждый букет с фотографией!\\n\\nПожалуйста, подождите минутку...", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "I'll show you each bouquet with photo!\\n\\nPlease wait a moment...", "content_thai": "ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดู!\\n\\nกรุณารอสักครู่..."}}
[2025-07-06 11:51:53] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 11:51:54] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T11:51:54.155084", "execution_time_ms": 1142.03, "result": true}
[2025-07-06 11:51:54] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T11:51:54.155586", "execution_time_ms": 28891.01, "result": true}
[2025-07-06 12:11:31] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:11:31.325426", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108cb3bb0>", "message_data": {"sender_id": "79140775712", "message_text": "Этот (ответ на: Clouds\n2 400,00 ฿ 🌸)", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTE0MzA0ODhEMUI3RjY3Mjg1MgA=", "timestamp": "1751778610", "reply_to_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJFNjY5MzcxN0NCMjZFQUUyRTEA"}}}
[2025-07-06 12:11:33] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:11:33.989207", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108cb3230>", "text": "Этот (ответ на: Clouds\n2 400,00 ฿ 🌸)", "user_lang": "ru"}}
[2025-07-06 12:11:33] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:11:33.989543", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108cb3230>", "text": "Этот (ответ на: Clouds\n2 400,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 12:11:35] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:11:35.797826", "execution_time_ms": 1807.96, "result": "This (reply to: Clouds\n2,400.00 ฿ 🌸)"}
[2025-07-06 12:11:35] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:11:35.798450", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108cb3230>", "text": "Этот (ответ на: Clouds\n2 400,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 12:11:39] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:11:39.241887", "execution_time_ms": 3442.99, "result": "อันนี้ (ตอบกลับถึง: Clouds 2,400.00 ฿ 🌸)"}
[2025-07-06 12:11:39] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:11:39.243106", "execution_time_ms": 5253.62, "result": ["Этот (ответ на: Clouds\n2 400,00 ฿ 🌸)", "This (reply to: Clouds\n2,400.00 ฿ 🌸)", "อันนี้ (ตอบกลับถึง: Clouds 2,400.00 ฿ 🌸)"]}
[2025-07-06 12:11:41] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:11:41.658439", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108cb3230>", "messages": ["Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 6, 12, 11, 41, 465518), content_en='Hello!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброе утро! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 12, 11, 41, 465537), content_en='Good morning! Would you like to see our flower catalog?', content_thai='อรุณสวัสดิ์ค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 12, 11, 41, 465540), content_en='yes', content_thai='ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\n\\nСейчас я покажу вам каждый букет с фотографией.\\n\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 12, 11, 41, 465543), content_en='Excellent!\\n\\nI will now show you each bouquet with a photo.\\n\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\n\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูค่ะ\\n\\nกรุณารอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 12, 11, 41, 465545), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 12, 11, 41, 465548), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 12, 11, 41, 465551), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 12, 11, 41, 465553), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty \\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 12, 11, 41, 465555), content_en=None, content_thai=None, id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Покажу вам каждый букет с фотографией!\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 12, 11, 41, 465557), content_en=\"I'll show you each bouquet with photo!\\\\n\\\\nPlease wait a moment...\", content_thai='ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดู!\\\\n\\\\nกรุณารอสักครู่...', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis"}}
[2025-07-06 12:11:50] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:11:50.970813", "execution_time_ms": 9311.27, "result": ["```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", null]}
[2025-07-06 12:11:50] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:11:50.974692", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108cb3bb0>", "to_number": "79140775712", "content": "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", "content_thai": "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```"}}
[2025-07-06 12:11:53] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 12:11:53] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:11:53.893977", "execution_time_ms": 2919.1, "result": true}
[2025-07-06 12:11:53] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:11:53.894433", "execution_time_ms": 22568.53, "result": true}
[2025-07-06 12:30:50] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:30:50.028298", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107af7750>", "message_data": {"sender_id": "79140775712", "message_text": "Привет", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTE1MDlFRjYxNTc0NkQzNjhEMgA=", "timestamp": "1751779840", "reply_to_message_id": null}}}
[2025-07-06 12:30:53] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T12:30:53.158974", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107af7ed0>", "text": "Привет"}}
[2025-07-06 12:30:53] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T12:30:53.161238", "execution_time_ms": 0.58, "result": "ru"}
[2025-07-06 12:30:53] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:30:53.363619", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107af7ed0>", "text": "Привет", "user_lang": "ru"}}
[2025-07-06 12:30:53] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:30:53.364428", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107af7ed0>", "text": "Привет", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 12:30:54] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:30:54.498234", "execution_time_ms": 1133.56, "result": "Hello"}
[2025-07-06 12:30:54] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:30:54.498710", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107af7ed0>", "text": "Привет", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 12:30:55] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:30:55.571346", "execution_time_ms": 1072.31, "result": "สวัสดี"}
[2025-07-06 12:30:55] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:30:55.572055", "execution_time_ms": 2207.69, "result": ["Привет", "Hello", "สวัสดี"]}
[2025-07-06 12:30:55] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:30:55.976163", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107af7ed0>", "messages": [], "user_lang": "auto", "sender_name": "Denis"}}
[2025-07-06 12:31:01] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:31:01.230043", "execution_time_ms": 5253.07, "result": ["Good afternoon! Would you like to see our flower catalog?", "Good afternoon! Would you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 12:31:01] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:31:01.232594", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107af7750>", "to_number": "79140775712", "content": "Good afternoon! Would you like to see our flower catalog?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "Good afternoon! Would you like to see our flower catalog?", "content_thai": "สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?"}}
[2025-07-06 12:31:05] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 12:31:07] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:31:07.067671", "execution_time_ms": 5834.87, "result": true}
[2025-07-06 12:31:07] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:31:07.068642", "execution_time_ms": 17038.59, "result": true}
[2025-07-06 12:31:28] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:31:28.163328", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107af7890>", "message_data": {"sender_id": "79140775712", "message_text": "Да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTU3ODZDODYyOUU4Mzk0RkVDNAA=", "timestamp": "1751779878", "reply_to_message_id": null}}}
[2025-07-06 12:31:30] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T12:31:30.875357", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107af6fd0>", "text": "Да"}}
[2025-07-06 12:31:30] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T12:31:30.876000", "execution_time_ms": 0.08, "result": "ru"}
[2025-07-06 12:31:31] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:31:31.091518", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107af6fd0>", "text": "Да", "user_lang": "ru"}}
[2025-07-06 12:31:31] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:31:31.091808", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107af6fd0>", "text": "Да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 12:31:33] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:31:33.295546", "execution_time_ms": 2203.59, "result": "Yes"}
[2025-07-06 12:31:33] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:31:33.296120", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107af6fd0>", "text": "Да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 12:31:37] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:31:37.083623", "execution_time_ms": 3787.14, "result": "ครับ"}
[2025-07-06 12:31:37] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:31:37.084547", "execution_time_ms": 5992.78, "result": ["Да", "Yes", "ครับ"]}
[2025-07-06 12:31:37] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:31:37.482396", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107af6fd0>", "messages": [], "user_lang": "ru", "sender_name": "Denis"}}
[2025-07-06 12:31:41] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:31:41.730469", "execution_time_ms": 4247.65, "result": ["Хотите посмотреть наш каталог цветов?", "Would you like to see our flower catalog?", "คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 12:31:41] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:31:41.733750", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107af7890>", "to_number": "79140775712", "content": "Хотите посмотреть наш каталог цветов?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "Would you like to see our flower catalog?", "content_thai": "คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?"}}
[2025-07-06 12:31:42] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 12:31:44] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:31:44.050771", "execution_time_ms": 2316.69, "result": true}
[2025-07-06 12:31:44] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:31:44.051271", "execution_time_ms": 15887.61, "result": true}
[2025-07-06 12:32:05] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:32:05.848457", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107b37360>", "message_data": {"sender_id": "79140775712", "message_text": "да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUUyODJGMDVGRjE3QTZFMjA2QQA=", "timestamp": "1751779915", "reply_to_message_id": null}}}
[2025-07-06 12:32:08] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:32:08.426897", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107b37950>", "text": "да", "user_lang": "ru"}}
[2025-07-06 12:32:08] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:32:08.427418", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107b37950>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 12:32:10] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:32:10.559906", "execution_time_ms": 2132.22, "result": "yes"}
[2025-07-06 12:32:10] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:32:10.560501", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107b37950>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 12:32:16] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:32:16.453419", "execution_time_ms": 5892.7, "result": "ใช่"}
[2025-07-06 12:32:16] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:32:16.454420", "execution_time_ms": 8027.07, "result": ["да", "yes", "ใช่"]}
[2025-07-06 12:32:16] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:32:16.824742", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107b37950>", "messages": [], "user_lang": "ru", "sender_name": "Denis"}}
[2025-07-06 12:32:20] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:32:20.544411", "execution_time_ms": 3719.32, "result": ["Добрый день, Денис!\\n\\nХотели бы посмотреть наш каталог цветов?", "Good afternoon, Denis!\\n\\nWould you like to see our flower catalog?", "สวัสดีตอนบ่าย, เดนิส!\\n\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ", null]}
[2025-07-06 12:32:20] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:32:20.549315", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107b37360>", "to_number": "79140775712", "content": "Добрый день, Денис!\\n\\nХотели бы посмотреть наш каталог цветов?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "Good afternoon, Denis!\\n\\nWould you like to see our flower catalog?", "content_thai": "สวัสดีตอนบ่าย, เดนิส!\\n\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ"}}
[2025-07-06 12:32:21] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 12:32:23] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:32:23.664621", "execution_time_ms": 3114.92, "result": true}
[2025-07-06 12:32:23] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:32:23.665136", "execution_time_ms": 17816.07, "result": true}
[2025-07-06 12:38:49] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:38:49.018594", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108a4f890>", "message_data": {"sender_id": "79140775712", "message_text": "Привет!", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUM3RTNEMTM0QTYxMDc0NzdEQwA=", "timestamp": "1751780319", "reply_to_message_id": null}}}
[2025-07-06 12:38:52] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T12:38:52.077978", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108b5c2d0>", "text": "Привет!"}}
[2025-07-06 12:38:52] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T12:38:52.079978", "execution_time_ms": 1.7, "result": "ru"}
[2025-07-06 12:38:52] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:38:52.290174", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108b5c2d0>", "text": "Привет!", "user_lang": "ru"}}
[2025-07-06 12:38:52] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:38:52.313068", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108b5c2d0>", "text": "Привет!", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 12:38:53] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:38:53.648374", "execution_time_ms": 1334.86, "result": "Hello!"}
[2025-07-06 12:38:53] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:38:53.649278", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108b5c2d0>", "text": "Привет!", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 12:38:54] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:38:54.854769", "execution_time_ms": 1205.3, "result": "สวัสดีครับ/ค่ะ"}
[2025-07-06 12:38:54] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:38:54.855311", "execution_time_ms": 2542.59, "result": ["Привет!", "Hello!", "สวัสดีครับ/ค่ะ"]}
[2025-07-06 12:38:55] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:38:55.246877", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108b5c2d0>", "messages": [], "user_lang": "auto", "sender_name": "Denis"}}
[2025-07-06 12:39:00] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:39:00.474950", "execution_time_ms": 5226.74, "result": ["Добрый день! Хотели бы Вы посмотреть наш каталог цветов?", "Good afternoon! Would you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแค็ตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 12:39:00] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:39:00.489389", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108a4f890>", "to_number": "79140775712", "content": "Добрый день! Хотели бы Вы посмотреть наш каталог цветов?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "Good afternoon! Would you like to see our flower catalog?", "content_thai": "สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแค็ตตาล็อกดอกไม้ของเราไหมคะ?"}}
[2025-07-06 12:39:01] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 12:39:03] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:39:03.185067", "execution_time_ms": 2694.94, "result": true}
[2025-07-06 12:39:03] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:39:03.185567", "execution_time_ms": 14165.69, "result": true}
[2025-07-06 12:39:17] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:39:17.120233", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108a4efd0>", "message_data": {"sender_id": "79140775712", "message_text": "да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTAwRDNDRkQ2QkY4QTcyRjdGNgA=", "timestamp": "1751780347", "reply_to_message_id": null}}}
[2025-07-06 12:39:19] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T12:39:19.655777", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108a4e850>", "text": "да"}}
[2025-07-06 12:39:19] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T12:39:19.656362", "execution_time_ms": 0.05, "result": "ru"}
[2025-07-06 12:39:19] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:39:19.862811", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108a4e850>", "text": "да", "user_lang": "ru"}}
[2025-07-06 12:39:19] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:39:19.864059", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108a4e850>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 12:39:21] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:39:21.073730", "execution_time_ms": 1209.08, "result": "yes"}
[2025-07-06 12:39:21] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:39:21.074020", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108a4e850>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 12:39:25] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:39:25.886869", "execution_time_ms": 4812.39, "result": "ใช่"}
[2025-07-06 12:39:25] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:39:25.888402", "execution_time_ms": 6024.69, "result": ["да", "yes", "ใช่"]}
[2025-07-06 12:39:26] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:39:26.255826", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108a4e850>", "messages": [], "user_lang": "ru", "sender_name": "Denis"}}
[2025-07-06 12:39:29] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:39:29.483164", "execution_time_ms": 3226.82, "result": ["Добрый день, Денис! Хотите посмотреть наш каталог цветов?", "Good afternoon, Denis! Would you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ เดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 12:39:29] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:39:29.486906", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108a4efd0>", "to_number": "79140775712", "content": "Добрый день, Денис! Хотите посмотреть наш каталог цветов?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "Good afternoon, Denis! Would you like to see our flower catalog?", "content_thai": "สวัสดีตอนบ่ายค่ะ เดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?"}}
[2025-07-06 12:39:30] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 12:39:31] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:39:31.669506", "execution_time_ms": 2182.27, "result": true}
[2025-07-06 12:39:31] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:39:31.670117", "execution_time_ms": 14549.22, "result": true}
[2025-07-06 12:41:42] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:41:42.140822", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x106bab750>", "message_data": {"sender_id": "79140775712", "message_text": "Тест истории сообщений", "message_type": "text", "sender_name": "Test", "wa_message_id": "wamid.test_message_123", "timestamp": "1751781000", "reply_to_message_id": null}}}
[2025-07-06 12:41:45] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:41:45.037792", "parameters": {"self": "<src.services.ai_service.AIService object at 0x106c40190>", "text": "Тест истории сообщений", "user_lang": "ru"}}
[2025-07-06 12:41:45] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:41:45.038147", "parameters": {"self": "<src.services.ai_service.AIService object at 0x106c40190>", "text": "Тест истории сообщений", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 12:41:47] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:41:47.800764", "execution_time_ms": 2762.42, "result": "Message history test"}
[2025-07-06 12:41:47] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:41:47.801323", "parameters": {"self": "<src.services.ai_service.AIService object at 0x106c40190>", "text": "Тест истории сообщений", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 12:41:51] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:41:51.225400", "execution_time_ms": 3423.82, "result": "การทดสอบประวัติข้อความ"}
[2025-07-06 12:41:51] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:41:51.226425", "execution_time_ms": 6188.34, "result": ["Тест истории сообщений", "Message history test", "การทดสอบประวัติข้อความ"]}
[2025-07-06 12:41:51] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:41:51.604415", "parameters": {"self": "<src.services.ai_service.AIService object at 0x106c40190>", "messages": [], "user_lang": "ru", "sender_name": "Test"}}
[2025-07-06 12:41:55] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:41:55.071713", "execution_time_ms": 3466.81, "result": ["Добрый день!\\n\\nХотели бы Вы посмотреть наш каталог цветов?", "Good afternoon!\\n\\nWould you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ!\\n\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 12:41:55] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:41:55.076103", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x106bab750>", "to_number": "79140775712", "content": "Добрый день!\\n\\nХотели бы Вы посмотреть наш каталог цветов?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "Good afternoon!\\n\\nWould you like to see our flower catalog?", "content_thai": "สวัสดีตอนบ่ายค่ะ!\\n\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?"}}
[2025-07-06 12:41:55] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 12:41:58] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:41:58.277130", "execution_time_ms": 3199.93, "result": true}
[2025-07-06 12:41:58] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:41:58.277612", "execution_time_ms": 16135.77, "result": true}
[2025-07-06 12:42:33] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:42:33.836764", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x106baafd0>", "message_data": {"sender_id": "79140775712", "message_text": "Проверка транзакций", "message_type": "text", "sender_name": "Test", "wa_message_id": "wamid.test_message_456", "timestamp": "1751781100", "reply_to_message_id": null}}}
[2025-07-06 12:42:36] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:42:36.235029", "parameters": {"self": "<src.services.ai_service.AIService object at 0x106baac10>", "text": "Проверка транзакций", "user_lang": "ru"}}
[2025-07-06 12:42:36] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:42:36.235683", "parameters": {"self": "<src.services.ai_service.AIService object at 0x106baac10>", "text": "Проверка транзакций", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 12:42:38] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:42:38.565053", "execution_time_ms": 2328.74, "result": "Transaction verification"}
[2025-07-06 12:42:38] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:42:38.567497", "parameters": {"self": "<src.services.ai_service.AIService object at 0x106baac10>", "text": "Проверка транзакций", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 12:42:41] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:42:41.255688", "execution_time_ms": 2687.89, "result": "การตรวจสอบธุรกรรม"}
[2025-07-06 12:42:41] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:42:41.256375", "execution_time_ms": 5020.76, "result": ["Проверка транзакций", "Transaction verification", "การตรวจสอบธุรกรรม"]}
[2025-07-06 12:42:41] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:42:41.637998", "parameters": {"self": "<src.services.ai_service.AIService object at 0x106baac10>", "messages": [], "user_lang": "ru", "sender_name": "Test"}}
[2025-07-06 12:42:45] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:42:45.280566", "execution_time_ms": 3642.03, "result": ["Добрый день! Хотели бы посмотреть наш каталог цветов?", "Good afternoon! Would you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 12:42:45] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:42:45.285718", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x106baafd0>", "to_number": "79140775712", "content": "Добрый день! Хотели бы посмотреть наш каталог цветов?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "Good afternoon! Would you like to see our flower catalog?", "content_thai": "สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?"}}
[2025-07-06 12:42:46] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 12:42:48] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:42:48.206883", "execution_time_ms": 2920.93, "result": true}
[2025-07-06 12:42:48] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:42:48.208525", "execution_time_ms": 14370.68, "result": true}
[2025-07-06 12:50:12] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:50:12.929977", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x106ba7bb0>", "message_data": {"sender_id": "79140775712", "message_text": "Финальный тест транзакций", "message_type": "text", "sender_name": "Test", "wa_message_id": "wamid.test_final_123", "timestamp": "1751781200", "reply_to_message_id": null}}}
[2025-07-06 12:50:16] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:50:16.047474", "parameters": {"self": "<src.services.ai_service.AIService object at 0x106ba7e10>", "text": "Финальный тест транзакций", "user_lang": "ru"}}
[2025-07-06 12:50:16] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:50:16.048070", "parameters": {"self": "<src.services.ai_service.AIService object at 0x106ba7e10>", "text": "Финальный тест транзакций", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 12:50:19] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:50:19.003561", "execution_time_ms": 2955.08, "result": "Final test of transactions"}
[2025-07-06 12:50:19] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:50:19.003783", "parameters": {"self": "<src.services.ai_service.AIService object at 0x106ba7e10>", "text": "Финальный тест транзакций", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 12:50:23] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:50:23.386416", "execution_time_ms": 4382.3, "result": "การทดสอบธุรกรรมขั้นสุดท้าย"}
[2025-07-06 12:50:23] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:50:23.387695", "execution_time_ms": 7339.8, "result": ["Финальный тест транзакций", "Final test of transactions", "การทดสอบธุรกรรมขั้นสุดท้าย"]}
[2025-07-06 12:50:23] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:50:23.792734", "parameters": {"self": "<src.services.ai_service.AIService object at 0x106ba7e10>", "messages": [], "user_lang": "ru", "sender_name": "Test"}}
[2025-07-06 12:50:28] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:50:28.289393", "execution_time_ms": 4496.11, "result": ["Добрый день! Желаете посмотреть наш каталог цветов?", "Good afternoon! Would you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 12:50:28] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:50:28.293094", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x106ba7bb0>", "to_number": "79140775712", "content": "Добрый день! Желаете посмотреть наш каталог цветов?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "Good afternoon! Would you like to see our flower catalog?", "content_thai": "สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?"}}
[2025-07-06 12:50:29] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 12:50:31] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:50:31.064692", "execution_time_ms": 2771.1, "result": true}
[2025-07-06 12:50:31] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:50:31.065593", "execution_time_ms": 18134.89, "result": true}
[2025-07-06 12:52:28] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:52:28.533137", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x11a78ae90>", "message_data": {"sender_id": "79140775712", "message_text": "Проверка транзакций после запуска через скрипт", "message_type": "text", "sender_name": "Test", "wa_message_id": "wamid.test_final_789", "timestamp": "1751781400", "reply_to_message_id": null}}}
[2025-07-06 12:52:31] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:52:31.605184", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a78b890>", "text": "Проверка транзакций после запуска через скрипт", "user_lang": "ru"}}
[2025-07-06 12:52:31] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:52:31.605765", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a78b890>", "text": "Проверка транзакций после запуска через скрипт", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 12:52:37] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:52:37.903533", "execution_time_ms": 6297.37, "result": "Checking transactions after script execution"}
[2025-07-06 12:52:37] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:52:37.904884", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a78b890>", "text": "Проверка транзакций после запуска через скрипт", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 12:52:45] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:52:45.026220", "execution_time_ms": 7120.97, "result": "การตรวจสอบธุรกรรมหลังจากที่ถูกเรียกใช้งานผ่านสคริปต์"}
[2025-07-06 12:52:45] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:52:45.027889", "execution_time_ms": 13422.18, "result": ["Проверка транзакций после запуска через скрипт", "Checking transactions after script execution", "การตรวจสอบธุรกรรมหลังจากที่ถูกเรียกใช้งานผ่านสคริปต์"]}
[2025-07-06 12:52:46] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:52:46.963023", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a78b890>", "messages": ["Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы Вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 12, 52, 46, 797605), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแค็ตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 12, 52, 46, 797658), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ เดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день!\\\\n\\\\nХотели бы Вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 12, 52, 46, 797663), content_en='Good afternoon!\\\\n\\\\nWould you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ!\\\\n\\\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 12, 52, 46, 797666), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Желаете посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 12, 52, 46, 797669), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Test"}}
[2025-07-06 12:52:53] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:52:53.725313", "execution_time_ms": 6761.7, "result": ["Добрый день! Желаете посмотреть наш каталог цветов?", "Good afternoon! Would you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 12:52:54] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:52:54.395951", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x11a78ae90>", "to_number": "79140775712", "content": "Добрый день! Желаете посмотреть наш каталог цветов?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "Good afternoon! Would you like to see our flower catalog?", "content_thai": "สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?"}}
[2025-07-06 12:52:56] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 12:52:56] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:52:56.848771", "execution_time_ms": 2451.85, "result": true}
[2025-07-06 12:52:56] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:52:56.851895", "execution_time_ms": 28317.4, "result": true}
[2025-07-06 12:54:48] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:54:48.580212", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x11a78aad0>", "message_data": {"sender_id": "79140775712", "message_text": "Привет!", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUY0NDhEMTMxRDAwNDAxODAwNwA=", "timestamp": "1751781279", "reply_to_message_id": null}}}
[2025-07-06 12:54:51] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T12:54:51.203012", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a78ad50>", "text": "Привет!"}}
[2025-07-06 12:54:51] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T12:54:51.203668", "execution_time_ms": 0.31, "result": "ru"}
[2025-07-06 12:54:51] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:54:51.437267", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a78ad50>", "text": "Привет!", "user_lang": "ru"}}
[2025-07-06 12:54:51] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:54:51.437602", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a78ad50>", "text": "Привет!", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 12:54:53] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:54:53.689925", "execution_time_ms": 2251.87, "result": "Hi!"}
[2025-07-06 12:54:53] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:54:53.691393", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a78ad50>", "text": "Привет!", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 12:54:56] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:54:56.857850", "execution_time_ms": 3166.21, "result": "สวัสดี"}
[2025-07-06 12:54:56] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:54:56.859101", "execution_time_ms": 5421.55, "result": ["Привет!", "Hi!", "สวัสดี"]}
[2025-07-06 12:54:59] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:54:59.439187", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a78ad50>", "messages": [], "user_lang": "auto", "sender_name": "Denis"}}
[2025-07-06 12:55:07] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:55:07.343371", "execution_time_ms": 7903.76, "result": ["Добрый день, Денис! Хотели бы Вы посмотреть наш каталог цветов?", "Good afternoon, Denis! Would you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 12:55:08] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:55:08.121177", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x11a78aad0>", "to_number": "79140775712", "content": "Добрый день, Денис! Хотели бы Вы посмотреть наш каталог цветов?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "Good afternoon, Denis! Would you like to see our flower catalog?", "content_thai": "สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?"}}
[2025-07-06 12:55:09] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 12:55:09] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:55:09.659573", "execution_time_ms": 1537.12, "result": true}
[2025-07-06 12:55:09] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:55:09.659844", "execution_time_ms": 21079.11, "result": true}
[2025-07-06 12:55:25] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:55:25.123871", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x11a787360>", "message_data": {"sender_id": "79140775712", "message_text": "да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTVEOUNDQkNCMEJDMDNEQjI4NQA=", "timestamp": "1751781315", "reply_to_message_id": null}}}
[2025-07-06 12:55:27] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T12:55:27.603516", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a786d70>", "text": "да"}}
[2025-07-06 12:55:27] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T12:55:27.603901", "execution_time_ms": 0.05, "result": "ru"}
[2025-07-06 12:55:27] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:55:27.829230", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a786d70>", "text": "да", "user_lang": "ru"}}
[2025-07-06 12:55:27] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:55:27.829799", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a786d70>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 12:55:29] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:55:29.829311", "execution_time_ms": 1999.24, "result": "yes"}
[2025-07-06 12:55:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:55:29.830035", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a786d70>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 12:55:35] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:55:35.569920", "execution_time_ms": 5739.36, "result": "ใช่"}
[2025-07-06 12:55:35] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:55:35.570391", "execution_time_ms": 7740.69, "result": ["да", "yes", "ใช่"]}
[2025-07-06 12:55:37] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:55:37.534984", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a786d70>", "messages": ["Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 6, 12, 55, 37, 378060), content_en='Hi!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы Вы посмотреть наш каталог цветов?', timestamp=datetime.datetime(2025, 7, 6, 12, 55, 37, 378086), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы Вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 12, 55, 37, 378092), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis"}}
[2025-07-06 12:55:49] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:55:49.943209", "execution_time_ms": 12406.99, "result": ["Пожалуйста, дайте знать, если Вы хотели бы посмотреть наш каталог цветов.", "Please let us know if you would like to see our flower catalog.", "โปรดแจ้งให้เราทราบหากคุณต้องการดูแคตตาล็อกดอกไม้ของเรา", null]}
[2025-07-06 12:55:50] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:55:50.556275", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x11a787360>", "to_number": "79140775712", "content": "Пожалуйста, дайте знать, если Вы хотели бы посмотреть наш каталог цветов.", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "Please let us know if you would like to see our flower catalog.", "content_thai": "โปรดแจ้งให้เราทราบหากคุณต้องการดูแคตตาล็อกดอกไม้ของเรา"}}
[2025-07-06 12:55:52] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 12:55:53] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:55:53.031230", "execution_time_ms": 2474.61, "result": true}
[2025-07-06 12:55:53] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:55:53.031608", "execution_time_ms": 27907.33, "result": true}
[2025-07-06 12:57:27] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:57:27.392400", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x11a787ce0>", "message_data": {"sender_id": "79140775712", "message_text": "Тест исправления истории", "message_type": "text", "sender_name": "Test", "wa_message_id": "wamid.test_fix_123", "timestamp": "1751781500", "reply_to_message_id": null}}}
[2025-07-06 12:57:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:57:29.662434", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a787bb0>", "text": "Тест исправления истории", "user_lang": "ru"}}
[2025-07-06 12:57:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:57:29.662931", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a787bb0>", "text": "Тест исправления истории", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 12:57:32] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:57:32.239967", "execution_time_ms": 2576.54, "result": "History correction test"}
[2025-07-06 12:57:32] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:57:32.240816", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a787bb0>", "text": "Тест исправления истории", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 12:57:35] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T12:57:35.431329", "execution_time_ms": 3190.18, "result": "การทดสอบการแก้ไขประวัติศาสตร์"}
[2025-07-06 12:57:35] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T12:57:35.432789", "execution_time_ms": 5769.92, "result": ["Тест исправления истории", "History correction test", "การทดสอบการแก้ไขประวัติศาสตร์"]}
[2025-07-06 12:57:37] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:57:37.341889", "parameters": {"self": "<src.services.ai_service.AIService object at 0x11a787bb0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 6, 12, 57, 37, 187795), content_en='Hi!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы Вы посмотреть наш каталог цветов?', timestamp=datetime.datetime(2025, 7, 6, 12, 57, 37, 187812), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы Вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 12, 57, 37, 187817), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 12, 57, 37, 187821), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Пожалуйста, дайте знать, если Вы хотели бы посмотреть наш каталог цветов.', timestamp=datetime.datetime(2025, 7, 6, 12, 57, 37, 187824), content_en='Please let us know if you would like to see our flower catalog.', content_thai='โปรดแจ้งให้เราทราบหากคุณต้องการดูแคตตาล็อกดอกไม้ของเรา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Пожалуйста, дайте знать, если Вы хотели бы посмотреть наш каталог цветов. 🌸', timestamp=datetime.datetime(2025, 7, 6, 12, 57, 37, 187828), content_en='Please let us know if you would like to see our flower catalog.', content_thai='โปรดแจ้งให้เราทราบหากคุณต้องการดูแคตตาล็อกดอกไม้ของเรา', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Test"}}
[2025-07-06 12:57:40] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T12:57:40.635558", "execution_time_ms": 3292.62, "result": ["```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", null]}
[2025-07-06 12:57:41] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:57:41.215201", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x11a787ce0>", "to_number": "79140775712", "content": "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", "content_thai": "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```"}}
[2025-07-06 12:57:43] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 12:57:43] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T12:57:43.809695", "execution_time_ms": 2593.98, "result": true}
[2025-07-06 12:57:43] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T12:57:43.810310", "execution_time_ms": 16416.72, "result": true}
[2025-07-06 13:01:52] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:01:52.340106", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10511b890>", "message_data": {"sender_id": "79140775712", "message_text": "Тест единой транзакции", "message_type": "text", "sender_name": "Test", "wa_message_id": "wamid.test_unified_456", "timestamp": "1751781700", "reply_to_message_id": null}}}
[2025-07-06 13:01:55] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:01:55.245729", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10522c2d0>", "text": "Тест единой транзакции", "user_lang": "ru"}}
[2025-07-06 13:01:55] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:01:55.246168", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10522c2d0>", "text": "Тест единой транзакции", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 13:01:58] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:01:58.317300", "execution_time_ms": 3070.54, "result": "Single transaction test"}
[2025-07-06 13:01:58] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:01:58.318760", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10522c2d0>", "text": "Тест единой транзакции", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 13:02:05] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:02:05.895431", "execution_time_ms": 7576.24, "result": "ทดสอบธุรกรรมแบบรวม"}
[2025-07-06 13:02:05] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:02:05.896959", "execution_time_ms": 10650.84, "result": ["Тест единой транзакции", "Single transaction test", "ทดสอบธุรกรรมแบบรวม"]}
[2025-07-06 13:02:07] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:02:07.445164", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10522c2d0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 6, 13, 2, 7, 290054), content_en='Hi!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы Вы посмотреть наш каталог цветов?', timestamp=datetime.datetime(2025, 7, 6, 13, 2, 7, 290068), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы Вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 2, 7, 290071), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 13, 2, 7, 290073), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Пожалуйста, дайте знать, если Вы хотели бы посмотреть наш каталог цветов.', timestamp=datetime.datetime(2025, 7, 6, 13, 2, 7, 290075), content_en='Please let us know if you would like to see our flower catalog.', content_thai='โปรดแจ้งให้เราทราบหากคุณต้องการดูแคตตาล็อกดอกไม้ของเรา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Пожалуйста, дайте знать, если Вы хотели бы посмотреть наш каталог цветов. 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 2, 7, 290076), content_en='Please let us know if you would like to see our flower catalog.', content_thai='โปรดแจ้งให้เราทราบหากคุณต้องการดูแคตตาล็อกดอกไม้ของเรา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='Тест исправления истории', timestamp=datetime.datetime(2025, 7, 6, 13, 2, 7, 290078), content_en='History correction test', content_thai='การทดสอบการแก้ไขประวัติศาสตร์', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='```json\\\\n{\\\\n  \"text\": \"\",\\\\n  \"text_en\": \"\",\\\\n  \"text_thai\": \"\",\\\\n  \"command\": {\\\\n    \"type\": \"send_catalog\"\\\\n  }\\\\n}\\\\n```', timestamp=datetime.datetime(2025, 7, 6, 13, 2, 7, 290080), content_en='```json\\\\n{\\\\n  \"text\": \"\",\\\\n  \"text_en\": \"\",\\\\n  \"text_thai\": \"\",\\\\n  \"command\": {\\\\n    \"type\": \"send_catalog\"\\\\n  }\\\\n}\\\\n```', content_thai='```json\\\\n{\\\\n  \"text\": \"\",\\\\n  \"text_en\": \"\",\\\\n  \"text_thai\": \"\",\\\\n  \"command\": {\\\\n    \"type\": \"send_catalog\"\\\\n  }\\\\n}\\\\n```', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='```json\\\\n{\\\\n  \"text\": \"\",\\\\n  \"text_en\": \"\",\\\\n  \"text_thai\": \"\",\\\\n  \"command\": {\\\\n    \"type\": \"send_catalog\"\\\\n  }\\\\n}\\\\n``` 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 2, 7, 290081), content_en='```json\\\\n{\\\\n  \"text\": \"\",\\\\n  \"text_en\": \"\",\\\\n  \"text_thai\": \"\",\\\\n  \"command\": {\\\\n    \"type\": \"send_catalog\"\\\\n  }\\\\n}\\\\n```', content_thai='```json\\\\n{\\\\n  \"text\": \"\",\\\\n  \"text_en\": \"\",\\\\n  \"text_thai\": \"\",\\\\n  \"command\": {\\\\n    \"type\": \"send_catalog\"\\\\n  }\\\\n}\\\\n```', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Test"}}
[2025-07-06 13:02:11] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:02:11.672349", "execution_time_ms": 4226.46, "result": ["Вот наш каталог цветов:", "Here is our flower catalog:", "นี่คือแคตตาล็อกดอกไม้ของเรา:", {"type": "send_catalog"}]}
[2025-07-06 13:02:13] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 13:02:13] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 13:02:14] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 13:02:14] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:14.277142", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1050f17f0>", "to_number": "79140775712", "content": "Отлично!\n\nСейчас я покажу вам каждый букет с фотографией.\n\nПожалуйста, подождите минутку...", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "Excellent!\n\nI will now show you each bouquet with a photo.\n\nPlease wait a moment...", "content_thai": "ยอดเยี่ยม!\n\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูค่ะ\n\nกรุณารอสักครู่..."}}
[2025-07-06 13:02:16] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:02:17] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:17.796987", "execution_time_ms": 3519.56, "result": true}
[2025-07-06 13:02:17] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-06 13:02:17] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:17.798018", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1050f17f0>", "to_number": "79140775712", "content": "Love is on the air\n2 200,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.fbkk22-6.fna.fbcdn.net/v/t45.5328-4/503765845_1222228859683151_4028827634893880558_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_eui2=AeEdRz6dYpz1xIugnsNVyIRZTTfz-HH_R0tNN_P4cf9HS1mjUDWck5BE7QVtRLK58loSQDVRsAJNAU-YPzIilBsl&_nc_ohc=sb7DUXn5wNAQ7kNvwFeaZ17&_nc_oc=Adk2T91_xWu8aT-gsUggB91o6CpIHsE8MwHjZbhiLaHlCyKYgGn4_aheweGddgQhShg&_nc_zt=23&_nc_ht=scontent.fbkk22-6.fna&edm=ANyJclEEAAAA&_nc_gid=gOWckalAWOQ6KNauxv7qOQ&oh=00_AfQkIZjI-ghYefMtSZLtlrI4NePLdyimCJOUPm9OhVcpag&oe=686FD98A"}, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 13:02:18] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:02:19] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:19.206676", "execution_time_ms": 1408.33, "result": true}
[2025-07-06 13:02:19] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-06 13:02:19] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:19.207405", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1050f17f0>", "to_number": "79140775712", "content": "Good vibes🌸\n2 350,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.fbkk22-4.fna.fbcdn.net/v/t45.5328-4/511947769_2130442957421658_3783812242789464194_n.jpg?_nc_cat=109&ccb=1-7&_nc_sid=c7e7b7&_nc_eui2=AeHECJuwXP7JJbiMKWOBZ3yTNgdGyQvvcbc2B0bJC-9xtwW_rq6j9YN2BVjzqcwQ1Ka0PY1m1rxmKMO_mA6jAm_s&_nc_ohc=GmbXR_yO18MQ7kNvwFd50Ge&_nc_oc=AdlYQg2AAtwP6IIYJjoV6aWADdzlcuLU9IJe5CcSF53ZKh8nIA530cukCWAzM4_kPuk&_nc_zt=23&_nc_ht=scontent.fbkk22-4.fna&edm=ANyJclEEAAAA&_nc_gid=gOWckalAWOQ6KNauxv7qOQ&oh=00_AfQaBVY06V7TSoEaAWI6-QPLNRccwAmQ4ewGN3e2sIFzYw&oe=686FDC3D"}, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 13:02:20] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:02:20] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:20.732129", "execution_time_ms": 1524.54, "result": true}
[2025-07-06 13:02:20] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-06 13:02:20] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:20.732635", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1050f17f0>", "to_number": "79140775712", "content": "Clouds\n2 400,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.fbkk22-6.fna.fbcdn.net/v/t45.5328-4/513288773_3083699665127219_1955152157776052338_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_eui2=AeFe94LoietDziuh43tPCT77mhmz1BXEEOuaGbPUFcQQ69-3xoX2o7nHKv61peytUMrvF-ifwNwCYp2tqmYGmfS-&_nc_ohc=lZG4SBZGUpIQ7kNvwGa-D5M&_nc_oc=AdlGK6Ea-2meficF-oRFkNIqPdSl-8Bn5ojZnUNRkoMagw3qbnVzLWuzHWq_AE_0Tu8&_nc_zt=23&_nc_ht=scontent.fbkk22-6.fna&edm=ANyJclEEAAAA&_nc_gid=gOWckalAWOQ6KNauxv7qOQ&oh=00_AfTdBMtaYpKf_lKOFtROZGYVrdByYJSXiXu-GhvVvpXDgA&oe=686FF5A8"}, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 13:02:21] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:02:22] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:22.179470", "execution_time_ms": 1446.59, "result": true}
[2025-07-06 13:02:22] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-06 13:02:22] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:22.180308", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1050f17f0>", "to_number": "79140775712", "content": "Candy’s\n1 450,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.fbkk22-1.fna.fbcdn.net/v/t45.5328-4/513521068_1203881994842049_840424551106600581_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=c7e7b7&_nc_eui2=AeH5Tjxi_MTetP9s5RwwHUoSAu9BxjnAGSsC70HGOcAZK1hsVZHPEYyVMZiSwBlbqG6nyqfmIWkFWSAC24MqhOw4&_nc_ohc=R8uTNyO1i80Q7kNvwFaR8qT&_nc_oc=AdkZiMOcV-sPQSQc03p-YwZi2RiNKmIiKuzUMYBubmeiaMWUi4zbM2KKs8eALzfbegA&_nc_zt=23&_nc_ht=scontent.fbkk22-1.fna&edm=ANyJclEEAAAA&_nc_gid=gOWckalAWOQ6KNauxv7qOQ&oh=00_AfTxhizR1ScFbLxWxr4v10A9U-ovJJ4-XShKMkZ2XuvumA&oe=686FF226"}, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 13:02:23] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:02:23] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:23.551601", "execution_time_ms": 1371.13, "result": true}
[2025-07-06 13:02:23] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-06 13:02:23] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:23.552139", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1050f17f0>", "to_number": "79140775712", "content": "Pretty 😍\n2 600,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.fbkk22-2.fna.fbcdn.net/v/t45.5328-4/513058785_748208634241719_9170859285232997266_n.jpg?_nc_cat=106&ccb=1-7&_nc_sid=c7e7b7&_nc_eui2=AeGuAFK8Opughasx6JpUR7oAK4sDRWdVrosriwNFZ1Wui-6dir18YgV6Bv5ujiMVN8R5g4pis3BrnbhUtCLaSB_J&_nc_ohc=-kFXCnhe93kQ7kNvwHYyfCk&_nc_oc=Adlh_NiN6TljGXKJYQOiLlkiV7DB89FIwYLN_QSxZBuKsrQjy8uipoSgtfsak8C9i8I&_nc_zt=23&_nc_ht=scontent.fbkk22-2.fna&edm=ANyJclEEAAAA&_nc_gid=gOWckalAWOQ6KNauxv7qOQ&oh=00_AfRBnFlRGXdtpP3dg_saozGyEt1DJ1ibHxIzsDdfl8AvNA&oe=686FCA6C"}, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 13:02:24] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:02:24] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:24.944588", "execution_time_ms": 1392.3, "result": true}
[2025-07-06 13:02:24] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79140775712
[2025-07-06 13:02:24] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 13:02:24] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 13:02:24] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 13:02:24] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:24.945257", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1050f17f0>", "to_number": "79140775712", "content": "Отлично!\n\nСейчас я покажу вам каждый букет с фотографией.\n\nПожалуйста, подождите минутку...", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "Excellent!\n\nI will now show you each bouquet with a photo.\n\nPlease wait a moment...", "content_thai": "ยอดเยี่ยม!\n\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูค่ะ\n\nกรุณารอสักครู่..."}}
[2025-07-06 13:02:25] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:02:26] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:26.334506", "execution_time_ms": 1389.17, "result": true}
[2025-07-06 13:02:26] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-06 13:02:26] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:26.334867", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1050f17f0>", "to_number": "79140775712", "content": "Love is on the air\n2 200,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.fbkk22-6.fna.fbcdn.net/v/t45.5328-4/503765845_1222228859683151_4028827634893880558_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_eui2=AeEdRz6dYpz1xIugnsNVyIRZTTfz-HH_R0tNN_P4cf9HS1mjUDWck5BE7QVtRLK58loSQDVRsAJNAU-YPzIilBsl&_nc_ohc=sb7DUXn5wNAQ7kNvwFeaZ17&_nc_oc=Adk2T91_xWu8aT-gsUggB91o6CpIHsE8MwHjZbhiLaHlCyKYgGn4_aheweGddgQhShg&_nc_zt=23&_nc_ht=scontent.fbkk22-6.fna&edm=ANyJclEEAAAA&_nc_gid=gOWckalAWOQ6KNauxv7qOQ&oh=00_AfQkIZjI-ghYefMtSZLtlrI4NePLdyimCJOUPm9OhVcpag&oe=686FD98A"}, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 13:02:27] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:02:27] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:27.659721", "execution_time_ms": 1324.65, "result": true}
[2025-07-06 13:02:27] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-06 13:02:27] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:27.660324", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1050f17f0>", "to_number": "79140775712", "content": "Good vibes🌸\n2 350,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.fbkk22-4.fna.fbcdn.net/v/t45.5328-4/511947769_2130442957421658_3783812242789464194_n.jpg?_nc_cat=109&ccb=1-7&_nc_sid=c7e7b7&_nc_eui2=AeHECJuwXP7JJbiMKWOBZ3yTNgdGyQvvcbc2B0bJC-9xtwW_rq6j9YN2BVjzqcwQ1Ka0PY1m1rxmKMO_mA6jAm_s&_nc_ohc=GmbXR_yO18MQ7kNvwFd50Ge&_nc_oc=AdlYQg2AAtwP6IIYJjoV6aWADdzlcuLU9IJe5CcSF53ZKh8nIA530cukCWAzM4_kPuk&_nc_zt=23&_nc_ht=scontent.fbkk22-4.fna&edm=ANyJclEEAAAA&_nc_gid=gOWckalAWOQ6KNauxv7qOQ&oh=00_AfQaBVY06V7TSoEaAWI6-QPLNRccwAmQ4ewGN3e2sIFzYw&oe=686FDC3D"}, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 13:02:28] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:02:29] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:29.050551", "execution_time_ms": 1390.06, "result": true}
[2025-07-06 13:02:29] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-06 13:02:29] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:29.050968", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1050f17f0>", "to_number": "79140775712", "content": "Clouds\n2 400,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.fbkk22-6.fna.fbcdn.net/v/t45.5328-4/513288773_3083699665127219_1955152157776052338_n.jpg?_nc_cat=102&ccb=1-7&_nc_sid=c7e7b7&_nc_eui2=AeFe94LoietDziuh43tPCT77mhmz1BXEEOuaGbPUFcQQ69-3xoX2o7nHKv61peytUMrvF-ifwNwCYp2tqmYGmfS-&_nc_ohc=lZG4SBZGUpIQ7kNvwGa-D5M&_nc_oc=AdlGK6Ea-2meficF-oRFkNIqPdSl-8Bn5ojZnUNRkoMagw3qbnVzLWuzHWq_AE_0Tu8&_nc_zt=23&_nc_ht=scontent.fbkk22-6.fna&edm=ANyJclEEAAAA&_nc_gid=gOWckalAWOQ6KNauxv7qOQ&oh=00_AfTdBMtaYpKf_lKOFtROZGYVrdByYJSXiXu-GhvVvpXDgA&oe=686FF5A8"}, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 13:02:29] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:02:30] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:30.290507", "execution_time_ms": 1239.4, "result": true}
[2025-07-06 13:02:30] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-06 13:02:30] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:30.290912", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1050f17f0>", "to_number": "79140775712", "content": "Candy’s\n1 450,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.fbkk22-1.fna.fbcdn.net/v/t45.5328-4/513521068_1203881994842049_840424551106600581_n.jpg?_nc_cat=101&ccb=1-7&_nc_sid=c7e7b7&_nc_eui2=AeH5Tjxi_MTetP9s5RwwHUoSAu9BxjnAGSsC70HGOcAZK1hsVZHPEYyVMZiSwBlbqG6nyqfmIWkFWSAC24MqhOw4&_nc_ohc=R8uTNyO1i80Q7kNvwFaR8qT&_nc_oc=AdkZiMOcV-sPQSQc03p-YwZi2RiNKmIiKuzUMYBubmeiaMWUi4zbM2KKs8eALzfbegA&_nc_zt=23&_nc_ht=scontent.fbkk22-1.fna&edm=ANyJclEEAAAA&_nc_gid=gOWckalAWOQ6KNauxv7qOQ&oh=00_AfTxhizR1ScFbLxWxr4v10A9U-ovJJ4-XShKMkZ2XuvumA&oe=686FF226"}, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 13:02:31] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:02:32] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:32.025901", "execution_time_ms": 1734.87, "result": true}
[2025-07-06 13:02:32] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-06 13:02:32] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:32.026237", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1050f17f0>", "to_number": "79140775712", "content": "Pretty 😍\n2 600,00 ฿ 🌸", "msg_type": "image", "meta": {"image_url": "https://scontent.fbkk22-2.fna.fbcdn.net/v/t45.5328-4/513058785_748208634241719_9170859285232997266_n.jpg?_nc_cat=106&ccb=1-7&_nc_sid=c7e7b7&_nc_eui2=AeGuAFK8Opughasx6JpUR7oAK4sDRWdVrosriwNFZ1Wui-6dir18YgV6Bv5ujiMVN8R5g4pis3BrnbhUtCLaSB_J&_nc_ohc=-kFXCnhe93kQ7kNvwHYyfCk&_nc_oc=Adlh_NiN6TljGXKJYQOiLlkiV7DB89FIwYLN_QSxZBuKsrQjy8uipoSgtfsak8C9i8I&_nc_zt=23&_nc_ht=scontent.fbkk22-2.fna&edm=ANyJclEEAAAA&_nc_gid=gOWckalAWOQ6KNauxv7qOQ&oh=00_AfRBnFlRGXdtpP3dg_saozGyEt1DJ1ibHxIzsDdfl8AvNA&oe=686FCA6C"}, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": null, "content_thai": null}}
[2025-07-06 13:02:32] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:02:33] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:02:33.459782", "execution_time_ms": 1433.4, "result": true}
[2025-07-06 13:02:33] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79140775712
[2025-07-06 13:02:33] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:02:33.460157", "execution_time_ms": 41116.89, "result": true}
[2025-07-06 13:12:08] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:12:08.628569", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1052439d0>", "message_data": {"sender_id": "79140775712", "message_text": "привет", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTA4NDNEMzFFN0ZDRkI4REUzMwA=", "timestamp": "1751782318", "reply_to_message_id": null}}}
[2025-07-06 13:12:12] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T13:12:12.202506", "parameters": {"self": "<src.services.ai_service.AIService object at 0x105338410>", "text": "привет"}}
[2025-07-06 13:12:12] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T13:12:12.203454", "execution_time_ms": 0.56, "result": "ru"}
[2025-07-06 13:12:12] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:12:12.481316", "parameters": {"self": "<src.services.ai_service.AIService object at 0x105338410>", "text": "привет", "user_lang": "ru"}}
[2025-07-06 13:12:12] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:12:12.481861", "parameters": {"self": "<src.services.ai_service.AIService object at 0x105338410>", "text": "привет", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 13:12:14] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:12:14.701970", "execution_time_ms": 2219.89, "result": "hi"}
[2025-07-06 13:12:14] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:12:14.702443", "parameters": {"self": "<src.services.ai_service.AIService object at 0x105338410>", "text": "привет", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 13:12:15] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:12:15.567926", "execution_time_ms": 865.35, "result": "สวัสดี"}
[2025-07-06 13:12:15] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:12:15.568395", "execution_time_ms": 3086.6, "result": ["привет", "hi", "สวัสดี"]}
[2025-07-06 13:12:17] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:12:17.869415", "parameters": {"self": "<src.services.ai_service.AIService object at 0x105338410>", "messages": ["Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='привет', timestamp=datetime.datetime(2025, 7, 6, 13, 12, 17, 714559), content_en='hi', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)"], "user_lang": "auto", "sender_name": "Denis"}}
[2025-07-06 13:12:22] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:12:22.035357", "execution_time_ms": 4165.17, "result": ["Добрый день! Хотели бы посмотреть наш каталог цветов?", "Good afternoon! Would you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 13:12:22] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:12:22.682398", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1052439d0>", "to_number": "79140775712", "content": "Добрый день! Хотели бы посмотреть наш каталог цветов?", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "Good afternoon! Would you like to see our flower catalog?", "content_thai": "สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?"}}
[2025-07-06 13:12:24] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:12:25] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:12:25.254271", "execution_time_ms": 2571.46, "result": true}
[2025-07-06 13:12:25] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:12:25.254769", "execution_time_ms": 16624.79, "result": true}
[2025-07-06 13:12:52] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:12:52.302974", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x105338f50>", "message_data": {"sender_id": "79140775712", "message_text": "да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQURCMTAxRUVEOTc0RjAwM0RFNgA=", "timestamp": "1751782362", "reply_to_message_id": null}}}
[2025-07-06 13:12:54] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T13:12:54.841903", "parameters": {"self": "<src.services.ai_service.AIService object at 0x105338e10>", "text": "да"}}
[2025-07-06 13:12:54] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T13:12:54.842438", "execution_time_ms": 0.07, "result": "ru"}
[2025-07-06 13:12:55] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:12:55.080692", "parameters": {"self": "<src.services.ai_service.AIService object at 0x105338e10>", "text": "да", "user_lang": "ru"}}
[2025-07-06 13:12:55] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:12:55.081140", "parameters": {"self": "<src.services.ai_service.AIService object at 0x105338e10>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 13:12:57] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:12:57.191795", "execution_time_ms": 2110.41, "result": "yes"}
[2025-07-06 13:12:57] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:12:57.192774", "parameters": {"self": "<src.services.ai_service.AIService object at 0x105338e10>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 13:13:04] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:13:04.241104", "execution_time_ms": 7047.86, "result": "ใช่"}
[2025-07-06 13:13:04] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:13:04.242773", "execution_time_ms": 9161.7, "result": ["да", "yes", "ใช่"]}
[2025-07-06 13:13:07] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:13:07.280812", "parameters": {"self": "<src.services.ai_service.AIService object at 0x105338e10>", "messages": ["Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='привет', timestamp=datetime.datetime(2025, 7, 6, 13, 13, 7, 141003), content_en='hi', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы посмотреть наш каталог цветов?', timestamp=datetime.datetime(2025, 7, 6, 13, 13, 7, 141024), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 13, 7, 141028), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 13, 13, 7, 141030), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis"}}
[2025-07-06 13:13:11] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:13:11.057822", "execution_time_ms": 3776.22, "result": ["```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", null]}
[2025-07-06 13:13:11] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:13:11.771921", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x105338f50>", "to_number": "79140775712", "content": "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", "content_thai": "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```"}}
[2025-07-06 13:13:14] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:13:14] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:13:14.731961", "execution_time_ms": 2958.61, "result": true}
[2025-07-06 13:13:14] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:13:14.732407", "execution_time_ms": 22428.79, "result": true}
[2025-07-06 13:14:45] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:14:45.428910", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10524fa80>", "message_data": {"sender_id": "79140775712", "message_text": "да", "message_type": "text", "sender_name": "Test", "wa_message_id": "wamid.test_command_fix_123", "timestamp": "1751782000", "reply_to_message_id": null}}}
[2025-07-06 13:14:48] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:14:48.029590", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10524f360>", "text": "да", "user_lang": "ru"}}
[2025-07-06 13:14:48] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:14:48.029970", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10524f360>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 13:14:49] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:14:49.511128", "execution_time_ms": 1480.87, "result": "yes"}
[2025-07-06 13:14:49] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:14:49.511710", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10524f360>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 13:14:56] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:14:56.591379", "execution_time_ms": 7079.18, "result": "ใช่"}
[2025-07-06 13:14:56] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:14:56.594053", "execution_time_ms": 8564.05, "result": ["да", "yes", "ใช่"]}
[2025-07-06 13:14:58] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:14:58.558286", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10524f360>", "messages": ["Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='привет', timestamp=datetime.datetime(2025, 7, 6, 13, 14, 58, 414416), content_en='hi', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы посмотреть наш каталог цветов?', timestamp=datetime.datetime(2025, 7, 6, 13, 14, 58, 414433), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 14, 58, 414436), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 13, 14, 58, 414439), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='```json\\\\n{\\\\n  \"text\": \"\",\\\\n  \"text_en\": \"\",\\\\n  \"text_thai\": \"\",\\\\n  \"command\": {\\\\n    \"type\": \"send_catalog\"\\\\n  }\\\\n}\\\\n```', timestamp=datetime.datetime(2025, 7, 6, 13, 14, 58, 414442), content_en='```json\\\\n{\\\\n  \"text\": \"\",\\\\n  \"text_en\": \"\",\\\\n  \"text_thai\": \"\",\\\\n  \"command\": {\\\\n    \"type\": \"send_catalog\"\\\\n  }\\\\n}\\\\n```', content_thai='```json\\\\n{\\\\n  \"text\": \"\",\\\\n  \"text_en\": \"\",\\\\n  \"text_thai\": \"\",\\\\n  \"command\": {\\\\n    \"type\": \"send_catalog\"\\\\n  }\\\\n}\\\\n```', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='```json\\\\n{\\\\n  \"text\": \"\",\\\\n  \"text_en\": \"\",\\\\n  \"text_thai\": \"\",\\\\n  \"command\": {\\\\n    \"type\": \"send_catalog\"\\\\n  }\\\\n}\\\\n``` 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 14, 58, 414444), content_en='```json\\\\n{\\\\n  \"text\": \"\",\\\\n  \"text_en\": \"\",\\\\n  \"text_thai\": \"\",\\\\n  \"command\": {\\\\n    \"type\": \"send_catalog\"\\\\n  }\\\\n}\\\\n```', content_thai='```json\\\\n{\\\\n  \"text\": \"\",\\\\n  \"text_en\": \"\",\\\\n  \"text_thai\": \"\",\\\\n  \"command\": {\\\\n    \"type\": \"send_catalog\"\\\\n  }\\\\n}\\\\n```', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 13, 14, 58, 414447), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Test"}}
[2025-07-06 13:15:03] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:15:03.555134", "execution_time_ms": 4995.65, "result": ["```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", null]}
[2025-07-06 13:15:04] INFO: root - {"event": "function_start", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:15:04.179125", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10524fa80>", "to_number": "79140775712", "content": "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", "msg_type": "text", "meta": null, "save_to_db": true, "session_id": "20250706_115046_601831_301", "sender_id": "79140775712", "content_en": "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```", "content_thai": "```json\\n{\\n  \"text\": \"\",\\n  \"text_en\": \"\",\\n  \"text_thai\": \"\",\\n  \"command\": {\\n    \"type\": \"send_catalog\"\\n  }\\n}\\n```"}}
[2025-07-06 13:15:06] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:15:06] INFO: root - {"event": "function_end", "module": "message_processor", "function": "send_message", "timestamp": "2025-07-06T13:15:06.616423", "execution_time_ms": 2436.65, "result": true}
[2025-07-06 13:15:06] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:15:06.616941", "execution_time_ms": 21187.6, "result": true}
[2025-07-06 13:31:23] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:31:23.192166", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10547f610>", "message_data": {"sender_id": "79140775712", "message_text": "Привет!", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTkwOTg4ODM4RjEyRTI3NUU3NAA=", "timestamp": "1751783473", "reply_to_message_id": null}}}
[2025-07-06 13:31:26] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T13:31:26.170048", "parameters": {"self": "<src.services.ai_service.AIService object at 0x105514050>", "text": "Привет!"}}
[2025-07-06 13:31:26] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T13:31:26.170486", "execution_time_ms": 0.27, "result": "ru"}
[2025-07-06 13:31:26] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:31:26.399171", "parameters": {"self": "<src.services.ai_service.AIService object at 0x105514050>", "text": "Привет!", "user_lang": "ru"}}
[2025-07-06 13:31:26] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:31:26.399700", "parameters": {"self": "<src.services.ai_service.AIService object at 0x105514050>", "text": "Привет!", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 13:31:28] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:31:28.668328", "execution_time_ms": 2268.47, "result": "Hello!"}
[2025-07-06 13:31:28] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:31:28.668656", "parameters": {"self": "<src.services.ai_service.AIService object at 0x105514050>", "text": "Привет!", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 13:31:35] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:31:35.763177", "execution_time_ms": 7093.03, "result": "สวัสดีครับ"}
[2025-07-06 13:31:35] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:31:35.766837", "execution_time_ms": 9367.14, "result": ["Привет!", "Hello!", "สวัสดีครับ"]}
[2025-07-06 13:31:37] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:31:37.953839", "parameters": {"self": "<src.services.ai_service.AIService object at 0x105514050>", "messages": ["Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 6, 13, 31, 37, 782806), content_en='Hello!', content_thai='สวัสดีครับ', id=None, wa_message_id=None, parts=None)"], "user_lang": "auto", "sender_name": "Denis"}}
[2025-07-06 13:31:42] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:31:42.122676", "execution_time_ms": 4168.3, "result": ["Добрый день! Хотели бы вы посмотреть наш каталог цветов?", "Good afternoon! Would you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 13:31:44] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:31:45] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:31:45.266577", "execution_time_ms": 22072.65, "result": true}
[2025-07-06 13:32:41] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:32:41.846199", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10547efd0>", "message_data": {"sender_id": "79140775712", "message_text": "Да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTAzMTcyMEFEOEIzMDA3NDYwOQA=", "timestamp": "1751783552", "reply_to_message_id": null}}}
[2025-07-06 13:32:44] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T13:32:44.228137", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10547f610>", "text": "Да"}}
[2025-07-06 13:32:44] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T13:32:44.229545", "execution_time_ms": 0.93, "result": "ru"}
[2025-07-06 13:32:44] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:32:44.459133", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10547f610>", "text": "Да", "user_lang": "ru"}}
[2025-07-06 13:32:44] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:32:44.459701", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10547f610>", "text": "Да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 13:32:45] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:32:45.804340", "execution_time_ms": 1344.33, "result": "Yes"}
[2025-07-06 13:32:45] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:32:45.804852", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10547f610>", "text": "Да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 13:32:53] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:32:53.546655", "execution_time_ms": 7741.43, "result": "ครับ"}
[2025-07-06 13:32:53] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:32:53.548110", "execution_time_ms": 9088.53, "result": ["Да", "Yes", "ครับ"]}
[2025-07-06 13:32:55] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:32:55.798668", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10547f610>", "messages": ["Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 6, 13, 32, 55, 573340), content_en='Hello!', content_thai='สวัสดีครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы вы посмотреть наш каталог цветов?', timestamp=datetime.datetime(2025, 7, 6, 13, 32, 55, 573363), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 32, 55, 573365), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_115046_601831_301', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 13, 32, 55, 573366), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis"}}
[2025-07-06 13:32:58] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:32:58.750450", "execution_time_ms": 2950.88, "result": ["", "", "", {"type": "send_catalog"}]}
[2025-07-06 13:32:58] ERROR: root - [MESSAGE_PROCESSOR] Error: content не может быть пустым
[2025-07-06 13:32:58] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:32:58.751926", "execution_time_ms": 16905.1, "result": false}
[2025-07-06 13:40:24] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:40:24.120509", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x114147610>", "message_data": {"sender_id": "79140775712", "message_text": "Привет", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUIzNUJBNkQ2RUVEQ0RBNDNFMQA=", "timestamp": "1751784014", "reply_to_message_id": null}}}
[2025-07-06 13:40:25] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:40:25] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:40:28] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T13:40:28.799722", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1141d8050>", "text": "Привет"}}
[2025-07-06 13:40:28] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T13:40:28.800676", "execution_time_ms": 0.54, "result": "ru"}
[2025-07-06 13:40:28] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:40:28.998387", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1141d8050>", "text": "Привет", "user_lang": "ru"}}
[2025-07-06 13:40:28] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:40:28.998819", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1141d8050>", "text": "Привет", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 13:40:31] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:40:31.258594", "execution_time_ms": 2259.48, "result": "Hello"}
[2025-07-06 13:40:31] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:40:31.260576", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1141d8050>", "text": "Привет", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 13:40:32] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:40:32.389929", "execution_time_ms": 1128.95, "result": "สวัสดี"}
[2025-07-06 13:40:32] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:40:32.390572", "execution_time_ms": 3391.82, "result": ["Привет", "Hello", "สวัสดี"]}
[2025-07-06 13:40:34] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:40:34.681775", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1141d8050>", "messages": ["Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 13, 40, 34, 433602), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)"], "user_lang": "auto", "sender_name": "Denis", "is_first_message": true}}
[2025-07-06 13:40:39] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:40:39.212712", "execution_time_ms": 4530.33, "result": ["Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов?", "Good afternoon, Denis! Would you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 13:40:42] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:40:43] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:40:43.165828", "execution_time_ms": 19044.14, "result": true}
[2025-07-06 13:40:57] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:40:57.521334", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x114146d50>", "message_data": {"sender_id": "79140775712", "message_text": "да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTJFRkVGNTgwNkM2MDZERkM4QQA=", "timestamp": "1751784048", "reply_to_message_id": null}}}
[2025-07-06 13:40:58] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:40:58] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:41:01] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T13:41:01.645766", "parameters": {"self": "<src.services.ai_service.AIService object at 0x114147610>", "text": "да"}}
[2025-07-06 13:41:01] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T13:41:01.646456", "execution_time_ms": 0.04, "result": "ru"}
[2025-07-06 13:41:01] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:41:01.840137", "parameters": {"self": "<src.services.ai_service.AIService object at 0x114147610>", "text": "да", "user_lang": "ru"}}
[2025-07-06 13:41:01] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:41:01.840560", "parameters": {"self": "<src.services.ai_service.AIService object at 0x114147610>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 13:41:03] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:41:03.964961", "execution_time_ms": 2124.22, "result": "yes"}
[2025-07-06 13:41:03] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:41:03.965675", "parameters": {"self": "<src.services.ai_service.AIService object at 0x114147610>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 13:41:14] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:41:14.218341", "execution_time_ms": 10252.13, "result": "ค่ะ"}
[2025-07-06 13:41:14] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:41:14.220403", "execution_time_ms": 12379.91, "result": ["да", "yes", "ค่ะ"]}
[2025-07-06 13:41:16] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:41:16.615568", "parameters": {"self": "<src.services.ai_service.AIService object at 0x114147610>", "messages": ["Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 13, 41, 16, 383177), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов?', timestamp=datetime.datetime(2025, 7, 6, 13, 41, 16, 383193), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 41, 16, 383196), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 13, 41, 16, 383198), content_en='yes', content_thai='ค่ะ', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 13:41:19] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:41:19.937519", "execution_time_ms": 3321.31, "result": ["", "", "", {"type": "send_catalog"}]}
[2025-07-06 13:41:21] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 13:41:21] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 13:41:22] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 13:41:22] ERROR: src.services.catalog_sender - [CATALOG_SEND_ERROR] Ошибка отправки каталога: 'MessageProcessor' object has no attribute 'send_message'
[2025-07-06 13:41:22] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:41:22.380198", "execution_time_ms": 24858.35, "result": true}
[2025-07-06 13:45:05] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:45:05.362689", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x109995e80>", "message_data": {"sender_id": "79140775712", "message_text": "Привет", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTAzMTU3NzIyRUYxRDI0QjYwRgA=", "timestamp": "1751784295", "reply_to_message_id": null}}}
[2025-07-06 13:45:06] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:45:06] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:45:14] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T13:45:14.887985", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109996900>", "text": "Привет"}}
[2025-07-06 13:45:14] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T13:45:14.890105", "execution_time_ms": 0.6, "result": "ru"}
[2025-07-06 13:45:15] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:45:15.105406", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109996900>", "text": "Привет", "user_lang": "ru"}}
[2025-07-06 13:45:15] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:45:15.105988", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109996900>", "text": "Привет", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 13:45:17] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:45:17.514941", "execution_time_ms": 2408.69, "result": "Hello"}
[2025-07-06 13:45:17] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:45:17.515605", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109996900>", "text": "Привет", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 13:45:18] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:45:18.591502", "execution_time_ms": 1075.68, "result": "สวัสดี"}
[2025-07-06 13:45:18] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:45:18.591831", "execution_time_ms": 3485.91, "result": ["Привет", "Hello", "สวัสดี"]}
[2025-07-06 13:45:20] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:45:20.707705", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109996900>", "messages": ["Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 13, 45, 20, 569537), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)"], "user_lang": "auto", "sender_name": "Denis", "is_first_message": true}}
[2025-07-06 13:45:24] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:45:24.896130", "execution_time_ms": 4187.63, "result": ["Добрый день! Хотели бы посмотреть наш каталог цветов?", "Good afternoon! Would you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 13:45:28] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:45:28] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:45:28.943277", "execution_time_ms": 23579.22, "result": true}
[2025-07-06 13:46:18] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:46:18.368921", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x109932c10>", "message_data": {"sender_id": "79140775712", "message_text": "да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUU2NTlCMUZENTY0QkM1QkRDMwA=", "timestamp": "1751784368", "reply_to_message_id": null}}}
[2025-07-06 13:46:19] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:46:19] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:46:22] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T13:46:22.279129", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109933d90>", "text": "да"}}
[2025-07-06 13:46:22] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T13:46:22.280083", "execution_time_ms": 0.14, "result": "ru"}
[2025-07-06 13:46:22] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:46:22.483186", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109933d90>", "text": "да", "user_lang": "ru"}}
[2025-07-06 13:46:22] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:46:22.483731", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109933d90>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 13:46:24] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:46:24.443607", "execution_time_ms": 1959.7, "result": "yes"}
[2025-07-06 13:46:24] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:46:24.443858", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109933d90>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 13:46:27] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:46:27.689535", "execution_time_ms": 3245.4, "result": "ใช่"}
[2025-07-06 13:46:27] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:46:27.690395", "execution_time_ms": 5206.76, "result": ["да", "yes", "ใช่"]}
[2025-07-06 13:46:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:46:29.839931", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109933d90>", "messages": ["Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 13, 46, 29, 708528), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы посмотреть наш каталог цветов?', timestamp=datetime.datetime(2025, 7, 6, 13, 46, 29, 708546), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 46, 29, 708550), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 13, 46, 29, 708553), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 13:46:33] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:46:33.338372", "execution_time_ms": 3497.71, "result": ["", "", "", {"type": "send_catalog"}]}
[2025-07-06 13:46:34] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 13:46:34] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 13:46:35] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 13:46:37] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:46:39] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-06 13:46:40] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:46:40] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-06 13:46:41] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:46:42] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-06 13:46:43] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:46:43] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-06 13:46:44] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:46:45] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-06 13:46:46] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:46:46] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79140775712
[2025-07-06 13:46:46] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:46:46.568014", "execution_time_ms": 28197.96, "result": true}
[2025-07-06 13:47:24] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:47:24.925279", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x109932850>", "message_data": {"sender_id": "79140775712", "message_text": "Этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTEzNkExREVCRjVFNEQ5NDk4MAA=", "timestamp": "1751784427", "reply_to_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI5MkE5MzJFMTA3Q0FGNEY2MDgA"}}}
[2025-07-06 13:47:25] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:47:26] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:47:28] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:47:28.861201", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109933110>", "text": "Этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "user_lang": "ru"}}
[2025-07-06 13:47:28] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:47:28.862660", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109933110>", "text": "Этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 13:47:30] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:47:30.769050", "execution_time_ms": 1906.14, "result": "This (reply to: Candy’s\n฿1,450.00 🌸)"}
[2025-07-06 13:47:30] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:47:30.770493", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109933110>", "text": "Этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 13:47:39] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:47:39.674748", "execution_time_ms": 8903.71, "result": "นี่ (ตอบกลับถึง: Candy’s\n1,450.00 ฿ 🌸)"}
[2025-07-06 13:47:39] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:47:39.675898", "execution_time_ms": 10813.3, "result": ["Этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "This (reply to: Candy’s\n฿1,450.00 🌸)", "นี่ (ตอบกลับถึง: Candy’s\n1,450.00 ฿ 🌸)"]}
[2025-07-06 13:47:41] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:47:41.950641", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109933110>", "messages": ["Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 13, 47, 41, 775200), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы посмотреть наш каталог цветов?', timestamp=datetime.datetime(2025, 7, 6, 13, 47, 41, 775231), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 47, 41, 775235), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 13, 47, 41, 775238), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='[COMMAND]', timestamp=datetime.datetime(2025, 7, 6, 13, 47, 41, 775241), content_en='[COMMAND]', content_thai='[COMMAND]', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\n\\nСейчас я покажу вам каждый букет с фотографией.\\n\\nПожалуйста, подождите минутку...', timestamp=datetime.datetime(2025, 7, 6, 13, 47, 41, 775243), content_en='Excellent!\\n\\nI will now show you each bouquet with a photo.\\n\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\n\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูค่ะ\\n\\nกรุณารอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 47, 41, 775250), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 47, 41, 775252), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 47, 41, 775255), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 47, 41, 775257), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 13:47:46] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:47:46.879592", "execution_time_ms": 4928.04, "result": ["Pink peony 15\\n4 500,00 ฿", "Pink peony 15\\n4,500.00 ฿", "ดอกโบตั๋นสีชมพู 15\\n4,500.00 ฿", null]}
[2025-07-06 13:47:49] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:47:50] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:47:50.106991", "execution_time_ms": 25180.66, "result": true}
[2025-07-06 13:51:51] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:51:51.284782", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1079b6120>", "message_data": {"sender_id": "79140775712", "message_text": "Вот этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTIxQThBOTNFQUNEMTM5MDIyNAA=", "timestamp": "1751784695", "reply_to_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI5MkE5MzJFMTA3Q0FGNEY2MDgA"}}}
[2025-07-06 13:51:52] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:51:52] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:51:55] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:51:55.685114", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079b6900>", "text": "Вот этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "user_lang": "ru"}}
[2025-07-06 13:51:55] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:51:55.686326", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079b6900>", "text": "Вот этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 13:51:58] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:51:58.822716", "execution_time_ms": 3136.13, "result": "This one (reply to: Candy’s 1 450,00 ฿ 🌸)"}
[2025-07-06 13:51:58] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:51:58.823252", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079b6900>", "text": "Вот этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 13:52:05] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T13:52:05.075288", "execution_time_ms": 6251.5, "result": "อันนี้ (ตอบกลับ: Candy’s 1 450,00 ฿ 🌸)"}
[2025-07-06 13:52:05] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T13:52:05.077418", "execution_time_ms": 9391.16, "result": ["Вот этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "This one (reply to: Candy’s 1 450,00 ฿ 🌸)", "อันนี้ (ตอบกลับ: Candy’s 1 450,00 ฿ 🌸)"]}
[2025-07-06 13:52:07] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:52:07.296992", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079b6900>", "messages": ["Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 13, 52, 7, 164283), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы посмотреть наш каталог цветов?', timestamp=datetime.datetime(2025, 7, 6, 13, 52, 7, 164294), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 52, 7, 164296), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 13, 52, 7, 164298), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='[COMMAND]', timestamp=datetime.datetime(2025, 7, 6, 13, 52, 7, 164299), content_en='[COMMAND]', content_thai='[COMMAND]', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\n\\nСейчас я покажу вам каждый букет с фотографией.\\n\\nПожалуйста, подождите минутку...', timestamp=datetime.datetime(2025, 7, 6, 13, 52, 7, 164300), content_en='Excellent!\\n\\nI will now show you each bouquet with a photo.\\n\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\n\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูค่ะ\\n\\nกรุณารอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 52, 7, 164302), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 52, 7, 164303), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 52, 7, 164304), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 13, 52, 7, 164305), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 13:52:19] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T13:52:19.449423", "execution_time_ms": 12151.58, "result": ["", "", "", {"type": "send_catalog"}]}
[2025-07-06 13:52:21] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 13:52:21] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 13:52:22] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 13:52:22] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:52:24] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-06 13:52:25] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:52:25] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-06 13:52:26] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:52:27] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-06 13:52:28] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:52:28] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-06 13:52:29] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:52:30] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-06 13:52:30] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 13:52:31] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79140775712
[2025-07-06 13:52:31] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T13:52:31.443762", "execution_time_ms": 40157.88, "result": true}
[2025-07-06 14:42:37] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T14:42:37.347494", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1093967b0>", "message_data": {"sender_id": "79140775712", "message_text": "эй", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUYzQzNFM0UwNjJDOURENEE2QwA=", "timestamp": "1751727298", "reply_to_message_id": null}}}
[2025-07-06 14:42:38] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 14:42:38] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 14:42:40] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T14:42:40.966675", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109396cf0>", "text": "эй", "user_lang": "ru"}}
[2025-07-06 14:42:40] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T14:42:40.967229", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109396cf0>", "text": "эй", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 14:42:42] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T14:42:42.037762", "execution_time_ms": 1070.23, "result": "hey"}
[2025-07-06 14:42:42] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T14:42:42.038619", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109396cf0>", "text": "эй", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 14:42:43] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T14:42:43.991963", "execution_time_ms": 1953.16, "result": "เฮ้"}
[2025-07-06 14:42:43] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T14:42:43.992689", "execution_time_ms": 3025.53, "result": ["эй", "hey", "เฮ้"]}
[2025-07-06 14:42:45] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T14:42:45.906788", "parameters": {"self": "<src.services.ai_service.AIService object at 0x109396cf0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 14, 42, 45, 773401), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы посмотреть наш каталог цветов?', timestamp=datetime.datetime(2025, 7, 6, 14, 42, 45, 773457), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 14, 42, 45, 773464), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 14, 42, 45, 773468), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='[COMMAND]', timestamp=datetime.datetime(2025, 7, 6, 14, 42, 45, 773471), content_en='[COMMAND]', content_thai='[COMMAND]', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\n\\nСейчас я покажу вам каждый букет с фотографией.\\n\\nПожалуйста, подождите минутку...', timestamp=datetime.datetime(2025, 7, 6, 14, 42, 45, 773474), content_en='Excellent!\\n\\nI will now show you each bouquet with a photo.\\n\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\n\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูค่ะ\\n\\nกรุณารอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 14, 42, 45, 773477), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 14, 42, 45, 773480), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 14, 42, 45, 773483), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 14, 42, 45, 773486), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 14:42:53] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T14:42:53.254134", "execution_time_ms": 7344.59, "result": ["Pretty 😍\\n2 600,00 ฿", "Pretty 😍\\n2,600.00 ฿", "Pretty 😍\\n2,600.00 ฿", null]}
[2025-07-06 14:42:54] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 14:42:54] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T14:42:54.629758", "execution_time_ms": 17280.37, "result": true}
[2025-07-06 14:48:19] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T14:48:19.422008", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x110fea900>", "message_data": {"sender_id": "79140775712", "message_text": "привет", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTBDOTcyNURGMjU4Mjk0OTIwOAA=", "timestamp": "1751788089", "reply_to_message_id": null}}}
[2025-07-06 14:48:20] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 14:48:20] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 14:48:22] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T14:48:22.860969", "parameters": {"self": "<src.services.ai_service.AIService object at 0x110feae40>", "text": "привет"}}
[2025-07-06 14:48:22] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T14:48:22.861957", "execution_time_ms": 0.46, "result": "ru"}
[2025-07-06 14:48:23] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T14:48:23.087937", "parameters": {"self": "<src.services.ai_service.AIService object at 0x110feae40>", "text": "привет", "user_lang": "ru"}}
[2025-07-06 14:48:23] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T14:48:23.089055", "parameters": {"self": "<src.services.ai_service.AIService object at 0x110feae40>", "text": "привет", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 14:48:24] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T14:48:24.428770", "execution_time_ms": 1339.2, "result": "hello"}
[2025-07-06 14:48:24] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T14:48:24.429448", "parameters": {"self": "<src.services.ai_service.AIService object at 0x110feae40>", "text": "привет", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 14:48:25] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T14:48:25.163336", "execution_time_ms": 733.67, "result": "สวัสดี"}
[2025-07-06 14:48:25] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T14:48:25.163926", "execution_time_ms": 2075.32, "result": ["привет", "hello", "สวัสดี"]}
[2025-07-06 14:48:27] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T14:48:27.043945", "parameters": {"self": "<src.services.ai_service.AIService object at 0x110feae40>", "messages": ["Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='привет', timestamp=datetime.datetime(2025, 7, 6, 14, 48, 26, 877975), content_en='hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)"], "user_lang": "auto", "sender_name": "Denis", "is_first_message": true}}
[2025-07-06 14:48:31] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T14:48:31.754656", "execution_time_ms": 4710.21, "result": ["Добрый день! Хотели бы вы посмотреть наш каталог цветов?", "Good afternoon! Would you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 14:48:32] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 14:48:32] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T14:48:32.957958", "execution_time_ms": 13534.11, "result": true}
[2025-07-06 14:49:00] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T14:49:00.838441", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x110f8a990>", "message_data": {"sender_id": "79140775712", "message_text": "Давай", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTIyQTlENDRDOUU0MzU5NzMwRgA=", "timestamp": "1751788129", "reply_to_message_id": null}}}
[2025-07-06 14:49:01] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 14:49:01] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 14:49:03] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T14:49:03.849102", "parameters": {"self": "<src.services.ai_service.AIService object at 0x110f8a0d0>", "text": "Давай"}}
[2025-07-06 14:49:03] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T14:49:03.851469", "execution_time_ms": 1.53, "result": "ru"}
[2025-07-06 14:49:04] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T14:49:04.137638", "parameters": {"self": "<src.services.ai_service.AIService object at 0x110f8a0d0>", "text": "Давай", "user_lang": "ru"}}
[2025-07-06 14:49:04] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T14:49:04.138123", "parameters": {"self": "<src.services.ai_service.AIService object at 0x110f8a0d0>", "text": "Давай", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 14:49:07] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T14:49:07.702755", "execution_time_ms": 3564.21, "result": "Let's go"}
[2025-07-06 14:49:07] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T14:49:07.703352", "parameters": {"self": "<src.services.ai_service.AIService object at 0x110f8a0d0>", "text": "Давай", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 14:49:13] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T14:49:13.722101", "execution_time_ms": 6018.49, "result": "เอาเลย"}
[2025-07-06 14:49:13] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T14:49:13.722795", "execution_time_ms": 9584.77, "result": ["Давай", "Let's go", "เอาเลย"]}
[2025-07-06 14:49:15] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T14:49:15.589524", "parameters": {"self": "<src.services.ai_service.AIService object at 0x110f8a0d0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='привет', timestamp=datetime.datetime(2025, 7, 6, 14, 49, 15, 468420), content_en='hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 14, 49, 15, 468454), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='Давай', timestamp=datetime.datetime(2025, 7, 6, 14, 49, 15, 468458), content_en=\"Let's go\", content_thai='เอาเลย', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 14:49:23] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T14:49:23.309642", "execution_time_ms": 7718.85, "result": ["Отлично!\\n\\nСейчас я покажу вам каждый букет с фотографией.\\n\\nПожалуйста, подождите минутку...", "Excellent!\\n\\nNow I will show you each bouquet with a photo.\\n\\nPlease wait a moment...", "เยี่ยมเลยค่ะ!\\n\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\n\\nกรุณารอสักครู่ค่ะ...", {"type": "send_catalog"}]}
[2025-07-06 14:49:24] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 14:49:25] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 14:49:25] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 14:49:25] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 14:49:25] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-06 14:49:26] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 14:49:27] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-06 14:49:28] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 14:49:29] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-06 14:49:29] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 14:49:30] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-06 14:49:31] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 14:49:31] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-06 14:49:32] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 14:49:32] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79140775712
[2025-07-06 14:49:32] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T14:49:32.709899", "execution_time_ms": 31870.06, "result": true}
[2025-07-06 14:50:31] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T14:50:31.515410", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x110f8ae90>", "message_data": {"sender_id": "79140775712", "message_text": "Этот (ответ на: Good vibes🌸\n2 350,00 ฿ 🌸)", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUU3ODZDNTY2MDNCRjQ5MEU3RgA=", "timestamp": "1751788216", "reply_to_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI4OTkxMDY0OTY3RjdGNDBFODUA"}}}
[2025-07-06 14:50:32] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 14:50:32] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 14:50:34] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T14:50:34.579844", "parameters": {"self": "<src.services.ai_service.AIService object at 0x110f8afd0>", "text": "Этот (ответ на: Good vibes🌸\n2 350,00 ฿ 🌸)", "user_lang": "ru"}}
[2025-07-06 14:50:34] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T14:50:34.580329", "parameters": {"self": "<src.services.ai_service.AIService object at 0x110f8afd0>", "text": "Этот (ответ на: Good vibes🌸\n2 350,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 14:50:36] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T14:50:36.558413", "execution_time_ms": 1977.87, "result": "This (reply to: Good vibes🌸\n2,350.00 ฿ 🌸)"}
[2025-07-06 14:50:36] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T14:50:36.559043", "parameters": {"self": "<src.services.ai_service.AIService object at 0x110f8afd0>", "text": "Этот (ответ на: Good vibes🌸\n2 350,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 14:50:40] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T14:50:40.404468", "execution_time_ms": 3845.1, "result": "ตอบกลับถึง: Good vibes🌸\n2 350,00 ฿ 🌸)"}
[2025-07-06 14:50:40] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T14:50:40.405952", "execution_time_ms": 5825.69, "result": ["Этот (ответ на: Good vibes🌸\n2 350,00 ฿ 🌸)", "This (reply to: Good vibes🌸\n2,350.00 ฿ 🌸)", "ตอบกลับถึง: Good vibes🌸\n2 350,00 ฿ 🌸)"]}
[2025-07-06 14:50:42] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T14:50:42.362018", "parameters": {"self": "<src.services.ai_service.AIService object at 0x110f8afd0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='привет', timestamp=datetime.datetime(2025, 7, 6, 14, 50, 42, 229043), content_en='hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 14, 50, 42, 229063), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='Давай', timestamp=datetime.datetime(2025, 7, 6, 14, 50, 42, 229066), content_en=\"Let's go\", content_thai='เอาเลย', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 14, 50, 42, 229069), content_en='Excellent!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='เยี่ยมเลยค่ะ!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\\\n\\\\nกรุณารอสักครู่ค่ะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 14, 50, 42, 229071), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 14, 50, 42, 229074), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 14, 50, 42, 229076), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 14, 50, 42, 229079), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 14, 50, 42, 229082), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_134027_94496_144', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 14, 50, 42, 229084), content_en='This (reply to: Good vibes🌸\\n2,350.00 ฿ 🌸)', content_thai='ตอบกลับถึง: Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸)', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 14:50:48] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T14:50:48.106690", "execution_time_ms": 5743.77, "result": ["Букет 'Good vibes🌸' сохранен.\\n\\nНужна ли доставка? Куда?", "The bouquet 'Good vibes🌸' is saved.\\n\\nDo you need delivery? Where?", "บันทึกช่อดอกไม้ 'Good vibes🌸' แล้วค่ะ\\n\\nต้องการจัดส่งหรือไม่คะ? ที่ไหนคะ?", {"type": "save_order_info", "bouquet": "Good vibes🌸", "retailer_id": "xi6jawqotv"}]}
[2025-07-06 14:50:48] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 14:50:50] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T14:50:50.349605", "execution_time_ms": 18833.31, "result": true}
[2025-07-06 15:05:21] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:05:21.386267", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107136900>", "message_data": {"sender_id": "79140775712", "message_text": "Привет!", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTM4NDI0Rjk0QTk5NUZGNUVFQgA=", "timestamp": "1751789110", "reply_to_message_id": null}}}
[2025-07-06 15:05:22] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:05:22] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:05:27] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T15:05:27.932807", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107136e40>", "text": "Привет!"}}
[2025-07-06 15:05:27] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T15:05:27.933829", "execution_time_ms": 0.36, "result": "ru"}
[2025-07-06 15:05:28] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:05:28.149463", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107136e40>", "text": "Привет!", "user_lang": "ru"}}
[2025-07-06 15:05:28] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:05:28.149610", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107136e40>", "text": "Привет!", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 15:05:30] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:05:30.512472", "execution_time_ms": 2362.55, "result": "Hello!"}
[2025-07-06 15:05:30] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:05:30.513605", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107136e40>", "text": "Привет!", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 15:05:31] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:05:31.522468", "execution_time_ms": 1008.65, "result": "สวัสดี"}
[2025-07-06 15:05:31] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:05:31.522886", "execution_time_ms": 3373.29, "result": ["Привет!", "Hello!", "สวัสดี"]}
[2025-07-06 15:05:33] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:05:33.211145", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107136e40>", "messages": ["Message(sender_id='79140775712', session_id='20250706_150524_459548_448', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 6, 15, 5, 33, 81523), content_en='Hello!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)"], "user_lang": "auto", "sender_name": "Denis", "is_first_message": true}}
[2025-07-06 15:05:38] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:05:38.587800", "execution_time_ms": 5375.74, "result": ["Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов?", "Good afternoon, Denis! Would you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ เดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 15:05:39] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:05:39] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:05:39.742951", "execution_time_ms": 18355.36, "result": true}
[2025-07-06 15:09:57] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:09:57.758076", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x123aa63c0>", "message_data": {"sender_id": "79140775712", "message_text": "Привет", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTY0QjVGNjk2QTUyNzYwMzgxMAA=", "timestamp": "1751789387", "reply_to_message_id": null}}}
[2025-07-06 15:09:58] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:09:58] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:10:03] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T15:10:03.312321", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123aa6a50>", "text": "Привет"}}
[2025-07-06 15:10:03] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T15:10:03.313853", "execution_time_ms": 0.7, "result": "ru"}
[2025-07-06 15:10:03] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:10:03.554052", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123aa6a50>", "text": "Привет", "user_lang": "ru"}}
[2025-07-06 15:10:03] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:10:03.554365", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123aa6a50>", "text": "Привет", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 15:10:05] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:10:05.700457", "execution_time_ms": 2145.84, "result": "Hello"}
[2025-07-06 15:10:05] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:10:05.701490", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123aa6a50>", "text": "Привет", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 15:10:06] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:10:06.602208", "execution_time_ms": 900.49, "result": "สวัสดี"}
[2025-07-06 15:10:06] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:10:06.602537", "execution_time_ms": 3048.21, "result": ["Привет", "Hello", "สวัสดี"]}
[2025-07-06 15:10:08] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:10:08.362622", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123aa6a50>", "messages": ["Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 15, 10, 8, 247861), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)"], "user_lang": "auto", "sender_name": "Denis", "is_first_message": true}}
[2025-07-06 15:10:13] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:10:13.091421", "execution_time_ms": 4727.22, "result": ["Добрый день!\\n\\nХотели бы вы посмотреть наш каталог цветов?", "Good afternoon!\\n\\nWould you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ!\\n\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 15:10:13] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:10:14] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:10:14.380255", "execution_time_ms": 16620.58, "result": true}
[2025-07-06 15:11:02] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:11:02.702580", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x123a4ee90>", "message_data": {"sender_id": "79140775712", "message_text": "Да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTMxNTQ4NjREOERFOTNFMTg1NQA=", "timestamp": "1751789452", "reply_to_message_id": null}}}
[2025-07-06 15:11:03] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:11:03] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:11:07] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T15:11:07.624638", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123a4fc50>", "text": "Да"}}
[2025-07-06 15:11:07] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T15:11:07.626857", "execution_time_ms": 1.5, "result": "ru"}
[2025-07-06 15:11:07] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:11:07.863822", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123a4fc50>", "text": "Да", "user_lang": "ru"}}
[2025-07-06 15:11:07] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:11:07.865343", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123a4fc50>", "text": "Да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 15:11:09] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:11:09.889087", "execution_time_ms": 2023.16, "result": "Yes"}
[2025-07-06 15:11:09] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:11:09.889770", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123a4fc50>", "text": "Да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 15:11:15] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:11:15.333038", "execution_time_ms": 5442.7, "result": "ครับ"}
[2025-07-06 15:11:15] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:11:15.334790", "execution_time_ms": 7469.58, "result": ["Да", "Yes", "ครับ"]}
[2025-07-06 15:11:17] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:11:17.168068", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123a4fc50>", "messages": ["Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 15, 11, 17, 33788), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день!\\\\n\\\\nХотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 11, 17, 33815), content_en='Good afternoon!\\\\n\\\\nWould you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ!\\\\n\\\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 15, 11, 17, 33822), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 15:11:22] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:11:22.421743", "execution_time_ms": 5252.84, "result": ["Отлично!\\n\\nСейчас я покажу вам каждый букет с фотографией.\\n\\nПожалуйста, подождите минутку...", "Great!\\n\\nNow I will show you each bouquet with a photo.\\n\\nPlease wait a moment...", "ยอดเยี่ยม!\\n\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\n\\nโปรดรอสักครู่นะคะ...", {"type": "send_catalog"}]}
[2025-07-06 15:11:23] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:11:24] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 15:11:24] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 15:11:25] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 15:11:25] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-06 15:11:25] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:11:27] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-06 15:11:27] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:11:28] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-06 15:11:29] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:11:29] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-06 15:11:30] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:11:30] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-06 15:11:31] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:11:32] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79140775712
[2025-07-06 15:11:32] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:11:32.079149", "execution_time_ms": 29375.18, "result": true}
[2025-07-06 15:12:04] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:12:04.135441", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x123a4e0d0>", "message_data": {"sender_id": "79140775712", "message_text": "этот (ответ на: Good vibes🌸\n2 350,00 ฿ 🌸)", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUZFODJFQTAyQ0Y5NjZBMjNGQgA=", "timestamp": "1751789509", "reply_to_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI3Q0UzQjkyMDdDRTRBNDA1NkQA"}}}
[2025-07-06 15:12:04] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:12:05] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:12:08] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:12:08.957314", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123a4fc50>", "text": "этот (ответ на: Good vibes🌸\n2 350,00 ฿ 🌸)", "user_lang": "ru"}}
[2025-07-06 15:12:08] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:12:08.957859", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123a4fc50>", "text": "этот (ответ на: Good vibes🌸\n2 350,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 15:12:12] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:12:11.999958", "execution_time_ms": 3041.82, "result": "this (reply to: Good vibes🌸\n2,350.00 ฿ 🌸)"}
[2025-07-06 15:12:12] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:12:12.000918", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123a4fc50>", "text": "этот (ответ на: Good vibes🌸\n2 350,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 15:12:21] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:12:21.493765", "execution_time_ms": 9491.78, "result": "(ตอบกลับถึง: Good vibes🌸\n2 350,00 ฿ 🌸)"}
[2025-07-06 15:12:21] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:12:21.496605", "execution_time_ms": 12538.8, "result": ["этот (ответ на: Good vibes🌸\n2 350,00 ฿ 🌸)", "this (reply to: Good vibes🌸\n2,350.00 ฿ 🌸)", "(ตอบกลับถึง: Good vibes🌸\n2 350,00 ฿ 🌸)"]}
[2025-07-06 15:12:23] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:12:23.370537", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123a4fc50>", "messages": ["Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 15, 12, 23, 220904), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день!\\\\n\\\\nХотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 12, 23, 220922), content_en='Good afternoon!\\\\n\\\\nWould you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ!\\\\n\\\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 15, 12, 23, 220926), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 12, 23, 220928), content_en='Great!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่นะคะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 12, 23, 220931), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 12, 23, 220933), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 12, 23, 220935), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 12, 23, 220938), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 12, 23, 220940), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.USER: 'user'>, content='этот (ответ на: Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 15, 12, 23, 220943), content_en='this (reply to: Good vibes🌸\\n2,350.00 ฿ 🌸)', content_thai='(ตอบกลับถึง: Good vibes🌸\\n2 350,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 15:12:29] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:12:29.433714", "execution_time_ms": 6062.17, "result": ["Ваш букет 'Good vibes🌸' сохранен.\\n\\nВам нужна доставка?", "Your bouquet 'Good vibes🌸' is saved.\\n\\nDo you need delivery?", "บันทึกช่อดอกไม้ 'Good vibes🌸' ของคุณแล้วค่ะ\\n\\nคุณต้องการบริการจัดส่งไหมคะ?", {"type": "save_order_info", "bouquet": "Good vibes🌸", "retailer_id": "xi6jawqotv"}]}
[2025-07-06 15:12:30] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:12:32] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:12:32.258723", "execution_time_ms": 28122.52, "result": true}
[2025-07-06 15:13:25] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:13:25.216663", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x123a6e9e0>", "message_data": {"sender_id": "79140775712", "message_text": "вгв", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTcxMjUxMjI5OEUxOEMxMEM0RAA=", "timestamp": "1751789595", "reply_to_message_id": null}}}
[2025-07-06 15:13:25] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:13:26] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:13:30] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:13:30.126560", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123a6e650>", "text": "вгв", "user_lang": "ru"}}
[2025-07-06 15:13:30] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:13:30.128750", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123a6e650>", "text": "вгв", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 15:13:32] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:13:32.675919", "execution_time_ms": 2546.14, "result": "vgv"}
[2025-07-06 15:13:32] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:13:32.676565", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123a6e650>", "text": "вгв", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 15:13:37] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:13:37.061368", "execution_time_ms": 4384.38, "result": "วกว"}
[2025-07-06 15:13:37] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:13:37.062204", "execution_time_ms": 6933.58, "result": ["вгв", "vgv", "วกว"]}
[2025-07-06 15:13:38] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:13:38.890239", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123a6e650>", "messages": ["Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 15, 13, 38, 774308), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день!\\\\n\\\\nХотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 13, 38, 774332), content_en='Good afternoon!\\\\n\\\\nWould you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ!\\\\n\\\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 15, 13, 38, 774335), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 13, 38, 774338), content_en='Great!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่นะคะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 13, 38, 774340), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 13, 38, 774342), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 13, 38, 774344), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 13, 38, 774346), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 13, 38, 774348), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.USER: 'user'>, content='этот (ответ на: Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 15, 13, 38, 774350), content_en='this (reply to: Good vibes🌸\\n2,350.00 ฿ 🌸)', content_thai='(ตอบกลับถึง: Good vibes🌸\\n2 350,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 15:13:45] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:13:45.696387", "execution_time_ms": 6805.08, "result": ["Ваш букет 'Good vibes🌸' сохранен.\\n\\nВам нужна доставка?", "Your bouquet 'Good vibes🌸' is saved.\\n\\nDo you need delivery?", "บันทึกช่อดอกไม้ 'Good vibes🌸' ของคุณแล้วค่ะ\\n\\nคุณต้องการบริการจัดส่งหรือไม่คะ?", {"type": "save_order_info", "bouquet": "Good vibes🌸", "retailer_id": "xi6jawqotv"}]}
[2025-07-06 15:13:46] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:13:48] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:13:48.489816", "execution_time_ms": 23272.38, "result": true}
[2025-07-06 15:15:34] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:15:34.103982", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x123a6ed70>", "message_data": {"sender_id": "79140775712", "message_text": "да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTREQUEyRjE5RURFMzRCMEE1OAA=", "timestamp": "1751789723", "reply_to_message_id": null}}}
[2025-07-06 15:15:34] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:15:35] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:15:39] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:15:39.240753", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123a6e520>", "text": "да", "user_lang": "ru"}}
[2025-07-06 15:15:39] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:15:39.241579", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123a6e520>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 15:15:41] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:15:41.406840", "execution_time_ms": 2165.04, "result": "yes"}
[2025-07-06 15:15:41] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:15:41.407262", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123a6e520>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 15:15:45] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:15:45.013473", "execution_time_ms": 3606.02, "result": "ค่ะ"}
[2025-07-06 15:15:45] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:15:45.013755", "execution_time_ms": 5772.24, "result": ["да", "yes", "ค่ะ"]}
[2025-07-06 15:15:46] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:15:46.846296", "parameters": {"self": "<src.services.ai_service.AIService object at 0x123a6e520>", "messages": ["Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 15, 15, 46, 681584), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день!\\\\n\\\\nХотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 15, 46, 681602), content_en='Good afternoon!\\\\n\\\\nWould you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ!\\\\n\\\\nคุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 15, 15, 46, 681606), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 15, 46, 681609), content_en='Great!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่นะคะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 15, 46, 681612), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 15, 46, 681615), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 15, 46, 681617), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 15, 46, 681619), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 15, 46, 681621), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_150959_946085_351', role=<MessageRole.USER: 'user'>, content='этот (ответ на: Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 15, 15, 46, 681624), content_en='this (reply to: Good vibes🌸\\n2,350.00 ฿ 🌸)', content_thai='(ตอบกลับถึง: Good vibes🌸\\n2 350,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 15:15:51] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:15:51.552026", "execution_time_ms": 4704.53, "result": ["Букет 'Good vibes🌸' сохранен.\\n\\nВам нужна доставка?", "Bouquet 'Good vibes🌸' is saved.\\n\\nDo you need delivery?", "บันทึกช่อดอกไม้ 'Good vibes🌸' แล้วค่ะ\\n\\nคุณต้องการจัดส่งหรือไม่คะ?", {"type": "save_order_info", "bouquet": "Good vibes🌸", "retailer_id": "xi6jawqotv"}]}
[2025-07-06 15:15:52] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:15:54] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:15:54.496724", "execution_time_ms": 20391.74, "result": true}
[2025-07-06 15:24:11] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:24:11.528008", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1091a6ba0>", "message_data": {"sender_id": "79140775712", "message_text": "Привет", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUM5NkY5NDA0OTIzRkI4RERCNAA=", "timestamp": "1751790242", "reply_to_message_id": null}}}
[2025-07-06 15:24:12] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:24:12] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:24:17] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T15:24:17.197264", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1091a70e0>", "text": "Привет"}}
[2025-07-06 15:24:17] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T15:24:17.198983", "execution_time_ms": 0.66, "result": "ru"}
[2025-07-06 15:24:17] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:24:17.406269", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1091a70e0>", "text": "Привет", "user_lang": "ru"}}
[2025-07-06 15:24:17] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:24:17.406724", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1091a70e0>", "text": "Привет", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 15:24:19] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:24:19.625244", "execution_time_ms": 2218.12, "result": "Hello"}
[2025-07-06 15:24:19] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:24:19.626404", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1091a70e0>", "text": "Привет", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 15:24:20] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:24:20.515183", "execution_time_ms": 888.38, "result": "สวัสดี"}
[2025-07-06 15:24:20] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:24:20.515673", "execution_time_ms": 3109.0, "result": ["Привет", "Hello", "สวัสดี"]}
[2025-07-06 15:24:22] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:24:22.388824", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1091a70e0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 15, 24, 22, 265841), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)"], "user_lang": "auto", "sender_name": "Denis", "is_first_message": true}}
[2025-07-06 15:24:27] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:24:27.383971", "execution_time_ms": 4994.56, "result": ["Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов?", "Good afternoon, Denis! Would you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 15:24:28] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:24:28] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:24:28.558971", "execution_time_ms": 17029.66, "result": true}
[2025-07-06 15:24:41] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:24:41.985190", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10914bed0>", "message_data": {"sender_id": "79140775712", "message_text": "да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTQyRUY1QjgxQjE5QjlGRkRBNQA=", "timestamp": "1751790272", "reply_to_message_id": null}}}
[2025-07-06 15:24:42] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:24:43] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:24:46] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T15:24:46.698165", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10914b9d0>", "text": "да"}}
[2025-07-06 15:24:46] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T15:24:46.698645", "execution_time_ms": 0.05, "result": "ru"}
[2025-07-06 15:24:46] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:24:46.912780", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10914b9d0>", "text": "да", "user_lang": "ru"}}
[2025-07-06 15:24:46] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:24:46.913129", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10914b9d0>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 15:24:48] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:24:48.975693", "execution_time_ms": 2062.39, "result": "yes"}
[2025-07-06 15:24:48] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:24:48.976683", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10914b9d0>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 15:25:01] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:25:01.050508", "execution_time_ms": 12073.51, "result": "ครับ"}
[2025-07-06 15:25:01] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:25:01.053576", "execution_time_ms": 14140.48, "result": ["да", "yes", "ครับ"]}
[2025-07-06 15:25:02] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:25:02.889957", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10914b9d0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 15, 25, 2, 753711), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 25, 2, 753735), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 15, 25, 2, 753741), content_en='yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 15:25:08] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:25:08.284778", "execution_time_ms": 5393.86, "result": ["Отлично!\\n\\nСейчас я покажу вам каждый букет с фотографией.\\n\\nПожалуйста, подождите минутку...", "Excellent!\\n\\nNow I will show you each bouquet with a photo.\\n\\nPlease wait a moment...", "ยอดเยี่ยม!\\n\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\n\\nกรุณารอสักครู่นะคะ...", {"type": "send_catalog"}]}
[2025-07-06 15:25:09] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:25:10] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 15:25:10] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 15:25:10] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 15:25:10] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-06 15:25:11] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:25:12] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-06 15:25:13] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:25:14] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-06 15:25:14] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:25:15] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-06 15:25:16] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:25:16] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-06 15:25:17] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:25:17] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79140775712
[2025-07-06 15:25:17] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:25:17.537426", "execution_time_ms": 35551.6, "result": true}
[2025-07-06 15:26:26] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:26:26.019883", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10914bd90>", "message_data": {"sender_id": "79140775712", "message_text": "Этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTY3RkZEQTI2NjJBQkMwMDZGRQA=", "timestamp": "1751790369", "reply_to_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBIzMkI5RDdFNDFERUE5M0Q3RTcA"}}}
[2025-07-06 15:26:26] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:26:27] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:26:31] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:26:31.217794", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10914b390>", "text": "Этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "user_lang": "ru"}}
[2025-07-06 15:26:31] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:26:31.218692", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10914b390>", "text": "Этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 15:26:33] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:26:33.082409", "execution_time_ms": 1863.35, "result": "This (reply to: Candy’s\n฿1,450.00 🌸)"}
[2025-07-06 15:26:33] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:26:33.084375", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10914b390>", "text": "Этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 15:26:40] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:26:40.701088", "execution_time_ms": 7616.39, "result": "นี่ (ตอบกลับถึง: Candy’s\n1 450,00 ฿ 🌸)"}
[2025-07-06 15:26:40] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:26:40.702696", "execution_time_ms": 9484.1, "result": ["Этот (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "This (reply to: Candy’s\n฿1,450.00 🌸)", "นี่ (ตอบกลับถึง: Candy’s\n1 450,00 ฿ 🌸)"]}
[2025-07-06 15:26:42] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:26:42.567495", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10914b390>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 15, 26, 42, 432829), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 26, 42, 432858), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 15, 26, 42, 432865), content_en='yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 26, 42, 432869), content_en='Excellent!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\\\n\\\\nกรุณารอสักครู่นะคะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 26, 42, 432872), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 26, 42, 432875), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 26, 42, 432878), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 26, 42, 432881), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 26, 42, 432883), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Candy’s\\n1\\xa0450,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 15, 26, 42, 432886), content_en='This (reply to: Candy’s\\n฿1,450.00 🌸)', content_thai='นี่ (ตอบกลับถึง: Candy’s\\n1\\xa0450,00\\xa0฿ 🌸)', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 15:26:47] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:26:47.514700", "execution_time_ms": 4945.65, "result": ["Букет 'Candy’s' добавлен к вашему заказу.\\n\\nВам потребуется доставка?", "The bouquet 'Candy’s' has been added to your order.\\n\\nDo you need delivery?", "ช่อดอกไม้ 'Candy’s' ได้ถูกเพิ่มในคำสั่งซื้อของคุณแล้วค่ะ\\n\\nคุณต้องการบริการจัดส่งไหมคะ?", {"type": "save_order_info", "bouquet": "Candy’s", "retailer_id": "t8bpd4wssw"}]}
[2025-07-06 15:26:48] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:26:50] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:26:50.441195", "execution_time_ms": 24420.0, "result": true}
[2025-07-06 15:30:58] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:30:58.268032", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x122786660>", "message_data": {"sender_id": "79140775712", "message_text": "Привет", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUQ5QjYyNzM2QUQ1NTcyQTBDMwA=", "timestamp": "1751790648", "reply_to_message_id": null}}}
[2025-07-06 15:30:58] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:30:59] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:31:03] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T15:31:03.973869", "parameters": {"self": "<src.services.ai_service.AIService object at 0x122786a50>", "text": "Привет"}}
[2025-07-06 15:31:03] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T15:31:03.976054", "execution_time_ms": 0.59, "result": "ru"}
[2025-07-06 15:31:04] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:31:04.227992", "parameters": {"self": "<src.services.ai_service.AIService object at 0x122786a50>", "text": "Привет", "user_lang": "ru"}}
[2025-07-06 15:31:04] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:31:04.228391", "parameters": {"self": "<src.services.ai_service.AIService object at 0x122786a50>", "text": "Привет", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 15:31:05] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:31:05.385161", "execution_time_ms": 1156.11, "result": "Hello"}
[2025-07-06 15:31:05] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:31:05.385648", "parameters": {"self": "<src.services.ai_service.AIService object at 0x122786a50>", "text": "Привет", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 15:31:06] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:31:06.497975", "execution_time_ms": 1111.97, "result": "สวัสดี"}
[2025-07-06 15:31:06] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:31:06.498449", "execution_time_ms": 2270.13, "result": ["Привет", "Hello", "สวัสดี"]}
[2025-07-06 15:31:08] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:31:08.392970", "parameters": {"self": "<src.services.ai_service.AIService object at 0x122786a50>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 15, 31, 8, 250025), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)"], "user_lang": "auto", "sender_name": "Denis", "is_first_message": true}}
[2025-07-06 15:31:13] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:31:13.851805", "execution_time_ms": 5458.41, "result": ["Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов?", "Good afternoon, Denis! Would you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 15:31:14] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:31:15] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:31:15.094123", "execution_time_ms": 16824.23, "result": true}
[2025-07-06 15:33:12] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:33:12.866030", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10cf8e270>", "message_data": {"sender_id": "79140775712", "message_text": "да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTIxOTIwQzA5OTg0M0I3QzUyRgA=", "timestamp": "1751790782", "reply_to_message_id": null}}}
[2025-07-06 15:33:13] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:33:14] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:33:18] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T15:33:18.206778", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10cf8e900>", "text": "да"}}
[2025-07-06 15:33:18] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T15:33:18.207946", "execution_time_ms": 0.48, "result": "ru"}
[2025-07-06 15:33:18] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:33:18.457075", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10cf8e900>", "text": "да", "user_lang": "ru"}}
[2025-07-06 15:33:18] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:33:18.457735", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10cf8e900>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 15:33:20] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:33:20.639718", "execution_time_ms": 2181.46, "result": "yes"}
[2025-07-06 15:33:20] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:33:20.641053", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10cf8e900>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 15:33:27] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:33:27.682725", "execution_time_ms": 7041.1, "result": "ใช่"}
[2025-07-06 15:33:27] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:33:27.684269", "execution_time_ms": 9226.63, "result": ["да", "yes", "ใช่"]}
[2025-07-06 15:33:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:33:29.709223", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10cf8e900>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 15, 33, 29, 567349), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 33, 29, 567364), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 15, 33, 29, 567368), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 15:33:34] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:33:34.645326", "execution_time_ms": 4934.92, "result": ["Отлично!\\n\\nСейчас я покажу вам каждый букет с фотографией.\\n\\nПожалуйста, подождите минутку...", "Excellent!\\n\\nNow I will show you each bouquet with a photo.\\n\\nPlease wait a moment...", "ยอดเยี่ยม!\\n\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\n\\nโปรดรอสักครู่...", {"type": "send_catalog"}]}
[2025-07-06 15:33:35] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:33:37] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 15:33:37] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 15:33:37] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 15:33:37] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-06 15:33:38] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:33:39] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-06 15:33:40] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:33:41] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-06 15:33:41] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:33:42] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-06 15:33:43] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:33:43] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-06 15:33:44] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:33:44] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79140775712
[2025-07-06 15:33:44] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:33:44.658279", "execution_time_ms": 31791.28, "result": true}
[2025-07-06 15:35:03] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:35:03.531040", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10d022990>", "message_data": {"sender_id": "79140775712", "message_text": "Этот (ответ на: Pretty 😍\n2 600,00 ฿ 🌸)", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTlGODUwNEI1OTVGODlDMUNFQgA=", "timestamp": "1751790887", "reply_to_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI2RTM0NDEyNjMxMUI5QjY5RjEA"}}}
[2025-07-06 15:35:04] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:35:04] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:35:08] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:35:08.507825", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10d0220d0>", "text": "Этот (ответ на: Pretty 😍\n2 600,00 ฿ 🌸)", "user_lang": "ru"}}
[2025-07-06 15:35:08] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:35:08.508587", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10d0220d0>", "text": "Этот (ответ на: Pretty 😍\n2 600,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 15:35:10] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:35:10.341099", "execution_time_ms": 1832.18, "result": "This (response to: Pretty 😍\n2 600,00 ฿ 🌸)"}
[2025-07-06 15:35:10] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:35:10.342380", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10d0220d0>", "text": "Этот (ответ на: Pretty 😍\n2 600,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 15:35:14] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:35:14.331414", "execution_time_ms": 3988.55, "result": "อันนี้ (ตอบกลับถึง: Pretty 😍\n2 600,00 ฿ 🌸)"}
[2025-07-06 15:35:14] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:35:14.331974", "execution_time_ms": 5823.46, "result": ["Этот (ответ на: Pretty 😍\n2 600,00 ฿ 🌸)", "This (response to: Pretty 😍\n2 600,00 ฿ 🌸)", "อันนี้ (ตอบกลับถึง: Pretty 😍\n2 600,00 ฿ 🌸)"]}
[2025-07-06 15:35:16] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:35:16.249924", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10d0220d0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 15, 35, 16, 126968), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 35, 16, 126985), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 15, 35, 16, 126989), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 35, 16, 126992), content_en='Excellent!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 35, 16, 126995), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 35, 16, 126998), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 35, 16, 127000), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 35, 16, 127003), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 35, 16, 127005), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 15, 35, 16, 127007), content_en='This (response to: Pretty 😍\\n2 600,00 ฿ 🌸)', content_thai='อันนี้ (ตอบกลับถึง: Pretty 😍\\n2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 15:35:21] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:35:21.258454", "execution_time_ms": 5007.33, "result": ["Букет 'Pretty 😍' сохранен.\\n\\nВам нужна доставка?", "Your bouquet 'Pretty 😍' is saved.\\n\\nDo you need delivery?", "บันทึกช่อดอกไม้ 'Pretty 😍' ของคุณแล้วค่ะ\\n\\nคุณต้องการบริการจัดส่งไหมคะ?", {"type": "save_order_info", "bouquet": "Pretty 😍", "retailer_id": "kie4sy3qsy"}]}
[2025-07-06 15:35:22] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:35:24] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:35:24.109667", "execution_time_ms": 20577.27, "result": true}
[2025-07-06 15:40:11] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:40:11.902121", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108b16a50>", "message_data": {"sender_id": "79140775712", "message_text": "да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUYxMDUzQkUzNDVEN0Q5NkZBQwA=", "timestamp": "1751791202", "reply_to_message_id": null}}}
[2025-07-06 15:40:12] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:40:13] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:40:17] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:40:17.349382", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108b170e0>", "text": "да", "user_lang": "ru"}}
[2025-07-06 15:40:17] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:40:17.350695", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108b170e0>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 15:40:19] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:40:19.457117", "execution_time_ms": 2105.09, "result": "yes"}
[2025-07-06 15:40:19] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:40:19.458899", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108b170e0>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 15:40:26] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:40:26.538783", "execution_time_ms": 7079.28, "result": "ใช่"}
[2025-07-06 15:40:26] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:40:26.540273", "execution_time_ms": 9189.68, "result": ["да", "yes", "ใช่"]}
[2025-07-06 15:40:28] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:40:28.435473", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108b170e0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 15, 40, 28, 295400), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 40, 28, 295420), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 15, 40, 28, 295425), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 40, 28, 295428), content_en='Excellent!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 40, 28, 295432), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 40, 28, 295435), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 40, 28, 295438), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 40, 28, 295441), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 40, 28, 295444), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 15, 40, 28, 295446), content_en='This (response to: Pretty 😍\\n2 600,00 ฿ 🌸)', content_thai='อันนี้ (ตอบกลับถึง: Pretty 😍\\n2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Букет 'Pretty 😍' сохранен.\\\\n\\\\nВам нужна доставка? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 15, 40, 28, 295449), content_en=\"Your bouquet 'Pretty 😍' is saved.\\\\n\\\\nDo you need delivery?\", content_thai=\"บันทึกช่อดอกไม้ 'Pretty 😍' ของคุณแล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 15, 40, 28, 295452), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 15:40:37] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:40:37.134612", "execution_time_ms": 8697.62, "result": ["Доставка включена в ваш заказ.\\n\\nСтоимость доставки по районам:\\n- Раваи: 500 бат\\n- Чалонг: 380 бат\\n- Пхукет Таун: 300 бат\\n- Кату: 280 бат\\n- Патонг: 400 бат\\n- Банг Тао: 500 бат\\n- Лагуна: 500 бат\\n- Таланг/Май Као: 550 бат\\n\\nПожалуйста, укажите полный адрес доставки.", "Delivery is included in your order.\\n\\nDelivery costs by district:\\n- Rawai: 500 baht\\n- Chalong: 380 baht\\n- Phuket Town: 300 baht\\n- Kathu: 280 baht\\n- Patong: 400 baht\\n- Bang Tao: 500 baht\\n- Laguna: 500 baht\\n- Thalang/Mai Khao: 550 baht\\n\\nPlease provide the full delivery address.", "รวมค่าจัดส่งในการสั่งซื้อของคุณแล้วค่ะ\\n\\nค่าจัดส่งตามเขต:\\n- ราไวย์: 500 บาท\\n- ฉลอง: 380 บาท\\n- ภูเก็ตทาวน์: 300 บาท\\n- กะทู้: 280 บาท\\n- ป่าตอง: 400 บาท\\n- บางเทา: 500 บาท\\n- ลากูน่า: 500 บาท\\n- ถลาง/ไม้ขาว: 550 บาท\\n\\nกรุณาระบุที่อยู่จัดส่งให้ครบถ้วนค่ะ", {"type": "save_order_info", "bouquet": "Pretty 😍", "retailer_id": "kie4sy3qsy", "delivery_needed": true}]}
[2025-07-06 15:40:37] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:40:40] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:40:40.910622", "execution_time_ms": 29007.21, "result": true}
[2025-07-06 15:41:20] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:41:20.791197", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108abfd90>", "message_data": {"sender_id": "79140775712", "message_text": "Centio condo", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTY5MDY4QjY4NjY4M0VGNEVGNAA=", "timestamp": "1751791270", "reply_to_message_id": null}}}
[2025-07-06 15:41:21] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:41:22] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:41:25] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:41:25.826080", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108abe5d0>", "text": "Centio condo", "user_lang": "ru"}}
[2025-07-06 15:41:25] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:41:25.826965", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108abe5d0>", "text": "Centio condo", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 15:41:30] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:41:30.964724", "execution_time_ms": 5137.46, "result": "Centio condo"}
[2025-07-06 15:41:30] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:41:30.965586", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108abe5d0>", "text": "Centio condo", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 15:41:34] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T15:41:34.139798", "execution_time_ms": 3173.95, "result": "เซ็นติโอ คอนโด"}
[2025-07-06 15:41:34] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T15:41:34.141285", "execution_time_ms": 8314.36, "result": ["Centio condo", "Centio condo", "เซ็นติโอ คอนโด"]}
[2025-07-06 15:41:36] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:41:36.114260", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108abe5d0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 15, 41, 35, 999494), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 41, 35, 999508), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 15, 41, 35, 999518), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 41, 35, 999524), content_en='Excellent!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 41, 35, 999526), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 41, 35, 999528), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 41, 35, 999530), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 41, 35, 999531), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 41, 35, 999533), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 15, 41, 35, 999535), content_en='This (response to: Pretty 😍\\n2 600,00 ฿ 🌸)', content_thai='อันนี้ (ตอบกลับถึง: Pretty 😍\\n2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Букет 'Pretty 😍' сохранен.\\\\n\\\\nВам нужна доставка? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 15, 41, 35, 999536), content_en=\"Your bouquet 'Pretty 😍' is saved.\\\\n\\\\nDo you need delivery?\", content_thai=\"บันทึกช่อดอกไม้ 'Pretty 😍' ของคุณแล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 15, 41, 35, 999538), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доставка включена в ваш заказ.\\\\n\\\\nСтоимость доставки по районам:\\\\n- Раваи: 500 бат\\\\n- Чалонг: 380 бат\\\\n- Пхукет Таун: 300 бат\\\\n- Кату: 280 бат\\\\n- Патонг: 400 бат\\\\n- Банг Тао: 500 бат\\\\n- Лагуна: 500 бат\\\\n- Таланг/Май Као: 550 бат\\\\n\\\\nПожалуйста, укажите полный адрес доставки. 🌸', timestamp=datetime.datetime(2025, 7, 6, 15, 41, 35, 999643), content_en='Delivery is included in your order.\\\\n\\\\nDelivery costs by district:\\\\n- Rawai: 500 baht\\\\n- Chalong: 380 baht\\\\n- Phuket Town: 300 baht\\\\n- Kathu: 280 baht\\\\n- Patong: 400 baht\\\\n- Bang Tao: 500 baht\\\\n- Laguna: 500 baht\\\\n- Thalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='รวมค่าจัดส่งในการสั่งซื้อของคุณแล้วค่ะ\\\\n\\\\nค่าจัดส่งตามเขต:\\\\n- ราไวย์: 500 บาท\\\\n- ฉลอง: 380 บาท\\\\n- ภูเก็ตทาวน์: 300 บาท\\\\n- กะทู้: 280 บาท\\\\n- ป่าตอง: 400 บาท\\\\n- บางเทา: 500 บาท\\\\n- ลากูน่า: 500 บาท\\\\n- ถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งให้ครบถ้วนค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Centio condo', timestamp=datetime.datetime(2025, 7, 6, 15, 41, 35, 999644), content_en='Centio condo', content_thai='เซ็นติโอ คอนโด', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 15:41:43] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T15:41:43.457121", "execution_time_ms": 7341.75, "result": ["Спасибо за адрес!\\n\\nПожалуйста, укажите желаемую дату и время доставки.\\n\\nМы доставляем цветы с 8:00 до 21:00.", "Thank you for the address!\\n\\nPlease specify the desired date and time for delivery.\\n\\nWe deliver flowers from 8:00 AM to 9:00 PM.", "ขอบคุณสำหรับที่อยู่ค่ะ!\\n\\nกรุณาระบุวันที่และเวลาที่ต้องการจัดส่งดอกไม้ค่ะ\\n\\nเราจัดส่งดอกไม้ตั้งแต่ 8:00 น. ถึง 21:00 น.", {"type": "save_order_info", "address": "Centio condo"}]}
[2025-07-06 15:41:44] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 15:41:45] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T15:41:45.958839", "execution_time_ms": 25166.73, "result": true}
[2025-07-06 16:00:40] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:00:40.908156", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107552120>", "message_data": {"sender_id": "79140775712", "message_text": "В среду в 15", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUNENkI1MTI4QkVERDM5QzY2NgA=", "timestamp": "1751792432", "reply_to_message_id": null}}}
[2025-07-06 16:00:41] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:00:42] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:00:46] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:00:46.330877", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107552900>", "text": "В среду в 15", "user_lang": "ru"}}
[2025-07-06 16:00:46] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:00:46.331646", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107552900>", "text": "В среду в 15", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 16:00:47] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:00:47.687996", "execution_time_ms": 1356.12, "result": "On Wednesday at 15"}
[2025-07-06 16:00:47] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:00:47.688779", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107552900>", "text": "В среду в 15", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 16:00:50] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:00:50.873221", "execution_time_ms": 3183.93, "result": "วันพุธ เวลา 15:00 น."}
[2025-07-06 16:00:50] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:00:50.874787", "execution_time_ms": 4543.17, "result": ["В среду в 15", "On Wednesday at 15", "วันพุธ เวลา 15:00 น."]}
[2025-07-06 16:00:52] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:00:52.871517", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107552900>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 16, 0, 52, 744286), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 0, 52, 744310), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 0, 52, 744313), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 0, 52, 744316), content_en='Excellent!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 0, 52, 744319), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 0, 52, 744322), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 0, 52, 744324), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 0, 52, 744326), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 0, 52, 744328), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 0, 52, 744330), content_en='This (response to: Pretty 😍\\n2 600,00 ฿ 🌸)', content_thai='อันนี้ (ตอบกลับถึง: Pretty 😍\\n2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Букет 'Pretty 😍' сохранен.\\\\n\\\\nВам нужна доставка? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 0, 52, 744332), content_en=\"Your bouquet 'Pretty 😍' is saved.\\\\n\\\\nDo you need delivery?\", content_thai=\"บันทึกช่อดอกไม้ 'Pretty 😍' ของคุณแล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 0, 52, 744335), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доставка включена в ваш заказ.\\\\n\\\\nСтоимость доставки по районам:\\\\n- Раваи: 500 бат\\\\n- Чалонг: 380 бат\\\\n- Пхукет Таун: 300 бат\\\\n- Кату: 280 бат\\\\n- Патонг: 400 бат\\\\n- Банг Тао: 500 бат\\\\n- Лагуна: 500 бат\\\\n- Таланг/Май Као: 550 бат\\\\n\\\\nПожалуйста, укажите полный адрес доставки. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 0, 52, 744337), content_en='Delivery is included in your order.\\\\n\\\\nDelivery costs by district:\\\\n- Rawai: 500 baht\\\\n- Chalong: 380 baht\\\\n- Phuket Town: 300 baht\\\\n- Kathu: 280 baht\\\\n- Patong: 400 baht\\\\n- Bang Tao: 500 baht\\\\n- Laguna: 500 baht\\\\n- Thalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='รวมค่าจัดส่งในการสั่งซื้อของคุณแล้วค่ะ\\\\n\\\\nค่าจัดส่งตามเขต:\\\\n- ราไวย์: 500 บาท\\\\n- ฉลอง: 380 บาท\\\\n- ภูเก็ตทาวน์: 300 บาท\\\\n- กะทู้: 280 บาท\\\\n- ป่าตอง: 400 บาท\\\\n- บางเทา: 500 บาท\\\\n- ลากูน่า: 500 บาท\\\\n- ถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งให้ครบถ้วนค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Centio condo', timestamp=datetime.datetime(2025, 7, 6, 16, 0, 52, 744339), content_en='Centio condo', content_thai='เซ็นติโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо за адрес!\\\\n\\\\nПожалуйста, укажите желаемую дату и время доставки.\\\\n\\\\nМы доставляем цветы с 8:00 до 21:00. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 0, 52, 744341), content_en='Thank you for the address!\\\\n\\\\nPlease specify the desired date and time for delivery.\\\\n\\\\nWe deliver flowers from 8:00 AM to 9:00 PM.', content_thai='ขอบคุณสำหรับที่อยู่ค่ะ!\\\\n\\\\nกรุณาระบุวันที่และเวลาที่ต้องการจัดส่งดอกไม้ค่ะ\\\\n\\\\nเราจัดส่งดอกไม้ตั้งแต่ 8:00 น. ถึง 21:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='В среду в 15', timestamp=datetime.datetime(2025, 7, 6, 16, 0, 52, 744343), content_en='On Wednesday at 15', content_thai='วันพุธ เวลา 15:00 น.', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:01:00] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:01:00.474302", "execution_time_ms": 7601.6, "result": ["Спасибо! Дата и время доставки сохранены: 9 июля 2025 года, 15:00.\\n\\nНужна ли открытка к букету? Если да, какой текст на ней написать?", "Thank you! The delivery date and time have been saved: July 9, 2025, 15:00.\\n\\nDo you need a card with the bouquet? If yes, what text should be written on it?", "ขอบคุณค่ะ! วันที่และเวลาจัดส่งได้บันทึกไว้แล้ว: 9 กรกฎาคม 2568, 15:00 น.\\n\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่? ถ้าใช่, ต้องการให้เขียนข้อความอะไรลงในการ์ดคะ?", {"type": "save_order_info", "bouquet": "Pretty 😍", "retailer_id": "kie4sy3qsy", "delivery_needed": true, "address": "Centio condo", "date": "2025-07-09", "time": "15:00"}]}
[2025-07-06 16:01:01] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:01:04] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:01:04.080355", "execution_time_ms": 23170.78, "result": true}
[2025-07-06 16:02:06] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:02:06.049550", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1074f3ed0>", "message_data": {"sender_id": "79140775712", "message_text": "С любовью, Петя", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTUxNDQxMUQ4QkFFNzkyODREOQA=", "timestamp": "1751792516", "reply_to_message_id": null}}}
[2025-07-06 16:02:06] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:02:07] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:02:11] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:02:11.181792", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1074f2ad0>", "text": "С любовью, Петя", "user_lang": "ru"}}
[2025-07-06 16:02:11] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:02:11.183257", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1074f2ad0>", "text": "С любовью, Петя", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 16:02:13] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:02:13.080118", "execution_time_ms": 1896.42, "result": "With love, Petya"}
[2025-07-06 16:02:13] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:02:13.081606", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1074f2ad0>", "text": "С любовью, Петя", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 16:02:18] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:02:18.051641", "execution_time_ms": 4969.57, "result": "ด้วยรัก, เปตยา"}
[2025-07-06 16:02:18] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:02:18.052906", "execution_time_ms": 6869.8, "result": ["С любовью, Петя", "With love, Petya", "ด้วยรัก, เปตยา"]}
[2025-07-06 16:02:19] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:02:19.919243", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1074f2ad0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779920), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779935), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779938), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779941), content_en='Excellent!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779944), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779946), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779949), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779951), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779954), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779956), content_en='This (response to: Pretty 😍\\n2 600,00 ฿ 🌸)', content_thai='อันนี้ (ตอบกลับถึง: Pretty 😍\\n2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Букет 'Pretty 😍' сохранен.\\\\n\\\\nВам нужна доставка? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779959), content_en=\"Your bouquet 'Pretty 😍' is saved.\\\\n\\\\nDo you need delivery?\", content_thai=\"บันทึกช่อดอกไม้ 'Pretty 😍' ของคุณแล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779961), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доставка включена в ваш заказ.\\\\n\\\\nСтоимость доставки по районам:\\\\n- Раваи: 500 бат\\\\n- Чалонг: 380 бат\\\\n- Пхукет Таун: 300 бат\\\\n- Кату: 280 бат\\\\n- Патонг: 400 бат\\\\n- Банг Тао: 500 бат\\\\n- Лагуна: 500 бат\\\\n- Таланг/Май Као: 550 бат\\\\n\\\\nПожалуйста, укажите полный адрес доставки. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779963), content_en='Delivery is included in your order.\\\\n\\\\nDelivery costs by district:\\\\n- Rawai: 500 baht\\\\n- Chalong: 380 baht\\\\n- Phuket Town: 300 baht\\\\n- Kathu: 280 baht\\\\n- Patong: 400 baht\\\\n- Bang Tao: 500 baht\\\\n- Laguna: 500 baht\\\\n- Thalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='รวมค่าจัดส่งในการสั่งซื้อของคุณแล้วค่ะ\\\\n\\\\nค่าจัดส่งตามเขต:\\\\n- ราไวย์: 500 บาท\\\\n- ฉลอง: 380 บาท\\\\n- ภูเก็ตทาวน์: 300 บาท\\\\n- กะทู้: 280 บาท\\\\n- ป่าตอง: 400 บาท\\\\n- บางเทา: 500 บาท\\\\n- ลากูน่า: 500 บาท\\\\n- ถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งให้ครบถ้วนค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Centio condo', timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779965), content_en='Centio condo', content_thai='เซ็นติโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо за адрес!\\\\n\\\\nПожалуйста, укажите желаемую дату и время доставки.\\\\n\\\\nМы доставляем цветы с 8:00 до 21:00. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779968), content_en='Thank you for the address!\\\\n\\\\nPlease specify the desired date and time for delivery.\\\\n\\\\nWe deliver flowers from 8:00 AM to 9:00 PM.', content_thai='ขอบคุณสำหรับที่อยู่ค่ะ!\\\\n\\\\nกรุณาระบุวันที่และเวลาที่ต้องการจัดส่งดอกไม้ค่ะ\\\\n\\\\nเราจัดส่งดอกไม้ตั้งแต่ 8:00 น. ถึง 21:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='В среду в 15', timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779970), content_en='On Wednesday at 15', content_thai='วันพุธ เวลา 15:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо! Дата и время доставки сохранены: 9 июля 2025 года, 15:00.\\\\n\\\\nНужна ли открытка к букету? Если да, какой текст на ней написать? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779972), content_en='Thank you! The delivery date and time have been saved: July 9, 2025, 15:00.\\\\n\\\\nDo you need a card with the bouquet? If yes, what text should be written on it?', content_thai='ขอบคุณค่ะ! วันที่และเวลาจัดส่งได้บันทึกไว้แล้ว: 9 กรกฎาคม 2568, 15:00 น.\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่? ถ้าใช่, ต้องการให้เขียนข้อความอะไรลงในการ์ดคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='С любовью, Петя', timestamp=datetime.datetime(2025, 7, 6, 16, 2, 19, 779974), content_en='With love, Petya', content_thai='ด้วยรัก, เปตยา', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:02:26] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:02:26.081457", "execution_time_ms": 6159.75, "result": ["Текст для открытки сохранен.\\n\\nПожалуйста, укажите имя получателя.", "The card text has been saved.\\n\\nPlease provide the recipient's name.", "ข้อความการ์ดได้ถูกบันทึกแล้วค่ะ\\n\\nกรุณาระบุชื่อผู้รับค่ะ", {"type": "save_order_info", "card_needed": true, "card_text": "С любовью, Петя"}]}
[2025-07-06 16:02:26] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:02:28] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:02:28.329376", "execution_time_ms": 22278.25, "result": true}
[2025-07-06 16:02:56] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:02:56.676510", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1074f3390>", "message_data": {"sender_id": "79140775712", "message_text": "Саша", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTYxQzRBRUM3ODk4OEYwMjcxMgA=", "timestamp": "1751792566", "reply_to_message_id": null}}}
[2025-07-06 16:02:57] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:02:57] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:06:42] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:06:42.449966", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x106ef1fd0>", "message_data": {"sender_id": "79140775712", "message_text": "Саша", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTREQzEyNzI1MEZBN0Q2RUUwQgA=", "timestamp": "1751792793", "reply_to_message_id": null}}}
[2025-07-06 16:06:43] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:06:43] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:06:47] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:06:47.921197", "parameters": {"self": "<src.services.ai_service.AIService object at 0x106ef2a50>", "text": "Саша", "user_lang": "ru"}}
[2025-07-06 16:06:47] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:06:47.921451", "parameters": {"self": "<src.services.ai_service.AIService object at 0x106ef2a50>", "text": "Саша", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 16:06:49] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:06:49.332517", "execution_time_ms": 1410.91, "result": "Sasha"}
[2025-07-06 16:06:49] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:06:49.333539", "parameters": {"self": "<src.services.ai_service.AIService object at 0x106ef2a50>", "text": "Саша", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 16:06:52] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:06:52.820053", "execution_time_ms": 3486.06, "result": "ซาช่า"}
[2025-07-06 16:06:52] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:06:52.821096", "execution_time_ms": 4899.65, "result": ["Саша", "Sasha", "ซาช่า"]}
[2025-07-06 16:06:54] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:06:54.744569", "parameters": {"self": "<src.services.ai_service.AIService object at 0x106ef2a50>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580314), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580365), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580367), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580369), content_en='Excellent!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580370), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580371), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580379), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580380), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580381), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580421), content_en='This (response to: Pretty 😍\\n2 600,00 ฿ 🌸)', content_thai='อันนี้ (ตอบกลับถึง: Pretty 😍\\n2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Букет 'Pretty 😍' сохранен.\\\\n\\\\nВам нужна доставка? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580446), content_en=\"Your bouquet 'Pretty 😍' is saved.\\\\n\\\\nDo you need delivery?\", content_thai=\"บันทึกช่อดอกไม้ 'Pretty 😍' ของคุณแล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580449), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доставка включена в ваш заказ.\\\\n\\\\nСтоимость доставки по районам:\\\\n- Раваи: 500 бат\\\\n- Чалонг: 380 бат\\\\n- Пхукет Таун: 300 бат\\\\n- Кату: 280 бат\\\\n- Патонг: 400 бат\\\\n- Банг Тао: 500 бат\\\\n- Лагуна: 500 бат\\\\n- Таланг/Май Као: 550 бат\\\\n\\\\nПожалуйста, укажите полный адрес доставки. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580450), content_en='Delivery is included in your order.\\\\n\\\\nDelivery costs by district:\\\\n- Rawai: 500 baht\\\\n- Chalong: 380 baht\\\\n- Phuket Town: 300 baht\\\\n- Kathu: 280 baht\\\\n- Patong: 400 baht\\\\n- Bang Tao: 500 baht\\\\n- Laguna: 500 baht\\\\n- Thalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='รวมค่าจัดส่งในการสั่งซื้อของคุณแล้วค่ะ\\\\n\\\\nค่าจัดส่งตามเขต:\\\\n- ราไวย์: 500 บาท\\\\n- ฉลอง: 380 บาท\\\\n- ภูเก็ตทาวน์: 300 บาท\\\\n- กะทู้: 280 บาท\\\\n- ป่าตอง: 400 บาท\\\\n- บางเทา: 500 บาท\\\\n- ลากูน่า: 500 บาท\\\\n- ถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งให้ครบถ้วนค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Centio condo', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580451), content_en='Centio condo', content_thai='เซ็นติโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо за адрес!\\\\n\\\\nПожалуйста, укажите желаемую дату и время доставки.\\\\n\\\\nМы доставляем цветы с 8:00 до 21:00. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580452), content_en='Thank you for the address!\\\\n\\\\nPlease specify the desired date and time for delivery.\\\\n\\\\nWe deliver flowers from 8:00 AM to 9:00 PM.', content_thai='ขอบคุณสำหรับที่อยู่ค่ะ!\\\\n\\\\nกรุณาระบุวันที่และเวลาที่ต้องการจัดส่งดอกไม้ค่ะ\\\\n\\\\nเราจัดส่งดอกไม้ตั้งแต่ 8:00 น. ถึง 21:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='В среду в 15', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580453), content_en='On Wednesday at 15', content_thai='วันพุธ เวลา 15:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо! Дата и время доставки сохранены: 9 июля 2025 года, 15:00.\\\\n\\\\nНужна ли открытка к букету? Если да, какой текст на ней написать? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580454), content_en='Thank you! The delivery date and time have been saved: July 9, 2025, 15:00.\\\\n\\\\nDo you need a card with the bouquet? If yes, what text should be written on it?', content_thai='ขอบคุณค่ะ! วันที่และเวลาจัดส่งได้บันทึกไว้แล้ว: 9 กรกฎาคม 2568, 15:00 น.\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่? ถ้าใช่, ต้องการให้เขียนข้อความอะไรลงในการ์ดคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='С любовью, Петя', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580455), content_en='With love, Petya', content_thai='ด้วยรัก, เปตยา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Текст для открытки сохранен.\\\\n\\\\nПожалуйста, укажите имя получателя. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580456), content_en=\"The card text has been saved.\\\\n\\\\nPlease provide the recipient's name.\", content_thai='ข้อความการ์ดได้ถูกบันทึกแล้วค่ะ\\\\n\\\\nกรุณาระบุชื่อผู้รับค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 16, 6, 54, 580457), content_en='Sasha', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:06:59] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:06:59.112295", "execution_time_ms": 4366.38, "result": ["Имя получателя сохранено.\\n\\nПожалуйста, укажите номер телефона получателя.", "Recipient's name has been saved.\\n\\nPlease provide the recipient's phone number.", "บันทึกชื่อผู้รับเรียบร้อยแล้วค่ะ\\n\\nกรุณาระบุเบอร์โทรศัพท์ของผู้รับด้วยค่ะ", {"type": "save_order_info", "recipient_name": "Саша"}]}
[2025-07-06 16:06:59] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:07:01] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:07:01.625328", "execution_time_ms": 19173.95, "result": true}
[2025-07-06 16:10:05] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:10:05.823639", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107885fd0>", "message_data": {"sender_id": "79140775712", "message_text": "8900005566", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQThCNjQ4OUE4NEU5ODgzNjlGQQA=", "timestamp": "1751792997", "reply_to_message_id": null}}}
[2025-07-06 16:10:06] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:10:07] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:10:10] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:10:10.917451", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107886a50>", "text": "8900005566", "user_lang": "ru"}}
[2025-07-06 16:10:10] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:10:10.918704", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107886a50>", "text": "8900005566", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 16:10:13] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:10:13.630469", "execution_time_ms": 2711.42, "result": "8900005566"}
[2025-07-06 16:10:13] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:10:13.631440", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107886a50>", "text": "8900005566", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 16:10:16] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:10:16.998985", "execution_time_ms": 3367.08, "result": "8900005566"}
[2025-07-06 16:10:16] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:10:16.999224", "execution_time_ms": 6080.63, "result": ["8900005566", "8900005566", "8900005566"]}
[2025-07-06 16:10:18] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:10:18.868807", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107886a50>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746281), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746313), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746318), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746323), content_en='Excellent!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746327), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746331), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746334), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746337), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746340), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746344), content_en='This (response to: Pretty 😍\\n2 600,00 ฿ 🌸)', content_thai='อันนี้ (ตอบกลับถึง: Pretty 😍\\n2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Букет 'Pretty 😍' сохранен.\\\\n\\\\nВам нужна доставка? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746347), content_en=\"Your bouquet 'Pretty 😍' is saved.\\\\n\\\\nDo you need delivery?\", content_thai=\"บันทึกช่อดอกไม้ 'Pretty 😍' ของคุณแล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746350), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доставка включена в ваш заказ.\\\\n\\\\nСтоимость доставки по районам:\\\\n- Раваи: 500 бат\\\\n- Чалонг: 380 бат\\\\n- Пхукет Таун: 300 бат\\\\n- Кату: 280 бат\\\\n- Патонг: 400 бат\\\\n- Банг Тао: 500 бат\\\\n- Лагуна: 500 бат\\\\n- Таланг/Май Као: 550 бат\\\\n\\\\nПожалуйста, укажите полный адрес доставки. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746354), content_en='Delivery is included in your order.\\\\n\\\\nDelivery costs by district:\\\\n- Rawai: 500 baht\\\\n- Chalong: 380 baht\\\\n- Phuket Town: 300 baht\\\\n- Kathu: 280 baht\\\\n- Patong: 400 baht\\\\n- Bang Tao: 500 baht\\\\n- Laguna: 500 baht\\\\n- Thalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='รวมค่าจัดส่งในการสั่งซื้อของคุณแล้วค่ะ\\\\n\\\\nค่าจัดส่งตามเขต:\\\\n- ราไวย์: 500 บาท\\\\n- ฉลอง: 380 บาท\\\\n- ภูเก็ตทาวน์: 300 บาท\\\\n- กะทู้: 280 บาท\\\\n- ป่าตอง: 400 บาท\\\\n- บางเทา: 500 บาท\\\\n- ลากูน่า: 500 บาท\\\\n- ถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งให้ครบถ้วนค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Centio condo', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746356), content_en='Centio condo', content_thai='เซ็นติโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо за адрес!\\\\n\\\\nПожалуйста, укажите желаемую дату и время доставки.\\\\n\\\\nМы доставляем цветы с 8:00 до 21:00. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746359), content_en='Thank you for the address!\\\\n\\\\nPlease specify the desired date and time for delivery.\\\\n\\\\nWe deliver flowers from 8:00 AM to 9:00 PM.', content_thai='ขอบคุณสำหรับที่อยู่ค่ะ!\\\\n\\\\nกรุณาระบุวันที่และเวลาที่ต้องการจัดส่งดอกไม้ค่ะ\\\\n\\\\nเราจัดส่งดอกไม้ตั้งแต่ 8:00 น. ถึง 21:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='В среду в 15', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746362), content_en='On Wednesday at 15', content_thai='วันพุธ เวลา 15:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо! Дата и время доставки сохранены: 9 июля 2025 года, 15:00.\\\\n\\\\nНужна ли открытка к букету? Если да, какой текст на ней написать? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746365), content_en='Thank you! The delivery date and time have been saved: July 9, 2025, 15:00.\\\\n\\\\nDo you need a card with the bouquet? If yes, what text should be written on it?', content_thai='ขอบคุณค่ะ! วันที่และเวลาจัดส่งได้บันทึกไว้แล้ว: 9 กรกฎาคม 2568, 15:00 น.\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่? ถ้าใช่, ต้องการให้เขียนข้อความอะไรลงในการ์ดคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='С любовью, Петя', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746367), content_en='With love, Petya', content_thai='ด้วยรัก, เปตยา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Текст для открытки сохранен.\\\\n\\\\nПожалуйста, укажите имя получателя. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746370), content_en=\"The card text has been saved.\\\\n\\\\nPlease provide the recipient's name.\", content_thai='ข้อความการ์ดได้ถูกบันทึกแล้วค่ะ\\\\n\\\\nกรุณาระบุชื่อผู้รับค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746372), content_en='Sasha', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Имя получателя сохранено.\\\\n\\\\nПожалуйста, укажите номер телефона получателя. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746375), content_en=\"Recipient's name has been saved.\\\\n\\\\nPlease provide the recipient's phone number.\", content_thai='บันทึกชื่อผู้รับเรียบร้อยแล้วค่ะ\\\\n\\\\nกรุณาระบุเบอร์โทรศัพท์ของผู้รับด้วยค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='8900005566', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 18, 746378), content_en='8900005566', content_thai='8900005566', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:10:25] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:10:25.841018", "execution_time_ms": 6970.27, "result": ["Номер телефона получателя сохранен.\\n\\nВот сводка вашего заказа:\\nБукет: Pretty 😍\\nЦена: 2 600,00 ฿\\nДоставка: Нужна, по адресу Centio condo\\nДата и время доставки: 9 июля 2025 года, 15:00\\nОткрытка: Нужна, с текстом «С любовью, Петя»\\nПолучатель: Саша, телефон: 8900005566\\n\\nПожалуйста, подтвердите, что все данные верны, чтобы я могла отправить заказ менеджеру.", "The recipient's phone number has been saved.\\n\\nHere is a summary of your order:\\nBouquet: Pretty 😍\\nPrice: 2,600.00 ฿\\nDelivery: Needed, to Centio condo\\nDelivery date and time: July 9, 2025, 15:00\\nCard: Needed, with text \"With love, Petya\"\\nRecipient: Sasha, phone: 8900005566\\n\\nPlease confirm that all details are correct so I can send the order to the manager.", "ได้บันทึกหมายเลขโทรศัพท์ของผู้รับแล้วค่ะ\\n\\nนี่คือสรุปคำสั่งซื้อของคุณ:\\nช่อดอกไม้: Pretty 😍\\nราคา: 2,600.00 ฿\\nการจัดส่ง: ต้องการ, ไปยัง Centio condo\\nวันที่และเวลาจัดส่ง: 9 กรกฎาคม 2568, 15:00 น.\\nการ์ด: ต้องการ, พร้อมข้อความ \"ด้วยรัก, เปทยา\"\\nผู้รับ: ซาช่า, โทรศัพท์: 8900005566\\n\\nโปรดยืนยันว่ารายละเอียดทั้งหมดถูกต้อง เพื่อที่ฉันจะสามารถส่งคำสั่งซื้อนี้ให้ผู้จัดการได้ค่ะ", {"type": "save_order_info", "recipient_phone": "8900005566"}]}
[2025-07-06 16:10:35] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:10:35.816707", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107936fd0>", "message_data": {"sender_id": "79140775712", "message_text": "Саша", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTYxQzRBRUM3ODk4OEYwMjcxMgA=", "timestamp": "1751792566", "reply_to_message_id": null}}}
[2025-07-06 16:10:35] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:10:35.838079", "execution_time_ms": 30013.54, "result": false}
[2025-07-06 16:10:36] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:10:37] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:10:40] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:10:40.809943", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107937610>", "text": "Саша", "user_lang": "ru"}}
[2025-07-06 16:10:40] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:10:40.810471", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107937610>", "text": "Саша", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 16:10:42] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:10:42.927767", "execution_time_ms": 2117.09, "result": "Sasha"}
[2025-07-06 16:10:42] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:10:42.928678", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107937610>", "text": "Саша", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 16:10:44] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:10:44.641680", "execution_time_ms": 1712.73, "result": "ซาชา"}
[2025-07-06 16:10:44] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:10:44.642033", "execution_time_ms": 3831.6, "result": ["Саша", "Sasha", "ซาชา"]}
[2025-07-06 16:10:46] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:10:46.468665", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107937610>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 283949), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 283968), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 283973), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 283978), content_en='Excellent!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 283983), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 283988), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 283992), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 283997), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 284001), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 284006), content_en='This (response to: Pretty 😍\\n2 600,00 ฿ 🌸)', content_thai='อันนี้ (ตอบกลับถึง: Pretty 😍\\n2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Букет 'Pretty 😍' сохранен.\\\\n\\\\nВам нужна доставка? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 284010), content_en=\"Your bouquet 'Pretty 😍' is saved.\\\\n\\\\nDo you need delivery?\", content_thai=\"บันทึกช่อดอกไม้ 'Pretty 😍' ของคุณแล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 284014), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доставка включена в ваш заказ.\\\\n\\\\nСтоимость доставки по районам:\\\\n- Раваи: 500 бат\\\\n- Чалонг: 380 бат\\\\n- Пхукет Таун: 300 бат\\\\n- Кату: 280 бат\\\\n- Патонг: 400 бат\\\\n- Банг Тао: 500 бат\\\\n- Лагуна: 500 бат\\\\n- Таланг/Май Као: 550 бат\\\\n\\\\nПожалуйста, укажите полный адрес доставки. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 284018), content_en='Delivery is included in your order.\\\\n\\\\nDelivery costs by district:\\\\n- Rawai: 500 baht\\\\n- Chalong: 380 baht\\\\n- Phuket Town: 300 baht\\\\n- Kathu: 280 baht\\\\n- Patong: 400 baht\\\\n- Bang Tao: 500 baht\\\\n- Laguna: 500 baht\\\\n- Thalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='รวมค่าจัดส่งในการสั่งซื้อของคุณแล้วค่ะ\\\\n\\\\nค่าจัดส่งตามเขต:\\\\n- ราไวย์: 500 บาท\\\\n- ฉลอง: 380 บาท\\\\n- ภูเก็ตทาวน์: 300 บาท\\\\n- กะทู้: 280 บาท\\\\n- ป่าตอง: 400 บาท\\\\n- บางเทา: 500 บาท\\\\n- ลากูน่า: 500 บาท\\\\n- ถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งให้ครบถ้วนค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Centio condo', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 284022), content_en='Centio condo', content_thai='เซ็นติโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо за адрес!\\\\n\\\\nПожалуйста, укажите желаемую дату и время доставки.\\\\n\\\\nМы доставляем цветы с 8:00 до 21:00. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 284026), content_en='Thank you for the address!\\\\n\\\\nPlease specify the desired date and time for delivery.\\\\n\\\\nWe deliver flowers from 8:00 AM to 9:00 PM.', content_thai='ขอบคุณสำหรับที่อยู่ค่ะ!\\\\n\\\\nกรุณาระบุวันที่และเวลาที่ต้องการจัดส่งดอกไม้ค่ะ\\\\n\\\\nเราจัดส่งดอกไม้ตั้งแต่ 8:00 น. ถึง 21:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='В среду в 15', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 284030), content_en='On Wednesday at 15', content_thai='วันพุธ เวลา 15:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо! Дата и время доставки сохранены: 9 июля 2025 года, 15:00.\\\\n\\\\nНужна ли открытка к букету? Если да, какой текст на ней написать? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 284034), content_en='Thank you! The delivery date and time have been saved: July 9, 2025, 15:00.\\\\n\\\\nDo you need a card with the bouquet? If yes, what text should be written on it?', content_thai='ขอบคุณค่ะ! วันที่และเวลาจัดส่งได้บันทึกไว้แล้ว: 9 กรกฎาคม 2568, 15:00 น.\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่? ถ้าใช่, ต้องการให้เขียนข้อความอะไรลงในการ์ดคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='С любовью, Петя', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 284037), content_en='With love, Petya', content_thai='ด้วยรัก, เปตยา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Текст для открытки сохранен.\\\\n\\\\nПожалуйста, укажите имя получателя. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 284040), content_en=\"The card text has been saved.\\\\n\\\\nPlease provide the recipient's name.\", content_thai='ข้อความการ์ดได้ถูกบันทึกแล้วค่ะ\\\\n\\\\nกรุณาระบุชื่อผู้รับค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 284044), content_en='Sasha', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Имя получателя сохранено.\\\\n\\\\nПожалуйста, укажите номер телефона получателя. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 284048), content_en=\"Recipient's name has been saved.\\\\n\\\\nPlease provide the recipient's phone number.\", content_thai='บันทึกชื่อผู้รับเรียบร้อยแล้วค่ะ\\\\n\\\\nกรุณาระบุเบอร์โทรศัพท์ของผู้รับด้วยค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='8900005566', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 284051), content_en='8900005566', content_thai='8900005566', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 16, 10, 46, 284054), content_en='Sasha', content_thai='ซาชา', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:10:53] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:10:53.709353", "execution_time_ms": 7237.38, "result": ["Номер телефона получателя сохранен.\\n\\nПожалуйста, проверьте данные вашего заказа:\\n\\nБукет: Pretty 😍\\nСтоимость букета: 2 600,00 ฿\\nДоставка: Нужна, по адресу Centio condo\\nДата и время доставки: 9 июля 2025 года, 15:00\\nОткрытка: Нужна, текст: \"С любовью, Петя\"\\nИмя получателя: Саша\\nТелефон получателя: 8900005566\\n\\nПодтверждаете заказ?", "Recipient's phone number saved.\\n\\nPlease review your order details:\\n\\nBouquet: Pretty 😍\\nBouquet price: 2,600.00 ฿\\nDelivery: Needed, to address Centio condo\\nDelivery date and time: July 9, 2025, 15:00\\nCard: Needed, text: \"With love, Petya\"\\nRecipient's name: Sasha\\nRecipient's phone: 8900005566\\n\\nDo you confirm the order?", "บันทึกเบอร์โทรศัพท์ผู้รับแล้วค่ะ\\n\\nโปรดตรวจสอบรายละเอียดคำสั่งซื้อของคุณ:\\n\\nช่อดอกไม้: Pretty 😍\\nราคาช่อดอกไม้: 2,600.00 ฿\\nการจัดส่ง: ต้องการ, ไปยังที่อยู่ Centio condo\\nวันที่และเวลาจัดส่ง: 9 กรกฎาคม 2568, 15:00 น.\\nการ์ด: ต้องการ, ข้อความ: \"With love, Petya\"\\nชื่อผู้รับ: Sasha\\nเบอร์โทรศัพท์ผู้รับ: 8900005566\\n\\nคุณยืนยันคำสั่งซื้อหรือไม่คะ?", {"type": "save_order_info", "bouquet": "Pretty 😍", "retailer_id": "kie4sy3qsy", "delivery_needed": true, "address": "Centio condo", "date": "2025-07-09", "time": "15:00", "card_needed": true, "card_text": "С любовью, Петя", "recipient_name": "Саша", "recipient_phone": "8900005566"}]}
[2025-07-06 16:10:54] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:10:56] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:10:56.961838", "execution_time_ms": 21144.44, "result": true}
[2025-07-06 16:11:13] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:11:13.541661", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10781e990>", "message_data": {"sender_id": "79140775712", "message_text": "да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTIwMkM3NjRDNTY2RjgzNzUxOAA=", "timestamp": "1751793064", "reply_to_message_id": null}}}
[2025-07-06 16:11:14] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:11:14] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:11:18] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:11:18.723016", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10781f110>", "text": "да", "user_lang": "ru"}}
[2025-07-06 16:11:18] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:11:18.725091", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10781f110>", "text": "да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 16:11:19] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:11:19.718320", "execution_time_ms": 992.99, "result": "yes"}
[2025-07-06 16:11:19] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:11:19.719028", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10781f110>", "text": "да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 16:11:24] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:11:24.650748", "execution_time_ms": 4931.51, "result": "ใช่"}
[2025-07-06 16:11:24] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:11:24.650979", "execution_time_ms": 5925.94, "result": ["да", "yes", "ใช่"]}
[2025-07-06 16:11:26] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:11:26.643561", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10781f110>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527338), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527358), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527364), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527369), content_en='Excellent!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527374), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527380), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527385), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527390), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527395), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527401), content_en='This (response to: Pretty 😍\\n2 600,00 ฿ 🌸)', content_thai='อันนี้ (ตอบกลับถึง: Pretty 😍\\n2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Букет 'Pretty 😍' сохранен.\\\\n\\\\nВам нужна доставка? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527406), content_en=\"Your bouquet 'Pretty 😍' is saved.\\\\n\\\\nDo you need delivery?\", content_thai=\"บันทึกช่อดอกไม้ 'Pretty 😍' ของคุณแล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527411), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доставка включена в ваш заказ.\\\\n\\\\nСтоимость доставки по районам:\\\\n- Раваи: 500 бат\\\\n- Чалонг: 380 бат\\\\n- Пхукет Таун: 300 бат\\\\n- Кату: 280 бат\\\\n- Патонг: 400 бат\\\\n- Банг Тао: 500 бат\\\\n- Лагуна: 500 бат\\\\n- Таланг/Май Као: 550 бат\\\\n\\\\nПожалуйста, укажите полный адрес доставки. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527415), content_en='Delivery is included in your order.\\\\n\\\\nDelivery costs by district:\\\\n- Rawai: 500 baht\\\\n- Chalong: 380 baht\\\\n- Phuket Town: 300 baht\\\\n- Kathu: 280 baht\\\\n- Patong: 400 baht\\\\n- Bang Tao: 500 baht\\\\n- Laguna: 500 baht\\\\n- Thalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='รวมค่าจัดส่งในการสั่งซื้อของคุณแล้วค่ะ\\\\n\\\\nค่าจัดส่งตามเขต:\\\\n- ราไวย์: 500 บาท\\\\n- ฉลอง: 380 บาท\\\\n- ภูเก็ตทาวน์: 300 บาท\\\\n- กะทู้: 280 บาท\\\\n- ป่าตอง: 400 บาท\\\\n- บางเทา: 500 บาท\\\\n- ลากูน่า: 500 บาท\\\\n- ถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งให้ครบถ้วนค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Centio condo', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527420), content_en='Centio condo', content_thai='เซ็นติโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо за адрес!\\\\n\\\\nПожалуйста, укажите желаемую дату и время доставки.\\\\n\\\\nМы доставляем цветы с 8:00 до 21:00. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527425), content_en='Thank you for the address!\\\\n\\\\nPlease specify the desired date and time for delivery.\\\\n\\\\nWe deliver flowers from 8:00 AM to 9:00 PM.', content_thai='ขอบคุณสำหรับที่อยู่ค่ะ!\\\\n\\\\nกรุณาระบุวันที่และเวลาที่ต้องการจัดส่งดอกไม้ค่ะ\\\\n\\\\nเราจัดส่งดอกไม้ตั้งแต่ 8:00 น. ถึง 21:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='В среду в 15', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527430), content_en='On Wednesday at 15', content_thai='วันพุธ เวลา 15:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо! Дата и время доставки сохранены: 9 июля 2025 года, 15:00.\\\\n\\\\nНужна ли открытка к букету? Если да, какой текст на ней написать? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527433), content_en='Thank you! The delivery date and time have been saved: July 9, 2025, 15:00.\\\\n\\\\nDo you need a card with the bouquet? If yes, what text should be written on it?', content_thai='ขอบคุณค่ะ! วันที่และเวลาจัดส่งได้บันทึกไว้แล้ว: 9 กรกฎาคม 2568, 15:00 น.\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่? ถ้าใช่, ต้องการให้เขียนข้อความอะไรลงในการ์ดคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='С любовью, Петя', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527437), content_en='With love, Petya', content_thai='ด้วยรัก, เปตยา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Текст для открытки сохранен.\\\\n\\\\nПожалуйста, укажите имя получателя. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527441), content_en=\"The card text has been saved.\\\\n\\\\nPlease provide the recipient's name.\", content_thai='ข้อความการ์ดได้ถูกบันทึกแล้วค่ะ\\\\n\\\\nกรุณาระบุชื่อผู้รับค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527445), content_en='Sasha', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Имя получателя сохранено.\\\\n\\\\nПожалуйста, укажите номер телефона получателя. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527450), content_en=\"Recipient's name has been saved.\\\\n\\\\nPlease provide the recipient's phone number.\", content_thai='บันทึกชื่อผู้รับเรียบร้อยแล้วค่ะ\\\\n\\\\nกรุณาระบุเบอร์โทรศัพท์ของผู้รับด้วยค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='8900005566', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527454), content_en='8900005566', content_thai='8900005566', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527458), content_en='Sasha', content_thai='ซาชา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Номер телефона получателя сохранен.\\\\n\\\\nПожалуйста, проверьте данные вашего заказа:\\\\n\\\\nБукет: Pretty 😍\\\\nСтоимость букета: 2\\xa0600,00\\xa0฿\\\\nДоставка: Нужна, по адресу Centio condo\\\\nДата и время доставки: 9 июля 2025 года, 15:00\\\\nОткрытка: Нужна, текст: \"С любовью, Петя\"\\\\nИмя получателя: Саша\\\\nТелефон получателя: 8900005566\\\\n\\\\nПодтверждаете заказ? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527462), content_en='Recipient\\'s phone number saved.\\\\n\\\\nPlease review your order details:\\\\n\\\\nBouquet: Pretty 😍\\\\nBouquet price: 2,600.00 ฿\\\\nDelivery: Needed, to address Centio condo\\\\nDelivery date and time: July 9, 2025, 15:00\\\\nCard: Needed, text: \"With love, Petya\"\\\\nRecipient\\'s name: Sasha\\\\nRecipient\\'s phone: 8900005566\\\\n\\\\nDo you confirm the order?', content_thai='บันทึกเบอร์โทรศัพท์ผู้รับแล้วค่ะ\\\\n\\\\nโปรดตรวจสอบรายละเอียดคำสั่งซื้อของคุณ:\\\\n\\\\nช่อดอกไม้: Pretty 😍\\\\nราคาช่อดอกไม้: 2,600.00 ฿\\\\nการจัดส่ง: ต้องการ, ไปยังที่อยู่ Centio condo\\\\nวันที่และเวลาจัดส่ง: 9 กรกฎาคม 2568, 15:00 น.\\\\nการ์ด: ต้องการ, ข้อความ: \"With love, Petya\"\\\\nชื่อผู้รับ: Sasha\\\\nเบอร์โทรศัพท์ผู้รับ: 8900005566\\\\n\\\\nคุณยืนยันคำสั่งซื้อหรือไม่คะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 11, 26, 527466), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:11:32] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:11:32.859068", "execution_time_ms": 6207.25, "result": ["Спасибо за подтверждение!\\n\\nВаш заказ принят и будет передан менеджеру для обработки.\\n\\nНаш магазин работает ежедневно с 9:00 до 18:00 и находится недалеко от Central Festival.\\n\\nОплата производится перед доставкой через менеджера. Мы принимаем баты, рубли и USDT.\\n\\nЕсли у вас возникнут вопросы, пожалуйста, свяжитесь с нами.", "Thank you for your confirmation!\\n\\nYour order has been accepted and will be forwarded to the manager for processing.\\n\\nOur store is open daily from 9:00 AM to 6:00 PM and is located near Central Festival.\\n\\nPayment is made before delivery via the manager. We accept Baht, Rubles, and USDT.\\n\\nIf you have any questions, please contact us.", "ขอบคุณสำหรับการยืนยัน!\\n\\nคำสั่งซื้อของคุณได้รับการยอมรับและจะถูกส่งต่อไปยังผู้จัดการเพื่อดำเนินการ\\n\\nร้านของเราเปิดทำการทุกวันตั้งแต่ 9:00 น. ถึง 18:00 น. และตั้งอยู่ใกล้กับ Central Festival\\n\\nการชำระเงินจะทำก่อนการจัดส่งผ่านผู้จัดการ เรารับเงินบาท รูเบิล และ USDT\\n\\nหากคุณมีคำถามใดๆ โปรดติดต่อเรา", {"type": "confirm_order", "bouquet": "Pretty 😍", "retailer_id": "kie4sy3qsy", "delivery_needed": true, "address": "Centio condo", "date": "2025-07-09", "time": "15:00", "card_needed": true, "card_text": "С любовью, Петя", "recipient_name": "Саша", "recipient_phone": "8900005566"}]}
[2025-07-06 16:11:33] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:11:35] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:11:35.132020", "execution_time_ms": 21589.62, "result": true}
[2025-07-06 16:12:03] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:12:03.877850", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107836d70>", "message_data": {"sender_id": "79140775712", "message_text": "Саша, 89084407880", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUNERUM5OUNGODU0RDdDMzk2MQA=", "timestamp": "1751792659", "reply_to_message_id": null}}}
[2025-07-06 16:12:11] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:12:11.337683", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107836b10>", "message_data": {"sender_id": "79140775712", "message_text": "Саша", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTlCMzg4NjEyQTA5MENBNkU5MAA=", "timestamp": "1751792726", "reply_to_message_id": null}}}
[2025-07-06 16:12:11] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:12:15] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:12:15.553384", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107836fd0>", "text": "Саша, 89084407880", "user_lang": "ru"}}
[2025-07-06 16:12:15] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:12:15.554169", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107836fd0>", "text": "Саша, 89084407880", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 16:12:17] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:12:17.880050", "execution_time_ms": 2325.54, "result": "Sasha, 89084407880"}
[2025-07-06 16:12:17] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:12:17.881344", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107836fd0>", "text": "Саша, 89084407880", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 16:12:19] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:12:19.108457", "execution_time_ms": 1226.87, "result": "ซาช่า, 89084407880"}
[2025-07-06 16:12:19] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:12:19.109168", "execution_time_ms": 3555.04, "result": ["Саша, 89084407880", "Sasha, 89084407880", "ซาช่า, 89084407880"]}
[2025-07-06 16:12:21] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:12:21.033176", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107836fd0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907745), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907767), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907771), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907775), content_en='Excellent!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907778), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907781), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907784), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907788), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907791), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907794), content_en='This (response to: Pretty 😍\\n2 600,00 ฿ 🌸)', content_thai='อันนี้ (ตอบกลับถึง: Pretty 😍\\n2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Букет 'Pretty 😍' сохранен.\\\\n\\\\nВам нужна доставка? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907798), content_en=\"Your bouquet 'Pretty 😍' is saved.\\\\n\\\\nDo you need delivery?\", content_thai=\"บันทึกช่อดอกไม้ 'Pretty 😍' ของคุณแล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907802), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доставка включена в ваш заказ.\\\\n\\\\nСтоимость доставки по районам:\\\\n- Раваи: 500 бат\\\\n- Чалонг: 380 бат\\\\n- Пхукет Таун: 300 бат\\\\n- Кату: 280 бат\\\\n- Патонг: 400 бат\\\\n- Банг Тао: 500 бат\\\\n- Лагуна: 500 бат\\\\n- Таланг/Май Као: 550 бат\\\\n\\\\nПожалуйста, укажите полный адрес доставки. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907805), content_en='Delivery is included in your order.\\\\n\\\\nDelivery costs by district:\\\\n- Rawai: 500 baht\\\\n- Chalong: 380 baht\\\\n- Phuket Town: 300 baht\\\\n- Kathu: 280 baht\\\\n- Patong: 400 baht\\\\n- Bang Tao: 500 baht\\\\n- Laguna: 500 baht\\\\n- Thalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='รวมค่าจัดส่งในการสั่งซื้อของคุณแล้วค่ะ\\\\n\\\\nค่าจัดส่งตามเขต:\\\\n- ราไวย์: 500 บาท\\\\n- ฉลอง: 380 บาท\\\\n- ภูเก็ตทาวน์: 300 บาท\\\\n- กะทู้: 280 บาท\\\\n- ป่าตอง: 400 บาท\\\\n- บางเทา: 500 บาท\\\\n- ลากูน่า: 500 บาท\\\\n- ถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งให้ครบถ้วนค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Centio condo', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907809), content_en='Centio condo', content_thai='เซ็นติโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо за адрес!\\\\n\\\\nПожалуйста, укажите желаемую дату и время доставки.\\\\n\\\\nМы доставляем цветы с 8:00 до 21:00. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907812), content_en='Thank you for the address!\\\\n\\\\nPlease specify the desired date and time for delivery.\\\\n\\\\nWe deliver flowers from 8:00 AM to 9:00 PM.', content_thai='ขอบคุณสำหรับที่อยู่ค่ะ!\\\\n\\\\nกรุณาระบุวันที่และเวลาที่ต้องการจัดส่งดอกไม้ค่ะ\\\\n\\\\nเราจัดส่งดอกไม้ตั้งแต่ 8:00 น. ถึง 21:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='В среду в 15', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907824), content_en='On Wednesday at 15', content_thai='วันพุธ เวลา 15:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо! Дата и время доставки сохранены: 9 июля 2025 года, 15:00.\\\\n\\\\nНужна ли открытка к букету? Если да, какой текст на ней написать? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907827), content_en='Thank you! The delivery date and time have been saved: July 9, 2025, 15:00.\\\\n\\\\nDo you need a card with the bouquet? If yes, what text should be written on it?', content_thai='ขอบคุณค่ะ! วันที่และเวลาจัดส่งได้บันทึกไว้แล้ว: 9 กรกฎาคม 2568, 15:00 น.\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่? ถ้าใช่, ต้องการให้เขียนข้อความอะไรลงในการ์ดคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='С любовью, Петя', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907830), content_en='With love, Petya', content_thai='ด้วยรัก, เปตยา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Текст для открытки сохранен.\\\\n\\\\nПожалуйста, укажите имя получателя. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907834), content_en=\"The card text has been saved.\\\\n\\\\nPlease provide the recipient's name.\", content_thai='ข้อความการ์ดได้ถูกบันทึกแล้วค่ะ\\\\n\\\\nกรุณาระบุชื่อผู้รับค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907838), content_en='Sasha', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Имя получателя сохранено.\\\\n\\\\nПожалуйста, укажите номер телефона получателя. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907840), content_en=\"Recipient's name has been saved.\\\\n\\\\nPlease provide the recipient's phone number.\", content_thai='บันทึกชื่อผู้รับเรียบร้อยแล้วค่ะ\\\\n\\\\nกรุณาระบุเบอร์โทรศัพท์ของผู้รับด้วยค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='8900005566', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907843), content_en='8900005566', content_thai='8900005566', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907846), content_en='Sasha', content_thai='ซาชา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Номер телефона получателя сохранен.\\\\n\\\\nПожалуйста, проверьте данные вашего заказа:\\\\n\\\\nБукет: Pretty 😍\\\\nСтоимость букета: 2\\xa0600,00\\xa0฿\\\\nДоставка: Нужна, по адресу Centio condo\\\\nДата и время доставки: 9 июля 2025 года, 15:00\\\\nОткрытка: Нужна, текст: \"С любовью, Петя\"\\\\nИмя получателя: Саша\\\\nТелефон получателя: 8900005566\\\\n\\\\nПодтверждаете заказ? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907849), content_en='Recipient\\'s phone number saved.\\\\n\\\\nPlease review your order details:\\\\n\\\\nBouquet: Pretty 😍\\\\nBouquet price: 2,600.00 ฿\\\\nDelivery: Needed, to address Centio condo\\\\nDelivery date and time: July 9, 2025, 15:00\\\\nCard: Needed, text: \"With love, Petya\"\\\\nRecipient\\'s name: Sasha\\\\nRecipient\\'s phone: 8900005566\\\\n\\\\nDo you confirm the order?', content_thai='บันทึกเบอร์โทรศัพท์ผู้รับแล้วค่ะ\\\\n\\\\nโปรดตรวจสอบรายละเอียดคำสั่งซื้อของคุณ:\\\\n\\\\nช่อดอกไม้: Pretty 😍\\\\nราคาช่อดอกไม้: 2,600.00 ฿\\\\nการจัดส่ง: ต้องการ, ไปยังที่อยู่ Centio condo\\\\nวันที่และเวลาจัดส่ง: 9 กรกฎาคม 2568, 15:00 น.\\\\nการ์ด: ต้องการ, ข้อความ: \"With love, Petya\"\\\\nชื่อผู้รับ: Sasha\\\\nเบอร์โทรศัพท์ผู้รับ: 8900005566\\\\n\\\\nคุณยืนยันคำสั่งซื้อหรือไม่คะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907851), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо за подтверждение!\\\\n\\\\nВаш заказ принят и будет передан менеджеру для обработки.\\\\n\\\\nНаш магазин работает ежедневно с 9:00 до 18:00 и находится недалеко от Central Festival.\\\\n\\\\nОплата производится перед доставкой через менеджера. Мы принимаем баты, рубли и USDT.\\\\n\\\\nЕсли у вас возникнут вопросы, пожалуйста, свяжитесь с нами. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907854), content_en='Thank you for your confirmation!\\\\n\\\\nYour order has been accepted and will be forwarded to the manager for processing.\\\\n\\\\nOur store is open daily from 9:00 AM to 6:00 PM and is located near Central Festival.\\\\n\\\\nPayment is made before delivery via the manager. We accept Baht, Rubles, and USDT.\\\\n\\\\nIf you have any questions, please contact us.', content_thai='ขอบคุณสำหรับการยืนยัน!\\\\n\\\\nคำสั่งซื้อของคุณได้รับการยอมรับและจะถูกส่งต่อไปยังผู้จัดการเพื่อดำเนินการ\\\\n\\\\nร้านของเราเปิดทำการทุกวันตั้งแต่ 9:00 น. ถึง 18:00 น. และตั้งอยู่ใกล้กับ Central Festival\\\\n\\\\nการชำระเงินจะทำก่อนการจัดส่งผ่านผู้จัดการ เรารับเงินบาท รูเบิล และ USDT\\\\n\\\\nหากคุณมีคำถามใดๆ โปรดติดต่อเรา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша, 89084407880', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 20, 907856), content_en='Sasha, 89084407880', content_thai='ซาช่า, 89084407880', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:12:27] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:12:27.744439", "execution_time_ms": 6706.82, "result": ["Ваш заказ уже был подтвержден и передан менеджеру.\\n\\nЕсли вам нужно внести изменения в данные получателя, пожалуйста, свяжитесь напрямую с нашим менеджером.", "Your order has already been confirmed and sent to the manager.\\n\\nIf you need to make changes to the recipient's details, please contact our manager directly.", "คำสั่งซื้อของคุณได้รับการยืนยันและส่งให้ผู้จัดการแล้ว\\n\\nหากคุณต้องการเปลี่ยนแปลงรายละเอียดผู้รับ โปรดติดต่อผู้จัดการของเราโดยตรง", null]}
[2025-07-06 16:12:27] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:12:28] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:12:32] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:12:32.343931", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079075c0>", "text": "Саша", "user_lang": "ru"}}
[2025-07-06 16:12:32] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:12:32.344727", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079075c0>", "text": "Саша", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 16:12:33] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:12:33.343265", "execution_time_ms": 998.34, "result": "Sasha"}
[2025-07-06 16:12:33] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:12:33.343760", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079075c0>", "text": "Саша", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 16:12:40] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:12:40.196360", "execution_time_ms": 6851.97, "result": "ซาช่า"}
[2025-07-06 16:12:40] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:12:40.198461", "execution_time_ms": 7853.77, "result": ["Саша", "Sasha", "ซาช่า"]}
[2025-07-06 16:12:42] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:12:42.032888", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079075c0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915230), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915244), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915247), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915251), content_en='Excellent!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915254), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915257), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915260), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915263), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915266), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915269), content_en='This (response to: Pretty 😍\\n2 600,00 ฿ 🌸)', content_thai='อันนี้ (ตอบกลับถึง: Pretty 😍\\n2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Букет 'Pretty 😍' сохранен.\\\\n\\\\nВам нужна доставка? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915273), content_en=\"Your bouquet 'Pretty 😍' is saved.\\\\n\\\\nDo you need delivery?\", content_thai=\"บันทึกช่อดอกไม้ 'Pretty 😍' ของคุณแล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915275), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доставка включена в ваш заказ.\\\\n\\\\nСтоимость доставки по районам:\\\\n- Раваи: 500 бат\\\\n- Чалонг: 380 бат\\\\n- Пхукет Таун: 300 бат\\\\n- Кату: 280 бат\\\\n- Патонг: 400 бат\\\\n- Банг Тао: 500 бат\\\\n- Лагуна: 500 бат\\\\n- Таланг/Май Као: 550 бат\\\\n\\\\nПожалуйста, укажите полный адрес доставки. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915278), content_en='Delivery is included in your order.\\\\n\\\\nDelivery costs by district:\\\\n- Rawai: 500 baht\\\\n- Chalong: 380 baht\\\\n- Phuket Town: 300 baht\\\\n- Kathu: 280 baht\\\\n- Patong: 400 baht\\\\n- Bang Tao: 500 baht\\\\n- Laguna: 500 baht\\\\n- Thalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='รวมค่าจัดส่งในการสั่งซื้อของคุณแล้วค่ะ\\\\n\\\\nค่าจัดส่งตามเขต:\\\\n- ราไวย์: 500 บาท\\\\n- ฉลอง: 380 บาท\\\\n- ภูเก็ตทาวน์: 300 บาท\\\\n- กะทู้: 280 บาท\\\\n- ป่าตอง: 400 บาท\\\\n- บางเทา: 500 บาท\\\\n- ลากูน่า: 500 บาท\\\\n- ถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งให้ครบถ้วนค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Centio condo', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915281), content_en='Centio condo', content_thai='เซ็นติโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо за адрес!\\\\n\\\\nПожалуйста, укажите желаемую дату и время доставки.\\\\n\\\\nМы доставляем цветы с 8:00 до 21:00. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915284), content_en='Thank you for the address!\\\\n\\\\nPlease specify the desired date and time for delivery.\\\\n\\\\nWe deliver flowers from 8:00 AM to 9:00 PM.', content_thai='ขอบคุณสำหรับที่อยู่ค่ะ!\\\\n\\\\nกรุณาระบุวันที่และเวลาที่ต้องการจัดส่งดอกไม้ค่ะ\\\\n\\\\nเราจัดส่งดอกไม้ตั้งแต่ 8:00 น. ถึง 21:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='В среду в 15', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915286), content_en='On Wednesday at 15', content_thai='วันพุธ เวลา 15:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо! Дата и время доставки сохранены: 9 июля 2025 года, 15:00.\\\\n\\\\nНужна ли открытка к букету? Если да, какой текст на ней написать? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915289), content_en='Thank you! The delivery date and time have been saved: July 9, 2025, 15:00.\\\\n\\\\nDo you need a card with the bouquet? If yes, what text should be written on it?', content_thai='ขอบคุณค่ะ! วันที่และเวลาจัดส่งได้บันทึกไว้แล้ว: 9 กรกฎาคม 2568, 15:00 น.\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่? ถ้าใช่, ต้องการให้เขียนข้อความอะไรลงในการ์ดคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='С любовью, Петя', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915292), content_en='With love, Petya', content_thai='ด้วยรัก, เปตยา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Текст для открытки сохранен.\\\\n\\\\nПожалуйста, укажите имя получателя. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915295), content_en=\"The card text has been saved.\\\\n\\\\nPlease provide the recipient's name.\", content_thai='ข้อความการ์ดได้ถูกบันทึกแล้วค่ะ\\\\n\\\\nกรุณาระบุชื่อผู้รับค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915298), content_en='Sasha', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Имя получателя сохранено.\\\\n\\\\nПожалуйста, укажите номер телефона получателя. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915301), content_en=\"Recipient's name has been saved.\\\\n\\\\nPlease provide the recipient's phone number.\", content_thai='บันทึกชื่อผู้รับเรียบร้อยแล้วค่ะ\\\\n\\\\nกรุณาระบุเบอร์โทรศัพท์ของผู้รับด้วยค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='8900005566', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915303), content_en='8900005566', content_thai='8900005566', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915306), content_en='Sasha', content_thai='ซาชา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Номер телефона получателя сохранен.\\\\n\\\\nПожалуйста, проверьте данные вашего заказа:\\\\n\\\\nБукет: Pretty 😍\\\\nСтоимость букета: 2\\xa0600,00\\xa0฿\\\\nДоставка: Нужна, по адресу Centio condo\\\\nДата и время доставки: 9 июля 2025 года, 15:00\\\\nОткрытка: Нужна, текст: \"С любовью, Петя\"\\\\nИмя получателя: Саша\\\\nТелефон получателя: 8900005566\\\\n\\\\nПодтверждаете заказ? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915309), content_en='Recipient\\'s phone number saved.\\\\n\\\\nPlease review your order details:\\\\n\\\\nBouquet: Pretty 😍\\\\nBouquet price: 2,600.00 ฿\\\\nDelivery: Needed, to address Centio condo\\\\nDelivery date and time: July 9, 2025, 15:00\\\\nCard: Needed, text: \"With love, Petya\"\\\\nRecipient\\'s name: Sasha\\\\nRecipient\\'s phone: 8900005566\\\\n\\\\nDo you confirm the order?', content_thai='บันทึกเบอร์โทรศัพท์ผู้รับแล้วค่ะ\\\\n\\\\nโปรดตรวจสอบรายละเอียดคำสั่งซื้อของคุณ:\\\\n\\\\nช่อดอกไม้: Pretty 😍\\\\nราคาช่อดอกไม้: 2,600.00 ฿\\\\nการจัดส่ง: ต้องการ, ไปยังที่อยู่ Centio condo\\\\nวันที่และเวลาจัดส่ง: 9 กรกฎาคม 2568, 15:00 น.\\\\nการ์ด: ต้องการ, ข้อความ: \"With love, Petya\"\\\\nชื่อผู้รับ: Sasha\\\\nเบอร์โทรศัพท์ผู้รับ: 8900005566\\\\n\\\\nคุณยืนยันคำสั่งซื้อหรือไม่คะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915311), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо за подтверждение!\\\\n\\\\nВаш заказ принят и будет передан менеджеру для обработки.\\\\n\\\\nНаш магазин работает ежедневно с 9:00 до 18:00 и находится недалеко от Central Festival.\\\\n\\\\nОплата производится перед доставкой через менеджера. Мы принимаем баты, рубли и USDT.\\\\n\\\\nЕсли у вас возникнут вопросы, пожалуйста, свяжитесь с нами. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915314), content_en='Thank you for your confirmation!\\\\n\\\\nYour order has been accepted and will be forwarded to the manager for processing.\\\\n\\\\nOur store is open daily from 9:00 AM to 6:00 PM and is located near Central Festival.\\\\n\\\\nPayment is made before delivery via the manager. We accept Baht, Rubles, and USDT.\\\\n\\\\nIf you have any questions, please contact us.', content_thai='ขอบคุณสำหรับการยืนยัน!\\\\n\\\\nคำสั่งซื้อของคุณได้รับการยอมรับและจะถูกส่งต่อไปยังผู้จัดการเพื่อดำเนินการ\\\\n\\\\nร้านของเราเปิดทำการทุกวันตั้งแต่ 9:00 น. ถึง 18:00 น. และตั้งอยู่ใกล้กับ Central Festival\\\\n\\\\nการชำระเงินจะทำก่อนการจัดส่งผ่านผู้จัดการ เรารับเงินบาท รูเบิล และ USDT\\\\n\\\\nหากคุณมีคำถามใดๆ โปรดติดต่อเรา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша, 89084407880', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915316), content_en='Sasha, 89084407880', content_thai='ซาช่า, 89084407880', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 16, 12, 41, 915319), content_en='Sasha', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:12:50] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:12:50.260328", "execution_time_ms": 8225.76, "result": ["Ваш заказ уже был подтвержден и передан менеджеру.\\n\\nЕсли у вас есть другие вопросы или вам нужна дополнительная помощь, пожалуйста, сообщите мне.", "Your order has already been confirmed and forwarded to the manager.\\n\\nIf you have any other questions or need further assistance, please let me know.", "คำสั่งซื้อของคุณได้รับการยืนยันและส่งต่อไปยังผู้จัดการแล้วค่ะ\\n\\nหากคุณมีคำถามอื่น ๆ หรือต้องการความช่วยเหลือเพิ่มเติม โปรดแจ้งให้เราทราบนะคะ", null]}
[2025-07-06 16:12:50] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:12:50] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:12:50.737723", "execution_time_ms": 46858.93, "result": true}
[2025-07-06 16:12:51] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:12:51] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:12:51.855765", "execution_time_ms": 40517.54, "result": true}
[2025-07-06 16:15:17] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:15:17.486339", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10785b530>", "message_data": {"sender_id": "79140775712", "message_text": "89084407880", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTU0QTFFMUQ2ODdFNTk0RUYwQgA=", "timestamp": "1751792860", "reply_to_message_id": null}}}
[2025-07-06 16:15:24] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:15:24.801149", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107832470>", "message_data": {"sender_id": "79140775712", "message_text": "89084407880", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTdBMDUxMUMzQzY5Qzc4MDgwMQA=", "timestamp": "1751792908", "reply_to_message_id": null}}}
[2025-07-06 16:15:25] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:15:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:15:29.522555", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1078e6e70>", "text": "89084407880", "user_lang": "ru"}}
[2025-07-06 16:15:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:15:29.523293", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1078e6e70>", "text": "89084407880", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 16:15:31] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:15:31.941519", "execution_time_ms": 2418.01, "result": "89084407880"}
[2025-07-06 16:15:31] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:15:31.942341", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1078e6e70>", "text": "89084407880", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 16:15:35] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:15:35.621798", "execution_time_ms": 3679.17, "result": "89084407880"}
[2025-07-06 16:15:35] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:15:35.622446", "execution_time_ms": 6099.21, "result": ["89084407880", "89084407880", "89084407880"]}
[2025-07-06 16:15:37] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:15:37.506908", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1078e6e70>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 353932), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 353986), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 353990), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 353994), content_en='Excellent!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 353997), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354001), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354004), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354008), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354012), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354015), content_en='This (response to: Pretty 😍\\n2 600,00 ฿ 🌸)', content_thai='อันนี้ (ตอบกลับถึง: Pretty 😍\\n2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Букет 'Pretty 😍' сохранен.\\\\n\\\\nВам нужна доставка? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354019), content_en=\"Your bouquet 'Pretty 😍' is saved.\\\\n\\\\nDo you need delivery?\", content_thai=\"บันทึกช่อดอกไม้ 'Pretty 😍' ของคุณแล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354022), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доставка включена в ваш заказ.\\\\n\\\\nСтоимость доставки по районам:\\\\n- Раваи: 500 бат\\\\n- Чалонг: 380 бат\\\\n- Пхукет Таун: 300 бат\\\\n- Кату: 280 бат\\\\n- Патонг: 400 бат\\\\n- Банг Тао: 500 бат\\\\n- Лагуна: 500 бат\\\\n- Таланг/Май Као: 550 бат\\\\n\\\\nПожалуйста, укажите полный адрес доставки. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354026), content_en='Delivery is included in your order.\\\\n\\\\nDelivery costs by district:\\\\n- Rawai: 500 baht\\\\n- Chalong: 380 baht\\\\n- Phuket Town: 300 baht\\\\n- Kathu: 280 baht\\\\n- Patong: 400 baht\\\\n- Bang Tao: 500 baht\\\\n- Laguna: 500 baht\\\\n- Thalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='รวมค่าจัดส่งในการสั่งซื้อของคุณแล้วค่ะ\\\\n\\\\nค่าจัดส่งตามเขต:\\\\n- ราไวย์: 500 บาท\\\\n- ฉลอง: 380 บาท\\\\n- ภูเก็ตทาวน์: 300 บาท\\\\n- กะทู้: 280 บาท\\\\n- ป่าตอง: 400 บาท\\\\n- บางเทา: 500 บาท\\\\n- ลากูน่า: 500 บาท\\\\n- ถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งให้ครบถ้วนค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Centio condo', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354030), content_en='Centio condo', content_thai='เซ็นติโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо за адрес!\\\\n\\\\nПожалуйста, укажите желаемую дату и время доставки.\\\\n\\\\nМы доставляем цветы с 8:00 до 21:00. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354034), content_en='Thank you for the address!\\\\n\\\\nPlease specify the desired date and time for delivery.\\\\n\\\\nWe deliver flowers from 8:00 AM to 9:00 PM.', content_thai='ขอบคุณสำหรับที่อยู่ค่ะ!\\\\n\\\\nกรุณาระบุวันที่และเวลาที่ต้องการจัดส่งดอกไม้ค่ะ\\\\n\\\\nเราจัดส่งดอกไม้ตั้งแต่ 8:00 น. ถึง 21:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='В среду в 15', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354038), content_en='On Wednesday at 15', content_thai='วันพุธ เวลา 15:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо! Дата и время доставки сохранены: 9 июля 2025 года, 15:00.\\\\n\\\\nНужна ли открытка к букету? Если да, какой текст на ней написать? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354041), content_en='Thank you! The delivery date and time have been saved: July 9, 2025, 15:00.\\\\n\\\\nDo you need a card with the bouquet? If yes, what text should be written on it?', content_thai='ขอบคุณค่ะ! วันที่และเวลาจัดส่งได้บันทึกไว้แล้ว: 9 กรกฎาคม 2568, 15:00 น.\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่? ถ้าใช่, ต้องการให้เขียนข้อความอะไรลงในการ์ดคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='С любовью, Петя', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354044), content_en='With love, Petya', content_thai='ด้วยรัก, เปตยา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Текст для открытки сохранен.\\\\n\\\\nПожалуйста, укажите имя получателя. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354047), content_en=\"The card text has been saved.\\\\n\\\\nPlease provide the recipient's name.\", content_thai='ข้อความการ์ดได้ถูกบันทึกแล้วค่ะ\\\\n\\\\nกรุณาระบุชื่อผู้รับค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354051), content_en='Sasha', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Имя получателя сохранено.\\\\n\\\\nПожалуйста, укажите номер телефона получателя. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354054), content_en=\"Recipient's name has been saved.\\\\n\\\\nPlease provide the recipient's phone number.\", content_thai='บันทึกชื่อผู้รับเรียบร้อยแล้วค่ะ\\\\n\\\\nกรุณาระบุเบอร์โทรศัพท์ของผู้รับด้วยค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='8900005566', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354057), content_en='8900005566', content_thai='8900005566', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354061), content_en='Sasha', content_thai='ซาชา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Номер телефона получателя сохранен.\\\\n\\\\nПожалуйста, проверьте данные вашего заказа:\\\\n\\\\nБукет: Pretty 😍\\\\nСтоимость букета: 2\\xa0600,00\\xa0฿\\\\nДоставка: Нужна, по адресу Centio condo\\\\nДата и время доставки: 9 июля 2025 года, 15:00\\\\nОткрытка: Нужна, текст: \"С любовью, Петя\"\\\\nИмя получателя: Саша\\\\nТелефон получателя: 8900005566\\\\n\\\\nПодтверждаете заказ? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354065), content_en='Recipient\\'s phone number saved.\\\\n\\\\nPlease review your order details:\\\\n\\\\nBouquet: Pretty 😍\\\\nBouquet price: 2,600.00 ฿\\\\nDelivery: Needed, to address Centio condo\\\\nDelivery date and time: July 9, 2025, 15:00\\\\nCard: Needed, text: \"With love, Petya\"\\\\nRecipient\\'s name: Sasha\\\\nRecipient\\'s phone: 8900005566\\\\n\\\\nDo you confirm the order?', content_thai='บันทึกเบอร์โทรศัพท์ผู้รับแล้วค่ะ\\\\n\\\\nโปรดตรวจสอบรายละเอียดคำสั่งซื้อของคุณ:\\\\n\\\\nช่อดอกไม้: Pretty 😍\\\\nราคาช่อดอกไม้: 2,600.00 ฿\\\\nการจัดส่ง: ต้องการ, ไปยังที่อยู่ Centio condo\\\\nวันที่และเวลาจัดส่ง: 9 กรกฎาคม 2568, 15:00 น.\\\\nการ์ด: ต้องการ, ข้อความ: \"With love, Petya\"\\\\nชื่อผู้รับ: Sasha\\\\nเบอร์โทรศัพท์ผู้รับ: 8900005566\\\\n\\\\nคุณยืนยันคำสั่งซื้อหรือไม่คะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354068), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо за подтверждение!\\\\n\\\\nВаш заказ принят и будет передан менеджеру для обработки.\\\\n\\\\nНаш магазин работает ежедневно с 9:00 до 18:00 и находится недалеко от Central Festival.\\\\n\\\\nОплата производится перед доставкой через менеджера. Мы принимаем баты, рубли и USDT.\\\\n\\\\nЕсли у вас возникнут вопросы, пожалуйста, свяжитесь с нами. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354071), content_en='Thank you for your confirmation!\\\\n\\\\nYour order has been accepted and will be forwarded to the manager for processing.\\\\n\\\\nOur store is open daily from 9:00 AM to 6:00 PM and is located near Central Festival.\\\\n\\\\nPayment is made before delivery via the manager. We accept Baht, Rubles, and USDT.\\\\n\\\\nIf you have any questions, please contact us.', content_thai='ขอบคุณสำหรับการยืนยัน!\\\\n\\\\nคำสั่งซื้อของคุณได้รับการยอมรับและจะถูกส่งต่อไปยังผู้จัดการเพื่อดำเนินการ\\\\n\\\\nร้านของเราเปิดทำการทุกวันตั้งแต่ 9:00 น. ถึง 18:00 น. และตั้งอยู่ใกล้กับ Central Festival\\\\n\\\\nการชำระเงินจะทำก่อนการจัดส่งผ่านผู้จัดการ เรารับเงินบาท รูเบิล และ USDT\\\\n\\\\nหากคุณมีคำถามใดๆ โปรดติดต่อเรา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша, 89084407880', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354075), content_en='Sasha, 89084407880', content_thai='ซาช่า, 89084407880', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354078), content_en='Sasha', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Ваш заказ уже был подтвержден и передан менеджеру.\\\\n\\\\nЕсли вам нужно внести изменения в данные получателя, пожалуйста, свяжитесь напрямую с нашим менеджером. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354081), content_en=\"Your order has already been confirmed and sent to the manager.\\\\n\\\\nIf you need to make changes to the recipient's details, please contact our manager directly.\", content_thai='คำสั่งซื้อของคุณได้รับการยืนยันและส่งให้ผู้จัดการแล้ว\\\\n\\\\nหากคุณต้องการเปลี่ยนแปลงรายละเอียดผู้รับ โปรดติดต่อผู้จัดการของเราโดยตรง', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Ваш заказ уже был подтвержден и передан менеджеру.\\\\n\\\\nЕсли у вас есть другие вопросы или вам нужна дополнительная помощь, пожалуйста, сообщите мне. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354083), content_en='Your order has already been confirmed and forwarded to the manager.\\\\n\\\\nIf you have any other questions or need further assistance, please let me know.', content_thai='คำสั่งซื้อของคุณได้รับการยืนยันและส่งต่อไปยังผู้จัดการแล้วค่ะ\\\\n\\\\nหากคุณมีคำถามอื่น ๆ หรือต้องการความช่วยเหลือเพิ่มเติม โปรดแจ้งให้เราทราบนะคะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='89084407880', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 37, 354086), content_en='89084407880', content_thai='89084407880', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:15:42] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:15:42.401706", "execution_time_ms": 4891.78, "result": ["Ваш заказ уже был подтвержден и передан менеджеру.\\n\\nЕсли вам нужно внести изменения, пожалуйста, свяжитесь напрямую с нашим менеджером.", "Your order has already been confirmed and passed to the manager.\\n\\nIf you need to make changes, please contact our manager directly.", "คำสั่งซื้อของคุณได้รับการยืนยันและส่งต่อให้ผู้จัดการแล้วค่ะ\\n\\nหากคุณต้องการเปลี่ยนแปลงข้อมูลใดๆ โปรดติดต่อผู้จัดการของเราโดยตรงค่ะ", null]}
[2025-07-06 16:15:42] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:15:42] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:15:46] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:15:46.965025", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107994050>", "text": "89084407880", "user_lang": "ru"}}
[2025-07-06 16:15:46] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:15:46.965598", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107994050>", "text": "89084407880", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 16:15:48] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:15:48.006835", "execution_time_ms": 1040.99, "result": "89084407880"}
[2025-07-06 16:15:48] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:15:48.008462", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107994050>", "text": "89084407880", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 16:15:49] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:15:49.521064", "execution_time_ms": 1512.28, "result": "89084407880"}
[2025-07-06 16:15:49] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:15:49.521405", "execution_time_ms": 2555.85, "result": ["89084407880", "89084407880", "89084407880"]}
[2025-07-06 16:15:51] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:15:51.359659", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107994050>", "messages": ["Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Привет', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238723), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день, Денис! Хотели бы вы посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238747), content_en='Good afternoon, Denis! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ คุณเดนิส! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238751), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238755), content_en='Excellent!\\\\n\\\\nNow I will show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='ยอดเยี่ยม!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปถ่ายให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238759), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238763), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238767), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238771), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238776), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238780), content_en='This (response to: Pretty 😍\\n2 600,00 ฿ 🌸)', content_thai='อันนี้ (ตอบกลับถึง: Pretty 😍\\n2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Букет 'Pretty 😍' сохранен.\\\\n\\\\nВам нужна доставка? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238784), content_en=\"Your bouquet 'Pretty 😍' is saved.\\\\n\\\\nDo you need delivery?\", content_thai=\"บันทึกช่อดอกไม้ 'Pretty 😍' ของคุณแล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238788), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доставка включена в ваш заказ.\\\\n\\\\nСтоимость доставки по районам:\\\\n- Раваи: 500 бат\\\\n- Чалонг: 380 бат\\\\n- Пхукет Таун: 300 бат\\\\n- Кату: 280 бат\\\\n- Патонг: 400 бат\\\\n- Банг Тао: 500 бат\\\\n- Лагуна: 500 бат\\\\n- Таланг/Май Као: 550 бат\\\\n\\\\nПожалуйста, укажите полный адрес доставки. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238791), content_en='Delivery is included in your order.\\\\n\\\\nDelivery costs by district:\\\\n- Rawai: 500 baht\\\\n- Chalong: 380 baht\\\\n- Phuket Town: 300 baht\\\\n- Kathu: 280 baht\\\\n- Patong: 400 baht\\\\n- Bang Tao: 500 baht\\\\n- Laguna: 500 baht\\\\n- Thalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='รวมค่าจัดส่งในการสั่งซื้อของคุณแล้วค่ะ\\\\n\\\\nค่าจัดส่งตามเขต:\\\\n- ราไวย์: 500 บาท\\\\n- ฉลอง: 380 บาท\\\\n- ภูเก็ตทาวน์: 300 บาท\\\\n- กะทู้: 280 บาท\\\\n- ป่าตอง: 400 บาท\\\\n- บางเทา: 500 บาท\\\\n- ลากูน่า: 500 บาท\\\\n- ถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งให้ครบถ้วนค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Centio condo', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238795), content_en='Centio condo', content_thai='เซ็นติโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо за адрес!\\\\n\\\\nПожалуйста, укажите желаемую дату и время доставки.\\\\n\\\\nМы доставляем цветы с 8:00 до 21:00. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238799), content_en='Thank you for the address!\\\\n\\\\nPlease specify the desired date and time for delivery.\\\\n\\\\nWe deliver flowers from 8:00 AM to 9:00 PM.', content_thai='ขอบคุณสำหรับที่อยู่ค่ะ!\\\\n\\\\nกรุณาระบุวันที่และเวลาที่ต้องการจัดส่งดอกไม้ค่ะ\\\\n\\\\nเราจัดส่งดอกไม้ตั้งแต่ 8:00 น. ถึง 21:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='В среду в 15', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238802), content_en='On Wednesday at 15', content_thai='วันพุธ เวลา 15:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо! Дата и время доставки сохранены: 9 июля 2025 года, 15:00.\\\\n\\\\nНужна ли открытка к букету? Если да, какой текст на ней написать? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238806), content_en='Thank you! The delivery date and time have been saved: July 9, 2025, 15:00.\\\\n\\\\nDo you need a card with the bouquet? If yes, what text should be written on it?', content_thai='ขอบคุณค่ะ! วันที่และเวลาจัดส่งได้บันทึกไว้แล้ว: 9 กรกฎาคม 2568, 15:00 น.\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่? ถ้าใช่, ต้องการให้เขียนข้อความอะไรลงในการ์ดคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='С любовью, Петя', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238808), content_en='With love, Petya', content_thai='ด้วยรัก, เปตยา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Текст для открытки сохранен.\\\\n\\\\nПожалуйста, укажите имя получателя. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238812), content_en=\"The card text has been saved.\\\\n\\\\nPlease provide the recipient's name.\", content_thai='ข้อความการ์ดได้ถูกบันทึกแล้วค่ะ\\\\n\\\\nกรุณาระบุชื่อผู้รับค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238815), content_en='Sasha', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Имя получателя сохранено.\\\\n\\\\nПожалуйста, укажите номер телефона получателя. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238818), content_en=\"Recipient's name has been saved.\\\\n\\\\nPlease provide the recipient's phone number.\", content_thai='บันทึกชื่อผู้รับเรียบร้อยแล้วค่ะ\\\\n\\\\nกรุณาระบุเบอร์โทรศัพท์ของผู้รับด้วยค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='8900005566', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238820), content_en='8900005566', content_thai='8900005566', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238823), content_en='Sasha', content_thai='ซาชา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Номер телефона получателя сохранен.\\\\n\\\\nПожалуйста, проверьте данные вашего заказа:\\\\n\\\\nБукет: Pretty 😍\\\\nСтоимость букета: 2\\xa0600,00\\xa0฿\\\\nДоставка: Нужна, по адресу Centio condo\\\\nДата и время доставки: 9 июля 2025 года, 15:00\\\\nОткрытка: Нужна, текст: \"С любовью, Петя\"\\\\nИмя получателя: Саша\\\\nТелефон получателя: 8900005566\\\\n\\\\nПодтверждаете заказ? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238826), content_en='Recipient\\'s phone number saved.\\\\n\\\\nPlease review your order details:\\\\n\\\\nBouquet: Pretty 😍\\\\nBouquet price: 2,600.00 ฿\\\\nDelivery: Needed, to address Centio condo\\\\nDelivery date and time: July 9, 2025, 15:00\\\\nCard: Needed, text: \"With love, Petya\"\\\\nRecipient\\'s name: Sasha\\\\nRecipient\\'s phone: 8900005566\\\\n\\\\nDo you confirm the order?', content_thai='บันทึกเบอร์โทรศัพท์ผู้รับแล้วค่ะ\\\\n\\\\nโปรดตรวจสอบรายละเอียดคำสั่งซื้อของคุณ:\\\\n\\\\nช่อดอกไม้: Pretty 😍\\\\nราคาช่อดอกไม้: 2,600.00 ฿\\\\nการจัดส่ง: ต้องการ, ไปยังที่อยู่ Centio condo\\\\nวันที่และเวลาจัดส่ง: 9 กรกฎาคม 2568, 15:00 น.\\\\nการ์ด: ต้องการ, ข้อความ: \"With love, Petya\"\\\\nชื่อผู้รับ: Sasha\\\\nเบอร์โทรศัพท์ผู้รับ: 8900005566\\\\n\\\\nคุณยืนยันคำสั่งซื้อหรือไม่คะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='да', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238828), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Спасибо за подтверждение!\\\\n\\\\nВаш заказ принят и будет передан менеджеру для обработки.\\\\n\\\\nНаш магазин работает ежедневно с 9:00 до 18:00 и находится недалеко от Central Festival.\\\\n\\\\nОплата производится перед доставкой через менеджера. Мы принимаем баты, рубли и USDT.\\\\n\\\\nЕсли у вас возникнут вопросы, пожалуйста, свяжитесь с нами. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238831), content_en='Thank you for your confirmation!\\\\n\\\\nYour order has been accepted and will be forwarded to the manager for processing.\\\\n\\\\nOur store is open daily from 9:00 AM to 6:00 PM and is located near Central Festival.\\\\n\\\\nPayment is made before delivery via the manager. We accept Baht, Rubles, and USDT.\\\\n\\\\nIf you have any questions, please contact us.', content_thai='ขอบคุณสำหรับการยืนยัน!\\\\n\\\\nคำสั่งซื้อของคุณได้รับการยอมรับและจะถูกส่งต่อไปยังผู้จัดการเพื่อดำเนินการ\\\\n\\\\nร้านของเราเปิดทำการทุกวันตั้งแต่ 9:00 น. ถึง 18:00 น. และตั้งอยู่ใกล้กับ Central Festival\\\\n\\\\nการชำระเงินจะทำก่อนการจัดส่งผ่านผู้จัดการ เรารับเงินบาท รูเบิล และ USDT\\\\n\\\\nหากคุณมีคำถามใดๆ โปรดติดต่อเรา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша, 89084407880', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238834), content_en='Sasha, 89084407880', content_thai='ซาช่า, 89084407880', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238836), content_en='Sasha', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Ваш заказ уже был подтвержден и передан менеджеру.\\\\n\\\\nЕсли вам нужно внести изменения в данные получателя, пожалуйста, свяжитесь напрямую с нашим менеджером. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238839), content_en=\"Your order has already been confirmed and sent to the manager.\\\\n\\\\nIf you need to make changes to the recipient's details, please contact our manager directly.\", content_thai='คำสั่งซื้อของคุณได้รับการยืนยันและส่งให้ผู้จัดการแล้ว\\\\n\\\\nหากคุณต้องการเปลี่ยนแปลงรายละเอียดผู้รับ โปรดติดต่อผู้จัดการของเราโดยตรง', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.ASSISTANT: 'assistant'>, content='Ваш заказ уже был подтвержден и передан менеджеру.\\\\n\\\\nЕсли у вас есть другие вопросы или вам нужна дополнительная помощь, пожалуйста, сообщите мне. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238841), content_en='Your order has already been confirmed and forwarded to the manager.\\\\n\\\\nIf you have any other questions or need further assistance, please let me know.', content_thai='คำสั่งซื้อของคุณได้รับการยืนยันและส่งต่อไปยังผู้จัดการแล้วค่ะ\\\\n\\\\nหากคุณมีคำถามอื่น ๆ หรือต้องการความช่วยเหลือเพิ่มเติม โปรดแจ้งให้เราทราบนะคะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='89084407880', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238844), content_en='89084407880', content_thai='89084407880', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_152413_739116_740', role=<MessageRole.USER: 'user'>, content='89084407880', timestamp=datetime.datetime(2025, 7, 6, 16, 15, 51, 238846), content_en='89084407880', content_thai='89084407880', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:15:56] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:15:56.164585", "execution_time_ms": 4802.29, "result": ["Ваш заказ уже был подтвержден и передан менеджеру.\\n\\nЕсли вам нужно внести изменения в данные получателя, пожалуйста, свяжитесь напрямую с нашим менеджером.", "Your order has already been confirmed and forwarded to the manager.\\n\\nIf you need to make changes to the recipient's details, please contact our manager directly.", "คำสั่งซื้อของคุณได้รับการยืนยันและส่งต่อไปยังผู้จัดการแล้วค่ะ\\n\\nหากคุณต้องการเปลี่ยนแปลงข้อมูลผู้รับ กรุณาติดต่อผู้จัดการของเราโดยตรงค่ะ", null]}
[2025-07-06 16:15:56] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:15:56] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:15:56.637941", "execution_time_ms": 39150.57, "result": true}
[2025-07-06 16:15:57] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:15:57] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:15:57.819969", "execution_time_ms": 33018.19, "result": true}
[2025-07-06 16:29:40] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:29:40.500652", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10b72e660>", "message_data": {"sender_id": "79140775712", "message_text": "Hi!", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUY1RTZDNUQ4NDQ1NDIyMEU1OAA=", "timestamp": "1751794171", "reply_to_message_id": null}}}
[2025-07-06 16:29:41] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:29:41] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:29:46] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T16:29:46.465274", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b72ea50>", "text": "Hi!"}}
[2025-07-06 16:29:46] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T16:29:46.466496", "execution_time_ms": 0.52, "result": "en"}
[2025-07-06 16:29:46] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:29:46.696023", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b72ea50>", "text": "Hi!", "user_lang": "en"}}
[2025-07-06 16:29:46] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:29:46.696294", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b72ea50>", "text": "Hi!", "source_lang": "en", "target_lang": "th"}}
[2025-07-06 16:29:49] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:29:49.817329", "execution_time_ms": 3120.79, "result": "สวัสดี"}
[2025-07-06 16:29:49] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:29:49.818214", "execution_time_ms": 3121.95, "result": ["Hi!", "Hi!", "สวัสดี"]}
[2025-07-06 16:29:51] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:29:51.567187", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b72ea50>", "messages": ["Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Hi!', timestamp=datetime.datetime(2025, 7, 6, 16, 29, 51, 447846), content_en='Hi!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)"], "user_lang": "auto", "sender_name": "Denis", "is_first_message": true}}
[2025-07-06 16:29:55] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:29:55.885010", "execution_time_ms": 4317.38, "result": ["Good afternoon! Would you like to see our flower catalog?", "Good afternoon! Would you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 16:29:56] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:29:57] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:29:57.073076", "execution_time_ms": 16570.85, "result": true}
[2025-07-06 16:30:13] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:30:13.712450", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10b6ce990>", "message_data": {"sender_id": "79140775712", "message_text": "yes", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUUwM0RGRkI5MzJEODcyOTU3NAA=", "timestamp": "1751794201", "reply_to_message_id": null}}}
[2025-07-06 16:30:14] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:30:14] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:30:18] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T16:30:18.839630", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6cee90>", "text": "yes"}}
[2025-07-06 16:30:18] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T16:30:18.841443", "execution_time_ms": 0.11, "result": "en"}
[2025-07-06 16:30:19] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:30:19.037001", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6cee90>", "text": "yes", "user_lang": "en"}}
[2025-07-06 16:30:19] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:30:19.039315", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6cee90>", "text": "yes", "source_lang": "en", "target_lang": "th"}}
[2025-07-06 16:30:20] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:30:20.008438", "execution_time_ms": 966.61, "result": "ใช่"}
[2025-07-06 16:30:20] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:30:20.009323", "execution_time_ms": 970.08, "result": ["yes", "yes", "ใช่"]}
[2025-07-06 16:30:21] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:30:21.854272", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6cee90>", "messages": ["Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Hi!', timestamp=datetime.datetime(2025, 7, 6, 16, 30, 21, 728524), content_en='Hi!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good afternoon! Would you like to see our flower catalog? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 30, 21, 728739), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 30, 21, 728746), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)"], "user_lang": "en", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:30:27] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:30:27.695705", "execution_time_ms": 5840.47, "result": ["Excellent!\\n\\nI'll show you each bouquet with a photo now.\\n\\nPlease wait a moment...", "Excellent!\\n\\nI'll show you each bouquet with a photo now.\\n\\nPlease wait a moment...", "เยี่ยมเลยค่ะ!\\n\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\n\\nกรุณารอสักครู่ค่ะ...", {"type": "send_catalog"}]}
[2025-07-06 16:30:28] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:30:29] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 16:30:29] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 16:30:30] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 16:30:30] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-06 16:30:31] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:30:32] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-06 16:30:33] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:30:34] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-06 16:30:34] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:30:35] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-06 16:30:35] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:30:36] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-06 16:30:37] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:30:37] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79140775712
[2025-07-06 16:30:37] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:30:37.535866", "execution_time_ms": 23822.32, "result": true}
[2025-07-06 16:31:14] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:31:14.847642", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10b6ce0d0>", "message_data": {"sender_id": "79140775712", "message_text": "This (ответ на: Clouds\n2 400,00 ฿ 🌸)", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTkyMjNFRDM4OUVBMEQ3NThEMQA=", "timestamp": "1751794258", "reply_to_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJBQ0U0N0VEQkI3NDVEMTA0NjkA"}}}
[2025-07-06 16:31:15] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:31:15] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:31:19] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:31:19.644716", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6cf390>", "text": "This (ответ на: Clouds\n2 400,00 ฿ 🌸)", "user_lang": "en"}}
[2025-07-06 16:31:19] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:31:19.645442", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6cf390>", "text": "This (ответ на: Clouds\n2 400,00 ฿ 🌸)", "source_lang": "en", "target_lang": "th"}}
[2025-07-06 16:31:22] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:31:22.966494", "execution_time_ms": 3320.74, "result": "นี่ (ตอบกลับ: เมฆ\n2,400.00 บาท 🌸)"}
[2025-07-06 16:31:22] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:31:22.968029", "execution_time_ms": 3322.63, "result": ["This (ответ на: Clouds\n2 400,00 ฿ 🌸)", "This (ответ на: Clouds\n2 400,00 ฿ 🌸)", "นี่ (ตอบกลับ: เมฆ\n2,400.00 บาท 🌸)"]}
[2025-07-06 16:31:24] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:31:24.810888", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6cf390>", "messages": ["Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Hi!', timestamp=datetime.datetime(2025, 7, 6, 16, 31, 24, 691021), content_en='Hi!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good afternoon! Would you like to see our flower catalog? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 31, 24, 691037), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 31, 24, 691041), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment... 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 31, 24, 691045), content_en=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment...\", content_thai='เยี่ยมเลยค่ะ!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\\\n\\\\nกรุณารอสักครู่ค่ะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 31, 24, 691047), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 31, 24, 691050), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 31, 24, 691053), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 31, 24, 691056), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 31, 24, 691059), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 31, 24, 691061), content_en='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', content_thai='นี่ (ตอบกลับ: เมฆ\\n2,400.00 บาท 🌸)', id=None, wa_message_id=None, parts=None)"], "user_lang": "en", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:31:30] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:31:30.278193", "execution_time_ms": 5466.27, "result": ["Bouquet 'Clouds' selected.\\n\\nDo you need delivery?", "Bouquet 'Clouds' selected.\\n\\nDo you need delivery?", "เลือกช่อดอกไม้ 'Clouds' แล้วค่ะ\\n\\nคุณต้องการบริการจัดส่งไหมคะ?", {"type": "save_order_info", "bouquet": "Clouds", "retailer_id": "uztv8n7g9i"}]}
[2025-07-06 16:31:31] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:31:34] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:31:34.000752", "execution_time_ms": 19152.27, "result": true}
[2025-07-06 16:31:52] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:31:52.676078", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10b6c7100>", "message_data": {"sender_id": "79140775712", "message_text": "yes", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTJFOTAyMjZDMjM1RTQ2MUNBNAA=", "timestamp": "1751794303", "reply_to_message_id": null}}}
[2025-07-06 16:31:53] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:31:53] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:31:57] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:31:57.677922", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6c69e0>", "text": "yes", "user_lang": "en"}}
[2025-07-06 16:31:57] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:31:57.678253", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6c69e0>", "text": "yes", "source_lang": "en", "target_lang": "th"}}
[2025-07-06 16:31:58] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:31:58.557094", "execution_time_ms": 878.66, "result": "ใช่"}
[2025-07-06 16:31:58] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:31:58.557981", "execution_time_ms": 879.75, "result": ["yes", "yes", "ใช่"]}
[2025-07-06 16:32:00] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:32:00.352898", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6c69e0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Hi!', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 0, 207234), content_en='Hi!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good afternoon! Would you like to see our flower catalog? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 0, 207249), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 0, 207254), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment... 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 32, 0, 207257), content_en=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment...\", content_thai='เยี่ยมเลยค่ะ!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\\\n\\\\nกรุณารอสักครู่ค่ะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 0, 207260), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 0, 207262), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 0, 207265), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 0, 207267), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 0, 207270), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 0, 207272), content_en='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', content_thai='นี่ (ตอบกลับ: เมฆ\\n2,400.00 บาท 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 32, 0, 207275), content_en=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery?\", content_thai=\"เลือกช่อดอกไม้ 'Clouds' แล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 0, 207277), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)"], "user_lang": "en", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:32:08] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:32:08.171815", "execution_time_ms": 7817.9, "result": ["Yes, delivery is available for your order.\\n\\nHere are our delivery prices across Phuket:\\n\\nRawai: 500 baht\\nChalong: 380 baht\\nPhuket Town: 300 baht\\nKathu: 280 baht\\nPatong: 400 baht\\nBang Tao: 500 baht\\nLaguna: 500 baht\\nThalang/Mai Khao: 550 baht\\n\\nPlease provide the full delivery address.", "Yes, delivery is available for your order.\\n\\nHere are our delivery prices across Phuket:\\n\\nRawai: 500 baht\\nChalong: 380 baht\\nPhuket Town: 300 baht\\nKathu: 280 baht\\nPatong: 400 baht\\nBang Tao: 500 baht\\nLaguna: 500 baht\\nThalang/Mai Khao: 550 baht\\n\\nPlease provide the full delivery address.", "ใช่ค่ะ บริการจัดส่งมีให้บริการสำหรับคำสั่งซื้อของคุณค่ะ\\n\\nราคาค่าจัดส่งทั่วภูเก็ตมีดังนี้ค่ะ:\\n\\nราไวย์: 500 บาท\\nฉลอง: 380 บาท\\nเมืองภูเก็ต: 300 บาท\\nกะทู้: 280 บาท\\nป่าตอง: 400 บาท\\nบางเทา: 500 บาท\\nลากูน่า: 500 บาท\\nถลาง/ไม้ขาว: 550 บาท\\n\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ", {"type": "save_order_info", "delivery_needed": true, "bouquet": "Clouds", "retailer_id": "uztv8n7g9i"}]}
[2025-07-06 16:32:08] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:32:11] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:32:11.241587", "execution_time_ms": 18564.88, "result": true}
[2025-07-06 16:32:33] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:32:33.366800", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10b6c68b0>", "message_data": {"sender_id": "79140775712", "message_text": "Centrio condo", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUJCNjRDNjNGMkY5REQxQjg0OQA=", "timestamp": "1751794344", "reply_to_message_id": null}}}
[2025-07-06 16:32:34] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:32:34] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:32:38] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:32:38.359930", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6c69e0>", "text": "Centrio condo", "user_lang": "en"}}
[2025-07-06 16:32:38] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:32:38.360680", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6c69e0>", "text": "Centrio condo", "source_lang": "en", "target_lang": "th"}}
[2025-07-06 16:32:41] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:32:41.323940", "execution_time_ms": 2963.05, "result": "เซ็นทรีโอ คอนโด"}
[2025-07-06 16:32:41] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:32:41.325309", "execution_time_ms": 2964.66, "result": ["Centrio condo", "Centrio condo", "เซ็นทรีโอ คอนโด"]}
[2025-07-06 16:32:43] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:32:43.198229", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6c69e0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Hi!', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 43, 49431), content_en='Hi!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good afternoon! Would you like to see our flower catalog? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 43, 49444), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 43, 49447), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment... 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 32, 43, 49449), content_en=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment...\", content_thai='เยี่ยมเลยค่ะ!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\\\n\\\\nกรุณารอสักครู่ค่ะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 43, 49452), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 43, 49454), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 43, 49457), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 43, 49459), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 43, 49461), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 43, 49463), content_en='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', content_thai='นี่ (ตอบกลับ: เมฆ\\n2,400.00 บาท 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 32, 43, 49466), content_en=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery?\", content_thai=\"เลือกช่อดอกไม้ 'Clouds' แล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 43, 49468), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 43, 49470), content_en='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='ใช่ค่ะ บริการจัดส่งมีให้บริการสำหรับคำสั่งซื้อของคุณค่ะ\\\\n\\\\nราคาค่าจัดส่งทั่วภูเก็ตมีดังนี้ค่ะ:\\\\n\\\\nราไวย์: 500 บาท\\\\nฉลอง: 380 บาท\\\\nเมืองภูเก็ต: 300 บาท\\\\nกะทู้: 280 บาท\\\\nป่าตอง: 400 บาท\\\\nบางเทา: 500 บาท\\\\nลากูน่า: 500 บาท\\\\nถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Centrio condo', timestamp=datetime.datetime(2025, 7, 6, 16, 32, 43, 49472), content_en='Centrio condo', content_thai='เซ็นทรีโอ คอนโด', id=None, wa_message_id=None, parts=None)"], "user_lang": "en", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:32:47] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:32:47.718142", "execution_time_ms": 4518.15, "result": ["Thank you. We have saved 'Centrio condo' as the delivery address.\\n\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM.", "Thank you. We have saved 'Centrio condo' as the delivery address.\\n\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM.", "ขอบคุณค่ะ เราได้บันทึก 'Centrio condo' เป็นที่อยู่จัดส่งแล้วค่ะ\\n\\nคุณต้องการให้จัดส่งในวันที่และเวลาใดคะ? โปรดทราบว่าบริการจัดส่งของเรามีตั้งแต่เวลา 8:00 น. ถึง 21:00 น. ค่ะ", {"type": "save_order_info", "address": "Centrio condo"}]}
[2025-07-06 16:32:48] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:32:49] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:32:49.827965", "execution_time_ms": 16460.43, "result": true}
[2025-07-06 16:33:18] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:33:18.324586", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10b78f9b0>", "message_data": {"sender_id": "79140775712", "message_text": "Wed, 17:00", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUExMTY1NzVFNjUyOEExRUZCMwA=", "timestamp": "1751794388", "reply_to_message_id": null}}}
[2025-07-06 16:33:18] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:33:19] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:33:23] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:33:23.127754", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b78f410>", "text": "Wed, 17:00", "user_lang": "en"}}
[2025-07-06 16:33:23] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:33:23.128583", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b78f410>", "text": "Wed, 17:00", "source_lang": "en", "target_lang": "th"}}
[2025-07-06 16:33:26] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:33:26.856557", "execution_time_ms": 3727.79, "result": "วันพุธ, 17:00 น."}
[2025-07-06 16:33:26] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:33:26.856794", "execution_time_ms": 3728.26, "result": ["Wed, 17:00", "Wed, 17:00", "วันพุธ, 17:00 น."]}
[2025-07-06 16:33:28] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:33:28.623061", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b78f410>", "messages": ["Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Hi!', timestamp=datetime.datetime(2025, 7, 6, 16, 33, 28, 470206), content_en='Hi!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good afternoon! Would you like to see our flower catalog? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 33, 28, 470218), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 33, 28, 470221), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment... 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 33, 28, 470224), content_en=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment...\", content_thai='เยี่ยมเลยค่ะ!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\\\n\\\\nกรุณารอสักครู่ค่ะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 33, 28, 470227), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 33, 28, 470229), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 33, 28, 470231), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 33, 28, 470234), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 33, 28, 470236), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 33, 28, 470239), content_en='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', content_thai='นี่ (ตอบกลับ: เมฆ\\n2,400.00 บาท 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 33, 28, 470241), content_en=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery?\", content_thai=\"เลือกช่อดอกไม้ 'Clouds' แล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 33, 28, 470243), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 33, 28, 470246), content_en='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='ใช่ค่ะ บริการจัดส่งมีให้บริการสำหรับคำสั่งซื้อของคุณค่ะ\\\\n\\\\nราคาค่าจัดส่งทั่วภูเก็ตมีดังนี้ค่ะ:\\\\n\\\\nราไวย์: 500 บาท\\\\nฉลอง: 380 บาท\\\\nเมืองภูเก็ต: 300 บาท\\\\nกะทู้: 280 บาท\\\\nป่าตอง: 400 บาท\\\\nบางเทา: 500 บาท\\\\nลากูน่า: 500 บาท\\\\nถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Centrio condo', timestamp=datetime.datetime(2025, 7, 6, 16, 33, 28, 470248), content_en='Centrio condo', content_thai='เซ็นทรีโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM. 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 33, 28, 470250), content_en=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM.\", content_thai=\"ขอบคุณค่ะ เราได้บันทึก 'Centrio condo' เป็นที่อยู่จัดส่งแล้วค่ะ\\\\n\\\\nคุณต้องการให้จัดส่งในวันที่และเวลาใดคะ? โปรดทราบว่าบริการจัดส่งของเรามีตั้งแต่เวลา 8:00 น. ถึง 21:00 น. ค่ะ\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Wed, 17:00', timestamp=datetime.datetime(2025, 7, 6, 16, 33, 28, 470252), content_en='Wed, 17:00', content_thai='วันพุธ, 17:00 น.', id=None, wa_message_id=None, parts=None)"], "user_lang": "en", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:33:34] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:33:34.267688", "execution_time_ms": 5642.73, "result": ["Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\n\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.", "Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\n\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.", "ขอบคุณค่ะ เราได้บันทึกวันที่จัดส่งเป็นวันที่ 9 กรกฎาคม และเวลา 17:00 น. ค่ะ\\n\\nคุณต้องการการ์ดพร้อมช่อดอกไม้ด้วยไหมคะ? ถ้าต้องการ โปรดระบุข้อความที่คุณต้องการให้ใส่ลงในการ์ดค่ะ", {"type": "save_order_info", "bouquet": "Clouds", "retailer_id": "uztv8n7g9i", "delivery_needed": true, "address": "Centrio condo", "date": "2025-07-09", "time": "17:00"}]}
[2025-07-06 16:33:35] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:33:37] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:33:37.404321", "execution_time_ms": 19078.77, "result": true}
[2025-07-06 16:34:05] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:34:05.587779", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10b6de8b0>", "message_data": {"sender_id": "79140775712", "message_text": "Change to this (ответ на: Pretty 😍\n2 600,00 ฿ 🌸)", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTM5MUREQzUzNDY2N0ZFNjJGMAA=", "timestamp": "1751794429", "reply_to_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBI4OTE3MTIyRjZFQUQwMjZCMkUA"}}}
[2025-07-06 16:34:06] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:34:06] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:34:10] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:34:10.648056", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6de470>", "text": "Change to this (ответ на: Pretty 😍\n2 600,00 ฿ 🌸)", "user_lang": "en"}}
[2025-07-06 16:34:10] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:34:10.648644", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6de470>", "text": "Change to this (ответ на: Pretty 😍\n2 600,00 ฿ 🌸)", "source_lang": "en", "target_lang": "th"}}
[2025-07-06 16:34:14] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:34:14.627850", "execution_time_ms": 3979.03, "result": "เปลี่ยนเป็นอันนี้ (ตอบกลับ: Pretty 😍 2 600,00 ฿ 🌸)"}
[2025-07-06 16:34:14] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:34:14.629260", "execution_time_ms": 3980.64, "result": ["Change to this (ответ на: Pretty 😍\n2 600,00 ฿ 🌸)", "Change to this (ответ на: Pretty 😍\n2 600,00 ฿ 🌸)", "เปลี่ยนเป็นอันนี้ (ตอบกลับ: Pretty 😍 2 600,00 ฿ 🌸)"]}
[2025-07-06 16:34:16] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:34:16.453453", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6de470>", "messages": ["Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Hi!', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316649), content_en='Hi!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good afternoon! Would you like to see our flower catalog? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316677), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316682), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment... 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316685), content_en=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment...\", content_thai='เยี่ยมเลยค่ะ!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\\\n\\\\nกรุณารอสักครู่ค่ะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316688), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316690), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316693), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316696), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316699), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316702), content_en='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', content_thai='นี่ (ตอบกลับ: เมฆ\\n2,400.00 บาท 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316704), content_en=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery?\", content_thai=\"เลือกช่อดอกไม้ 'Clouds' แล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316707), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316710), content_en='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='ใช่ค่ะ บริการจัดส่งมีให้บริการสำหรับคำสั่งซื้อของคุณค่ะ\\\\n\\\\nราคาค่าจัดส่งทั่วภูเก็ตมีดังนี้ค่ะ:\\\\n\\\\nราไวย์: 500 บาท\\\\nฉลอง: 380 บาท\\\\nเมืองภูเก็ต: 300 บาท\\\\nกะทู้: 280 บาท\\\\nป่าตอง: 400 บาท\\\\nบางเทา: 500 บาท\\\\nลากูน่า: 500 บาท\\\\nถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Centrio condo', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316712), content_en='Centrio condo', content_thai='เซ็นทรีโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM. 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316714), content_en=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM.\", content_thai=\"ขอบคุณค่ะ เราได้บันทึก 'Centrio condo' เป็นที่อยู่จัดส่งแล้วค่ะ\\\\n\\\\nคุณต้องการให้จัดส่งในวันที่และเวลาใดคะ? โปรดทราบว่าบริการจัดส่งของเรามีตั้งแต่เวลา 8:00 น. ถึง 21:00 น. ค่ะ\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Wed, 17:00', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316717), content_en='Wed, 17:00', content_thai='วันพุธ, 17:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316718), content_en='Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.', content_thai='ขอบคุณค่ะ เราได้บันทึกวันที่จัดส่งเป็นวันที่ 9 กรกฎาคม และเวลา 17:00 น. ค่ะ\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้ด้วยไหมคะ? ถ้าต้องการ โปรดระบุข้อความที่คุณต้องการให้ใส่ลงในการ์ดค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Change to this (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 16, 316720), content_en='Change to this (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', content_thai='เปลี่ยนเป็นอันนี้ (ตอบกลับ: Pretty 😍 2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)"], "user_lang": "en", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:34:25] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:34:25.670191", "execution_time_ms": 9213.84, "result": ["You have changed your bouquet selection to 'Pretty 😍'.\\n\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.", "You have changed your bouquet selection to 'Pretty 😍'.\\n\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.", "คุณได้เปลี่ยนการเลือกช่อดอกไม้เป็น 'Pretty 😍' แล้วค่ะ\\n\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่คะ ถ้าต้องการ โปรดระบุข้อความที่คุณต้องการให้เราเขียนลงในการ์ดค่ะ", {"type": "save_order_info", "bouquet": "Pretty 😍", "retailer_id": "kie4sy3qsy", "delivery_needed": true, "address": "Centrio condo", "date": "2025-07-09", "time": "17:00"}]}
[2025-07-06 16:34:26] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:34:28] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:34:28.975687", "execution_time_ms": 23387.09, "result": true}
[2025-07-06 16:34:45] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:34:45.921794", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10b6de250>", "message_data": {"sender_id": "79140775712", "message_text": "No", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTczMDVBNjcyRENEMDY0MTlDOQA=", "timestamp": "1751794476", "reply_to_message_id": null}}}
[2025-07-06 16:34:46] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:34:46] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:34:50] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:34:50.622893", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6dead0>", "text": "No", "user_lang": "en"}}
[2025-07-06 16:34:50] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:34:50.624068", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6dead0>", "text": "No", "source_lang": "en", "target_lang": "th"}}
[2025-07-06 16:34:51] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:34:51.572624", "execution_time_ms": 948.12, "result": "ไม่"}
[2025-07-06 16:34:51] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:34:51.573270", "execution_time_ms": 949.25, "result": ["No", "No", "ไม่"]}
[2025-07-06 16:34:53] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:34:53.430739", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b6dead0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Hi!', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296090), content_en='Hi!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good afternoon! Would you like to see our flower catalog? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296101), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296104), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment... 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296106), content_en=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment...\", content_thai='เยี่ยมเลยค่ะ!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\\\n\\\\nกรุณารอสักครู่ค่ะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296109), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296111), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296114), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296116), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296118), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296121), content_en='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', content_thai='นี่ (ตอบกลับ: เมฆ\\n2,400.00 บาท 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296124), content_en=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery?\", content_thai=\"เลือกช่อดอกไม้ 'Clouds' แล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296126), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296128), content_en='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='ใช่ค่ะ บริการจัดส่งมีให้บริการสำหรับคำสั่งซื้อของคุณค่ะ\\\\n\\\\nราคาค่าจัดส่งทั่วภูเก็ตมีดังนี้ค่ะ:\\\\n\\\\nราไวย์: 500 บาท\\\\nฉลอง: 380 บาท\\\\nเมืองภูเก็ต: 300 บาท\\\\nกะทู้: 280 บาท\\\\nป่าตอง: 400 บาท\\\\nบางเทา: 500 บาท\\\\nลากูน่า: 500 บาท\\\\nถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Centrio condo', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296130), content_en='Centrio condo', content_thai='เซ็นทรีโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM. 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296132), content_en=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM.\", content_thai=\"ขอบคุณค่ะ เราได้บันทึก 'Centrio condo' เป็นที่อยู่จัดส่งแล้วค่ะ\\\\n\\\\nคุณต้องการให้จัดส่งในวันที่และเวลาใดคะ? โปรดทราบว่าบริการจัดส่งของเรามีตั้งแต่เวลา 8:00 น. ถึง 21:00 น. ค่ะ\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Wed, 17:00', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296134), content_en='Wed, 17:00', content_thai='วันพุธ, 17:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296136), content_en='Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.', content_thai='ขอบคุณค่ะ เราได้บันทึกวันที่จัดส่งเป็นวันที่ 9 กรกฎาคม และเวลา 17:00 น. ค่ะ\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้ด้วยไหมคะ? ถ้าต้องการ โปรดระบุข้อความที่คุณต้องการให้ใส่ลงในการ์ดค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Change to this (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296138), content_en='Change to this (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', content_thai='เปลี่ยนเป็นอันนี้ (ตอบกลับ: Pretty 😍 2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"You have changed your bouquet selection to 'Pretty 😍'.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include. 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296140), content_en=\"You have changed your bouquet selection to 'Pretty 😍'.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.\", content_thai=\"คุณได้เปลี่ยนการเลือกช่อดอกไม้เป็น 'Pretty 😍' แล้วค่ะ\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่คะ ถ้าต้องการ โปรดระบุข้อความที่คุณต้องการให้เราเขียนลงในการ์ดค่ะ\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='No', timestamp=datetime.datetime(2025, 7, 6, 16, 34, 53, 296142), content_en='No', content_thai='ไม่', id=None, wa_message_id=None, parts=None)"], "user_lang": "en", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:34:58] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:34:58.328673", "execution_time_ms": 4894.96, "result": ["Thank you. No card will be included with your order.\\n\\nWhat is the recipient's name?", "Thank you. No card will be included with your order.\\n\\nWhat is the recipient's name?", "ขอบคุณค่ะ ไม่มีบัตรอวยพรในคำสั่งซื้อของคุณนะคะ\\n\\nชื่อผู้รับคือใครคะ?", {"type": "save_order_info", "bouquet": "Pretty 😍", "retailer_id": "kie4sy3qsy", "delivery_needed": true, "address": "Centrio condo", "date": "2025-07-09", "time": "17:00", "card_needed": false, "card_text": null}]}
[2025-07-06 16:34:59] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:35:01] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:35:01.348109", "execution_time_ms": 15425.56, "result": true}
[2025-07-06 16:35:32] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:35:32.032372", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10b761350>", "message_data": {"sender_id": "79140775712", "message_text": "Sasha", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTg4QThGQTE5MEZDRkZFMTE5RAA=", "timestamp": "1751794522", "reply_to_message_id": null}}}
[2025-07-06 16:35:32] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:35:33] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:35:37] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:35:37.220987", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b761d50>", "text": "Sasha", "user_lang": "en"}}
[2025-07-06 16:35:37] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:35:37.221538", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b761d50>", "text": "Sasha", "source_lang": "en", "target_lang": "th"}}
[2025-07-06 16:35:42] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:35:42.795349", "execution_time_ms": 5573.43, "result": "ซาช่า"}
[2025-07-06 16:35:42] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:35:42.796527", "execution_time_ms": 5575.09, "result": ["Sasha", "Sasha", "ซาช่า"]}
[2025-07-06 16:35:44] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:35:44.722153", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b761d50>", "messages": ["Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Hi!', timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557501), content_en='Hi!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good afternoon! Would you like to see our flower catalog? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557523), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557527), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment... 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557531), content_en=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment...\", content_thai='เยี่ยมเลยค่ะ!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\\\n\\\\nกรุณารอสักครู่ค่ะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557535), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557539), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557542), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557545), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557549), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557552), content_en='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', content_thai='นี่ (ตอบกลับ: เมฆ\\n2,400.00 บาท 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557556), content_en=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery?\", content_thai=\"เลือกช่อดอกไม้ 'Clouds' แล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557560), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557563), content_en='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='ใช่ค่ะ บริการจัดส่งมีให้บริการสำหรับคำสั่งซื้อของคุณค่ะ\\\\n\\\\nราคาค่าจัดส่งทั่วภูเก็ตมีดังนี้ค่ะ:\\\\n\\\\nราไวย์: 500 บาท\\\\nฉลอง: 380 บาท\\\\nเมืองภูเก็ต: 300 บาท\\\\nกะทู้: 280 บาท\\\\nป่าตอง: 400 บาท\\\\nบางเทา: 500 บาท\\\\nลากูน่า: 500 บาท\\\\nถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Centrio condo', timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557566), content_en='Centrio condo', content_thai='เซ็นทรีโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM. 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557570), content_en=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM.\", content_thai=\"ขอบคุณค่ะ เราได้บันทึก 'Centrio condo' เป็นที่อยู่จัดส่งแล้วค่ะ\\\\n\\\\nคุณต้องการให้จัดส่งในวันที่และเวลาใดคะ? โปรดทราบว่าบริการจัดส่งของเรามีตั้งแต่เวลา 8:00 น. ถึง 21:00 น. ค่ะ\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Wed, 17:00', timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557572), content_en='Wed, 17:00', content_thai='วันพุธ, 17:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557575), content_en='Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.', content_thai='ขอบคุณค่ะ เราได้บันทึกวันที่จัดส่งเป็นวันที่ 9 กรกฎาคม และเวลา 17:00 น. ค่ะ\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้ด้วยไหมคะ? ถ้าต้องการ โปรดระบุข้อความที่คุณต้องการให้ใส่ลงในการ์ดค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Change to this (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557579), content_en='Change to this (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', content_thai='เปลี่ยนเป็นอันนี้ (ตอบกลับ: Pretty 😍 2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"You have changed your bouquet selection to 'Pretty 😍'.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include. 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557582), content_en=\"You have changed your bouquet selection to 'Pretty 😍'.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.\", content_thai=\"คุณได้เปลี่ยนการเลือกช่อดอกไม้เป็น 'Pretty 😍' แล้วค่ะ\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่คะ ถ้าต้องการ โปรดระบุข้อความที่คุณต้องการให้เราเขียนลงในการ์ดค่ะ\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='No', timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557585), content_en='No', content_thai='ไม่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. No card will be included with your order.\\\\n\\\\nWhat is the recipient's name? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557588), content_en=\"Thank you. No card will be included with your order.\\\\n\\\\nWhat is the recipient's name?\", content_thai='ขอบคุณค่ะ ไม่มีบัตรอวยพรในคำสั่งซื้อของคุณนะคะ\\\\n\\\\nชื่อผู้รับคือใครคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Sasha', timestamp=datetime.datetime(2025, 7, 6, 16, 35, 44, 557591), content_en='Sasha', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)"], "user_lang": "en", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:35:49] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:35:49.437704", "execution_time_ms": 4712.06, "result": ["Thank you. We have saved 'Sasha' as the recipient's name.\\n\\nWhat is the recipient's phone number?", "Thank you. We have saved 'Sasha' as the recipient's name.\\n\\nWhat is the recipient's phone number?", "ขอบคุณค่ะ เราได้บันทึกชื่อผู้รับว่า 'Sasha' แล้วค่ะ\\n\\nเบอร์โทรศัพท์ของผู้รับคืออะไรคะ?", {"type": "save_order_info", "recipient_name": "Sasha"}]}
[2025-07-06 16:35:50] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:35:51] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:35:51.887784", "execution_time_ms": 19853.86, "result": true}
[2025-07-06 16:36:06] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:36:06.412756", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10b760a50>", "message_data": {"sender_id": "79140775712", "message_text": "4575686784564", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTA2NUVDQzE3MDhGRDQ1ODY0NAA=", "timestamp": "1751794557", "reply_to_message_id": null}}}
[2025-07-06 16:36:06] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:36:07] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:36:11] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:36:11.507700", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b760850>", "text": "4575686784564", "user_lang": "en"}}
[2025-07-06 16:36:11] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:36:11.508620", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b760850>", "text": "4575686784564", "source_lang": "en", "target_lang": "th"}}
[2025-07-06 16:36:13] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:36:13.861240", "execution_time_ms": 2351.86, "result": "4575686784564"}
[2025-07-06 16:36:13] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:36:13.863929", "execution_time_ms": 2355.35, "result": ["4575686784564", "4575686784564", "4575686784564"]}
[2025-07-06 16:36:15] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:36:15.608166", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10b760850>", "messages": ["Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Hi!', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494260), content_en='Hi!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good afternoon! Would you like to see our flower catalog? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494280), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494285), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment... 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494290), content_en=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment...\", content_thai='เยี่ยมเลยค่ะ!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\\\n\\\\nกรุณารอสักครู่ค่ะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494294), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494299), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494303), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494307), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494312), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494316), content_en='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', content_thai='นี่ (ตอบกลับ: เมฆ\\n2,400.00 บาท 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494321), content_en=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery?\", content_thai=\"เลือกช่อดอกไม้ 'Clouds' แล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494325), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494330), content_en='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='ใช่ค่ะ บริการจัดส่งมีให้บริการสำหรับคำสั่งซื้อของคุณค่ะ\\\\n\\\\nราคาค่าจัดส่งทั่วภูเก็ตมีดังนี้ค่ะ:\\\\n\\\\nราไวย์: 500 บาท\\\\nฉลอง: 380 บาท\\\\nเมืองภูเก็ต: 300 บาท\\\\nกะทู้: 280 บาท\\\\nป่าตอง: 400 บาท\\\\nบางเทา: 500 บาท\\\\nลากูน่า: 500 บาท\\\\nถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Centrio condo', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494334), content_en='Centrio condo', content_thai='เซ็นทรีโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM. 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494338), content_en=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM.\", content_thai=\"ขอบคุณค่ะ เราได้บันทึก 'Centrio condo' เป็นที่อยู่จัดส่งแล้วค่ะ\\\\n\\\\nคุณต้องการให้จัดส่งในวันที่และเวลาใดคะ? โปรดทราบว่าบริการจัดส่งของเรามีตั้งแต่เวลา 8:00 น. ถึง 21:00 น. ค่ะ\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Wed, 17:00', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494342), content_en='Wed, 17:00', content_thai='วันพุธ, 17:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494346), content_en='Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.', content_thai='ขอบคุณค่ะ เราได้บันทึกวันที่จัดส่งเป็นวันที่ 9 กรกฎาคม และเวลา 17:00 น. ค่ะ\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้ด้วยไหมคะ? ถ้าต้องการ โปรดระบุข้อความที่คุณต้องการให้ใส่ลงในการ์ดค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Change to this (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494350), content_en='Change to this (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', content_thai='เปลี่ยนเป็นอันนี้ (ตอบกลับ: Pretty 😍 2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"You have changed your bouquet selection to 'Pretty 😍'.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include. 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494354), content_en=\"You have changed your bouquet selection to 'Pretty 😍'.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.\", content_thai=\"คุณได้เปลี่ยนการเลือกช่อดอกไม้เป็น 'Pretty 😍' แล้วค่ะ\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่คะ ถ้าต้องการ โปรดระบุข้อความที่คุณต้องการให้เราเขียนลงในการ์ดค่ะ\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='No', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494358), content_en='No', content_thai='ไม่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. No card will be included with your order.\\\\n\\\\nWhat is the recipient's name? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494361), content_en=\"Thank you. No card will be included with your order.\\\\n\\\\nWhat is the recipient's name?\", content_thai='ขอบคุณค่ะ ไม่มีบัตรอวยพรในคำสั่งซื้อของคุณนะคะ\\\\n\\\\nชื่อผู้รับคือใครคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Sasha', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494365), content_en='Sasha', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. We have saved 'Sasha' as the recipient's name.\\\\n\\\\nWhat is the recipient's phone number? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494369), content_en=\"Thank you. We have saved 'Sasha' as the recipient's name.\\\\n\\\\nWhat is the recipient's phone number?\", content_thai=\"ขอบคุณค่ะ เราได้บันทึกชื่อผู้รับว่า 'Sasha' แล้วค่ะ\\\\n\\\\nเบอร์โทรศัพท์ของผู้รับคืออะไรคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='4575686784564', timestamp=datetime.datetime(2025, 7, 6, 16, 36, 15, 494372), content_en='4575686784564', content_thai='4575686784564', id=None, wa_message_id=None, parts=None)"], "user_lang": "en", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:36:31] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:36:31.193250", "execution_time_ms": 15582.16, "result": ["Recipient phone number saved. Here is a summary of your order:\\n\\nBouquet: Pretty 😍 (2,600.00 baht)\\nDelivery: Yes, to Centrio condo\\nDate & Time: July 9th, 2025 at 5:00 PM\\nCard: No\\nRecipient Name: Sasha\\nRecipient Phone: 4575686784564\\n\\nDoes everything look correct? Please confirm your order.", "Recipient phone number saved. Here is a summary of your order:\\n\\nBouquet: Pretty 😍 (2,600.00 baht)\\nDelivery: Yes, to Centrio condo\\nDate & Time: July 9th, 2025 at 5:00 PM\\nCard: No\\nRecipient Name: Sasha\\nRecipient Phone: 4575686784564\\n\\nDoes everything look correct? Please confirm your order.", "บันทึกเบอร์โทรศัพท์ผู้รับเรียบร้อยแล้วค่ะ นี่คือสรุปคำสั่งซื้อของคุณ:\\n\\nช่อดอกไม้: Pretty 😍 (2,600.00 บาท)\\nการจัดส่ง: ใช่, ไปยัง Centrio condo\\nวันที่และเวลา: 9 กรกฎาคม 2568 เวลา 17:00 น.\\nการ์ด: ไม่มี\\nชื่อผู้รับ: Sasha\\nเบอร์โทรศัพท์ผู้รับ: 4575686784564\\n\\nข้อมูลทั้งหมดถูกต้องหรือไม่คะ โปรดยืนยันคำสั่งซื้อของคุณค่ะ", {"type": "save_order_info", "bouquet": "Pretty 😍", "retailer_id": "kie4sy3qsy", "delivery_needed": true, "address": "Centrio condo", "date": "2025-07-09", "time": "17:00", "card_needed": false, "card_text": null, "recipient_name": "Sasha", "recipient_phone": "4575686784564"}]}
[2025-07-06 16:36:31] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:36:34] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:36:34.203091", "execution_time_ms": 27789.48, "result": true}
[2025-07-06 16:36:47] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:36:47.271066", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10ca0f2f0>", "message_data": {"sender_id": "79140775712", "message_text": "I do", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUNCMDkwN0RCRUJBM0YxQkY2OQA=", "timestamp": "1751794598", "reply_to_message_id": null}}}
[2025-07-06 16:36:47] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:36:48] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:36:52] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:36:52.883175", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10ca0f4d0>", "text": "I do", "user_lang": "en"}}
[2025-07-06 16:36:52] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:36:52.883806", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10ca0f4d0>", "text": "I do", "source_lang": "en", "target_lang": "th"}}
[2025-07-06 16:36:58] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T16:36:58.769640", "execution_time_ms": 5884.34, "result": "ฉันทำ"}
[2025-07-06 16:36:58] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T16:36:58.772775", "execution_time_ms": 5888.98, "result": ["I do", "I do", "ฉันทำ"]}
[2025-07-06 16:37:00] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:37:00.698100", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10ca0f4d0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Hi!', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 572969), content_en='Hi!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good afternoon! Would you like to see our flower catalog? 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 572977), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 572979), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment... 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 572980), content_en=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment...\", content_thai='เยี่ยมเลยค่ะ!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\\\n\\\\nกรุณารอสักครู่ค่ะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 572982), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 572983), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 572984), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 572985), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 572987), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 572989), content_en='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', content_thai='นี่ (ตอบกลับ: เมฆ\\n2,400.00 บาท 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 572990), content_en=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery?\", content_thai=\"เลือกช่อดอกไม้ 'Clouds' แล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 572991), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 572993), content_en='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='ใช่ค่ะ บริการจัดส่งมีให้บริการสำหรับคำสั่งซื้อของคุณค่ะ\\\\n\\\\nราคาค่าจัดส่งทั่วภูเก็ตมีดังนี้ค่ะ:\\\\n\\\\nราไวย์: 500 บาท\\\\nฉลอง: 380 บาท\\\\nเมืองภูเก็ต: 300 บาท\\\\nกะทู้: 280 บาท\\\\nป่าตอง: 400 บาท\\\\nบางเทา: 500 บาท\\\\nลากูน่า: 500 บาท\\\\nถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Centrio condo', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 572994), content_en='Centrio condo', content_thai='เซ็นทรีโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM. 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 572995), content_en=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM.\", content_thai=\"ขอบคุณค่ะ เราได้บันทึก 'Centrio condo' เป็นที่อยู่จัดส่งแล้วค่ะ\\\\n\\\\nคุณต้องการให้จัดส่งในวันที่และเวลาใดคะ? โปรดทราบว่าบริการจัดส่งของเรามีตั้งแต่เวลา 8:00 น. ถึง 21:00 น. ค่ะ\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Wed, 17:00', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 572997), content_en='Wed, 17:00', content_thai='วันพุธ, 17:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 572998), content_en='Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.', content_thai='ขอบคุณค่ะ เราได้บันทึกวันที่จัดส่งเป็นวันที่ 9 กรกฎาคม และเวลา 17:00 น. ค่ะ\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้ด้วยไหมคะ? ถ้าต้องการ โปรดระบุข้อความที่คุณต้องการให้ใส่ลงในการ์ดค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Change to this (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 573000), content_en='Change to this (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', content_thai='เปลี่ยนเป็นอันนี้ (ตอบกลับ: Pretty 😍 2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"You have changed your bouquet selection to 'Pretty 😍'.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include. 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 573001), content_en=\"You have changed your bouquet selection to 'Pretty 😍'.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.\", content_thai=\"คุณได้เปลี่ยนการเลือกช่อดอกไม้เป็น 'Pretty 😍' แล้วค่ะ\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่คะ ถ้าต้องการ โปรดระบุข้อความที่คุณต้องการให้เราเขียนลงในการ์ดค่ะ\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='No', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 573002), content_en='No', content_thai='ไม่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. No card will be included with your order.\\\\n\\\\nWhat is the recipient's name? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 573003), content_en=\"Thank you. No card will be included with your order.\\\\n\\\\nWhat is the recipient's name?\", content_thai='ขอบคุณค่ะ ไม่มีบัตรอวยพรในคำสั่งซื้อของคุณนะคะ\\\\n\\\\nชื่อผู้รับคือใครคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Sasha', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 573004), content_en='Sasha', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. We have saved 'Sasha' as the recipient's name.\\\\n\\\\nWhat is the recipient's phone number? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 573006), content_en=\"Thank you. We have saved 'Sasha' as the recipient's name.\\\\n\\\\nWhat is the recipient's phone number?\", content_thai=\"ขอบคุณค่ะ เราได้บันทึกชื่อผู้รับว่า 'Sasha' แล้วค่ะ\\\\n\\\\nเบอร์โทรศัพท์ของผู้รับคืออะไรคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='4575686784564', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 573007), content_en='4575686784564', content_thai='4575686784564', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Recipient phone number saved. Here is a summary of your order:\\\\n\\\\nBouquet: Pretty 😍 (2,600.00 baht)\\\\nDelivery: Yes, to Centrio condo\\\\nDate & Time: July 9th, 2025 at 5:00 PM\\\\nCard: No\\\\nRecipient Name: Sasha\\\\nRecipient Phone: 4575686784564\\\\n\\\\nDoes everything look correct? Please confirm your order. 🌸', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 573008), content_en='Recipient phone number saved. Here is a summary of your order:\\\\n\\\\nBouquet: Pretty 😍 (2,600.00 baht)\\\\nDelivery: Yes, to Centrio condo\\\\nDate & Time: July 9th, 2025 at 5:00 PM\\\\nCard: No\\\\nRecipient Name: Sasha\\\\nRecipient Phone: 4575686784564\\\\n\\\\nDoes everything look correct? Please confirm your order.', content_thai='บันทึกเบอร์โทรศัพท์ผู้รับเรียบร้อยแล้วค่ะ นี่คือสรุปคำสั่งซื้อของคุณ:\\\\n\\\\nช่อดอกไม้: Pretty 😍 (2,600.00 บาท)\\\\nการจัดส่ง: ใช่, ไปยัง Centrio condo\\\\nวันที่และเวลา: 9 กรกฎาคม 2568 เวลา 17:00 น.\\\\nการ์ด: ไม่มี\\\\nชื่อผู้รับ: Sasha\\\\nเบอร์โทรศัพท์ผู้รับ: 4575686784564\\\\n\\\\nข้อมูลทั้งหมดถูกต้องหรือไม่คะ โปรดยืนยันคำสั่งซื้อของคุณค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='I do', timestamp=datetime.datetime(2025, 7, 6, 16, 37, 0, 573009), content_en='I do', content_thai='ฉันทำ', id=None, wa_message_id=None, parts=None)"], "user_lang": "en", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 16:37:09] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T16:37:09.000209", "execution_time_ms": 8299.68, "result": ["Your order has been successfully confirmed.\\n\\nA manager will contact you shortly to clarify payment details and finalize the delivery.", "Your order has been successfully confirmed.\\n\\nA manager will contact you shortly to clarify payment details and finalize the delivery.", "คำสั่งซื้อของคุณได้รับการยืนยันเรียบร้อยแล้วค่ะ\\n\\nผู้จัดการจะติดต่อกลับไปในไม่ช้าเพื่อยืนยันรายละเอียดการชำระเงินและดำเนินการจัดส่งให้เรียบร้อยค่ะ", {"type": "confirm_order", "bouquet": "Pretty 😍", "retailer_id": "kie4sy3qsy", "delivery_needed": true, "address": "Centrio condo", "date": "2025-07-09", "time": "17:00", "card_needed": false, "card_text": null, "recipient_name": "Sasha", "recipient_phone": "4575686784564"}]}
[2025-07-06 16:37:10] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 16:37:12] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T16:37:12.112771", "execution_time_ms": 24840.9, "result": true}
[2025-07-06 17:33:22] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T17:33:22.054484", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108edbe00>", "message_data": {"sender_id": "79140775712", "message_text": "В среду в 15", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUZCNUJGQ0U5OTY4N0U2RDJFRQA=", "timestamp": "1751791318", "reply_to_message_id": null}}}
[2025-07-06 17:33:22] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:33:23] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:33:27] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T17:33:27.243522", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108edae40>", "text": "В среду в 15", "user_lang": "en"}}
[2025-07-06 17:33:27] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:33:27.244047", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108edae40>", "text": "В среду в 15", "source_lang": "en", "target_lang": "th"}}
[2025-07-06 17:33:29] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:33:29.172499", "execution_time_ms": 1927.92, "result": "วันพุธ เวลา 15"}
[2025-07-06 17:33:29] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T17:33:29.174405", "execution_time_ms": 1930.38, "result": ["В среду в 15", "В среду в 15", "วันพุธ เวลา 15"]}
[2025-07-06 17:33:31] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T17:33:31.429107", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108edae40>", "messages": ["Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Hi!', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270428), content_en='Hi!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good afternoon! Would you like to see our flower catalog? 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270451), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270456), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment... 🌸\", timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270461), content_en=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment...\", content_thai='เยี่ยมเลยค่ะ!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\\\n\\\\nกรุณารอสักครู่ค่ะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270465), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270468), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270471), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270474), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270477), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270480), content_en='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', content_thai='นี่ (ตอบกลับ: เมฆ\\n2,400.00 บาท 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270483), content_en=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery?\", content_thai=\"เลือกช่อดอกไม้ 'Clouds' แล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270486), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address. 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270489), content_en='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='ใช่ค่ะ บริการจัดส่งมีให้บริการสำหรับคำสั่งซื้อของคุณค่ะ\\\\n\\\\nราคาค่าจัดส่งทั่วภูเก็ตมีดังนี้ค่ะ:\\\\n\\\\nราไวย์: 500 บาท\\\\nฉลอง: 380 บาท\\\\nเมืองภูเก็ต: 300 บาท\\\\nกะทู้: 280 บาท\\\\nป่าตอง: 400 บาท\\\\nบางเทา: 500 บาท\\\\nลากูน่า: 500 บาท\\\\nถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Centrio condo', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270492), content_en='Centrio condo', content_thai='เซ็นทรีโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM. 🌸\", timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270495), content_en=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM.\", content_thai=\"ขอบคุณค่ะ เราได้บันทึก 'Centrio condo' เป็นที่อยู่จัดส่งแล้วค่ะ\\\\n\\\\nคุณต้องการให้จัดส่งในวันที่และเวลาใดคะ? โปรดทราบว่าบริการจัดส่งของเรามีตั้งแต่เวลา 8:00 น. ถึง 21:00 น. ค่ะ\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Wed, 17:00', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270498), content_en='Wed, 17:00', content_thai='วันพุธ, 17:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include. 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270500), content_en='Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.', content_thai='ขอบคุณค่ะ เราได้บันทึกวันที่จัดส่งเป็นวันที่ 9 กรกฎาคม และเวลา 17:00 น. ค่ะ\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้ด้วยไหมคะ? ถ้าต้องการ โปรดระบุข้อความที่คุณต้องการให้ใส่ลงในการ์ดค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Change to this (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270503), content_en='Change to this (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', content_thai='เปลี่ยนเป็นอันนี้ (ตอบกลับ: Pretty 😍 2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"You have changed your bouquet selection to 'Pretty 😍'.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include. 🌸\", timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270506), content_en=\"You have changed your bouquet selection to 'Pretty 😍'.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.\", content_thai=\"คุณได้เปลี่ยนการเลือกช่อดอกไม้เป็น 'Pretty 😍' แล้วค่ะ\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่คะ ถ้าต้องการ โปรดระบุข้อความที่คุณต้องการให้เราเขียนลงในการ์ดค่ะ\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='No', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270509), content_en='No', content_thai='ไม่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. No card will be included with your order.\\\\n\\\\nWhat is the recipient's name? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270511), content_en=\"Thank you. No card will be included with your order.\\\\n\\\\nWhat is the recipient's name?\", content_thai='ขอบคุณค่ะ ไม่มีบัตรอวยพรในคำสั่งซื้อของคุณนะคะ\\\\n\\\\nชื่อผู้รับคือใครคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Sasha', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270514), content_en='Sasha', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. We have saved 'Sasha' as the recipient's name.\\\\n\\\\nWhat is the recipient's phone number? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270517), content_en=\"Thank you. We have saved 'Sasha' as the recipient's name.\\\\n\\\\nWhat is the recipient's phone number?\", content_thai=\"ขอบคุณค่ะ เราได้บันทึกชื่อผู้รับว่า 'Sasha' แล้วค่ะ\\\\n\\\\nเบอร์โทรศัพท์ของผู้รับคืออะไรคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='4575686784564', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270520), content_en='4575686784564', content_thai='4575686784564', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Recipient phone number saved. Here is a summary of your order:\\\\n\\\\nBouquet: Pretty 😍 (2,600.00 baht)\\\\nDelivery: Yes, to Centrio condo\\\\nDate & Time: July 9th, 2025 at 5:00 PM\\\\nCard: No\\\\nRecipient Name: Sasha\\\\nRecipient Phone: 4575686784564\\\\n\\\\nDoes everything look correct? Please confirm your order. 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270522), content_en='Recipient phone number saved. Here is a summary of your order:\\\\n\\\\nBouquet: Pretty 😍 (2,600.00 baht)\\\\nDelivery: Yes, to Centrio condo\\\\nDate & Time: July 9th, 2025 at 5:00 PM\\\\nCard: No\\\\nRecipient Name: Sasha\\\\nRecipient Phone: 4575686784564\\\\n\\\\nDoes everything look correct? Please confirm your order.', content_thai='บันทึกเบอร์โทรศัพท์ผู้รับเรียบร้อยแล้วค่ะ นี่คือสรุปคำสั่งซื้อของคุณ:\\\\n\\\\nช่อดอกไม้: Pretty 😍 (2,600.00 บาท)\\\\nการจัดส่ง: ใช่, ไปยัง Centrio condo\\\\nวันที่และเวลา: 9 กรกฎาคม 2568 เวลา 17:00 น.\\\\nการ์ด: ไม่มี\\\\nชื่อผู้รับ: Sasha\\\\nเบอร์โทรศัพท์ผู้รับ: 4575686784564\\\\n\\\\nข้อมูลทั้งหมดถูกต้องหรือไม่คะ โปรดยืนยันคำสั่งซื้อของคุณค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='I do', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270525), content_en='I do', content_thai='ฉันทำ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Your order has been successfully confirmed.\\\\n\\\\nA manager will contact you shortly to clarify payment details and finalize the delivery. 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270528), content_en='Your order has been successfully confirmed.\\\\n\\\\nA manager will contact you shortly to clarify payment details and finalize the delivery.', content_thai='คำสั่งซื้อของคุณได้รับการยืนยันเรียบร้อยแล้วค่ะ\\\\n\\\\nผู้จัดการจะติดต่อกลับไปในไม่ช้าเพื่อยืนยันรายละเอียดการชำระเงินและดำเนินการจัดส่งให้เรียบร้อยค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='В среду в 15', timestamp=datetime.datetime(2025, 7, 6, 17, 33, 31, 270530), content_en='В среду в 15', content_thai='วันพุธ เวลา 15', id=None, wa_message_id=None, parts=None)"], "user_lang": "en", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 17:33:48] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T17:33:48.508344", "execution_time_ms": 17075.62, "result": ["Хорошо, я обновила время доставки на среду, 9 июля, в 15:00.\\n\\nМенеджер свяжется с вами, чтобы подтвердить эти обновленные детали и уточнить оплату.", "Okay, I have updated the delivery time to Wednesday, July 9th, at 3:00 PM.\\n\\nA manager will contact you to confirm these updated details and clarify payment.", "ตกลงค่ะ ฉันได้อัปเดตเวลาจัดส่งเป็นวันพุธที่ 9 กรกฎาคม เวลา 15:00 น. แล้วค่ะ\\n\\nผู้จัดการจะติดต่อคุณเพื่อยืนยันรายละเอียดที่อัปเดตเหล่านี้และชี้แจงเรื่องการชำระเงินค่ะ", {"type": "save_order_info", "bouquet": "Pretty 😍", "retailer_id": "kie4sy3qsy", "delivery_needed": true, "address": "Centrio condo", "date": "2025-07-09", "time": "15:00", "card_needed": false, "card_text": null, "recipient_name": "Sasha", "recipient_phone": "4575686784564"}]}
[2025-07-06 17:33:50] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:33:52] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T17:33:52.802403", "execution_time_ms": 30745.66, "result": true}
[2025-07-06 17:36:25] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T17:36:25.084100", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108e1a710>", "message_data": {"sender_id": "79140775712", "message_text": "Саша", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTYxQzRBRUM3ODk4OEYwMjcxMgA=", "timestamp": "1751792566", "reply_to_message_id": null}}}
[2025-07-06 17:36:25] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:36:26] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:36:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T17:36:29.857983", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f574d0>", "text": "Саша", "user_lang": "en"}}
[2025-07-06 17:36:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:36:29.858694", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f574d0>", "text": "Саша", "source_lang": "en", "target_lang": "th"}}
[2025-07-06 17:36:32] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:36:32.365836", "execution_time_ms": 2506.69, "result": "ซาช่า"}
[2025-07-06 17:36:32] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T17:36:32.368156", "execution_time_ms": 2509.51, "result": ["Саша", "Саша", "ซาช่า"]}
[2025-07-06 17:36:34] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T17:36:34.290316", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f574d0>", "messages": ["Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Hi!', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150487), content_en='Hi!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good afternoon! Would you like to see our flower catalog? 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150507), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150511), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment... 🌸\", timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150515), content_en=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment...\", content_thai='เยี่ยมเลยค่ะ!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\\\n\\\\nกรุณารอสักครู่ค่ะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150518), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150521), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150556), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150560), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150563), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150566), content_en='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', content_thai='นี่ (ตอบกลับ: เมฆ\\n2,400.00 บาท 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150570), content_en=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery?\", content_thai=\"เลือกช่อดอกไม้ 'Clouds' แล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150573), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address. 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150575), content_en='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='ใช่ค่ะ บริการจัดส่งมีให้บริการสำหรับคำสั่งซื้อของคุณค่ะ\\\\n\\\\nราคาค่าจัดส่งทั่วภูเก็ตมีดังนี้ค่ะ:\\\\n\\\\nราไวย์: 500 บาท\\\\nฉลอง: 380 บาท\\\\nเมืองภูเก็ต: 300 บาท\\\\nกะทู้: 280 บาท\\\\nป่าตอง: 400 บาท\\\\nบางเทา: 500 บาท\\\\nลากูน่า: 500 บาท\\\\nถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Centrio condo', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150578), content_en='Centrio condo', content_thai='เซ็นทรีโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM. 🌸\", timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150581), content_en=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM.\", content_thai=\"ขอบคุณค่ะ เราได้บันทึก 'Centrio condo' เป็นที่อยู่จัดส่งแล้วค่ะ\\\\n\\\\nคุณต้องการให้จัดส่งในวันที่และเวลาใดคะ? โปรดทราบว่าบริการจัดส่งของเรามีตั้งแต่เวลา 8:00 น. ถึง 21:00 น. ค่ะ\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Wed, 17:00', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150584), content_en='Wed, 17:00', content_thai='วันพุธ, 17:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include. 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150586), content_en='Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.', content_thai='ขอบคุณค่ะ เราได้บันทึกวันที่จัดส่งเป็นวันที่ 9 กรกฎาคม และเวลา 17:00 น. ค่ะ\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้ด้วยไหมคะ? ถ้าต้องการ โปรดระบุข้อความที่คุณต้องการให้ใส่ลงในการ์ดค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Change to this (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150589), content_en='Change to this (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', content_thai='เปลี่ยนเป็นอันนี้ (ตอบกลับ: Pretty 😍 2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"You have changed your bouquet selection to 'Pretty 😍'.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include. 🌸\", timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150673), content_en=\"You have changed your bouquet selection to 'Pretty 😍'.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.\", content_thai=\"คุณได้เปลี่ยนการเลือกช่อดอกไม้เป็น 'Pretty 😍' แล้วค่ะ\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่คะ ถ้าต้องการ โปรดระบุข้อความที่คุณต้องการให้เราเขียนลงในการ์ดค่ะ\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='No', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150677), content_en='No', content_thai='ไม่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. No card will be included with your order.\\\\n\\\\nWhat is the recipient's name? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150680), content_en=\"Thank you. No card will be included with your order.\\\\n\\\\nWhat is the recipient's name?\", content_thai='ขอบคุณค่ะ ไม่มีบัตรอวยพรในคำสั่งซื้อของคุณนะคะ\\\\n\\\\nชื่อผู้รับคือใครคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Sasha', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150682), content_en='Sasha', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. We have saved 'Sasha' as the recipient's name.\\\\n\\\\nWhat is the recipient's phone number? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150684), content_en=\"Thank you. We have saved 'Sasha' as the recipient's name.\\\\n\\\\nWhat is the recipient's phone number?\", content_thai=\"ขอบคุณค่ะ เราได้บันทึกชื่อผู้รับว่า 'Sasha' แล้วค่ะ\\\\n\\\\nเบอร์โทรศัพท์ของผู้รับคืออะไรคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='4575686784564', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150687), content_en='4575686784564', content_thai='4575686784564', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Recipient phone number saved. Here is a summary of your order:\\\\n\\\\nBouquet: Pretty 😍 (2,600.00 baht)\\\\nDelivery: Yes, to Centrio condo\\\\nDate & Time: July 9th, 2025 at 5:00 PM\\\\nCard: No\\\\nRecipient Name: Sasha\\\\nRecipient Phone: 4575686784564\\\\n\\\\nDoes everything look correct? Please confirm your order. 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150689), content_en='Recipient phone number saved. Here is a summary of your order:\\\\n\\\\nBouquet: Pretty 😍 (2,600.00 baht)\\\\nDelivery: Yes, to Centrio condo\\\\nDate & Time: July 9th, 2025 at 5:00 PM\\\\nCard: No\\\\nRecipient Name: Sasha\\\\nRecipient Phone: 4575686784564\\\\n\\\\nDoes everything look correct? Please confirm your order.', content_thai='บันทึกเบอร์โทรศัพท์ผู้รับเรียบร้อยแล้วค่ะ นี่คือสรุปคำสั่งซื้อของคุณ:\\\\n\\\\nช่อดอกไม้: Pretty 😍 (2,600.00 บาท)\\\\nการจัดส่ง: ใช่, ไปยัง Centrio condo\\\\nวันที่และเวลา: 9 กรกฎาคม 2568 เวลา 17:00 น.\\\\nการ์ด: ไม่มี\\\\nชื่อผู้รับ: Sasha\\\\nเบอร์โทรศัพท์ผู้รับ: 4575686784564\\\\n\\\\nข้อมูลทั้งหมดถูกต้องหรือไม่คะ โปรดยืนยันคำสั่งซื้อของคุณค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='I do', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150692), content_en='I do', content_thai='ฉันทำ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Your order has been successfully confirmed.\\\\n\\\\nA manager will contact you shortly to clarify payment details and finalize the delivery. 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150695), content_en='Your order has been successfully confirmed.\\\\n\\\\nA manager will contact you shortly to clarify payment details and finalize the delivery.', content_thai='คำสั่งซื้อของคุณได้รับการยืนยันเรียบร้อยแล้วค่ะ\\\\n\\\\nผู้จัดการจะติดต่อกลับไปในไม่ช้าเพื่อยืนยันรายละเอียดการชำระเงินและดำเนินการจัดส่งให้เรียบร้อยค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='В среду в 15', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150698), content_en='В среду в 15', content_thai='วันพุธ เวลา 15', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Хорошо, я обновила время доставки на среду, 9 июля, в 15:00.\\\\n\\\\nМенеджер свяжется с вами, чтобы подтвердить эти обновленные детали и уточнить оплату. 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150700), content_en='Okay, I have updated the delivery time to Wednesday, July 9th, at 3:00 PM.\\\\n\\\\nA manager will contact you to confirm these updated details and clarify payment.', content_thai='ตกลงค่ะ ฉันได้อัปเดตเวลาจัดส่งเป็นวันพุธที่ 9 กรกฎาคม เวลา 15:00 น. แล้วค่ะ\\\\n\\\\nผู้จัดการจะติดต่อคุณเพื่อยืนยันรายละเอียดที่อัปเดตเหล่านี้และชี้แจงเรื่องการชำระเงินค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 17, 36, 34, 150702), content_en='Саша', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)"], "user_lang": "en", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 17:36:41] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T17:36:41.450186", "execution_time_ms": 7157.4, "result": ["Спасибо, имя получателя 'Саша' сохранено.\\n\\nВаш заказ подтвержден, и менеджер скоро свяжется с вами для уточнения деталей оплаты и доставки.", "Thank you, the recipient's name 'Sasha' is saved.\\n\\nYour order is confirmed, and a manager will contact you shortly to clarify payment and delivery details.", "ขอบคุณค่ะ ชื่อผู้รับ 'Sasha' ได้รับการบันทึกแล้วค่ะ\\n\\nคำสั่งซื้อของคุณได้รับการยืนยันแล้ว และผู้จัดการจะติดต่อกลับไปในไม่ช้าเพื่อชี้แจงรายละเอียดการชำระเงินและการจัดส่งค่ะ", null]}
[2025-07-06 17:36:42] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:36:42] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T17:36:42.604510", "execution_time_ms": 17519.19, "result": true}
[2025-07-06 17:43:23] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T17:43:23.965309", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108e1b750>", "message_data": {"sender_id": "79084634603", "message_text": "Здравствуйте", "message_type": "text", "sender_name": "Petr", "wa_message_id": "wamid.HBgLNzkwODQ2MzQ2MDMVAgASGBQzQTEzM0VENjdBOTc4RTY4QTZBQwA=", "timestamp": "1751798593", "reply_to_message_id": null}}}
[2025-07-06 17:43:24] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:43:25] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:43:29] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T17:43:29.835792", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f57d90>", "text": "Здравствуйте"}}
[2025-07-06 17:43:29] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T17:43:29.837609", "execution_time_ms": 1.11, "result": "ru"}
[2025-07-06 17:43:30] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T17:43:30.107888", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f57d90>", "text": "Здравствуйте", "user_lang": "ru"}}
[2025-07-06 17:43:30] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:43:30.108117", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f57d90>", "text": "Здравствуйте", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 17:43:31] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:43:31.288010", "execution_time_ms": 1179.79, "result": "Hello"}
[2025-07-06 17:43:31] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:43:31.288258", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f57d90>", "text": "Здравствуйте", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 17:43:33] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:43:33.390907", "execution_time_ms": 2102.54, "result": "สวัสดี"}
[2025-07-06 17:43:33] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T17:43:33.391105", "execution_time_ms": 3283.02, "result": ["Здравствуйте", "Hello", "สวัสดี"]}
[2025-07-06 17:43:35] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T17:43:35.211319", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f57d90>", "messages": ["Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.USER: 'user'>, content='Здравствуйте', timestamp=datetime.datetime(2025, 7, 6, 17, 43, 35, 91047), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)"], "user_lang": "auto", "sender_name": "Petr", "is_first_message": true}}
[2025-07-06 17:43:40] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T17:43:40.661529", "execution_time_ms": 5448.79, "result": ["Добрый день! Хотите посмотреть наш каталог цветов?", "Good afternoon! Would you like to see our flower catalog?", "สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-06 17:43:41] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:43:42] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T17:43:42.431396", "execution_time_ms": 18464.69, "result": true}
[2025-07-06 17:43:56] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T17:43:56.452428", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108f41940>", "message_data": {"sender_id": "79084634603", "message_text": "Да", "message_type": "text", "sender_name": "Petr", "wa_message_id": "wamid.HBgLNzkwODQ2MzQ2MDMVAgASGBQzQTQwNjk2NjBGNzM5M0JCRkFDNAA=", "timestamp": "1751798627", "reply_to_message_id": null}}}
[2025-07-06 17:43:57] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:43:57] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:44:01] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T17:44:01.472454", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f43820>", "text": "Да"}}
[2025-07-06 17:44:01] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-06T17:44:01.473493", "execution_time_ms": 0.08, "result": "ru"}
[2025-07-06 17:44:01] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T17:44:01.602240", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f43820>", "text": "Да", "user_lang": "ru"}}
[2025-07-06 17:44:01] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:44:01.606105", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f43820>", "text": "Да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 17:44:03] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:44:03.556620", "execution_time_ms": 1950.2, "result": "Yes"}
[2025-07-06 17:44:03] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:44:03.557284", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f43820>", "text": "Да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 17:44:08] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:44:08.627334", "execution_time_ms": 5069.68, "result": "ครับ"}
[2025-07-06 17:44:08] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T17:44:08.628780", "execution_time_ms": 7022.74, "result": ["Да", "Yes", "ครับ"]}
[2025-07-06 17:44:10] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T17:44:10.545947", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f43820>", "messages": ["Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.USER: 'user'>, content='Здравствуйте', timestamp=datetime.datetime(2025, 7, 6, 17, 44, 10, 398544), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 44, 10, 398567), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 17, 44, 10, 398571), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Petr", "is_first_message": false}}
[2025-07-06 17:44:16] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T17:44:16.042923", "execution_time_ms": 5496.22, "result": ["Добрый вечер, Петр!\\n\\nОтлично! Сейчас я покажу вам каждый букет с фотографией.\\n\\nПожалуйста, подождите минутку...", "Good evening, Petr!\\n\\nExcellent! I will now show you each bouquet with a photo.\\n\\nPlease wait a moment...", "สวัสดีตอนเย็นค่ะ คุณเปตร!\\n\\nเยี่ยมเลยค่ะ! ตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\n\\nกรุณารอสักครู่ค่ะ...", {"type": "send_catalog"}]}
[2025-07-06 17:44:16] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:44:18] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-06 17:44:18] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-06 17:44:18] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-06 17:44:18] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-06 17:44:19] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:44:20] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-06 17:44:21] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:44:22] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-06 17:44:23] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:44:23] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-06 17:44:24] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:44:25] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-06 17:44:26] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:44:26] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79084634603
[2025-07-06 17:44:26] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T17:44:26.370150", "execution_time_ms": 29916.74, "result": true}
[2025-07-06 17:44:52] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T17:44:52.359898", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108f42b10>", "message_data": {"sender_id": "79084634603", "message_text": "Эти (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "message_type": "text", "sender_name": "Petr", "wa_message_id": "wamid.HBgLNzkwODQ2MzQ2MDMVAgASGBQzQTEwM0QzRTI0QTA0OUQxMERBQgA=", "timestamp": "1751798677", "reply_to_message_id": "wamid.HBgLNzkwODQ2MzQ2MDMVAgARGBJDMTdBN0E1QjdFNDk1RUZCMkQA"}}}
[2025-07-06 17:44:53] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:44:53] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:44:57] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T17:44:57.247827", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f428b0>", "text": "Эти (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "user_lang": "ru"}}
[2025-07-06 17:44:57] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:44:57.248361", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f428b0>", "text": "Эти (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 17:44:59] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:44:59.370211", "execution_time_ms": 2121.66, "result": "These (reply to: Candy’s\n1,450.00 ฿ 🌸)"}
[2025-07-06 17:44:59] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:44:59.371230", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f428b0>", "text": "Эти (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 17:45:08] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:45:08.986659", "execution_time_ms": 9614.9, "result": "เหล่านี้ (ตอบกลับถึง: Candy’s 1 450,00 ฿ 🌸)"}
[2025-07-06 17:45:08] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T17:45:08.988186", "execution_time_ms": 11739.85, "result": ["Эти (ответ на: Candy’s\n1 450,00 ฿ 🌸)", "These (reply to: Candy’s\n1,450.00 ฿ 🌸)", "เหล่านี้ (ตอบกลับถึง: Candy’s 1 450,00 ฿ 🌸)"]}
[2025-07-06 17:45:10] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T17:45:10.809364", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f428b0>", "messages": ["Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.USER: 'user'>, content='Здравствуйте', timestamp=datetime.datetime(2025, 7, 6, 17, 45, 10, 692772), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 45, 10, 692800), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 17, 45, 10, 692804), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый вечер, Петр!\\\\n\\\\nОтлично! Сейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 45, 10, 692807), content_en='Good evening, Petr!\\\\n\\\\nExcellent! I will now show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='สวัสดีตอนเย็นค่ะ คุณเปตร!\\\\n\\\\nเยี่ยมเลยค่ะ! ตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\\\n\\\\nกรุณารอสักครู่ค่ะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 45, 10, 692811), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 45, 10, 692813), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 45, 10, 692816), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 45, 10, 692819), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 45, 10, 692822), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.USER: 'user'>, content='Эти (ответ на: Candy’s\\n1\\xa0450,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 17, 45, 10, 692825), content_en='These (reply to: Candy’s\\n1,450.00 ฿ 🌸)', content_thai='เหล่านี้ (ตอบกลับถึง: Candy’s 1 450,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Petr", "is_first_message": false}}
[2025-07-06 17:45:16] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T17:45:16.298734", "execution_time_ms": 5487.18, "result": ["Букет 'Candy’s' выбран.\\n\\nВам нужна доставка?", "Bouquet 'Candy’s' selected.\\n\\nDo you need delivery?", "เลือกช่อดอกไม้ 'Candy’s' แล้ว\\n\\nคุณต้องการจัดส่งหรือไม่คะ?", {"type": "save_order_info", "bouquet": "Candy’s", "retailer_id": "t8bpd4wssw"}]}
[2025-07-06 17:45:18] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:45:21] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T17:45:21.068544", "execution_time_ms": 28707.6, "result": true}
[2025-07-06 17:46:02] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T17:46:02.422089", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108e13bf0>", "message_data": {"sender_id": "79084634603", "message_text": "Я передумал, вот такой хочу (ответ на: Pretty 😍\n2 600,00 ฿ 🌸)", "message_type": "text", "sender_name": "Petr", "wa_message_id": "wamid.HBgLNzkwODQ2MzQ2MDMVAgASGBQzQTc2N0Q3MjQ4QUNFNTRENEQxMAA=", "timestamp": "1751798747", "reply_to_message_id": "wamid.HBgLNzkwODQ2MzQ2MDMVAgARGBIzMjczMjIxNkE1NEVGOEZFOUQA"}}}
[2025-07-06 17:46:05] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:46:06] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:46:09] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T17:46:09.959769", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f23770>", "text": "Я передумал, вот такой хочу (ответ на: Pretty 😍\n2 600,00 ฿ 🌸)", "user_lang": "ru"}}
[2025-07-06 17:46:09] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:46:09.960373", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f23770>", "text": "Я передумал, вот такой хочу (ответ на: Pretty 😍\n2 600,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 17:46:15] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:46:15.003672", "execution_time_ms": 5043.02, "result": "I changed my mind, I want this one."}
[2025-07-06 17:46:15] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:46:15.004224", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f23770>", "text": "Я передумал, вот такой хочу (ответ на: Pretty 😍\n2 600,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 17:46:21] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:46:21.240264", "execution_time_ms": 6235.58, "result": "ผมเปลี่ยนใจแล้วครับ ผมเอาอันนี้"}
[2025-07-06 17:46:21] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T17:46:21.242446", "execution_time_ms": 11282.12, "result": ["Я передумал, вот такой хочу (ответ на: Pretty 😍\n2 600,00 ฿ 🌸)", "I changed my mind, I want this one.", "ผมเปลี่ยนใจแล้วครับ ผมเอาอันนี้"]}
[2025-07-06 17:46:23] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T17:46:23.317608", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f23770>", "messages": ["Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.USER: 'user'>, content='Здравствуйте', timestamp=datetime.datetime(2025, 7, 6, 17, 46, 23, 178381), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 46, 23, 178403), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 17, 46, 23, 178406), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый вечер, Петр!\\\\n\\\\nОтлично! Сейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 46, 23, 178408), content_en='Good evening, Petr!\\\\n\\\\nExcellent! I will now show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='สวัสดีตอนเย็นค่ะ คุณเปตร!\\\\n\\\\nเยี่ยมเลยค่ะ! ตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\\\n\\\\nกรุณารอสักครู่ค่ะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 46, 23, 178410), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 46, 23, 178413), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 46, 23, 178415), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 46, 23, 178417), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 46, 23, 178419), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.USER: 'user'>, content='Эти (ответ на: Candy’s\\n1\\xa0450,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 17, 46, 23, 178422), content_en='These (reply to: Candy’s\\n1,450.00 ฿ 🌸)', content_thai='เหล่านี้ (ตอบกลับถึง: Candy’s 1 450,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Букет 'Candy’s' выбран.\\\\n\\\\nВам нужна доставка? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 17, 46, 23, 178424), content_en=\"Bouquet 'Candy’s' selected.\\\\n\\\\nDo you need delivery?\", content_thai=\"เลือกช่อดอกไม้ 'Candy’s' แล้ว\\\\n\\\\nคุณต้องการจัดส่งหรือไม่คะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.USER: 'user'>, content='Я передумал, вот такой хочу (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 17, 46, 23, 178426), content_en='I changed my mind, I want this one.', content_thai='ผมเปลี่ยนใจแล้วครับ ผมเอาอันนี้', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Petr", "is_first_message": false}}
[2025-07-06 17:46:29] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T17:46:29.010402", "execution_time_ms": 5690.36, "result": ["Добрый вечер!\\n\\nБукет 'Pretty 😍' выбран.\\n\\nВам нужна доставка?", "Good evening!\\n\\nBouquet 'Pretty 😍' selected.\\n\\nDo you need delivery?", "สวัสดีตอนเย็นค่ะ!\\n\\nเลือกช่อดอกไม้ 'Pretty 😍' แล้วค่ะ\\n\\nคุณต้องการจัดส่งไหมคะ?", {"type": "save_order_info", "bouquet": "Pretty 😍", "retailer_id": "kie4sy3qsy"}]}
[2025-07-06 17:46:32] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:46:34] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T17:46:34.945753", "execution_time_ms": 32522.46, "result": true}
[2025-07-06 17:46:53] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T17:46:53.690349", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x108e03130>", "message_data": {"sender_id": "79084634603", "message_text": "Да", "message_type": "text", "sender_name": "Petr", "wa_message_id": "wamid.HBgLNzkwODQ2MzQ2MDMVAgASGBQzQThBMTBEREFEM0E4NzdBNUI1RgA=", "timestamp": "1751798804", "reply_to_message_id": null}}}
[2025-07-06 17:46:54] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:46:54] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 17:46:58] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T17:46:58.926452", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f3b680>", "text": "Да", "user_lang": "ru"}}
[2025-07-06 17:46:58] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:46:58.927391", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f3b680>", "text": "Да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-06 17:47:00] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:47:00.189667", "execution_time_ms": 1261.92, "result": "Yes"}
[2025-07-06 17:47:00] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:47:00.190086", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f3b680>", "text": "Да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-06 17:47:04] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T17:47:04.986943", "execution_time_ms": 4796.6, "result": "ใช่"}
[2025-07-06 17:47:04] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T17:47:04.988181", "execution_time_ms": 6060.85, "result": ["Да", "Yes", "ใช่"]}
[2025-07-06 17:47:06] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T17:47:06.764746", "parameters": {"self": "<src.services.ai_service.AIService object at 0x108f3b680>", "messages": ["Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.USER: 'user'>, content='Здравствуйте', timestamp=datetime.datetime(2025, 7, 6, 17, 47, 6, 626827), content_en='Hello', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый день! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 47, 6, 626853), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 17, 47, 6, 626858), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Добрый вечер, Петр!\\\\n\\\\nОтлично! Сейчас я покажу вам каждый букет с фотографией.\\\\n\\\\nПожалуйста, подождите минутку... 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 47, 6, 626862), content_en='Good evening, Petr!\\\\n\\\\nExcellent! I will now show you each bouquet with a photo.\\\\n\\\\nPlease wait a moment...', content_thai='สวัสดีตอนเย็นค่ะ คุณเปตร!\\\\n\\\\nเยี่ยมเลยค่ะ! ตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\\\n\\\\nกรุณารอสักครู่ค่ะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 47, 6, 626865), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 47, 6, 626868), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 47, 6, 626872), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 47, 6, 626874), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 17, 47, 6, 626877), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.USER: 'user'>, content='Эти (ответ на: Candy’s\\n1\\xa0450,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 17, 47, 6, 626880), content_en='These (reply to: Candy’s\\n1,450.00 ฿ 🌸)', content_thai='เหล่านี้ (ตอบกลับถึง: Candy’s 1 450,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Букет 'Candy’s' выбран.\\\\n\\\\nВам нужна доставка? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 17, 47, 6, 626883), content_en=\"Bouquet 'Candy’s' selected.\\\\n\\\\nDo you need delivery?\", content_thai=\"เลือกช่อดอกไม้ 'Candy’s' แล้ว\\\\n\\\\nคุณต้องการจัดส่งหรือไม่คะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.USER: 'user'>, content='Я передумал, вот такой хочу (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 17, 47, 6, 626886), content_en='I changed my mind, I want this one.', content_thai='ผมเปลี่ยนใจแล้วครับ ผมเอาอันนี้', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Добрый вечер!\\\\n\\\\nБукет 'Pretty 😍' выбран.\\\\n\\\\nВам нужна доставка? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 17, 47, 6, 626889), content_en=\"Good evening!\\\\n\\\\nBouquet 'Pretty 😍' selected.\\\\n\\\\nDo you need delivery?\", content_thai=\"สวัสดีตอนเย็นค่ะ!\\\\n\\\\nเลือกช่อดอกไม้ 'Pretty 😍' แล้วค่ะ\\\\n\\\\nคุณต้องการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79084634603', session_id='20250706_174326_388201_390', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 6, 17, 47, 6, 626892), content_en='Yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Petr", "is_first_message": false}}
[2025-07-06 17:47:17] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T17:47:17.764893", "execution_time_ms": 10998.59, "result": ["Добрый вечер!\\n\\nДоставка по всему острову Пхукет осуществляется с 8:00 до 21:00.\\n\\nСтоимость доставки:\\nРаваи: 500 бат\\nЧалонг: 380 бат\\nПхукет Таун: 300 бат\\nКату: 280 бат\\nПатонг: 400 бат\\nБанг Тао: 500 бат\\nЛагуна: 500 бат\\nТаланг/Май Као: 550 бат\\n\\nПожалуйста, укажите полный адрес доставки, чтобы мы могли передать его менеджеру.", "Good evening!\\n\\nIsland-wide delivery in Phuket is available from 8:00 to 21:00.\\n\\nDelivery cost:\\nRawai: 500 baht\\nChalong: 380 baht\\nPhuket Town: 300 baht\\nKathu: 280 baht\\nPatong: 400 baht\\nBang Tao: 500 baht\\nLaguna: 500 baht\\nThalang/Mai Khao: 550 baht\\n\\nPlease provide the full delivery address so we can pass it to the manager.", "สวัสดีตอนเย็นค่ะ!\\n\\nบริการจัดส่งทั่วเกาะภูเก็ตมีให้บริการตั้งแต่เวลา 8:00 น. ถึง 21:00 น.\\n\\nค่าจัดส่ง:\\nราไวย์: 500 บาท\\nฉลอง: 380 บาท\\nตัวเมืองภูเก็ต: 300 บาท\\nกะทู้: 280 บาท\\nป่าตอง: 400 บาท\\nบางเทา: 500 บาท\\nลากูน่า: 500 บาท\\nถลาง/ไม้ขาว: 550 บาท\\n\\nกรุณาระบุที่อยู่จัดส่งที่สมบูรณ์ เพื่อที่เราจะได้ส่งต่อให้ผู้จัดการค่ะ", {"type": "save_order_info", "delivery_needed": true}]}
[2025-07-06 17:47:23] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T17:47:23.616241", "execution_time_ms": 29925.02, "result": false}
[2025-07-06 18:07:54] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T18:07:54.809303", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x119eefb60>", "message_data": {"sender_id": "79140775712", "message_text": "Саша", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTlCMzg4NjEyQTA5MENBNkU5MAA=", "timestamp": "1751792726", "reply_to_message_id": null}}}
[2025-07-06 18:07:55] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 18:07:56] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-06 18:07:59] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T18:07:59.792516", "parameters": {"self": "<src.services.ai_service.AIService object at 0x119eefe00>", "text": "Саша", "user_lang": "en"}}
[2025-07-06 18:07:59] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T18:07:59.793089", "parameters": {"self": "<src.services.ai_service.AIService object at 0x119eefe00>", "text": "Саша", "source_lang": "en", "target_lang": "th"}}
[2025-07-06 18:08:03] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-06T18:08:03.118588", "execution_time_ms": 3325.16, "result": "ซาช่า"}
[2025-07-06 18:08:03] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-06T18:08:03.119910", "execution_time_ms": 3326.87, "result": ["Саша", "Саша", "ซาช่า"]}
[2025-07-06 18:08:05] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T18:08:05.224726", "parameters": {"self": "<src.services.ai_service.AIService object at 0x119eefe00>", "messages": ["Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Hi!', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 76965), content_en='Hi!', content_thai='สวัสดี', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good afternoon! Would you like to see our flower catalog? 🌸', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 76983), content_en='Good afternoon! Would you like to see our flower catalog?', content_thai='สวัสดีตอนบ่ายค่ะ! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 76987), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment... 🌸\", timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 76990), content_en=\"Excellent!\\\\n\\\\nI'll show you each bouquet with a photo now.\\\\n\\\\nPlease wait a moment...\", content_thai='เยี่ยมเลยค่ะ!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพให้คุณดูนะคะ\\\\n\\\\nกรุณารอสักครู่ค่ะ...', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 76994), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 76996), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 76999), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77002), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77004), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77006), content_en='This (ответ на: Clouds\\n2\\xa0400,00\\xa0฿ 🌸)', content_thai='นี่ (ตอบกลับ: เมฆ\\n2,400.00 บาท 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77009), content_en=\"Bouquet 'Clouds' selected.\\\\n\\\\nDo you need delivery?\", content_thai=\"เลือกช่อดอกไม้ 'Clouds' แล้วค่ะ\\\\n\\\\nคุณต้องการบริการจัดส่งไหมคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='yes', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77012), content_en='yes', content_thai='ใช่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address. 🌸', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77014), content_en='Yes, delivery is available for your order.\\\\n\\\\nHere are our delivery prices across Phuket:\\\\n\\\\nRawai: 500 baht\\\\nChalong: 380 baht\\\\nPhuket Town: 300 baht\\\\nKathu: 280 baht\\\\nPatong: 400 baht\\\\nBang Tao: 500 baht\\\\nLaguna: 500 baht\\\\nThalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='ใช่ค่ะ บริการจัดส่งมีให้บริการสำหรับคำสั่งซื้อของคุณค่ะ\\\\n\\\\nราคาค่าจัดส่งทั่วภูเก็ตมีดังนี้ค่ะ:\\\\n\\\\nราไวย์: 500 บาท\\\\nฉลอง: 380 บาท\\\\nเมืองภูเก็ต: 300 บาท\\\\nกะทู้: 280 บาท\\\\nป่าตอง: 400 บาท\\\\nบางเทา: 500 บาท\\\\nลากูน่า: 500 บาท\\\\nถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Centrio condo', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77017), content_en='Centrio condo', content_thai='เซ็นทรีโอ คอนโด', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM. 🌸\", timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77019), content_en=\"Thank you. We have saved 'Centrio condo' as the delivery address.\\\\n\\\\nWhat date and time would you like the delivery to be? Please note that deliveries are available from 8:00 AM to 9:00 PM.\", content_thai=\"ขอบคุณค่ะ เราได้บันทึก 'Centrio condo' เป็นที่อยู่จัดส่งแล้วค่ะ\\\\n\\\\nคุณต้องการให้จัดส่งในวันที่และเวลาใดคะ? โปรดทราบว่าบริการจัดส่งของเรามีตั้งแต่เวลา 8:00 น. ถึง 21:00 น. ค่ะ\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Wed, 17:00', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77022), content_en='Wed, 17:00', content_thai='วันพุธ, 17:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include. 🌸', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77024), content_en='Thank you. We have noted the delivery date as July 9th and the time as 5:00 PM.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.', content_thai='ขอบคุณค่ะ เราได้บันทึกวันที่จัดส่งเป็นวันที่ 9 กรกฎาคม และเวลา 17:00 น. ค่ะ\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้ด้วยไหมคะ? ถ้าต้องการ โปรดระบุข้อความที่คุณต้องการให้ใส่ลงในการ์ดค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Change to this (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77027), content_en='Change to this (ответ на: Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸)', content_thai='เปลี่ยนเป็นอันนี้ (ตอบกลับ: Pretty 😍 2 600,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"You have changed your bouquet selection to 'Pretty 😍'.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include. 🌸\", timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77029), content_en=\"You have changed your bouquet selection to 'Pretty 😍'.\\\\n\\\\nDo you need a card with the bouquet? If so, please provide the text you would like to include.\", content_thai=\"คุณได้เปลี่ยนการเลือกช่อดอกไม้เป็น 'Pretty 😍' แล้วค่ะ\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่คะ ถ้าต้องการ โปรดระบุข้อความที่คุณต้องการให้เราเขียนลงในการ์ดค่ะ\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='No', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77031), content_en='No', content_thai='ไม่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. No card will be included with your order.\\\\n\\\\nWhat is the recipient's name? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77034), content_en=\"Thank you. No card will be included with your order.\\\\n\\\\nWhat is the recipient's name?\", content_thai='ขอบคุณค่ะ ไม่มีบัตรอวยพรในคำสั่งซื้อของคุณนะคะ\\\\n\\\\nชื่อผู้รับคือใครคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Sasha', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77036), content_en='Sasha', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Thank you. We have saved 'Sasha' as the recipient's name.\\\\n\\\\nWhat is the recipient's phone number? 🌸\", timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77038), content_en=\"Thank you. We have saved 'Sasha' as the recipient's name.\\\\n\\\\nWhat is the recipient's phone number?\", content_thai=\"ขอบคุณค่ะ เราได้บันทึกชื่อผู้รับว่า 'Sasha' แล้วค่ะ\\\\n\\\\nเบอร์โทรศัพท์ของผู้รับคืออะไรคะ?\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='4575686784564', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77040), content_en='4575686784564', content_thai='4575686784564', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Recipient phone number saved. Here is a summary of your order:\\\\n\\\\nBouquet: Pretty 😍 (2,600.00 baht)\\\\nDelivery: Yes, to Centrio condo\\\\nDate & Time: July 9th, 2025 at 5:00 PM\\\\nCard: No\\\\nRecipient Name: Sasha\\\\nRecipient Phone: 4575686784564\\\\n\\\\nDoes everything look correct? Please confirm your order. 🌸', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77042), content_en='Recipient phone number saved. Here is a summary of your order:\\\\n\\\\nBouquet: Pretty 😍 (2,600.00 baht)\\\\nDelivery: Yes, to Centrio condo\\\\nDate & Time: July 9th, 2025 at 5:00 PM\\\\nCard: No\\\\nRecipient Name: Sasha\\\\nRecipient Phone: 4575686784564\\\\n\\\\nDoes everything look correct? Please confirm your order.', content_thai='บันทึกเบอร์โทรศัพท์ผู้รับเรียบร้อยแล้วค่ะ นี่คือสรุปคำสั่งซื้อของคุณ:\\\\n\\\\nช่อดอกไม้: Pretty 😍 (2,600.00 บาท)\\\\nการจัดส่ง: ใช่, ไปยัง Centrio condo\\\\nวันที่และเวลา: 9 กรกฎาคม 2568 เวลา 17:00 น.\\\\nการ์ด: ไม่มี\\\\nชื่อผู้รับ: Sasha\\\\nเบอร์โทรศัพท์ผู้รับ: 4575686784564\\\\n\\\\nข้อมูลทั้งหมดถูกต้องหรือไม่คะ โปรดยืนยันคำสั่งซื้อของคุณค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='I do', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77045), content_en='I do', content_thai='ฉันทำ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Your order has been successfully confirmed.\\\\n\\\\nA manager will contact you shortly to clarify payment details and finalize the delivery. 🌸', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77047), content_en='Your order has been successfully confirmed.\\\\n\\\\nA manager will contact you shortly to clarify payment details and finalize the delivery.', content_thai='คำสั่งซื้อของคุณได้รับการยืนยันเรียบร้อยแล้วค่ะ\\\\n\\\\nผู้จัดการจะติดต่อกลับไปในไม่ช้าเพื่อยืนยันรายละเอียดการชำระเงินและดำเนินการจัดส่งให้เรียบร้อยค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='В среду в 15', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77049), content_en='В среду в 15', content_thai='วันพุธ เวลา 15', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content='Хорошо, я обновила время доставки на среду, 9 июля, в 15:00.\\\\n\\\\nМенеджер свяжется с вами, чтобы подтвердить эти обновленные детали и уточнить оплату. 🌸', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77052), content_en='Okay, I have updated the delivery time to Wednesday, July 9th, at 3:00 PM.\\\\n\\\\nA manager will contact you to confirm these updated details and clarify payment.', content_thai='ตกลงค่ะ ฉันได้อัปเดตเวลาจัดส่งเป็นวันพุธที่ 9 กรกฎาคม เวลา 15:00 น. แล้วค่ะ\\\\n\\\\nผู้จัดการจะติดต่อคุณเพื่อยืนยันรายละเอียดที่อัปเดตเหล่านี้และชี้แจงเรื่องการชำระเงินค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77054), content_en='Саша', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.ASSISTANT: 'assistant'>, content=\"Спасибо, имя получателя 'Саша' сохранено.\\\\n\\\\nВаш заказ подтвержден, и менеджер скоро свяжется с вами для уточнения деталей оплаты и доставки. 🌸\", timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77055), content_en=\"Thank you, the recipient's name 'Sasha' is saved.\\\\n\\\\nYour order is confirmed, and a manager will contact you shortly to clarify payment and delivery details.\", content_thai=\"ขอบคุณค่ะ ชื่อผู้รับ 'Sasha' ได้รับการบันทึกแล้วค่ะ\\\\n\\\\nคำสั่งซื้อของคุณได้รับการยืนยันแล้ว และผู้จัดการจะติดต่อกลับไปในไม่ช้าเพื่อชี้แจงรายละเอียดการชำระเงินและการจัดส่งค่ะ\", id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250706_162943_50861_139', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 6, 18, 8, 5, 77057), content_en='Саша', content_thai='ซาช่า', id=None, wa_message_id=None, parts=None)"], "user_lang": "en", "sender_name": "Denis", "is_first_message": false}}
[2025-07-06 18:25:30] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-06T18:25:30.093527", "execution_time_ms": 1044866.59, "result": ["Извините, произошла ошибка. Попробуйте еще раз. 🌸", "Sorry, an error occurred. Please try again. 🌸", "ขออภัย เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง 🌸", null]}
[2025-07-06 18:25:30] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-06T18:25:30.127107", "execution_time_ms": 1055316.46, "result": false}
[2025-07-06 21:52:20] ERROR: grpc._plugin_wrapping - AuthMetadataPluginCallback "<google.auth.transport.grpc.AuthMetadataPlugin object at 0x119f81400>" raised exception!
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/urllib3/connectionpool.py", line 534, in _make_request
    response = conn.getresponse()
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/urllib3/connection.py", line 516, in getresponse
    httplib_response = super().getresponse()
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 1428, in getresponse
    response.begin()
    ~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 331, in begin
    version, status, reason = self._read_status()
                              ~~~~~~~~~~~~~~~~~^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/http/client.py", line 292, in _read_status
    line = str(self.fp.readline(_MAXLINE + 1), "iso-8859-1")
               ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/socket.py", line 719, in readinto
    return self._sock.recv_into(b)
           ~~~~~~~~~~~~~~~~~~~~^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/ssl.py", line 1304, in recv_into
    return self.read(nbytes, buffer)
           ~~~~~~~~~^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/ssl.py", line 1138, in read
    return self._sslobj.read(len, buffer)
           ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
TimeoutError: [Errno 60] Operation timed out

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/requests/adapters.py", line 667, in send
    resp = conn.urlopen(
        method=request.method,
    ...<9 lines>...
        chunked=chunked,
    )
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/urllib3/connectionpool.py", line 841, in urlopen
    retries = retries.increment(
        method, url, error=new_e, _pool=self, _stacktrace=sys.exc_info()[2]
    )
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/urllib3/util/retry.py", line 474, in increment
    raise reraise(type(error), error, _stacktrace)
          ~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/urllib3/util/util.py", line 39, in reraise
    raise value
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/urllib3/connectionpool.py", line 787, in urlopen
    response = self._make_request(
        conn,
    ...<10 lines>...
        **response_kw,
    )
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/urllib3/connectionpool.py", line 536, in _make_request
    self._raise_timeout(err=e, url=url, timeout_value=read_timeout)
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/urllib3/connectionpool.py", line 367, in _raise_timeout
    raise ReadTimeoutError(
        self, url, f"Read timed out. (read timeout={timeout_value})"
    ) from err
urllib3.exceptions.ReadTimeoutError: HTTPSConnectionPool(host='oauth2.googleapis.com', port=443): Read timed out. (read timeout=120)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/google/auth/transport/requests.py", line 187, in __call__
    response = self.session.request(
        method, url, data=body, headers=headers, timeout=timeout, **kwargs
    )
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/requests/sessions.py", line 589, in request
    resp = self.send(prep, **send_kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/requests/sessions.py", line 703, in send
    r = adapter.send(request, **kwargs)
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/requests/adapters.py", line 713, in send
    raise ReadTimeout(e, request=request)
requests.exceptions.ReadTimeout: HTTPSConnectionPool(host='oauth2.googleapis.com', port=443): Read timed out. (read timeout=120)

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/grpc/_plugin_wrapping.py", line 105, in __call__
    self._metadata_plugin(
    ~~~~~~~~~~~~~~~~~~~~~^
        context, _AuthMetadataPluginCallback(callback_state, callback)
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/google/auth/transport/grpc.py", line 95, in __call__
    callback(self._get_authorization_headers(context), None)
             ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/google/auth/transport/grpc.py", line 81, in _get_authorization_headers
    self._credentials.before_request(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        self._request, context.method_name, context.service_url, headers
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/google/auth/credentials.py", line 239, in before_request
    self._blocking_refresh(request)
    ~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/google/auth/credentials.py", line 202, in _blocking_refresh
    self.refresh(request)
    ~~~~~~~~~~~~^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/google/oauth2/credentials.py", line 409, in refresh
    ) = reauth.refresh_grant(
        ~~~~~~~~~~~~~~~~~~~~^
        request,
        ^^^^^^^^
    ...<6 lines>...
        enable_reauth_refresh=self._enable_reauth_refresh,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/google/oauth2/reauth.py", line 333, in refresh_grant
    response_status_ok, response_data, retryable_error = _client._token_endpoint_request_no_throw(
                                                         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        request, token_uri, body, headers=metrics_header
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/google/oauth2/_client.py", line 192, in _token_endpoint_request_no_throw
    response = request(
        method="POST", url=token_uri, headers=headers_to_use, body=body, **kwargs
    )
  File "/Library/Frameworks/Python.framework/Versions/3.13/lib/python3.13/site-packages/google/auth/transport/requests.py", line 194, in __call__
    raise new_exc from caught_exc
google.auth.exceptions.TransportError: HTTPSConnectionPool(host='oauth2.googleapis.com', port=443): Read timed out. (read timeout=120)
[2025-07-06 22:50:41] INFO: root - {"event": "function_start", "module": "healthcheck", "function": "health_check", "timestamp": "2025-07-06T22:50:41.287044", "parameters": {}}
[2025-07-07 01:55:50] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T01:55:50.402034", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1079ec830>", "message_data": {"sender_id": "79140775712", "message_text": "/newses", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTM3RUEwRDI5M0I3MEZDNTNGNgA=", "timestamp": "1751828138", "reply_to_message_id": null}}}
[2025-07-07 01:55:51] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:55:51] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:55:56] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:55:57] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T01:55:57.400417", "execution_time_ms": 6996.52, "result": true}
[2025-07-07 01:56:15] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T01:56:15.995271", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107a52350>", "message_data": {"sender_id": "79140775712", "message_text": "Привет!", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTAzNzkyMjNGMkRDRUI2NDdCNAA=", "timestamp": "1751828164", "reply_to_message_id": null}}}
[2025-07-07 01:56:16] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:56:17] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:56:20] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-07T01:56:20.704395", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a50b90>", "text": "Привет!"}}
[2025-07-07 01:56:20] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-07T01:56:20.706234", "execution_time_ms": 0.64, "result": "ru"}
[2025-07-07 01:56:20] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T01:56:20.948386", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a50b90>", "text": "Привет!", "user_lang": "ru"}}
[2025-07-07 01:56:20] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T01:56:20.948913", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a50b90>", "text": "Привет!", "source_lang": "ru", "target_lang": "en"}}
[2025-07-07 01:56:22] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T01:56:22.944570", "execution_time_ms": 1995.48, "result": "Hello!"}
[2025-07-07 01:56:22] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T01:56:22.945211", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a50b90>", "text": "Привет!", "source_lang": "ru", "target_lang": "th"}}
[2025-07-07 01:56:24] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T01:56:24.110277", "execution_time_ms": 1164.76, "result": "สวัสดีครับ/ค่ะ"}
[2025-07-07 01:56:24] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T01:56:24.110953", "execution_time_ms": 3162.09, "result": ["Привет!", "Hello!", "สวัสดีครับ/ค่ะ"]}
[2025-07-07 01:56:25] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T01:56:25.757398", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a50b90>", "messages": ["Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 7, 1, 56, 25, 616075), content_en='Hello!', content_thai='สวัสดีครับ/ค่ะ', id=None, wa_message_id=None, parts=None)"], "user_lang": "auto", "sender_name": "Denis", "is_first_message": true}}
[2025-07-07 01:56:30] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T01:56:30.499770", "execution_time_ms": 4741.48, "result": ["Доброй ночи! Хотите посмотреть наш каталог цветов?", "Good night! Would you like to see our flower catalog?", "ราตรีสวัสดิ์! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?", null]}
[2025-07-07 01:56:32] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:56:33] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T01:56:33.017970", "execution_time_ms": 17021.61, "result": true}
[2025-07-07 01:56:47] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T01:56:47.339386", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1079cb610>", "message_data": {"sender_id": "79140775712", "message_text": "Да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUFCNjVCNEYzRDVFNEZGNTU1NQA=", "timestamp": "1751828197", "reply_to_message_id": null}}}
[2025-07-07 01:56:48] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:56:48] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:56:52] INFO: root - {"event": "function_start", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-07T01:56:52.243858", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a52990>", "text": "Да"}}
[2025-07-07 01:56:52] INFO: root - {"event": "function_end", "module": "ai_service", "function": "detect_language", "timestamp": "2025-07-07T01:56:52.244641", "execution_time_ms": 0.14, "result": "ru"}
[2025-07-07 01:56:52] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T01:56:52.441637", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a52990>", "text": "Да", "user_lang": "ru"}}
[2025-07-07 01:56:52] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T01:56:52.442475", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a52990>", "text": "Да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-07 01:56:54] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T01:56:54.385787", "execution_time_ms": 1942.95, "result": "Yes"}
[2025-07-07 01:56:54] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T01:56:54.386418", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a52990>", "text": "Да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-07 01:57:03] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T01:57:03.367390", "execution_time_ms": 8980.54, "result": "ครับ"}
[2025-07-07 01:57:03] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T01:57:03.369782", "execution_time_ms": 10927.37, "result": ["Да", "Yes", "ครับ"]}
[2025-07-07 01:57:04] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T01:57:04.948959", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a52990>", "messages": ["Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 7, 1, 57, 4, 841673), content_en='Hello!', content_thai='สวัสดีครับ/ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 7, 1, 57, 4, 841685), content_en='Good night! Would you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 7, 1, 57, 4, 841688), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-07 01:57:10] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T01:57:10.051106", "execution_time_ms": 5101.07, "result": ["Отлично, Денис!\\n\\nСейчас я покажу вам каждый букет с фотографией из нашего каталога.\\n\\nПожалуйста, подождите минутку, пока загрузится информация.", "Excellent, Denis!\\n\\nNow I will show you each bouquet with a photo from our catalog.\\n\\nPlease, wait a minute while the information loads.", "ยอดเยี่ยมเลยค่ะ คุณเดนิส!\\n\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพจากแคตตาล็อกของเราให้คุณดูค่ะ\\n\\nโปรดรอสักครู่ในขณะที่ข้อมูลกำลังโหลดนะคะ", {"type": "send_catalog"}]}
[2025-07-07 01:57:10] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:57:11] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_CATALOG_ID: 742818811434193
[2025-07-07 01:57:11] INFO: src.services.catalog_sender - [CATALOG_SEND] WHATSAPP_TOKEN: EAAZAVqM... (скрыт)
[2025-07-07 01:57:12] INFO: src.services.catalog_sender - [CATALOG_SEND] Найдено 5 доступных товаров (всего: 7)
[2025-07-07 01:57:12] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Love is on the air - 2 200,00 ฿
[2025-07-07 01:57:13] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:57:14] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Good vibes🌸 - 2 350,00 ฿
[2025-07-07 01:57:15] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:57:15] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Clouds - 2 400,00 ฿
[2025-07-07 01:57:16] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:57:16] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Candy’s - 1 450,00 ฿
[2025-07-07 01:57:17] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:57:18] INFO: src.services.catalog_sender - [CATALOG_SEND] Отправляю товар: Pretty 😍 - 2 600,00 ฿
[2025-07-07 01:57:19] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:57:19] INFO: src.services.catalog_sender - [CATALOG_SEND] Каталог успешно отправлен пользователю 79140775712
[2025-07-07 01:57:19] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T01:57:19.575043", "execution_time_ms": 32234.3, "result": true}
[2025-07-07 01:58:45] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T01:58:45.110857", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1079de3f0>", "message_data": {"sender_id": "79140775712", "message_text": "Этот (ответ на: Good vibes🌸\n2 350,00 ฿ 🌸)", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTE0MTlENTJEMTcxRDJCMzJBMAA=", "timestamp": "1751828308", "reply_to_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJGNUYwQjQzRTUxMTJEOTZFQUQA"}}}
[2025-07-07 01:58:45] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:58:46] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:58:49] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T01:58:49.748029", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079de9e0>", "text": "Этот (ответ на: Good vibes🌸\n2 350,00 ฿ 🌸)", "user_lang": "ru"}}
[2025-07-07 01:58:49] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T01:58:49.748570", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079de9e0>", "text": "Этот (ответ на: Good vibes🌸\n2 350,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "en"}}
[2025-07-07 01:58:51] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T01:58:51.535344", "execution_time_ms": 1786.52, "result": "This (reply to: Good vibes🌸\n2,350.00 ฿ 🌸)"}
[2025-07-07 01:58:51] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T01:58:51.536999", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079de9e0>", "text": "Этот (ответ на: Good vibes🌸\n2 350,00 ฿ 🌸)", "source_lang": "ru", "target_lang": "th"}}
[2025-07-07 01:58:57] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T01:58:57.983361", "execution_time_ms": 6445.72, "result": "นี่ (ตอบกลับ: Good vibes🌸 2 350,00 ฿ 🌸)"}
[2025-07-07 01:58:57] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T01:58:57.985606", "execution_time_ms": 8237.07, "result": ["Этот (ответ на: Good vibes🌸\n2 350,00 ฿ 🌸)", "This (reply to: Good vibes🌸\n2,350.00 ฿ 🌸)", "นี่ (ตอบกลับ: Good vibes🌸 2 350,00 ฿ 🌸)"]}
[2025-07-07 01:58:59] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T01:58:59.539759", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079de9e0>", "messages": ["Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 7, 1, 58, 59, 443290), content_en='Hello!', content_thai='สวัสดีครับ/ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 7, 1, 58, 59, 443302), content_en='Good night! Would you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 7, 1, 58, 59, 443306), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично, Денис!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией из нашего каталога.\\\\n\\\\nПожалуйста, подождите минутку, пока загрузится информация. 🌸', timestamp=datetime.datetime(2025, 7, 7, 1, 58, 59, 443309), content_en='Excellent, Denis!\\\\n\\\\nNow I will show you each bouquet with a photo from our catalog.\\\\n\\\\nPlease, wait a minute while the information loads.', content_thai='ยอดเยี่ยมเลยค่ะ คุณเดนิส!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพจากแคตตาล็อกของเราให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่ในขณะที่ข้อมูลกำลังโหลดนะคะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 1, 58, 59, 443312), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 1, 58, 59, 443314), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 1, 58, 59, 443317), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 1, 58, 59, 443319), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 1, 58, 59, 443321), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 7, 1, 58, 59, 443323), content_en='This (reply to: Good vibes🌸\\n2,350.00 ฿ 🌸)', content_thai='นี่ (ตอบกลับ: Good vibes🌸 2 350,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-07 01:59:04] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T01:59:04.350757", "execution_time_ms": 4810.05, "result": ["Вы выбрали букет \"Good vibes🌸\".\\n\\nТребуется ли доставка?", "You have selected the \"Good vibes🌸\" bouquet.\\n\\nDo you need delivery?", "คุณเลือกช่อดอกไม้ \"Good vibes🌸\" แล้วค่ะ\\n\\nต้องการจัดส่งด้วยไหมคะ?", {"type": "save_order_info", "bouquet": "Good vibes🌸", "retailer_id": "xi6jawqotv"}]}
[2025-07-07 01:59:06] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:59:08] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T01:59:08.066685", "execution_time_ms": 22954.85, "result": true}
[2025-07-07 01:59:21] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T01:59:21.249691", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1079deb10>", "message_data": {"sender_id": "79140775712", "message_text": "Да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTlCOTAxNDE3QUQ1MDQzQjFDRQA=", "timestamp": "1751828352", "reply_to_message_id": null}}}
[2025-07-07 01:59:21] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:59:22] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:59:25] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T01:59:25.600887", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079dec40>", "text": "Да", "user_lang": "ru"}}
[2025-07-07 01:59:25] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T01:59:25.601464", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079dec40>", "text": "Да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-07 01:59:27] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T01:59:27.535640", "execution_time_ms": 1932.56, "result": "Yes"}
[2025-07-07 01:59:27] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T01:59:27.540872", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079dec40>", "text": "Да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-07 01:59:30] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T01:59:30.293520", "execution_time_ms": 2752.0, "result": "ครับ"}
[2025-07-07 01:59:30] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T01:59:30.294906", "execution_time_ms": 4693.5, "result": ["Да", "Yes", "ครับ"]}
[2025-07-07 01:59:31] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T01:59:31.816061", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079dec40>", "messages": ["Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 7, 1, 59, 31, 718171), content_en='Hello!', content_thai='สวัสดีครับ/ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 7, 1, 59, 31, 718192), content_en='Good night! Would you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 7, 1, 59, 31, 718197), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично, Денис!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией из нашего каталога.\\\\n\\\\nПожалуйста, подождите минутку, пока загрузится информация. 🌸', timestamp=datetime.datetime(2025, 7, 7, 1, 59, 31, 718201), content_en='Excellent, Denis!\\\\n\\\\nNow I will show you each bouquet with a photo from our catalog.\\\\n\\\\nPlease, wait a minute while the information loads.', content_thai='ยอดเยี่ยมเลยค่ะ คุณเดนิส!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพจากแคตตาล็อกของเราให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่ในขณะที่ข้อมูลกำลังโหลดนะคะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 1, 59, 31, 718206), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 1, 59, 31, 718211), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 1, 59, 31, 718215), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 1, 59, 31, 718220), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 1, 59, 31, 718223), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 7, 1, 59, 31, 718228), content_en='This (reply to: Good vibes🌸\\n2,350.00 ฿ 🌸)', content_thai='นี่ (ตอบกลับ: Good vibes🌸 2 350,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Вы выбрали букет \"Good vibes🌸\".\\\\n\\\\nТребуется ли доставка? 🌸', timestamp=datetime.datetime(2025, 7, 7, 1, 59, 31, 718232), content_en='You have selected the \"Good vibes🌸\" bouquet.\\\\n\\\\nDo you need delivery?', content_thai='คุณเลือกช่อดอกไม้ \"Good vibes🌸\" แล้วค่ะ\\\\n\\\\nต้องการจัดส่งด้วยไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 7, 1, 59, 31, 718235), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-07 01:59:38] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T01:59:38.045822", "execution_time_ms": 6228.12, "result": ["Отлично! Доставка возможна.\\n\\nВот наш прайс-лист на доставку по районам Пхукета:\\n- Раваи: 500 бат\\n- Чалонг: 380 бат\\n- Пхукет-Таун: 300 бат\\n- Кату: 280 бат\\n- Патонг: 400 бат\\n- Банг Тао: 500 бат\\n- Лагуна: 500 бат\\n- Таланг/Май Као: 550 бат\\n\\nПожалуйста, укажите полный адрес для доставки.", "Understood! Delivery is possible.\\n\\nHere is our delivery price list for Phuket districts:\\n- Rawai: 500 baht\\n- Chalong: 380 baht\\n- Phuket Town: 300 baht\\n- Kathu: 280 baht\\n- Patong: 400 baht\\n- Bang Tao: 500 baht\\n- Laguna: 500 baht\\n- Thalang/Mai Khao: 550 baht\\n\\nPlease provide the full delivery address.", "รับทราบค่ะ! มีบริการจัดส่ง\\n\\nนี่คือรายการราคาค่าจัดส่งของเราสำหรับเขตต่างๆ ในภูเก็ต:\\n- ราไวย์: 500 บาท\\n- ฉลอง: 380 บาท\\n- เมืองภูเก็ต: 300 บาท\\n- กะทู้: 280 บาท\\n- ป่าตอง: 400 บาท\\n- บางเทา: 500 บาท\\n- ลากูน่า: 500 บาท\\n- ถลาง/ไม้ขาว: 550 บาท\\n\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ", {"type": "save_order_info", "delivery_needed": true}]}
[2025-07-07 01:59:38] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:59:39] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T01:59:39.969010", "execution_time_ms": 18718.57, "result": true}
[2025-07-07 01:59:56] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T01:59:56.741214", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x10799f650>", "message_data": {"sender_id": "79140775712", "message_text": "Centrio", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTE4ODYzQUE0NDhDRTgxNkQ5OAA=", "timestamp": "1751828387", "reply_to_message_id": null}}}
[2025-07-07 01:59:57] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 01:59:57] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 02:00:02] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T02:00:02.255744", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10799ef90>", "text": "Centrio", "user_lang": "ru"}}
[2025-07-07 02:00:02] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:00:02.257201", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10799ef90>", "text": "Centrio", "source_lang": "ru", "target_lang": "en"}}
[2025-07-07 02:00:04] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:00:04.016617", "execution_time_ms": 1755.57, "result": "Centrio"}
[2025-07-07 02:00:04] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:00:04.017884", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10799ef90>", "text": "Centrio", "source_lang": "ru", "target_lang": "th"}}
[2025-07-07 02:00:06] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:00:06.484071", "execution_time_ms": 2465.91, "result": "เซนทริโอ"}
[2025-07-07 02:00:06] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T02:00:06.484749", "execution_time_ms": 4227.58, "result": ["Centrio", "Centrio", "เซนทริโอ"]}
[2025-07-07 02:00:07] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T02:00:07.980552", "parameters": {"self": "<src.services.ai_service.AIService object at 0x10799ef90>", "messages": ["Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 7, 883888), content_en='Hello!', content_thai='สวัสดีครับ/ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 7, 883898), content_en='Good night! Would you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 7, 883901), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично, Денис!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией из нашего каталога.\\\\n\\\\nПожалуйста, подождите минутку, пока загрузится информация. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 7, 883902), content_en='Excellent, Denis!\\\\n\\\\nNow I will show you each bouquet with a photo from our catalog.\\\\n\\\\nPlease, wait a minute while the information loads.', content_thai='ยอดเยี่ยมเลยค่ะ คุณเดนิส!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพจากแคตตาล็อกของเราให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่ในขณะที่ข้อมูลกำลังโหลดนะคะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 7, 883904), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 7, 883906), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 7, 883908), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 7, 883910), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 7, 883912), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 7, 883913), content_en='This (reply to: Good vibes🌸\\n2,350.00 ฿ 🌸)', content_thai='นี่ (ตอบกลับ: Good vibes🌸 2 350,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Вы выбрали букет \"Good vibes🌸\".\\\\n\\\\nТребуется ли доставка? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 7, 883915), content_en='You have selected the \"Good vibes🌸\" bouquet.\\\\n\\\\nDo you need delivery?', content_thai='คุณเลือกช่อดอกไม้ \"Good vibes🌸\" แล้วค่ะ\\\\n\\\\nต้องการจัดส่งด้วยไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 7, 883917), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично! Доставка возможна.\\\\n\\\\nВот наш прайс-лист на доставку по районам Пхукета:\\\\n- Раваи: 500 бат\\\\n- Чалонг: 380 бат\\\\n- Пхукет-Таун: 300 бат\\\\n- Кату: 280 бат\\\\n- Патонг: 400 бат\\\\n- Банг Тао: 500 бат\\\\n- Лагуна: 500 бат\\\\n- Таланг/Май Као: 550 бат\\\\n\\\\nПожалуйста, укажите полный адрес для доставки. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 7, 883919), content_en='Understood! Delivery is possible.\\\\n\\\\nHere is our delivery price list for Phuket districts:\\\\n- Rawai: 500 baht\\\\n- Chalong: 380 baht\\\\n- Phuket Town: 300 baht\\\\n- Kathu: 280 baht\\\\n- Patong: 400 baht\\\\n- Bang Tao: 500 baht\\\\n- Laguna: 500 baht\\\\n- Thalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='รับทราบค่ะ! มีบริการจัดส่ง\\\\n\\\\nนี่คือรายการราคาค่าจัดส่งของเราสำหรับเขตต่างๆ ในภูเก็ต:\\\\n- ราไวย์: 500 บาท\\\\n- ฉลอง: 380 บาท\\\\n- เมืองภูเก็ต: 300 บาท\\\\n- กะทู้: 280 บาท\\\\n- ป่าตอง: 400 บาท\\\\n- บางเทา: 500 บาท\\\\n- ลากูน่า: 500 บาท\\\\n- ถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Centrio', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 7, 883920), content_en='Centrio', content_thai='เซนทริโอ', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-07 02:00:12] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T02:00:12.494583", "execution_time_ms": 4512.29, "result": ["Поняла, адрес для доставки: Centrio.\\n\\nНа какую дату и время вы хотели бы оформить доставку? Доставка осуществляется с 8:00 до 21:00.", "Understood, delivery address: Centrio.\\n\\nWhat date and time would you like to arrange the delivery for? Delivery is available from 8:00 to 21:00.", "เข้าใจแล้วค่ะ ที่อยู่สำหรับจัดส่ง: Centrio\\n\\nคุณต้องการจัดส่งในวันและเวลาใดคะ? บริการจัดส่งมีตั้งแต่เวลา 8:00 ถึง 21:00 น.", {"type": "save_order_info", "address": "Centrio"}]}
[2025-07-07 02:00:14] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 02:00:15] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T02:00:15.695116", "execution_time_ms": 18951.19, "result": true}
[2025-07-07 02:00:46] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T02:00:46.094838", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1079bf9b0>", "message_data": {"sender_id": "79140775712", "message_text": "Послезавтра 17", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQUFEREMwNUQ3OThCNDU2OEM2MQA=", "timestamp": "1751828437", "reply_to_message_id": null}}}
[2025-07-07 02:00:46] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 02:00:47] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 02:00:50] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T02:00:50.515362", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079bf680>", "text": "Послезавтра 17", "user_lang": "ru"}}
[2025-07-07 02:00:50] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:00:50.516020", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079bf680>", "text": "Послезавтра 17", "source_lang": "ru", "target_lang": "en"}}
[2025-07-07 02:00:52] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:00:52.721972", "execution_time_ms": 2205.71, "result": "The day after tomorrow 17"}
[2025-07-07 02:00:52] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:00:52.722549", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079bf680>", "text": "Послезавтра 17", "source_lang": "ru", "target_lang": "th"}}
[2025-07-07 02:00:54] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:00:54.204952", "execution_time_ms": 1482.1, "result": "วันมะรืนนี้ 17"}
[2025-07-07 02:00:54] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T02:00:54.205308", "execution_time_ms": 3689.34, "result": ["Послезавтра 17", "The day after tomorrow 17", "วันมะรืนนี้ 17"]}
[2025-07-07 02:00:55] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T02:00:55.705658", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079bf680>", "messages": ["Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 55, 613851), content_en='Hello!', content_thai='สวัสดีครับ/ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 55, 614050), content_en='Good night! Would you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 55, 614060), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично, Денис!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией из нашего каталога.\\\\n\\\\nПожалуйста, подождите минутку, пока загрузится информация. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 55, 614108), content_en='Excellent, Denis!\\\\n\\\\nNow I will show you each bouquet with a photo from our catalog.\\\\n\\\\nPlease, wait a minute while the information loads.', content_thai='ยอดเยี่ยมเลยค่ะ คุณเดนิส!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพจากแคตตาล็อกของเราให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่ในขณะที่ข้อมูลกำลังโหลดนะคะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 55, 614113), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 55, 614116), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 55, 614119), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 55, 614129), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 55, 614143), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 55, 614146), content_en='This (reply to: Good vibes🌸\\n2,350.00 ฿ 🌸)', content_thai='นี่ (ตอบกลับ: Good vibes🌸 2 350,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Вы выбрали букет \"Good vibes🌸\".\\\\n\\\\nТребуется ли доставка? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 55, 614150), content_en='You have selected the \"Good vibes🌸\" bouquet.\\\\n\\\\nDo you need delivery?', content_thai='คุณเลือกช่อดอกไม้ \"Good vibes🌸\" แล้วค่ะ\\\\n\\\\nต้องการจัดส่งด้วยไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 55, 614152), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично! Доставка возможна.\\\\n\\\\nВот наш прайс-лист на доставку по районам Пхукета:\\\\n- Раваи: 500 бат\\\\n- Чалонг: 380 бат\\\\n- Пхукет-Таун: 300 бат\\\\n- Кату: 280 бат\\\\n- Патонг: 400 бат\\\\n- Банг Тао: 500 бат\\\\n- Лагуна: 500 бат\\\\n- Таланг/Май Као: 550 бат\\\\n\\\\nПожалуйста, укажите полный адрес для доставки. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 55, 614156), content_en='Understood! Delivery is possible.\\\\n\\\\nHere is our delivery price list for Phuket districts:\\\\n- Rawai: 500 baht\\\\n- Chalong: 380 baht\\\\n- Phuket Town: 300 baht\\\\n- Kathu: 280 baht\\\\n- Patong: 400 baht\\\\n- Bang Tao: 500 baht\\\\n- Laguna: 500 baht\\\\n- Thalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='รับทราบค่ะ! มีบริการจัดส่ง\\\\n\\\\nนี่คือรายการราคาค่าจัดส่งของเราสำหรับเขตต่างๆ ในภูเก็ต:\\\\n- ราไวย์: 500 บาท\\\\n- ฉลอง: 380 บาท\\\\n- เมืองภูเก็ต: 300 บาท\\\\n- กะทู้: 280 บาท\\\\n- ป่าตอง: 400 บาท\\\\n- บางเทา: 500 บาท\\\\n- ลากูน่า: 500 บาท\\\\n- ถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Centrio', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 55, 614158), content_en='Centrio', content_thai='เซนทริโอ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Поняла, адрес для доставки: Centrio.\\\\n\\\\nНа какую дату и время вы хотели бы оформить доставку? Доставка осуществляется с 8:00 до 21:00. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 55, 614160), content_en='Understood, delivery address: Centrio.\\\\n\\\\nWhat date and time would you like to arrange the delivery for? Delivery is available from 8:00 to 21:00.', content_thai='เข้าใจแล้วค่ะ ที่อยู่สำหรับจัดส่ง: Centrio\\\\n\\\\nคุณต้องการจัดส่งในวันและเวลาใดคะ? บริการจัดส่งมีตั้งแต่เวลา 8:00 ถึง 21:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Послезавтра 17', timestamp=datetime.datetime(2025, 7, 7, 2, 0, 55, 614162), content_en='The day after tomorrow 17', content_thai='วันมะรืนนี้ 17', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-07 02:01:00] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T02:01:00.879668", "execution_time_ms": 5171.85, "result": ["Дата доставки: 9 июля, 17:00.\\n\\nНужна ли открытка к букету?", "Delivery date: July 9, 17:00.\\n\\nDo you need a card with the bouquet?", "วันที่จัดส่ง: 9 กรกฎาคม, 17:00 น.\\n\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่?", {"type": "save_order_info", "date": "2025-07-09", "time": "17:00"}]}
[2025-07-07 02:01:01] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 02:01:02] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T02:01:02.832197", "execution_time_ms": 16736.54, "result": true}
[2025-07-07 02:02:11] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T02:02:11.914378", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x1079be690>", "message_data": {"sender_id": "79140775712", "message_text": "Нет", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTVGREZCOTA3QTNCMDQ5N0IyMwA=", "timestamp": "1751828521", "reply_to_message_id": null}}}
[2025-07-07 02:02:13] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 02:02:14] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 02:02:17] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T02:02:17.753516", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079bf790>", "text": "Нет", "user_lang": "ru"}}
[2025-07-07 02:02:17] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:02:17.754113", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079bf790>", "text": "Нет", "source_lang": "ru", "target_lang": "en"}}
[2025-07-07 02:02:19] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:02:19.648450", "execution_time_ms": 1893.69, "result": "No"}
[2025-07-07 02:02:19] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:02:19.651973", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079bf790>", "text": "Нет", "source_lang": "ru", "target_lang": "th"}}
[2025-07-07 02:02:20] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:02:20.833625", "execution_time_ms": 1181.46, "result": "ไม่"}
[2025-07-07 02:02:20] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T02:02:20.833753", "execution_time_ms": 3079.7, "result": ["Нет", "No", "ไม่"]}
[2025-07-07 02:02:22] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T02:02:22.458560", "parameters": {"self": "<src.services.ai_service.AIService object at 0x1079bf790>", "messages": ["Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362622), content_en='Hello!', content_thai='สวัสดีครับ/ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362648), content_en='Good night! Would you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362653), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично, Денис!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией из нашего каталога.\\\\n\\\\nПожалуйста, подождите минутку, пока загрузится информация. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362656), content_en='Excellent, Denis!\\\\n\\\\nNow I will show you each bouquet with a photo from our catalog.\\\\n\\\\nPlease, wait a minute while the information loads.', content_thai='ยอดเยี่ยมเลยค่ะ คุณเดนิส!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพจากแคตตาล็อกของเราให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่ในขณะที่ข้อมูลกำลังโหลดนะคะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362659), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362663), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362666), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362669), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362671), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362674), content_en='This (reply to: Good vibes🌸\\n2,350.00 ฿ 🌸)', content_thai='นี่ (ตอบกลับ: Good vibes🌸 2 350,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Вы выбрали букет \"Good vibes🌸\".\\\\n\\\\nТребуется ли доставка? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362676), content_en='You have selected the \"Good vibes🌸\" bouquet.\\\\n\\\\nDo you need delivery?', content_thai='คุณเลือกช่อดอกไม้ \"Good vibes🌸\" แล้วค่ะ\\\\n\\\\nต้องการจัดส่งด้วยไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362679), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично! Доставка возможна.\\\\n\\\\nВот наш прайс-лист на доставку по районам Пхукета:\\\\n- Раваи: 500 бат\\\\n- Чалонг: 380 бат\\\\n- Пхукет-Таун: 300 бат\\\\n- Кату: 280 бат\\\\n- Патонг: 400 бат\\\\n- Банг Тао: 500 бат\\\\n- Лагуна: 500 бат\\\\n- Таланг/Май Као: 550 бат\\\\n\\\\nПожалуйста, укажите полный адрес для доставки. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362682), content_en='Understood! Delivery is possible.\\\\n\\\\nHere is our delivery price list for Phuket districts:\\\\n- Rawai: 500 baht\\\\n- Chalong: 380 baht\\\\n- Phuket Town: 300 baht\\\\n- Kathu: 280 baht\\\\n- Patong: 400 baht\\\\n- Bang Tao: 500 baht\\\\n- Laguna: 500 baht\\\\n- Thalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='รับทราบค่ะ! มีบริการจัดส่ง\\\\n\\\\nนี่คือรายการราคาค่าจัดส่งของเราสำหรับเขตต่างๆ ในภูเก็ต:\\\\n- ราไวย์: 500 บาท\\\\n- ฉลอง: 380 บาท\\\\n- เมืองภูเก็ต: 300 บาท\\\\n- กะทู้: 280 บาท\\\\n- ป่าตอง: 400 บาท\\\\n- บางเทา: 500 บาท\\\\n- ลากูน่า: 500 บาท\\\\n- ถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Centrio', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362684), content_en='Centrio', content_thai='เซนทริโอ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Поняла, адрес для доставки: Centrio.\\\\n\\\\nНа какую дату и время вы хотели бы оформить доставку? Доставка осуществляется с 8:00 до 21:00. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362686), content_en='Understood, delivery address: Centrio.\\\\n\\\\nWhat date and time would you like to arrange the delivery for? Delivery is available from 8:00 to 21:00.', content_thai='เข้าใจแล้วค่ะ ที่อยู่สำหรับจัดส่ง: Centrio\\\\n\\\\nคุณต้องการจัดส่งในวันและเวลาใดคะ? บริการจัดส่งมีตั้งแต่เวลา 8:00 ถึง 21:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Послезавтра 17', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362689), content_en='The day after tomorrow 17', content_thai='วันมะรืนนี้ 17', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Дата доставки: 9 июля, 17:00.\\\\n\\\\nНужна ли открытка к букету? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362692), content_en='Delivery date: July 9, 17:00.\\\\n\\\\nDo you need a card with the bouquet?', content_thai='วันที่จัดส่ง: 9 กรกฎาคม, 17:00 น.\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Нет', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 22, 362694), content_en='No', content_thai='ไม่', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-07 02:02:27] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T02:02:27.894649", "execution_time_ms": 5433.7, "result": ["Отлично, открытка не нужна.\\n\\nКак зовут получателя букета?", "Okay, no card needed.\\n\\nWhat is the recipient's name?", "ตกลงค่ะ ไม่ต้องมีการ์ดนะคะ\\n\\nชื่อผู้รับช่อดอกไม้คือใครคะ?", {"type": "save_order_info", "bouquet": "Good vibes🌸", "retailer_id": "xi6jawqotv", "delivery_needed": true, "address": "Centrio", "date": "2025-07-09", "time": "17:00", "card_needed": false, "card_text": null}]}
[2025-07-07 02:02:28] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 02:02:30] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T02:02:30.915550", "execution_time_ms": 18999.92, "result": true}
[2025-07-07 02:02:43] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T02:02:43.975940", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107a1b650>", "message_data": {"sender_id": "79140775712", "message_text": "Саша", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTRFN0Q1QkQ3MDQ3ODNDNUFCMwA=", "timestamp": "1751828554", "reply_to_message_id": null}}}
[2025-07-07 02:02:44] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 02:02:45] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 02:02:48] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T02:02:48.730240", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a1b150>", "text": "Саша", "user_lang": "ru"}}
[2025-07-07 02:02:48] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:02:48.730928", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a1b150>", "text": "Саша", "source_lang": "ru", "target_lang": "en"}}
[2025-07-07 02:02:50] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:02:50.837126", "execution_time_ms": 2106.02, "result": "Sasha"}
[2025-07-07 02:02:50] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:02:50.838616", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a1b150>", "text": "Саша", "source_lang": "ru", "target_lang": "th"}}
[2025-07-07 02:02:52] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:02:52.187738", "execution_time_ms": 1348.88, "result": "ซาชา"}
[2025-07-07 02:02:52] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T02:02:52.188323", "execution_time_ms": 3457.43, "result": ["Саша", "Sasha", "ซาชา"]}
[2025-07-07 02:02:53] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T02:02:53.695210", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a1b150>", "messages": ["Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601659), content_en='Hello!', content_thai='สวัสดีครับ/ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601679), content_en='Good night! Would you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601683), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично, Денис!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией из нашего каталога.\\\\n\\\\nПожалуйста, подождите минутку, пока загрузится информация. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601687), content_en='Excellent, Denis!\\\\n\\\\nNow I will show you each bouquet with a photo from our catalog.\\\\n\\\\nPlease, wait a minute while the information loads.', content_thai='ยอดเยี่ยมเลยค่ะ คุณเดนิส!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพจากแคตตาล็อกของเราให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่ในขณะที่ข้อมูลกำลังโหลดนะคะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601690), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601694), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601697), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601700), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601704), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601708), content_en='This (reply to: Good vibes🌸\\n2,350.00 ฿ 🌸)', content_thai='นี่ (ตอบกลับ: Good vibes🌸 2 350,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Вы выбрали букет \"Good vibes🌸\".\\\\n\\\\nТребуется ли доставка? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601711), content_en='You have selected the \"Good vibes🌸\" bouquet.\\\\n\\\\nDo you need delivery?', content_thai='คุณเลือกช่อดอกไม้ \"Good vibes🌸\" แล้วค่ะ\\\\n\\\\nต้องการจัดส่งด้วยไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601716), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично! Доставка возможна.\\\\n\\\\nВот наш прайс-лист на доставку по районам Пхукета:\\\\n- Раваи: 500 бат\\\\n- Чалонг: 380 бат\\\\n- Пхукет-Таун: 300 бат\\\\n- Кату: 280 бат\\\\n- Патонг: 400 бат\\\\n- Банг Тао: 500 бат\\\\n- Лагуна: 500 бат\\\\n- Таланг/Май Као: 550 бат\\\\n\\\\nПожалуйста, укажите полный адрес для доставки. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601720), content_en='Understood! Delivery is possible.\\\\n\\\\nHere is our delivery price list for Phuket districts:\\\\n- Rawai: 500 baht\\\\n- Chalong: 380 baht\\\\n- Phuket Town: 300 baht\\\\n- Kathu: 280 baht\\\\n- Patong: 400 baht\\\\n- Bang Tao: 500 baht\\\\n- Laguna: 500 baht\\\\n- Thalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='รับทราบค่ะ! มีบริการจัดส่ง\\\\n\\\\nนี่คือรายการราคาค่าจัดส่งของเราสำหรับเขตต่างๆ ในภูเก็ต:\\\\n- ราไวย์: 500 บาท\\\\n- ฉลอง: 380 บาท\\\\n- เมืองภูเก็ต: 300 บาท\\\\n- กะทู้: 280 บาท\\\\n- ป่าตอง: 400 บาท\\\\n- บางเทา: 500 บาท\\\\n- ลากูน่า: 500 บาท\\\\n- ถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Centrio', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601723), content_en='Centrio', content_thai='เซนทริโอ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Поняла, адрес для доставки: Centrio.\\\\n\\\\nНа какую дату и время вы хотели бы оформить доставку? Доставка осуществляется с 8:00 до 21:00. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601727), content_en='Understood, delivery address: Centrio.\\\\n\\\\nWhat date and time would you like to arrange the delivery for? Delivery is available from 8:00 to 21:00.', content_thai='เข้าใจแล้วค่ะ ที่อยู่สำหรับจัดส่ง: Centrio\\\\n\\\\nคุณต้องการจัดส่งในวันและเวลาใดคะ? บริการจัดส่งมีตั้งแต่เวลา 8:00 ถึง 21:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Послезавтра 17', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601730), content_en='The day after tomorrow 17', content_thai='วันมะรืนนี้ 17', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Дата доставки: 9 июля, 17:00.\\\\n\\\\nНужна ли открытка к букету? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601749), content_en='Delivery date: July 9, 17:00.\\\\n\\\\nDo you need a card with the bouquet?', content_thai='วันที่จัดส่ง: 9 กรกฎาคม, 17:00 น.\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Нет', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601753), content_en='No', content_thai='ไม่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично, открытка не нужна.\\\\n\\\\nКак зовут получателя букета? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601756), content_en=\"Okay, no card needed.\\\\n\\\\nWhat is the recipient's name?\", content_thai='ตกลงค่ะ ไม่ต้องมีการ์ดนะคะ\\\\n\\\\nชื่อผู้รับช่อดอกไม้คือใครคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 7, 2, 2, 53, 601759), content_en='Sasha', content_thai='ซาชา', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-07 02:02:57] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T02:02:57.685710", "execution_time_ms": 3988.74, "result": ["Имя получателя: Саша.\\n\\nПожалуйста, укажите номер телефона получателя.", "Recipient's name: Sasha.\\n\\nPlease provide the recipient's phone number.", "ชื่อผู้รับ: Sasha.\\n\\nกรุณาระบุเบอร์โทรศัพท์ของผู้รับค่ะ", {"type": "save_order_info", "bouquet": "Good vibes🌸", "retailer_id": "xi6jawqotv", "delivery_needed": true, "address": "Centrio", "date": "2025-07-09", "time": "17:00", "card_needed": false, "recipient_name": "Саша"}]}
[2025-07-07 02:02:58] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 02:03:00] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T02:03:00.391874", "execution_time_ms": 16415.25, "result": true}
[2025-07-07 02:03:16] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T02:03:16.431097", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107a19b50>", "message_data": {"sender_id": "79140775712", "message_text": "3568644456", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTExQUJCQkU0RUI0MDREN0Y3NgA=", "timestamp": "1751828587", "reply_to_message_id": null}}}
[2025-07-07 02:03:17] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 02:03:17] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 02:03:21] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T02:03:21.925330", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a1b850>", "text": "3568644456", "user_lang": "ru"}}
[2025-07-07 02:03:21] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:03:21.926420", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a1b850>", "text": "3568644456", "source_lang": "ru", "target_lang": "en"}}
[2025-07-07 02:03:24] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:03:24.366198", "execution_time_ms": 2439.57, "result": "3568644456"}
[2025-07-07 02:03:24] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:03:24.367274", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a1b850>", "text": "3568644456", "source_lang": "ru", "target_lang": "th"}}
[2025-07-07 02:03:26] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:03:26.699124", "execution_time_ms": 2331.23, "result": "๓๕๖๘๖๔๔๔๕๖"}
[2025-07-07 02:03:26] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T02:03:26.701129", "execution_time_ms": 4774.72, "result": ["3568644456", "3568644456", "๓๕๖๘๖๔๔๔๕๖"]}
[2025-07-07 02:03:28] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T02:03:28.300215", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a1b850>", "messages": ["Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203174), content_en='Hello!', content_thai='สวัสดีครับ/ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203192), content_en='Good night! Would you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203198), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично, Денис!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией из нашего каталога.\\\\n\\\\nПожалуйста, подождите минутку, пока загрузится информация. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203202), content_en='Excellent, Denis!\\\\n\\\\nNow I will show you each bouquet with a photo from our catalog.\\\\n\\\\nPlease, wait a minute while the information loads.', content_thai='ยอดเยี่ยมเลยค่ะ คุณเดนิส!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพจากแคตตาล็อกของเราให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่ในขณะที่ข้อมูลกำลังโหลดนะคะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203207), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203212), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203217), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203221), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203226), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203231), content_en='This (reply to: Good vibes🌸\\n2,350.00 ฿ 🌸)', content_thai='นี่ (ตอบกลับ: Good vibes🌸 2 350,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Вы выбрали букет \"Good vibes🌸\".\\\\n\\\\nТребуется ли доставка? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203235), content_en='You have selected the \"Good vibes🌸\" bouquet.\\\\n\\\\nDo you need delivery?', content_thai='คุณเลือกช่อดอกไม้ \"Good vibes🌸\" แล้วค่ะ\\\\n\\\\nต้องการจัดส่งด้วยไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203240), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично! Доставка возможна.\\\\n\\\\nВот наш прайс-лист на доставку по районам Пхукета:\\\\n- Раваи: 500 бат\\\\n- Чалонг: 380 бат\\\\n- Пхукет-Таун: 300 бат\\\\n- Кату: 280 бат\\\\n- Патонг: 400 бат\\\\n- Банг Тао: 500 бат\\\\n- Лагуна: 500 бат\\\\n- Таланг/Май Као: 550 бат\\\\n\\\\nПожалуйста, укажите полный адрес для доставки. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203244), content_en='Understood! Delivery is possible.\\\\n\\\\nHere is our delivery price list for Phuket districts:\\\\n- Rawai: 500 baht\\\\n- Chalong: 380 baht\\\\n- Phuket Town: 300 baht\\\\n- Kathu: 280 baht\\\\n- Patong: 400 baht\\\\n- Bang Tao: 500 baht\\\\n- Laguna: 500 baht\\\\n- Thalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='รับทราบค่ะ! มีบริการจัดส่ง\\\\n\\\\nนี่คือรายการราคาค่าจัดส่งของเราสำหรับเขตต่างๆ ในภูเก็ต:\\\\n- ราไวย์: 500 บาท\\\\n- ฉลอง: 380 บาท\\\\n- เมืองภูเก็ต: 300 บาท\\\\n- กะทู้: 280 บาท\\\\n- ป่าตอง: 400 บาท\\\\n- บางเทา: 500 บาท\\\\n- ลากูน่า: 500 บาท\\\\n- ถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Centrio', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203249), content_en='Centrio', content_thai='เซนทริโอ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Поняла, адрес для доставки: Centrio.\\\\n\\\\nНа какую дату и время вы хотели бы оформить доставку? Доставка осуществляется с 8:00 до 21:00. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203255), content_en='Understood, delivery address: Centrio.\\\\n\\\\nWhat date and time would you like to arrange the delivery for? Delivery is available from 8:00 to 21:00.', content_thai='เข้าใจแล้วค่ะ ที่อยู่สำหรับจัดส่ง: Centrio\\\\n\\\\nคุณต้องการจัดส่งในวันและเวลาใดคะ? บริการจัดส่งมีตั้งแต่เวลา 8:00 ถึง 21:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Послезавтра 17', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203260), content_en='The day after tomorrow 17', content_thai='วันมะรืนนี้ 17', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Дата доставки: 9 июля, 17:00.\\\\n\\\\nНужна ли открытка к букету? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203264), content_en='Delivery date: July 9, 17:00.\\\\n\\\\nDo you need a card with the bouquet?', content_thai='วันที่จัดส่ง: 9 กรกฎาคม, 17:00 น.\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Нет', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203268), content_en='No', content_thai='ไม่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично, открытка не нужна.\\\\n\\\\nКак зовут получателя букета? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203272), content_en=\"Okay, no card needed.\\\\n\\\\nWhat is the recipient's name?\", content_thai='ตกลงค่ะ ไม่ต้องมีการ์ดนะคะ\\\\n\\\\nชื่อผู้รับช่อดอกไม้คือใครคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203276), content_en='Sasha', content_thai='ซาชา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Имя получателя: Саша.\\\\n\\\\nПожалуйста, укажите номер телефона получателя. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203279), content_en=\"Recipient's name: Sasha.\\\\n\\\\nPlease provide the recipient's phone number.\", content_thai='ชื่อผู้รับ: Sasha.\\\\n\\\\nกรุณาระบุเบอร์โทรศัพท์ของผู้รับค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='3568644456', timestamp=datetime.datetime(2025, 7, 7, 2, 3, 28, 203283), content_en='3568644456', content_thai='๓๕๖๘๖๔๔๔๕๖', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-07 02:03:38] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T02:03:38.968498", "execution_time_ms": 10665.53, "result": ["Получатель: Саша, телефон 3568644456.\\n\\nВот сводка вашего заказа:\\n- Букет: Good vibes🌸 (2 350,00 ฿)\\n- Доставка: Centrio, 9 июля 2025 г., 17:00\\n- Открытка: Не нужна\\n- Получатель: Саша, телефон: 3568644456\\n\\nВсе верно? Подтверждаете заказ?", "Recipient: Sasha, phone 3568644456.\\n\\nHere is a summary of your order:\\n- Bouquet: Good vibes🌸 (2,350.00 ฿)\\n- Delivery: Centrio, July 9, 2025, 17:00\\n- Card: Not needed\\n- Recipient: Sasha, phone: 3568644456\\n\\nIs everything correct? Do you confirm the order?", "ผู้รับ: ซาช่า, โทรศัพท์ 3568644456\\n\\nสรุปคำสั่งซื้อของคุณ:\\n- ช่อดอกไม้: Good vibes🌸 (2,350.00 ฿)\\n- การจัดส่ง: Centrio, 9 กรกฎาคม 2568, 17:00 น.\\n- การ์ด: ไม่จำเป็น\\n- ผู้รับ: ซาช่า, โทรศัพท์: 3568644456\\n\\nข้อมูลทั้งหมดถูกต้องหรือไม่? คุณยืนยันคำสั่งซื้อหรือไม่?", {"type": "save_order_info", "bouquet": "Good vibes🌸", "retailer_id": "xi6jawqotv", "delivery_needed": true, "address": "Centrio", "date": "2025-07-09", "time": "17:00", "card_needed": false, "card_text": null, "recipient_name": "Саша", "recipient_phone": "3568644456"}]}
[2025-07-07 02:03:40] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 02:03:42] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T02:03:42.717998", "execution_time_ms": 26286.11, "result": true}
[2025-07-07 02:03:56] INFO: root - {"event": "function_start", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T02:03:56.138360", "parameters": {"self": "<src.services.message_processor.MessageProcessor object at 0x107a3a6c0>", "message_data": {"sender_id": "79140775712", "message_text": "Да", "message_type": "text", "sender_name": "Denis", "wa_message_id": "wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTNDQzc0MEVFNzUxRjI1RkVCQgA=", "timestamp": "1751828626", "reply_to_message_id": null}}}
[2025-07-07 02:03:56] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 02:03:57] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 02:04:00] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T02:04:00.463859", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a39b80>", "text": "Да", "user_lang": "ru"}}
[2025-07-07 02:04:00] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:04:00.465161", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a39b80>", "text": "Да", "source_lang": "ru", "target_lang": "en"}}
[2025-07-07 02:04:02] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:04:02.358665", "execution_time_ms": 1893.01, "result": "Yes"}
[2025-07-07 02:04:02] INFO: root - {"event": "function_start", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:04:02.360884", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a39b80>", "text": "Да", "source_lang": "ru", "target_lang": "th"}}
[2025-07-07 02:04:05] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_text", "timestamp": "2025-07-07T02:04:05.456775", "execution_time_ms": 3095.58, "result": "ครับ"}
[2025-07-07 02:04:05] INFO: root - {"event": "function_end", "module": "ai_service", "function": "translate_user_message", "timestamp": "2025-07-07T02:04:05.457216", "execution_time_ms": 4992.11, "result": ["Да", "Yes", "ครับ"]}
[2025-07-07 02:04:07] INFO: root - {"event": "function_start", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T02:04:07.148934", "parameters": {"self": "<src.services.ai_service.AIService object at 0x107a39b80>", "messages": ["Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Привет!', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52371), content_en='Hello!', content_thai='สวัสดีครับ/ค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Доброй ночи! Хотите посмотреть наш каталог цветов? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52390), content_en='Good night! Would you like to see our flower catalog?', content_thai='ราตรีสวัสดิ์! คุณต้องการดูแคตตาล็อกดอกไม้ของเราไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52396), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично, Денис!\\\\n\\\\nСейчас я покажу вам каждый букет с фотографией из нашего каталога.\\\\n\\\\nПожалуйста, подождите минутку, пока загрузится информация. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52401), content_en='Excellent, Denis!\\\\n\\\\nNow I will show you each bouquet with a photo from our catalog.\\\\n\\\\nPlease, wait a minute while the information loads.', content_thai='ยอดเยี่ยมเลยค่ะ คุณเดนิส!\\\\n\\\\nตอนนี้ฉันจะแสดงช่อดอกไม้แต่ละช่อพร้อมรูปภาพจากแคตตาล็อกของเราให้คุณดูค่ะ\\\\n\\\\nโปรดรอสักครู่ในขณะที่ข้อมูลกำลังโหลดนะคะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52406), content_en='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', content_thai='Love is on the air\\n2\\xa0200,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52411), content_en='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', content_thai='Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52415), content_en='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', content_thai='Clouds\\n2\\xa0400,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52419), content_en='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', content_thai='Candy’s\\n1\\xa0450,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52424), content_en='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', content_thai='Pretty 😍\\n2\\xa0600,00\\xa0฿ 🌸', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Этот (ответ на: Good vibes🌸\\n2\\xa0350,00\\xa0฿ 🌸)', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52429), content_en='This (reply to: Good vibes🌸\\n2,350.00 ฿ 🌸)', content_thai='นี่ (ตอบกลับ: Good vibes🌸 2 350,00 ฿ 🌸)', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Вы выбрали букет \"Good vibes🌸\".\\\\n\\\\nТребуется ли доставка? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52434), content_en='You have selected the \"Good vibes🌸\" bouquet.\\\\n\\\\nDo you need delivery?', content_thai='คุณเลือกช่อดอกไม้ \"Good vibes🌸\" แล้วค่ะ\\\\n\\\\nต้องการจัดส่งด้วยไหมคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52439), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично! Доставка возможна.\\\\n\\\\nВот наш прайс-лист на доставку по районам Пхукета:\\\\n- Раваи: 500 бат\\\\n- Чалонг: 380 бат\\\\n- Пхукет-Таун: 300 бат\\\\n- Кату: 280 бат\\\\n- Патонг: 400 бат\\\\n- Банг Тао: 500 бат\\\\n- Лагуна: 500 бат\\\\n- Таланг/Май Као: 550 бат\\\\n\\\\nПожалуйста, укажите полный адрес для доставки. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52443), content_en='Understood! Delivery is possible.\\\\n\\\\nHere is our delivery price list for Phuket districts:\\\\n- Rawai: 500 baht\\\\n- Chalong: 380 baht\\\\n- Phuket Town: 300 baht\\\\n- Kathu: 280 baht\\\\n- Patong: 400 baht\\\\n- Bang Tao: 500 baht\\\\n- Laguna: 500 baht\\\\n- Thalang/Mai Khao: 550 baht\\\\n\\\\nPlease provide the full delivery address.', content_thai='รับทราบค่ะ! มีบริการจัดส่ง\\\\n\\\\nนี่คือรายการราคาค่าจัดส่งของเราสำหรับเขตต่างๆ ในภูเก็ต:\\\\n- ราไวย์: 500 บาท\\\\n- ฉลอง: 380 บาท\\\\n- เมืองภูเก็ต: 300 บาท\\\\n- กะทู้: 280 บาท\\\\n- ป่าตอง: 400 บาท\\\\n- บางเทา: 500 บาท\\\\n- ลากูน่า: 500 บาท\\\\n- ถลาง/ไม้ขาว: 550 บาท\\\\n\\\\nกรุณาระบุที่อยู่จัดส่งฉบับเต็มค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Centrio', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52447), content_en='Centrio', content_thai='เซนทริโอ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Поняла, адрес для доставки: Centrio.\\\\n\\\\nНа какую дату и время вы хотели бы оформить доставку? Доставка осуществляется с 8:00 до 21:00. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52450), content_en='Understood, delivery address: Centrio.\\\\n\\\\nWhat date and time would you like to arrange the delivery for? Delivery is available from 8:00 to 21:00.', content_thai='เข้าใจแล้วค่ะ ที่อยู่สำหรับจัดส่ง: Centrio\\\\n\\\\nคุณต้องการจัดส่งในวันและเวลาใดคะ? บริการจัดส่งมีตั้งแต่เวลา 8:00 ถึง 21:00 น.', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Послезавтра 17', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52454), content_en='The day after tomorrow 17', content_thai='วันมะรืนนี้ 17', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Дата доставки: 9 июля, 17:00.\\\\n\\\\nНужна ли открытка к букету? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52458), content_en='Delivery date: July 9, 17:00.\\\\n\\\\nDo you need a card with the bouquet?', content_thai='วันที่จัดส่ง: 9 กรกฎาคม, 17:00 น.\\\\n\\\\nคุณต้องการการ์ดพร้อมช่อดอกไม้หรือไม่?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Нет', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52462), content_en='No', content_thai='ไม่', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Отлично, открытка не нужна.\\\\n\\\\nКак зовут получателя букета? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52466), content_en=\"Okay, no card needed.\\\\n\\\\nWhat is the recipient's name?\", content_thai='ตกลงค่ะ ไม่ต้องมีการ์ดนะคะ\\\\n\\\\nชื่อผู้รับช่อดอกไม้คือใครคะ?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Саша', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52470), content_en='Sasha', content_thai='ซาชา', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Имя получателя: Саша.\\\\n\\\\nПожалуйста, укажите номер телефона получателя. 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52473), content_en=\"Recipient's name: Sasha.\\\\n\\\\nPlease provide the recipient's phone number.\", content_thai='ชื่อผู้รับ: Sasha.\\\\n\\\\nกรุณาระบุเบอร์โทรศัพท์ของผู้รับค่ะ', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='3568644456', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52477), content_en='3568644456', content_thai='๓๕๖๘๖๔๔๔๕๖', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.ASSISTANT: 'assistant'>, content='Получатель: Саша, телефон 3568644456.\\\\n\\\\nВот сводка вашего заказа:\\\\n- Букет: Good vibes🌸 (2 350,00 ฿)\\\\n- Доставка: Centrio, 9 июля 2025 г., 17:00\\\\n- Открытка: Не нужна\\\\n- Получатель: Саша, телефон: 3568644456\\\\n\\\\nВсе верно? Подтверждаете заказ? 🌸', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52480), content_en='Recipient: Sasha, phone 3568644456.\\\\n\\\\nHere is a summary of your order:\\\\n- Bouquet: Good vibes🌸 (2,350.00 ฿)\\\\n- Delivery: Centrio, July 9, 2025, 17:00\\\\n- Card: Not needed\\\\n- Recipient: Sasha, phone: 3568644456\\\\n\\\\nIs everything correct? Do you confirm the order?', content_thai='ผู้รับ: ซาช่า, โทรศัพท์ 3568644456\\\\n\\\\nสรุปคำสั่งซื้อของคุณ:\\\\n- ช่อดอกไม้: Good vibes🌸 (2,350.00 ฿)\\\\n- การจัดส่ง: Centrio, 9 กรกฎาคม 2568, 17:00 น.\\\\n- การ์ด: ไม่จำเป็น\\\\n- ผู้รับ: ซาช่า, โทรศัพท์: 3568644456\\\\n\\\\nข้อมูลทั้งหมดถูกต้องหรือไม่? คุณยืนยันคำสั่งซื้อหรือไม่?', id=None, wa_message_id=None, parts=None)", "Message(sender_id='79140775712', session_id='20250707_015555_233876_286', role=<MessageRole.USER: 'user'>, content='Да', timestamp=datetime.datetime(2025, 7, 7, 2, 4, 7, 52483), content_en='Yes', content_thai='ครับ', id=None, wa_message_id=None, parts=None)"], "user_lang": "ru", "sender_name": "Denis", "is_first_message": false}}
[2025-07-07 02:04:12] INFO: root - {"event": "function_end", "module": "ai_service", "function": "generate_response", "timestamp": "2025-07-07T02:04:12.857351", "execution_time_ms": 5705.74, "result": ["Отлично! Ваш заказ подтвержден и передан менеджеру.\\n\\nМенеджер свяжется с вами в ближайшее время для уточнения деталей оплаты и подтверждения доставки. Оплата производится до доставки.", "Excellent! Your order has been confirmed and passed to the manager.\\n\\nThe manager will contact you shortly to clarify payment details and confirm delivery. Payment is made before delivery.", "ยอดเยี่ยม! คำสั่งซื้อของคุณได้รับการยืนยันและส่งต่อไปยังผู้จัดการแล้วค่ะ\\n\\nผู้จัดการจะติดต่อคุณในไม่ช้าเพื่อยืนยันรายละเอียดการชำระเงินและการจัดส่ง การชำระเงินจะทำก่อนการจัดส่งค่ะ", {"type": "confirm_order", "bouquet": "Good vibes🌸", "retailer_id": "xi6jawqotv", "delivery_needed": true, "address": "Centrio", "date": "2025-07-09", "time": "17:00", "card_needed": false, "card_text": null, "recipient_name": "Саша", "recipient_phone": "3568644456"}]}
[2025-07-07 02:04:14] INFO: httpx - HTTP Request: POST https://graph.facebook.com/v23.0/494991623707876/messages "HTTP/1.1 200 OK"
[2025-07-07 02:04:16] INFO: root - {"event": "function_end", "module": "message_processor", "function": "process_user_message", "timestamp": "2025-07-07T02:04:16.826058", "execution_time_ms": 20686.96, "result": true}
