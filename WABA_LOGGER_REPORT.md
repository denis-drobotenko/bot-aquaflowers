# WABA –õ–æ–≥–≥–µ—Ä - –û—Ç—á–µ—Ç

## –ß—Ç–æ —Å–æ–∑–¥–∞–Ω–æ:

### 1. **–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ª–æ–≥–≥–µ—Ä –¥–ª—è WABA** ‚úÖ
- –§–∞–π–ª: `src/utils/waba_logger.py`
- –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Å —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –æ—Ç WhatsApp Business API
- –û—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª: `WABA.log`

### 2. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ª–æ–≥–æ–≤** ‚úÖ
–ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å —Å–æ–¥–µ—Ä–∂–∏—Ç:
- **–í—Ä–µ–º—è** (HH:MM:SS)
- **–¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è** (—ç–º–æ–¥–∑–∏ + –æ–ø–∏—Å–∞–Ω–∏–µ)
- **wamid** (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Å–æ–æ–±—â–µ–Ω–∏—è)
- **–ö–ª—é—á–µ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ** (–æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å, —Ç–µ–∫—Å—Ç, —Å—Ç–∞—Ç—É—Å –∏ —Ç.–¥.)

### 3. **–¢–∏–ø—ã –∑–∞–ø–∏—Å–µ–π** ‚úÖ
- üì® **MESSAGE** - –≤—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- üì® **STATUS** - —Å—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚úÖ **VALID** - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ webhook
- ü§ñ **AI_START** - –Ω–∞—á–∞–ª–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ AI
- ü§ñ **AI_RESPONSE** - –æ—Ç–≤–µ—Ç AI
- üì§ **SENT** - –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- üíæ **SAVED** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
- ‚öôÔ∏è **COMMAND** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã
- üí• **ERROR** - –æ—à–∏–±–∫–∏

### 4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ–¥** ‚úÖ
- `webhook_handler.py` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥—è—â–∏—Ö webhook'–æ–≤
- `message_processor.py` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- `webhook_routes.py` - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

### 5. **–£—Ç–∏–ª–∏—Ç—ã** ‚úÖ
- `test_waba_logger.py` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–≥–µ—Ä–∞
- `view_waba_logs.sh` - –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

## –ü—Ä–∏–º–µ—Ä –ª–æ–≥–∞:

```
23:32:43 | ================================================================================
23:32:43 | üîÑ NEW MESSAGE FLOW | wamid:wamid.test123
23:32:43 | ================================================================================
23:32:43 | üì® MESSAGE | wamid:wamid.test123 | type:text | from:79140775712 | text:–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞? | 
23:32:43 | ‚úÖ VALID | wamid:wamid.test123 | type:message | message_type:text
23:32:43 | ü§ñ AI_START | wamid:wamid.test123 | sender:79140775712 | text:–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?
23:32:43 | ü§ñ AI_RESPONSE | wamid:wamid.test123 | response:–ü—Ä–∏–≤–µ—Ç! –†–∞–¥ –≤–∞—Å –≤–∏–¥–µ—Ç—å. | command:greeting
23:32:43 | üì§ SENT | wamid:wamid.test123 | to:79140775712 | content:–ü—Ä–∏–≤–µ—Ç! –†–∞–¥ –≤–∞—Å –≤–∏–¥–µ—Ç—å. | response_wamid:wamid.response789
23:32:43 | üíæ SAVED | wamid:wamid.test123 | sender:79140775712 | session:session123 | role:user | content:–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?
```

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏
./view_waba_logs.sh

# –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f WABA.log

# –ü–æ–∏—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
grep 'wamid:YOUR_WAMID' WABA.log
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
python3 test_waba_logger.py
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

1. **–ß–µ—Ç–∫–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞** - –≤–∏–¥–Ω–æ –≤–µ—Å—å –ø—É—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏
2. **–ü–æ–∏—Å–∫ –ø–æ wamid** - –ª–µ–≥–∫–æ –Ω–∞–π—Ç–∏ –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
3. **–ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç** - —Ç–æ–ª—å–∫–æ –∫–ª—é—á–µ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ, –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω–æ–≥–æ JSON
4. **–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏** - —á–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –º–µ–∂–¥—É –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ä–∞–∑–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
5. **–≠–º–æ–¥–∑–∏** - –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Ä–∞–∑–ª–∏—á–∏–µ —Ç–∏–ø–æ–≤ –¥–µ–π—Å—Ç–≤–∏–π

## –†–µ–∑—É–ª—å—Ç–∞—Ç:
–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ —Ç–æ—á–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å, –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç WABA, –≤–∫–ª—é—á–∞—è:
- –ü–æ–ª—É—á–µ–Ω–∏–µ webhook
- –í–∞–ª–∏–¥–∞—Ü–∏—é
- –û–±—Ä–∞–±–æ—Ç–∫—É AI
- –û—Ç–ø—Ä–∞–≤–∫—É –æ—Ç–≤–µ—Ç–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
- –û—à–∏–±–∫–∏ –Ω–∞ –ª—é–±–æ–º —ç—Ç–∞–ø–µ 