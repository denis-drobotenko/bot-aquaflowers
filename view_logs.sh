#!/bin/bash

LOG_FILE="local_debug.log"

echo "üìã –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ AuraFlora Bot"
echo ""

if [ ! -f "$LOG_FILE" ]; then
    echo "‚ùå –§–∞–π–ª –ª–æ–≥–æ–≤ $LOG_FILE –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo "üí° –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω —Å ./run_local.sh"
    exit 1
fi

echo "üìÅ –§–∞–π–ª –ª–æ–≥–æ–≤: $LOG_FILE"
echo "üìä –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞: $(du -h $LOG_FILE | cut -f1)"
echo "üïê –ü–æ—Å–ª–µ–¥–Ω–µ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ: $(stat -f "%Sm" $LOG_FILE)"
echo ""

echo "üîç –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:"
echo "1) –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫"
echo "2) –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (tail -f)"
echo "3) –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É"
echo "4) –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏"
echo "5) –ü–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ webhook'–∏"
echo "6) –û—á–∏—Å—Ç–∏—Ç—å —Ñ–∞–π–ª –ª–æ–≥–æ–≤"
echo ""

read -p "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä (1-6): " choice

case $choice in
    1)
        echo "üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ 50 —Å—Ç—Ä–æ–∫:"
        tail -50 $LOG_FILE
        ;;
    2)
        echo "üëÄ –°–ª–µ–¥–∏–º –∑–∞ –ª–æ–≥–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (Ctrl+C –¥–ª—è –≤—ã—Ö–æ–¥–∞):"
        tail -f $LOG_FILE
        ;;
    3)
        read -p "üîç –í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ: " keyword
        echo "üîç –ü–æ–∏—Å–∫ '$keyword':"
        grep -i "$keyword" $LOG_FILE
        ;;
    4)
        echo "‚ùå –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏:"
        grep -i "error\|exception\|traceback" $LOG_FILE
        ;;
    5)
        echo "üì± –¢–æ–ª—å–∫–æ webhook'–∏:"
        grep -i "webhook" $LOG_FILE
        ;;
    6)
        echo "üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ —Ñ–∞–π–ª–∞ –ª–æ–≥–æ–≤..."
        > $LOG_FILE
        echo "‚úÖ –§–∞–π–ª –ª–æ–≥–æ–≤ –æ—á–∏—â–µ–Ω"
        ;;
    *)
        echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä"
        exit 1
        ;;
esac 