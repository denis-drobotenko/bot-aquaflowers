# –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç: –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è WABA

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

### 1. **–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π WABA –ª–æ–≥–≥–µ—Ä**
- **–§–∞–π–ª:** `src/utils/waba_logger.py`
- **–õ–æ–≥ —Ñ–∞–π–ª:** `WABA.log`
- **–§–æ—Ä–º–∞—Ç:** –í—Ä–µ–º—è | –¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è | wamid | –ö–ª—é—á–µ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ

### 2. **–ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π**
–ö–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç WABA —Ç–µ–ø–µ—Ä—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –≤–µ—Å—å –ø—É—Ç—å:

```
üì® MESSAGE ‚Üí ‚úÖ VALID ‚Üí ü§ñ AI_START ‚Üí ü§ñ AI_RESPONSE ‚Üí üì§ SENT ‚Üí üíæ SAVED
```

### 3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤–æ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**
- **Webhook Handler** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥—è—â–∏—Ö webhook'–æ–≤
- **Message Processor** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π  
- **AI Service** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤
- **Command Service** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–æ–º–∞–Ω–¥

### 4. **–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–≥–∞–º–∏**
- `test_waba_logger.py` - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
- `view_waba_logs.sh` - –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
- `tail -f WABA.log` - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## üéØ –†–µ—à–µ–Ω–∏–µ –≤–∞—à–∏—Ö –ø—Ä–æ–±–ª–µ–º:

### **–ü—Ä–æ–±–ª–µ–º–∞:** "–ü–æ—á–µ–º—É –±–æ—Ç –≤ –∫–æ–Ω—Ü–µ –Ω–∞–ø–∏—Å–∞–ª —Ç—Ä–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–¥—Ä—è–¥?"
**–†–µ—à–µ–Ω–∏–µ:** –¢–µ–ø–µ—Ä—å –≤ WABA.log –≤—ã —É–≤–∏–¥–∏—Ç–µ:
- –ö–∞–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—à–ª–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ö–∞–∫ AI –∏—Ö –æ–±—Ä–∞–±–æ—Ç–∞–ª
- –ö–∞–∫–∏–µ –æ—Ç–≤–µ—Ç—ã –±—ã–ª–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã
- –ì–¥–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

### **–ü—Ä–æ–±–ª–µ–º–∞:** "–ö—Ä–∏—Ç–∏—á–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç WABA"
**–†–µ—à–µ–Ω–∏–µ:** –ö–∞–∂–¥—ã–π webhook –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å –∫–ª—é—á–µ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
- wamid (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID)
- –¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è
- –û—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—å
- –¢–µ–∫—Å—Ç (–ø–µ—Ä–≤—ã–µ 50 —Å–∏–º–≤–æ–ª–æ–≤)
- –°—Ç–∞—Ç—É—Å –≤–∞–ª–∏–¥–∞—Ü–∏–∏

### **–ü—Ä–æ–±–ª–µ–º–∞:** "–ö–∞–∫ –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º"
**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª–Ω–∞—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ –∞–ª–≥–æ—Ä–∏—Ç–º–∞:
- –í–∞–ª–∏–¥–∞—Ü–∏—è webhook
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- –û–±—Ä–∞–±–æ—Ç–∫–∞ AI
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î

## üìä –ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∞:

```
23:45:12 | ================================================================================
23:45:12 | üîÑ NEW MESSAGE FLOW | wamid:wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTZDMEREODdDMjMzMkZEMEQxMQA=
23:45:12 | ================================================================================
23:45:12 | üì® MESSAGE | wamid:wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTZDMEREODdDMjMzMkZEMEQxMQA= | type:text | from:79140775712 | text:–¥–∞... | 
23:45:12 | ‚úÖ VALID | wamid:wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTZDMEREODdDMjMzMkZEMEQxMQA= | type:message | message_type:text
23:45:12 | ü§ñ AI_START | wamid:wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTZDMEREODdDMjMzMkZEMEQxMQA= | sender:79140775712 | text:–¥–∞...
23:45:12 | ü§ñ AI_RESPONSE | wamid:wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTZDMEREODdDMjMzMkZEMEQxMQA= | response:–ë—É–∫–µ—Ç 'Candy's' —Å–æ—Ö—Ä–∞–Ω–µ–Ω. | command:save_order_info
23:45:12 | üì§ SENT | wamid:wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTZDMEREODdDMjMzMkZEMEQxMQA= | to:79140775712 | content:–ë—É–∫–µ—Ç 'Candy's' —Å–æ—Ö—Ä–∞–Ω–µ–Ω. | response_wamid:wamid.HBgLNzkxNDA3NzU3MTIVAgARGBJFNTlFMjIyNUVBMzgyQ0QxQ0UA
23:45:12 | üíæ SAVED | wamid:wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTZDMEREODdDMjMzMkZEMEQxMQA= | sender:79140775712 | session:20250705_221836_840365_781 | role:user | content:–¥–∞...
```

## üõ†Ô∏è –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:
```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏
./view_waba_logs.sh

# –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f WABA.log

# –ü–æ–∏—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
grep 'wamid:YOUR_WAMID' WABA.log

# –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫
grep 'üí• ERROR' WABA.log
```

### –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º:
```bash
# –ù–∞–π—Ç–∏ –≤—Å–µ –¥–µ–π—Å—Ç–≤–∏—è —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
grep 'wamid:wamid.HBgLNzkxNDA3NzU3MTIVAgASGBQzQTZDMEREODdDMjMzMkZEMEQxMQA=' WABA.log

# –ù–∞–π—Ç–∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è –æ—Ç–≤–µ—Ç—ã AI
grep 'ü§ñ AI_RESPONSE' WABA.log | tail -10

# –ù–∞–π—Ç–∏ –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
grep 'üì§ SENT' WABA.log | grep 'error'
```

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç:

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ:
1. **–¢–æ—á–Ω–æ –æ—Ç—Å–ª–µ–¥–∏—Ç—å** –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—É—á–µ–Ω–∏—è –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏
2. **–ù–∞–π—Ç–∏ –¥—É–±–ª–∏–∫–∞—Ç—ã** –∏ –ø–æ–Ω—è—Ç—å –ø—Ä–∏—á–∏–Ω—É –∏—Ö –ø–æ—è–≤–ª–µ–Ω–∏—è
3. **–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º** –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
4. **–ë—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –æ—à–∏–±–∫–∏** –∏ –∏—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç
5. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** —Å–∏—Å—Ç–µ–º—ã

**WABA.log** —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞! 